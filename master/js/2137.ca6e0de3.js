"use strict";(self["webpackChunkramp_website"]=self["webpackChunkramp_website"]||[]).push([[2137],{17930:function(t,e,i){i.d(e,{t:function(){return s}});class s{constructor(t){this.size=0,this._start=0,this.maxSize=t,this._buffer=new Array(t)}get entries(){return this._buffer}enqueue(t){if(this.size===this.maxSize){const e=this._buffer[this._start];return this._buffer[this._start]=t,this._start=(this._start+1)%this.maxSize,e}return this._buffer[(this._start+this.size++)%this.maxSize]=t,null}dequeue(){if(0===this.size)return null;const t=this._buffer[this._start];return this._buffer[this._start]=null,this.size--,this._start=(this._start+1)%this.maxSize,t}peek(){return 0===this.size?null:this._buffer[this._start]}peekLast(){return 0===this.size?null:this._buffer[(this._start+(this.size-1))%this.maxSize]}find(t){if(0===this.size)return null;for(const e of this._buffer)if(null!=e&&t(e))return e;return null}clear(t){let e=this.dequeue();for(;null!=e;)t&&t(e),e=this.dequeue()}}},39416:function(t,e,i){i.d(e,{N:function(){return ke},P:function(){return ue},T:function(){return Ot},_:function(){return Be},a:function(){return Kt},b:function(){return se},c:function(){return R},d:function(){return Yt},e:function(){return Nt},f:function(){return b},g:function(){return k},h:function(){return Zt},i:function(){return ne},j:function(){return zt},k:function(){return E},l:function(){return Te},m:function(){return g},o:function(){return Dt},s:function(){return Ae}});var s=i(41470),r=i(98503),n=i(97233),o=i(77025),a=i(28549),c=i(68894),u=i(64027),h=i(44126),l=i(28373),p=(i(94381),i(75934)),d=i(95062),f=i(69539),x=i(31061);const _=()=>r.n.getLogger("esri.views.2d.engine.webgl.shaderGraph.techniques.meshWriterUtils"),y=0,m=100;function g(t,e){return[!!t?.minScale&&e.scaleToZoom(t.minScale)||y,!!t?.maxScale&&e.scaleToZoom(t.maxScale)||m]}function b(t){return 1<<t}function w(t){let e=0;for(const[i,s]of t)s&&(e|=1<<i);return e}function k(t){let e;if(!t)return[0,0,0,0];if("string"==typeof t){const i=r.aC.fromString(t);if(!i)return _().errorOnce(new r.s("mapview:mesh-processing","Unable to parse string into color",{color:t})),[0,0,0,0];e=i.toArray()}else e=t;const[i,s,n,o]=e;return[i*(o/255),s*(o/255),n*(o/255),o]}function v(t){switch(t){case"butt":case l.U.Butt:return l.e.BUTT;case"round":case l.U.Round:return l.e.ROUND;case"square":case l.U.Square:return l.e.SQUARE}}function S(t){switch(t){case"bevel":case l.w.Bevel:return l.n.BEVEL;case"miter":case l.w.Miter:return l.n.MITER;case"round":case l.w.Round:return l.n.ROUND}}function T(t,e){return Math.round(Math.min(Math.sqrt(t*e),255))}function P(t,e){return Math.round(t*e)/e}const C=96/72;let E=class{static executeEffects(t,e,i,s){const r=C,o=(0,n.ac)(t);let a=new n.ae(e);for(const c of t){const t=(0,n.ad)(c);t&&(a=t.execute(a,c,r,i,s,o))}return a}static applyEffects(t,e,i){if(!t)return e;const s=(0,n.ac)(t);let o,a=new n.ae(n.a7.fromJSONCIM(e));for(const r of t){const t=(0,n.ad)(r);t&&(a=t.execute(a,r,1,null,i,s))}const c=[];let u=null;for(;o=a.next();)c.push(...(0,r.iR)(o)),u=o.geometryType;return 0===c.length||null===u?null:"esriGeometryPolygon"===u?{rings:c}:{paths:c}}},M=null;function N(){return M}async function I(){M=await Promise.all([i.e(916),i.e(3318)]).then(i.bind(i,54752)).then((t=>t.g))}function z(t){switch(t){case s.C.BYTE:case s.C.UNSIGNED_BYTE:return 1;case s.C.SHORT:case s.C.UNSIGNED_SHORT:case s.C.HALF_FLOAT:return 2;case s.C.FLOAT:case s.C.INT:case s.C.UNSIGNED_INT:return 4}}function B(t){const e=[],i=[],s=[];for(const r of t){const t=z(r.type)*r.count;switch(t%2||t%4||4){case 4:e.push(r);continue;case 2:i.push(r);continue;case 1:s.push(r);continue;default:throw new Error("Found unexpected dataType byte count")}}return e.push(...i),e.push(...s),e}let D=class t{static fromVertexSpec(e,i){const{attributes:s,optionalAttributes:r}=e;let n,o,a;const c=[];for(const t in s){const e=s[t];"position"===e.pack?n={...e,name:t,offset:0}:"id"===e.pack?o={...e,name:t,offset:4}:"bitset"===t?a={...e,name:t,offset:7}:c.push({...e,name:t})}for(const t in r)if(!0===i[t]){const e=r[t];c.push({...e,name:t})}const u=B(c),h=[];let l=8,p=1;for(const t of u)h.push({...t,offset:l}),l+=z(t.type)*t.count,t.packAlternating&&(p=Math.max(t.packAlternating.count,p));const d=Uint32Array.BYTES_PER_ELEMENT,f=l%d;return new t(n,o,a,h,l+(f?d-f:0),p)}constructor(t,e,i,s,r,n){this.position=t,this.id=e,this.bitset=i,this.standardAttributes=s,this.stride=r,this.packVertexCount=n,s.push(i),this._attributes=[t,e,i,...s]}get attributeLayout(){if(!this._attributeLayout){const t=(0,u.e)(this._attributes),e=this._attributes.map((t=>({name:t.name,count:t.count,offset:t.offset,type:t.type,packPrecisionFactor:t.packPrecisionFactor,normalized:t.normalized??!1})));this._attributeLayout={attributes:e,hash:t,stride:this.stride}}return this._attributeLayout}},A=class t{static fromVertexSpec(e,i){const s=D.fromVertexSpec(e,i);return new t(s)}constructor(t){this._spec=t,this._packed=new Uint8Array(this._spec.stride*this._spec.packVertexCount),this._packedU32View=new Uint32Array(this._packed.buffer),this._dataView=new DataView(this._packed.buffer)}get attributeLayout(){return this._spec.attributeLayout}get stride(){return this._spec.stride}writeVertex(t,e,i,s,r,n){for(let o=0;o<this._spec.packVertexCount;o++){const t=o*this._spec.stride;this._packPosition(i,s,t),this._packId(e,t);const a=this._spec.bitset;if(n){if(a.packTessellation){const e=a.packTessellation(n,r);this._pack(e,a,t)}for(const e of this._spec.standardAttributes)if(null!=e.packTessellation){const i=e.packTessellation(n,r);this._pack(i,e,t)}else if(e.packAlternating?.packTessellation){const t=e.packAlternating.packTessellation(n,r);for(let i=0;i<this._spec.packVertexCount;i++){const s=t[i];this._pack(s,e,i*this._spec.stride)}}}}t.vertexWriteRegion(this._packedU32View)}pack(t,e){for(const i of this._spec.standardAttributes)if(i.pack&&"string"!=typeof i.pack){const s=i.pack(t,e);for(let t=0;t<this._spec.packVertexCount;t++)this._pack(s,i,t*this._spec.stride)}else if(i.packAlternating?.pack){const s=i.packAlternating.pack(t,e);for(let t=0;t<this._spec.packVertexCount;t++){const e=s[t];this._pack(e,i,t*this._spec.stride)}}}_packPosition(t,e,i){const{offset:s}=this._spec.position,r=this._spec.position.packPrecisionFactor??1,n=(0,u.f)(t*r,e*r);this._dataView.setUint32(i+s,n,!0)}_packId(t,e){const i=t*(this._spec.id.packPrecisionFactor??1),s=4278190080&this._dataView.getUint32(e+this._spec.id.offset,!0);this._dataView.setUint32(e+this._spec.id.offset,i|s,!0)}_pack(t,e,i){(0,u.o)(this._dataView,t,e,i)}};function L(t){if(!t)return!1;for(const e of t)switch(e.effect.type){case"CIMGeometricEffectBuffer":case"CIMGeometricEffectOffset":case"CIMGeometricEffectDonut":return!0}return!1}let R=class{constructor(t,e,i,s){this._instanceId=t,this._evaluator=e,this._enabledOptionalAttributes=i,this._viewParams=s,this._evaluator.evaluator=t=>this.vertexSpec.createComputedParams(t)}get _vertexPack(){if(!this._cachedVertexPack){const t=A.fromVertexSpec(this.vertexSpec,this._enabledOptionalAttributes);this._evaluator.hasDynamicProperties||t.pack(this._evaluator.evaluatedMeshParams,this._viewParams),this._cachedVertexPack=t}return this._cachedVertexPack}get evaluatedMeshParams(){return this._evaluator.evaluatedMeshParams}get hasEffects(){return!!this.evaluatedMeshParams.effects}get instanceId(){return this._instanceId}get attributeLayout(){return this._vertexPack.attributeLayout}setReferences(t){this._references=t}getBoundsInfo(){return null}getTileInfo(){return this._viewParams.tileInfo}async loadDependencies(){L(this._evaluator.inputMeshParams.effects?.effectInfos)&&await I()}enqueueRequest(t,e,i){this._evaluator.hasDynamicProperties&&this._evaluator.enqueueRequest(t,e,i)}write(t,e,i,s,r){this.ensurePacked(e,i,s);const o=this.evaluatedMeshParams.effects;if(!o||0===o.length)return void this._write(t,i,void 0,r);const a=i.readGeometryForDisplay()?.clone();if(!a)return;const c=n.a7.fromOptimizedCIM(a,i.geometryType),u=N();c.invertY();const h=t.id||"",l=E.executeEffects(o,c,h,u);let p;for(;p=l.next();)p.invertY(),this._write(t,i,p,r)}ensurePacked(t,e,i){if(!this._evaluator.hasDynamicProperties)return;const s=this._evaluator.evaluateMeshParams(t,e,i);this._vertexPack.pack(s,this._viewParams)}_writeVertex(t,e,i,s,r){const n=this.evaluatedMeshParams;this._vertexPack.writeVertex(t,e,i,s,n,r)}};function Y(t,e,i,s,r,n,o){xt=0;const a=(s-i)*n,c=r&&r.length,u=c?(r[0]-i)*n:a;let h,l,p,d,f,x=V(e,i,s,0,u,n,!0);if(x&&x.next!==x.prev){if(c&&(x=Z(e,i,s,r,x,n)),a>80*n){h=p=e[0+i*n],l=d=e[1+i*n];for(let t=n;t<u;t+=n){const s=e[t+i*n],r=e[t+1+i*n];h=Math.min(h,s),l=Math.min(l,r),p=Math.max(p,s),d=Math.max(d,r)}f=Math.max(p-h,d-l),f=0!==f?1/f:0}F(x,t,n,h,l,f,o,0)}}function V(t,e,i,s,r,n,o){let a;if(o===et(t,e,i,s,r,n)>0)for(let c=s;c<r;c+=n)a=W(c+e*n,t[c+e*n],t[c+1+e*n],a);else for(let c=r-n;c>=s;c-=n)a=W(c+e*n,t[c+e*n],t[c+1+e*n],a);return a&&nt(a,a.next)&&(H(a),a=a.next),a}function U(t,e=t){if(!t)return t;let i,s=t;do{if(i=!1,s.steiner||!nt(s,s.next)&&0!==J(s.prev,s,s.next))s=s.next;else{if(H(s),s=e=s.prev,s===s.next)break;i=!0}}while(i||s!==e);return e}function F(t,e,i,s,r,n,o,a){if(!t)return;!a&&n&&(t=j(t,s,r,n));let c=t;for(;t.prev!==t.next;){const u=t.prev,h=t.next;if(n?O(t,s,r,n):G(t))e.push(u.index/i+o),e.push(t.index/i+o),e.push(h.index/i+o),H(t),t=h.next,c=h.next;else if((t=h)===c){a?1===a?F(t=at(t,e,i,o),e,i,s,r,n,o,2):2===a&&ct(t,e,i,s,r,n,o):F(U(t),e,i,s,r,n,o,1);break}}}function G(t){const e=t.prev,i=t,s=t.next;if(J(e,i,s)>=0)return!1;let r=t.next.next;const n=r;let o=0;for(;r!==t.prev&&(0===o||r!==n);){if(o++,it(e.x,e.y,i.x,i.y,s.x,s.y,r.x,r.y)&&J(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function O(t,e,i,s){const r=t.prev,n=t,o=t.next;if(J(r,n,o)>=0)return!1;const a=r.x<n.x?r.x<o.x?r.x:o.x:n.x<o.x?n.x:o.x,c=r.y<n.y?r.y<o.y?r.y:o.y:n.y<o.y?n.y:o.y,u=r.x>n.x?r.x>o.x?r.x:o.x:n.x>o.x?n.x:o.x,h=r.y>n.y?r.y>o.y?r.y:o.y:n.y>o.y?n.y:o.y,l=rt(a,c,e,i,s),p=rt(u,h,e,i,s);let d=t.prevZ,f=t.nextZ;for(;d&&d.z>=l&&f&&f.z<=p;){if(d!==t.prev&&d!==t.next&&it(r.x,r.y,n.x,n.y,o.x,o.y,d.x,d.y)&&J(d.prev,d,d.next)>=0||(d=d.prevZ,f!==t.prev&&f!==t.next&&it(r.x,r.y,n.x,n.y,o.x,o.y,f.x,f.y)&&J(f.prev,f,f.next)>=0))return!1;f=f.nextZ}for(;d&&d.z>=l;){if(d!==t.prev&&d!==t.next&&it(r.x,r.y,n.x,n.y,o.x,o.y,d.x,d.y)&&J(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;f&&f.z<=p;){if(f!==t.prev&&f!==t.next&&it(r.x,r.y,n.x,n.y,o.x,o.y,f.x,f.y)&&J(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function W(t,e,i,s){const r=pt.create(t,e,i);return s?(r.next=s.next,r.prev=s,s.next.prev=r,s.next=r):(r.prev=r,r.next=r),r}function H(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function X(t){let e=t,i=t;do{(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next}while(e!==t);return i}function Z(t,e,i,s,r,n){const o=new Array;for(let a=0,c=s.length;a<c;a++){const r=V(t,e,i,s[a]*n,a<c-1?s[a+1]*n:i*n,n,!1);r===r.next&&(r.steiner=!0),o.push(X(r))}o.sort(ot);for(const a of o)r=q(a,r);return r}function q(t,e){const i=Q(t,e);if(!i)return e;const s=lt(i,t);return U(s,s.next),U(i,i.next)}function Q(t,e){let i=e;const s=t.x,r=t.y;let n,o=-1/0;do{if(r<=i.y&&r>=i.next.y&&i.next.y!==i.y){const t=i.x+(r-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(t<=s&&t>o){if(o=t,t===s){if(r===i.y)return i;if(r===i.next.y)return i.next}n=i.x<i.next.x?i:i.next}}i=i.next}while(i!==e);if(!n)return null;if(s===o)return n.prev;const a=n,c=n.x,u=n.y;let h,l=1/0;for(i=n.next;i!==a;)s>=i.x&&i.x>=c&&s!==i.x&&it(r<u?s:o,r,c,u,r<u?o:s,r,i.x,i.y)&&(h=Math.abs(r-i.y)/(s-i.x),(h<l||h===l&&i.x>n.x)&&st(i,t)&&(n=i,l=h)),i=i.next;return n}function j(t,e,i,s){let r;for(;r!==t;r=r.next){if(r=r||t,null===r.z&&(r.z=rt(r.x,r.y,e,i,s)),r.prev.next!==r||r.next.prev!==r)return r.prev.next=r,r.next.prev=r,j(t,e,i,s);r.prevZ=r.prev,r.nextZ=r.next}return t.prevZ.nextZ=null,t.prevZ=null,$(t)}function $(t){let e,i=1;for(;;){let s,r=t;t=null,e=null;let n=0;for(;r;){n++,s=r;let o=0;for(;o<i&&s;o++)s=s.nextZ;let a=i;for(;o>0||a>0&&s;){let i;0===o?(i=s,s=s.nextZ,a--):0!==a&&s?r.z<=s.z?(i=r,r=r.nextZ,o--):(i=s,s=s.nextZ,a--):(i=r,r=r.nextZ,o--),e?e.nextZ=i:t=i,i.prevZ=e,e=i}r=s}if(e.nextZ=null,i*=2,n<2)return t}}function J(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function K(t,e,i,s){return!!(nt(t,e)&&nt(i,s)||nt(t,s)&&nt(i,e))||J(t,e,i)>0!=J(t,e,s)>0&&J(i,s,t)>0!=J(i,s,e)>0}function tt(t,e){let i=t;do{if(i.index!==t.index&&i.next.index!==t.index&&i.index!==e.index&&i.next.index!==e.index&&K(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}function et(t,e,i,s,r,n){let o=0;for(let a=s,c=r-n;a<r;a+=n)o+=(t[c+e*n]-t[a+e*n])*(t[a+1+e*n]+t[c+1+e*n]),c=a;return o}function it(t,e,i,s,r,n,o,a){return(r-o)*(e-a)-(t-o)*(n-a)>=0&&(t-o)*(s-a)-(i-o)*(e-a)>=0&&(i-o)*(n-a)-(r-o)*(s-a)>=0}function st(t,e){return J(t.prev,t,t.next)<0?J(t,e,t.next)>=0&&J(t,t.prev,e)>=0:J(t,e,t.prev)<0||J(t,t.next,e)<0}function rt(t,e,i,s,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*r)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-s)*r)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function nt(t,e){return t.x===e.x&&t.y===e.y}function ot(t,e){return t.x-e.x}function at(t,e,i,s){let r=t;do{const n=r.prev,o=r.next.next;!nt(n,o)&&K(n,r,r.next,o)&&st(n,o)&&st(o,n)&&(e.push(n.index/i+s),e.push(r.index/i+s),e.push(o.index/i+s),H(r),H(r.next),r=t=o),r=r.next}while(r!==t);return r}function ct(t,e,i,s,r,n,o){let a=t;do{let t=a.next.next;for(;t!==a.prev;){if(a.index!==t.index&&ut(a,t)){let c=lt(a,t);return a=U(a,a.next),c=U(c,c.next),F(a,e,i,s,r,n,o,0),void F(c,e,i,s,r,n,o,0)}t=t.next}a=a.next}while(a!==t)}function ut(t,e){return t.next.index!==e.index&&t.prev.index!==e.index&&!tt(t,e)&&st(t,e)&&st(e,t)&&ht(t,e)}function ht(t,e){let i=t,s=!1;const r=(t.x+e.x)/2,n=(t.y+e.y)/2;do{i.y>n!=i.next.y>n&&i.next.y!==i.y&&r<(i.next.x-i.x)*(n-i.y)/(i.next.y-i.y)+i.x&&(s=!s),i=i.next}while(i!==t);return s}function lt(t,e){const i=pt.create(t.index,t.x,t.y),s=pt.create(e.index,e.x,e.y),r=t.next,n=e.prev;return t.next=e,e.prev=t,i.next=r,r.prev=i,s.next=i,i.prev=s,n.next=s,s.prev=n,s}class pt{constructor(){this.index=0,this.x=0,this.y=0,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}static create(t,e,i){const s=xt<dt.length?dt[xt++]:new pt;return s.index=t,s.x=e,s.y=i,s.prev=null,s.next=null,s.z=null,s.prevZ=null,s.nextZ=null,s.steiner=!1,s}}const dt=[],ft=8096;let xt=0;for(let Le=0;Le<ft;Le++)dt.push(new pt);const _t=1e-5,yt=new o.c(0,0,0,1,0),mt=new o.c(0,0,0,1,0);function gt(t,e,i){let s=0;for(let r=1;r<i;r++){const i=t[2*(e+r-1)],n=t[2*(e+r-1)+1];s+=(t[2*(e+r)]-i)*(t[2*(e+r)+1]+n)}return s}function bt(t,e,i,s,r){let n=0;const o=2;for(let a=i;a<s;a+=3){const i=(t[a]-r)*o,s=(t[a+1]-r)*o,c=(t[a+2]-r)*o;n+=Math.abs((e[i]-e[c])*(e[s+1]-e[i+1])-(e[i]-e[s])*(e[c+1]-e[i+1]))}return n}function wt(t,e){const{coords:i,lengths:s}=e,r=0,n=t;let o=0;for(let a=0;a<s.length;){let t=a,e=s[a],c=gt(i,o,e);const u=[];for(;++t<s.length;){const r=s[t],n=gt(i,o+e,r);if(!(n>0))break;c+=n,u.push(o+e),e+=r}const h=n.length;Y(n,i,o,o+e,u,2,r);const l=bt(n,i,h,n.length,r),p=Math.abs(c);if(Math.abs((l-p)/Math.max(1e-7,p))>_t)return n.length=0,!1;a=t,o+=e}return!0}function kt(t){const{coords:e,lengths:i}=t,{buffer:s}=(0,c.a)(e,i);return s}function vt(t,e,i){let s=0;for(let r=0;r<t.lengths.length;r++){const n=t.lengths[r];for(let r=0;r<n;r++){const n=t.coords[2*(r+s)],o=t.coords[2*(r+s)+1];if(n<e||n>i||o<e||o>i)return!0}s+=n}return!1}function St(t,e){if(null==t)return null;if(!vt(t,-128,a.a+128))return t;yt.setPixelMargin(e),yt.reset(o.i.Polygon);let i=0;for(let o=0;o<t.lengths.length;o++){const e=t.lengths[o];let s=t.coords[2*(0+i)],r=t.coords[2*(0+i)+1];yt.moveTo(s,r);for(let n=1;n<e;n++)s=t.coords[2*(n+i)],r=t.coords[2*(n+i)+1],yt.lineTo(s,r);yt.close(),i+=e}const s=yt.result(!1);if(!s)return null;const r=[],n=[];for(const o of s){let t=0;for(const e of o)n.push(e.x),n.push(e.y),t++;r.push(t)}return new p.s(r,n)}function Tt(t,e){mt.setPixelMargin(e);const i=mt,s=-e,r=a.a+e;let n=[],c=!1;if(!t.nextPath())return null;let u=!0;for(;u;){t.seekPathStart();const e=[];if(!t.pathSize)return null;i.reset(o.i.LineString),t.nextPoint();let a=t.x,h=t.y;if(c)i.moveTo(a,h);else{if(a<s||a>r||h<s||h>r){c=!0;continue}e.push({x:a,y:h})}let l=!1;for(;t.nextPoint();)if(a=t.x,h=t.y,c)i.lineTo(a,h);else{if(a<s||a>r||h<s||h>r){l=!0;break}e.push({x:a,y:h})}if(l)c=!0;else{if(c){const t=i.resultWithStarts();if(t)for(const e of t)n.push(e)}else n.push({line:e,start:0});u=t.nextPath(),c=!1}}return n=n.filter((t=>t.line.length>1)),0===n.length?null:n}yt.setExtent(a.a),mt.setExtent(a.a);const Pt=100,Ct=(0,r.a$)("featurelayer-fast-triangulation-enabled");class Et extends R{async loadDependencies(){await Promise.all([super.loadDependencies(),(0,c.i)()])}_write(t,e,i){const s=i?.asOptimized()??e.readGeometryForDisplay(),r=this._clip(s);r&&(t.recordStart(this.instanceId,this.attributeLayout),this._writeGeometry(t,e,r),t.recordEnd())}_clip(t){if(!t)return null;const e=this.hasEffects;return St(t,e?256:8)}_writeGeometry(t,e,i){const s=i.maxLength>Pt,r=[],n=this.createTesselationParams(e);if(!s&&Ct&&wt(r,i))return void(r.length&&this._writeVertices(t,e,i.coords,n,r));const o=kt(i);this._writeVertices(t,e,o,n)}_writeVertices(t,e,i,s,r){const n=e.getDisplayId(),o=t.vertexCount(),a=this.hasEffects;let c=0;if(r)for(const u of r){const e=i[2*u],r=i[2*u+1];a&&t.recordBounds(e,r,0,0),this._writeVertex(t,n,e,r,s),c++}else for(let u=0;u<i.length;u+=2){const e=Math.round(i[u]),r=Math.round(i[u+1]);a&&t.recordBounds(e,r,0,0),this._writeVertex(t,n,e,r,s),c++}t.indexEnsureSize(c);for(let u=0;u<c;u++)t.indexWrite(u+o)}}const Mt={createComputedParams:t=>t,optionalAttributes:{},attributes:{id:{type:s.C.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:s.C.UNSIGNED_BYTE,count:1},pos:{type:s.C.SHORT,count:2,pack:"position",packPrecisionFactor:10},inverseArea:{type:s.C.FLOAT,count:1,packTessellation:({inverseArea:t})=>t}}};let Nt=class extends Et{constructor(){super(...arguments),this.vertexSpec=Mt}createTesselationParams(t){return{inverseArea:1/t.readGeometryArea()}}};const It={createComputedParams:t=>t,optionalAttributes:{zoomRange:{type:s.C.SHORT,count:2,packPrecisionFactor:a.m,pack:({scaleInfo:t},{tileInfo:e})=>g(t,e)}},attributes:{id:{type:s.C.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:s.C.UNSIGNED_BYTE,count:1},pos:{type:s.C.SHORT,count:2,pack:"position",packPrecisionFactor:10},color:{type:s.C.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:t})=>k(t)}}};let zt=class extends Et{constructor(){super(...arguments),this.vertexSpec=It}createTesselationParams(t){return null}};const Bt={createComputedParams:t=>t,optionalAttributes:It.optionalAttributes,attributes:{...It.attributes,tlbr:{count:4,type:s.C.UNSIGNED_SHORT,pack:({sprite:t})=>{const{rect:e,width:i,height:s}=t,r=e.x+a.t,n=e.y+a.t;return[r,n,r+i,n+s]}},inverseRasterizationScale:{count:1,type:s.C.BYTE,packPrecisionFactor:16,pack:({sprite:t})=>1/t.rasterizationScale}}};let Dt=class extends zt{constructor(){super(...arguments),this.vertexSpec=Bt}_write(t,e,i){const s=i?.asOptimized()??e.readGeometryForDisplay(),r=this._clip(s);if(!r)return;const n=this.evaluatedMeshParams.sprite?.textureBinding;t.recordStart(this.instanceId,this.attributeLayout,n),this._writeGeometry(t,e,r),t.recordEnd()}};function At(t){const{sprite:e,aspectRatio:i,scaleProportionally:s}=t,n=(0,r.be)(t.height),o=n>0?n:e.height;let a=n*i;return a<=0?a=e.width:s&&(a*=e.width/e.height),{width:a,height:o}}function Lt(t){const{applyRandomOffset:e,sampleAlphaOnly:i}=t;return w([[n.af,e],[n.ag,i]])}const Rt={createComputedParams:t=>t,optionalAttributes:Bt.optionalAttributes,attributes:{...Bt.attributes,bitset:{count:1,type:s.C.UNSIGNED_BYTE,pack:Lt},width:{count:1,type:s.C.HALF_FLOAT,pack:t=>At(t).width},height:{count:1,type:s.C.HALF_FLOAT,pack:t=>At(t).height},offset:{count:2,type:s.C.HALF_FLOAT,pack:({offsetX:t,offsetY:e})=>[(0,r.be)(t),-(0,r.be)(e)]},scale:{count:2,type:s.C.UNSIGNED_BYTE,packPrecisionFactor:16,pack:({scaleX:t,scaleY:e})=>[t,e]},angle:{count:1,type:s.C.UNSIGNED_BYTE,pack:({angle:t})=>(0,o.l)(t)}}};let Yt=class extends Dt{constructor(){super(...arguments),this.vertexSpec=Rt}},Vt=class{constructor(){this.extrusionOffsetX=0,this.extrusionOffsetY=0,this.normalX=0,this.normalY=0,this.directionX=0,this.directionY=0,this.distance=0}};const Ut={createComputedParams:t=>t,optionalAttributes:{zoomRange:{type:s.C.SHORT,count:2,packPrecisionFactor:a.m,pack:({scaleInfo:t},{tileInfo:e})=>g(t,e)}},attributes:{id:{type:s.C.UNSIGNED_BYTE,count:3,pack:"id"},pos:{type:s.C.SHORT,count:2,pack:"position",packPrecisionFactor:10},bitset:{type:s.C.UNSIGNED_BYTE,count:1},color:{type:s.C.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:t})=>k(t)},offset:{type:s.C.BYTE,count:2,packPrecisionFactor:16,packTessellation:({extrusionOffsetX:t,extrusionOffsetY:e})=>[P(t,16),P(e,16)]},normal:{type:s.C.BYTE,count:2,packPrecisionFactor:16,packTessellation:({normalX:t,normalY:e})=>[P(t,16),P(e,16)]},halfWidth:{type:s.C.HALF_FLOAT,count:1,pack:({width:t})=>(0,r.be)(.5*t)},referenceHalfWidth:{type:s.C.HALF_FLOAT,count:1,pack:({referenceWidth:t})=>(0,r.be)(.5*t)}}};let Ft=class{constructor(){this.id=0,this.bitset=0,this.indexCount=0,this.vertexCount=0,this.vertexFrom=0,this.vertexBounds=0}};const Gt=65535;let Ot=class extends R{constructor(t,e,i,s){super(t,e,i,s),this.vertexSpec=Ut,this._currentWrite=new Ft,this._tessellationOptions={halfWidth:0,pixelCoordRatio:1,offset:0,wrapDistance:Gt,textured:!1},this._tessParams=new Vt,this._initializeTessellator()}writeLineVertices(t,e,i){const s=this._getLines(e);null!=s&&this._writeVertices(t,i,s)}_initializeTessellator(){this._lineTessellator=new c.c(this._writeTesselatedVertex.bind(this),this._writeTriangle.bind(this),!0)}_write(t,e,i){const s=i??n.a7.fromFeatureSetReaderCIM(e);s&&this._writeGeometry(t,e,s)}_writeGeometry(t,e,i,s){t.recordStart(this.instanceId,this.attributeLayout,s),this.writeLineVertices(t,i,e),t.recordEnd()}_getLines(t){return Tt(t,(0,u.g)(this.evaluatedMeshParams))}_writeVertices(t,e,i){const{_currentWrite:s,_tessellationOptions:n,evaluatedMeshParams:o}=this,{width:c,capType:u,joinType:h,miterLimit:l,hasSizeVV:p}=o,d=(0,r.be)(.5*c);n.halfWidth=d,n.capType=v(u),n.joinType=S(h),n.miterLimit=l;const f=!p;s.out=t,s.id=e.getDisplayId(),s.vertexCount=0,s.indexCount=0,s.vertexFrom=t.vertexCount(),s.vertexBounds=f&&d<a.R?0:1;for(const{line:r,start:a}of i)n.initialDistance=a%Gt,this._lineTessellator.tessellate(r,n,f)}_writeTesselatedVertex(t,e,i,s,r,n,o,a,c,u,h){const{out:l,id:p,vertexBounds:d}=this._currentWrite;return this.hasEffects&&l.recordBounds(t,e,d,d),this._tessParams.extrusionOffsetX=o,this._tessParams.extrusionOffsetY=a,this._tessParams.normalX=c,this._tessParams.normalY=u,this._tessParams.directionX=r,this._tessParams.directionY=n,this._tessParams.distance=h,this._writeVertex(l,p,t,e,this._tessParams),this._currentWrite.vertexFrom+this._currentWrite.vertexCount++}_writeTriangle(t,e,i){const{out:s}=this._currentWrite;s.indexEnsureSize(3),s.indexWrite(t),s.indexWrite(e),s.indexWrite(i),this._currentWrite.indexCount+=3}};const Wt={createComputedParams:t=>t,optionalAttributes:Ut.optionalAttributes,attributes:{...Ut.attributes,bitset:{type:s.C.UNSIGNED_BYTE,count:1,pack:t=>0},color:{type:s.C.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:t})=>k(t)}}},Ht={createComputedParams:t=>t,optionalAttributes:Ut.optionalAttributes,attributes:{...Ut.attributes,bitset:{type:s.C.UNSIGNED_BYTE,count:1,pack:t=>w([[n.ah,!0]])},color:{type:s.C.UNSIGNED_BYTE,count:4,normalized:!0,pack:({outlineColor:t})=>k(t)}}};let Xt=class extends Ot{constructor(){super(...arguments),this.vertexSpec=Ht}},Zt=class extends zt{constructor(t,e,i,s){super(t,e,i,s),this.vertexSpec=Wt,this._lineMeshWriter=this._createOutlineWriter(t,e,i,s)}_createOutlineWriter(t,e,i,s){return new Xt(t,e,i,s)}_write(t,e,i){const s=i?.asOptimized()??e.readGeometryForDisplay(),r=this._clip(s);r&&(t.recordStart(this.instanceId,this.attributeLayout),this._writeGeometry(t,e,r),this._lineMeshWriter.writeLineVertices(t,n.a7.fromOptimizedCIM(r,"esriGeometryPolyline"),e),t.recordEnd())}_clip(t){return t?St(t,(0,u.g)(this.evaluatedMeshParams)):null}ensurePacked(t,e,i){super.ensurePacked(t,e,i),this._lineMeshWriter.ensurePacked(t,e,i)}enqueueRequest(t,e,i){super.enqueueRequest(t,e,i),this._lineMeshWriter.enqueueRequest(t,e,i)}async loadDependencies(){await Promise.all([super.loadDependencies(),this._lineMeshWriter.loadDependencies()])}};const qt=Rt,Qt=Ht,jt={createComputedParams:t=>t,optionalAttributes:qt.optionalAttributes,attributes:{...qt.attributes,bitset:{type:s.C.UNSIGNED_BYTE,count:1,pack:t=>Lt(t)},aux1:{count:1,type:s.C.HALF_FLOAT,pack:t=>At(t).width},aux2:{count:1,type:s.C.HALF_FLOAT,pack:t=>At(t).height},aux3:{count:2,type:s.C.HALF_FLOAT,pack:({offsetX:t,offsetY:e})=>[(0,r.be)(t),(0,r.be)(e)]},aux4:{count:2,type:s.C.UNSIGNED_BYTE,pack:({scaleX:t,scaleY:e})=>[t*n.ai,e*n.ai]}}},$t={createComputedParams:t=>t,optionalAttributes:qt.optionalAttributes,attributes:{...qt.attributes,color:Qt.attributes.color,bitset:{type:s.C.UNSIGNED_BYTE,count:1,pack:t=>w([[n.ah,!0]])},aux1:{count:1,type:s.C.HALF_FLOAT,pack:t=>(0,r.be)(.5*t.width)},aux2:{count:1,type:s.C.HALF_FLOAT,pack:t=>(0,r.be)(.5*t.referenceWidth)},aux3:{count:2,type:s.C.HALF_FLOAT,packTessellation:({extrusionOffsetX:t,extrusionOffsetY:e})=>[t,e]},aux4:{count:2,type:s.C.UNSIGNED_BYTE,packTessellation:({normalX:t,normalY:e})=>[t*n.ai+n.aj,e*n.ai+n.aj]}}};class Jt extends Xt{constructor(){super(...arguments),this.vertexSpec=$t}}let Kt=class extends Zt{constructor(){super(...arguments),this.vertexSpec=jt}_createOutlineWriter(t,e,i,s){return new Jt(t,e,i,s)}_write(t,e,i){const s=i?.asOptimized()??e.readGeometryForDisplay(),r=this._clip(s);if(!r)return;const o=this.evaluatedMeshParams.sprite?.textureBinding;t.recordStart(this.instanceId,this.attributeLayout,o),this._writeGeometry(t,e,r),this._lineMeshWriter.writeLineVertices(t,n.a7.fromOptimizedCIM(r,"esriGeometryPolyline"),e),t.recordEnd()}ensurePacked(t,e,i){super.ensurePacked(t,e,i),this._lineMeshWriter.ensurePacked(t,e,i)}enqueueRequest(t,e,i){super.enqueueRequest(t,e,i),this._lineMeshWriter.enqueueRequest(t,e,i)}async loadDependencies(){await Promise.all([super.loadDependencies(),this._lineMeshWriter.loadDependencies()])}};const te={optionalAttributes:Bt.optionalAttributes,createComputedParams:t=>t,attributes:{...Bt.attributes,...Wt.attributes}},ee={optionalAttributes:Bt.optionalAttributes,createComputedParams:t=>t,attributes:{...Bt.attributes,...Ht.attributes}};class ie extends Xt{constructor(){super(...arguments),this.vertexSpec=ee}}class se extends Zt{constructor(){super(...arguments),this.vertexSpec=te}_createOutlineWriter(t,e,i,s){return new ie(t,e,i,s)}_write(t,e,i){const s=i?.asOptimized()??e.readGeometryForDisplay(),r=this._clip(s);if(!r)return;const o=this.evaluatedMeshParams.sprite?.textureBinding;t.recordStart(this.instanceId,this.attributeLayout,o),this._writeGeometry(t,e,r),this._lineMeshWriter.writeLineVertices(t,n.a7.fromOptimizedCIM(r,"esriGeometryPolyline"),e),t.recordEnd()}ensurePacked(t,e,i){super.ensurePacked(t,e,i),this._lineMeshWriter.ensurePacked(t,e,i)}enqueueRequest(t,e,i){super.enqueueRequest(t,e,i),this._lineMeshWriter.enqueueRequest(t,e,i)}async loadDependencies(){await Promise.all([super.loadDependencies(),this._lineMeshWriter.loadDependencies()])}}const re={createComputedParams:t=>t,optionalAttributes:{},attributes:{pos:{type:s.C.SHORT,count:2,pack:"position",packPrecisionFactor:10},id:{type:s.C.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:s.C.UNSIGNED_BYTE,count:1},offset:{type:s.C.BYTE,count:2,packAlternating:{count:4,pack:()=>[[-1,-1],[1,-1],[-1,1],[1,1]]}}}};let ne=class extends R{constructor(){super(...arguments),this.vertexSpec=re}_write(t,e){t.recordStart(this.instanceId,this.attributeLayout);const i=e.getDisplayId();if("esriGeometryPoint"===e.geometryType){const s=e.readXForDisplay(),r=e.readYForDisplay();this._writeQuad(t,i,s,r)}else"esriGeometryMultipoint"===e.geometryType&&e.readGeometryForDisplay()?.forEachVertex(((e,s)=>{e>=0&&e<=512&&s>=0&&s<=512&&this._writeQuad(t,i,e,s)}));t.recordEnd()}_writeQuad(t,e,i,s){const r=t.vertexCount();this._writeVertex(t,e,i,s),t.indexWrite(r+0),t.indexWrite(r+1),t.indexWrite(r+2),t.indexWrite(r+1),t.indexWrite(r+3),t.indexWrite(r+2)}};class oe{static getPlacement(t,e,i,s,r,o){const a=(0,n.ak)(i);return a?(-1===e&&t.invertY(),a.execute(t,i,s,r,o)):null}}const ae=96;class ce{constructor(t){const{offsetX:e,offsetY:i,postAngle:s,fontSize:r,haloSize:n,outlineSize:o,scaleFactor:a,transforms:c}=t;if(this.offsetX=e,this.offsetY=i,this.postAngle=s,this.fontSize=Math.min(r,ae),this.haloSize=n??0,this.outlineSize=o??0,this.transforms=c,c&&c.infos.length>1){const t=(0,h.E)(r,s,!1,e,i,c,!1);this.fontSize=Math.min(t.size,ae);const n=t.size/r;this.haloSize*=n,this.outlineSize*=n,this.postAngle=t.rotation,this.offsetX=t.offsetX,this.offsetY=t.offsetY}a&&(this.fontSize*=a,this.offsetX*=a,this.offsetY*=a)}}const ue=28,he=[4,4],le=[16,4],pe={topLeft:le,topRight:le,bottomLeft:le,bottomRight:le},de=[4,2],fe=[4,6],xe={topLeft:de,topRight:de,bottomLeft:fe,bottomRight:fe},_e={topLeft:de,topRight:fe,bottomLeft:de,bottomRight:fe},ye={topLeft:fe,topRight:fe,bottomLeft:he,bottomRight:he},me={topLeft:he,topRight:he,bottomLeft:fe,bottomRight:fe},ge={topLeft:fe,topRight:he,bottomLeft:fe,bottomRight:he},be={topLeft:he,topRight:fe,bottomLeft:he,bottomRight:fe},we={createComputedParams:t=>t,optionalAttributes:{zoomRange:{type:s.C.UNSIGNED_SHORT,count:2,packPrecisionFactor:a.m,packTessellation:({minZoom:t,maxZoom:e})=>[t||0,e||ue]},clipAngle:{type:s.C.UNSIGNED_BYTE,count:1,packTessellation:({clipAngle:t})=>ve(t||0)},referenceSymbol:{type:s.C.BYTE,count:4,packPrecisionFactor:1,packTessellation:(t,e)=>{const i=t.isLineLabel||!t.referenceBounds,s=(0,n.al)(i?"center":e.horizontalAlignment),o=(0,n.am)(i?"middle":e.verticalAlignment),{offsetX:a,offsetY:c,size:u}=i?{offsetX:0,offsetY:0,size:0}:t.referenceBounds;return[(0,r.be)(a),-(0,r.be)(c),Math.round((0,r.be)(u)),s+1<<2|o+1]}}},attributes:{pos:{type:s.C.SHORT,count:2,pack:"position",packPrecisionFactor:10},id:{type:s.C.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:s.C.UNSIGNED_BYTE,count:1,packTessellation:({isBackground:t,mapAligned:e})=>w([[n.an,t],[n.ao,!!e]])},offset:{type:s.C.SHORT,count:2,packPrecisionFactor:8,packAlternating:{count:4,packTessellation:({offsets:t})=>{const{bottomLeft:e,bottomRight:i,topLeft:s,topRight:r}=t;return[s,r,e,i]}}},textureUV:{type:s.C.SHORT,count:2,packPrecisionFactor:4,packAlternating:{count:4,packTessellation:({texcoords:t})=>{const{bottomLeft:e,bottomRight:i,topLeft:s,topRight:r}=t;return[s,r,e,i]}}},color:{type:s.C.UNSIGNED_BYTE,count:4,normalized:!0,packTessellation:({color:t})=>t},fontSize:{type:s.C.UNSIGNED_SHORT,count:1,packPrecisionFactor:4,packTessellation:({fontSize:t})=>Math.round((0,r.be)(t))},referenceSize:{type:s.C.UNSIGNED_BYTE,count:1,packPrecisionFactor:4,packTessellation:({fontSize:t},{referenceSize:e})=>Math.round((0,r.be)(e??t))},outlineColor:{type:s.C.UNSIGNED_BYTE,count:4,normalized:!0,pack:({outlineColor:t})=>k(t)},haloColor:{type:s.C.UNSIGNED_BYTE,count:4,normalized:!0,pack:({haloColor:t})=>k(t)},outlineAndHaloSize:{type:s.C.UNSIGNED_SHORT,count:2,packPrecisionFactor:4,packTessellation:({outlineSize:t,haloSize:e})=>[Math.round((0,r.be)(t)),Math.round((0,r.be)(e))]}}};class ke extends R{constructor(){super(...arguments),this.vertexSpec=we,this._textMeshParamsPropsInitialized=!1}ensurePacked(t,e,i){super.ensurePacked(t,e,i),this._textMeshParamsPropsInitialized&&!this._evaluator.hasDynamicProperties||(this._textMeshTransformProps=new ce(this.evaluatedMeshParams),this._textMeshParamsPropsInitialized=!0)}_write(t,e,i){const s=this._getShaping();if(!s)return;const r=e.getDisplayId();if(null!=this.evaluatedMeshParams.placement)return this._writePlacedTextMarkers(t,e,s,i);if(i?.nextPath())return i.nextPoint(),this._writeGlyphs(t,r,i.x,i.y,s,0);if("esriGeometryPolygon"===e.geometryType){const i=e.readCentroidForDisplay();if(!i)return;const[n,o]=i.coords;return this._writeGlyphs(t,r,n,o,s,0)}if("esriGeometryMultipoint"===e.geometryType)return void e.readGeometryForDisplay()?.forEachVertex(((e,i)=>this._writeGlyphs(t,r,e,i,s,0)));const n=e.readXForDisplay(),o=e.readYForDisplay();return this._writeGlyphs(t,r,n,o,s,0)}_writePlacedTextMarkers(t,e,i,s){const o=s??n.a7.fromFeatureSetReaderCIM(e);if(!o)return;const a=-1,c=oe.getPlacement(o,a,this.evaluatedMeshParams.placement,(0,r.be)(1),t.id,N());if(!c)return;const u=e.getDisplayId();let h=c.next();for(;null!=h;){const e=h.tx,s=-h.ty,r=-h.getAngle();this._writeGlyphs(t,u,e,s,i,r),h=c.next()}}_getShaping(t){const e=this._textMeshTransformProps,i=this.evaluatedMeshParams;if(!i.glyphs?.glyphs.length)return null;const s=(0,r.be)(e.fontSize),o=(0,r.be)(e.offsetX),c=(0,r.be)(e.offsetY),u=(0,r.aP)((0,r.be)(i.lineWidth),a.e,a.d),h=a.G*(0,r.aP)(i.lineHeightRatio,.25,4);return(0,n.ap)(i.glyphs,{scale:s/a.A,angle:e.postAngle,xOffset:o,yOffset:c,horizontalAlignment:i.horizontalAlignment,verticalAlignment:t||i.verticalAlignment,maxLineWidth:u,lineHeight:h,decoration:i.decoration,borderLineSizePx:(0,r.be)(i.boxBorderLineSize),hasBackground:!!i.boxBackgroundColor,useCIMAngleBehavior:i.useCIMAngleBehavior})}_writeGlyphs(t,e,i,s,n,o,a,c){const u=this.evaluatedMeshParams,h=this._textMeshTransformProps,l=(0,r.be)(h.fontSize),p=h.haloSize,d=h.outlineSize,f=(0,r.be)(h.offsetX),x=(0,r.be)(h.offsetY),[_,y]=g(u.scaleInfo,this.getTileInfo());0!==o&&n.setRotation(o);const m=n.bounds,b=i+m.x+f,w=s+m.y-x,v=2*(u.minPixelBuffer?u.minPixelBuffer/l:1),S=Math.max(m.width,m.height)*v;n.textBox&&(t.recordStart(this.instanceId,this.attributeLayout,n.glyphs[0].textureBinding),t.recordBounds(b,w,S,S),this._writeTextBox(t,e,i,s,n.textBox,a,c),t.recordEnd());for(const r of n.glyphs){t.recordStart(this.instanceId,this.attributeLayout,r.textureBinding),t.recordBounds(b,w,S,S);const{texcoords:n,offsets:o}=r;this._writeQuad(t,e,i,s,{texcoords:n,offsets:o,fontSize:l,haloSize:p,outlineSize:d,color:k(u.color),isBackground:!1,referenceBounds:a,minZoom:_,maxZoom:y,...c}),t.recordEnd()}0!==o&&n.setRotation(-o)}_writeTextBox(t,e,i,s,r,n,o){const a=this.evaluatedMeshParams,{fontSize:c,haloSize:u,outlineSize:h}=this._textMeshTransformProps,{boxBackgroundColor:l,boxBorderLineColor:p}=a,d={isBackground:!0,fontSize:c,haloSize:u,outlineSize:h,referenceBounds:n,...o};l&&(this._writeQuad(t,e,i,s,{texcoords:pe,offsets:r.main,color:k(l),...d}),p||(this._writeQuad(t,e,i,s,{texcoords:ye,offsets:r.top,color:k(l),...d}),this._writeQuad(t,e,i,s,{texcoords:me,offsets:r.bot,color:k(l),...d}),this._writeQuad(t,e,i,s,{texcoords:ge,offsets:r.left,color:k(l),...d}),this._writeQuad(t,e,i,s,{texcoords:be,offsets:r.right,color:k(l),...d}))),p&&(this._writeQuad(t,e,i,s,{texcoords:xe,offsets:r.top,color:k(p),...d}),this._writeQuad(t,e,i,s,{texcoords:xe,offsets:r.bot,color:k(p),...d}),this._writeQuad(t,e,i,s,{texcoords:_e,offsets:r.left,color:k(p),...d}),this._writeQuad(t,e,i,s,{texcoords:_e,offsets:r.right,color:k(p),...d}))}_writeQuad(t,e,i,s,r){const n=t.vertexCount();this._writeVertex(t,e,i,s,r),t.indexWrite(n+0),t.indexWrite(n+1),t.indexWrite(n+2),t.indexWrite(n+1),t.indexWrite(n+3),t.indexWrite(n+2)}}const ve=t=>Math.round(t*(254/360)),Se={createComputedParams:t=>t,optionalAttributes:Ut.optionalAttributes,attributes:{...Ut.attributes,bitset:{type:s.C.UNSIGNED_BYTE,count:1,pack:({shouldSampleAlphaOnly:t,shouldScaleDash:e,isSDF:i})=>w([[n.ag,t],[n.aq,e],[n.ar,i]])},tlbr:{type:s.C.UNSIGNED_SHORT,count:4,pack:({sprite:t})=>{const{rect:e,width:i,height:s}=t,r=e.x+a.t,n=e.y+a.t;return[r,n,r+i,n+s]}},accumulatedDistance:{type:s.C.UNSIGNED_SHORT,count:1,packTessellation:({distance:t})=>t},segmentDirection:{type:s.C.BYTE,count:2,packPrecisionFactor:16,packTessellation:({directionX:t,directionY:e})=>[t,e]},offsetAlongLine:{type:s.C.HALF_FLOAT,count:1,pack:({offsetAlongLine:t})=>(0,r.be)(t)},capType:{type:s.C.UNSIGNED_BYTE,count:1,pack:({capType:t})=>{switch(t){case l.U.Butt:case"butt":return 0;case l.U.Square:case"square":return 1;case l.U.Round:case"round":return 2;default:return 0}}}}};class Te extends Ot{constructor(t,e,i,s){super(t,e,i,s),this.vertexSpec=Se,this._tessellationOptions.textured=!0}_write(t,e,i){const s=i??n.a7.fromFeatureSetReaderCIM(e);if(!s)return;const{sprite:r}=this.evaluatedMeshParams;this._writeGeometry(t,e,s,r?.textureBinding)}}let Pe=class t{static from(t){return"width"in t?this.fromSimpleMeshParams(t):this.fromComplexMeshParams(t)}static fromSimpleMeshParams(e){const i=new t(e.sprite,e.color,e.outlineColor,e.minPixelBuffer,e.placement,e.scaleInfo,e.effects),{type:s,width:n,height:o,angle:a,alignment:c,outlineSize:u,referenceSize:h,sprite:l,overrideOutlineColor:p}=e;return i.rawWidth=(0,r.be)(n),i.rawHeight=(0,r.be)(o),i.angle=a,i.alignment=c,i.outlineSize=(0,r.be)(u),i.referenceSize=(0,r.be)(h),i.overrideOutlineColor=p,i.offsetX=(0,r.be)(e.offsetX),i.offsetY=(0,r.be)(e.offsetY),"simple"!==s||l.sdf||(i.rawWidth=l.width,i.rawHeight=l.height),i._computeSize(e,!1),i}static fromComplexMeshParams(e){const i=new t(e.sprite,e.color,e.outlineColor,e.minPixelBuffer,e.placement,e.scaleInfo,e.effects);let{alignment:s,transforms:n,size:o,scaleX:a,anchorX:c,anchorY:u,angle:l,colorLocked:p,frameHeight:d,widthRatio:f,offsetX:x,offsetY:_,outlineSize:y,referenceSize:m,scaleFactor:g,sizeRatio:b,isAbsoluteAnchorPoint:w,rotateClockwise:k,scaleSymbolsProportionally:v,sprite:S}=e;if(n&&n.infos.length>0){const t=(0,h.E)(o,l,k,x,_,n);o=t.size,l=t.rotation,x=t.offsetX,_=t.offsetY,k=!1}g&&(o*=g,x*=g,_*=g);const T=a*(S.width/S.height);i.alignment=s,i.rawHeight=(0,r.be)(o),i.rawWidth=i.rawHeight*T,i.referenceSize=(0,r.be)(m),i.sizeRatio=b,i.sdfDecodeCoeff=(S.sdfDecodeCoeff??1)*b,i.angle=l,i.rotateClockwise=k,i.anchorX=c,i.anchorY=u,i.offsetX=(0,r.be)(x),i.offsetY=(0,r.be)(_),w&&o&&(S.sdf?i.anchorX=c/(o*f):i.anchorX=c/(o*T),i.anchorY=u/o);const P=v&&d?o/d:1;return i.outlineSize=0===y||isNaN(y)?0:(0,r.be)(y)*P,i.scaleSymbolsProportionally=v,i.colorLocked=p,i._computeSize(e,!0),i}constructor(t,e,i,s,r,n,o){this.sprite=t,this.color=e,this.outlineColor=i,this.minPixelBuffer=s,this.placement=r,this.scaleInfo=n,this.effects=o,this.rawWidth=0,this.rawHeight=0,this.angle=0,this.outlineSize=0,this.referenceSize=0,this.sizeRatio=1,this.sdfDecodeCoeff=1,this.alignment=l.i.SCREEN,this.scaleSymbolsProportionally=!1,this.overrideOutlineColor=!1,this.colorLocked=!1,this.anchorX=0,this.anchorY=0,this.computedWidth=0,this.computedHeight=0,this.texXmin=0,this.texYmin=0,this.texXmax=0,this.texYmax=0,this.offsetX=0,this.offsetY=0,this.rotateClockwise=!0}get boundsInfo(){return{size:Math.max(this.computedHeight,this.computedWidth),offsetX:this.offsetX,offsetY:this.offsetY}}_computeSize(t,e){const{sprite:i,hasSizeVV:s}=t,r=!!i.sdf,n=i.sdfPaddingRatio??.5,{rawWidth:o,rawHeight:c,sizeRatio:u,outlineSize:h}=this,l=u*(r?1/(1-n):1),p=o*l,d=c*l;if(r&&!s){const t=e&&o>c?p:o,i=c,s=h+2;this.computedWidth=Math.min(t+s,p),this.computedHeight=Math.min(i+s,d)}else this.computedWidth=p,this.computedHeight=d;const f=r?Math.max(i.width,i.height)/Math.max(p,d):1,x=.5*(p-this.computedWidth)*f,_=.5*(d-this.computedHeight)*f,y=i.rect.x+a.t+x,m=i.rect.y+a.t+_,g=y+i.width-2*x,b=m+i.height-2*_;this.texXmin=Math.floor(y),this.texYmin=Math.floor(m),this.texXmax=Math.ceil(g),this.texYmax=Math.ceil(b),this.computedWidth*=(this.texXmax-this.texXmin)/(g-y),this.computedHeight*=(this.texYmax-this.texYmin)/(b-m),this.anchorX*=p/this.computedWidth,this.anchorY*=d/this.computedHeight}};const Ce=3.14159265359/180,Ee=128/Math.PI;function Me(t,e){return t%=e,Math.abs(t>=0?t:t+e)}function Ne(t){return Me(t*Ee,256)}function Ie(t,e,i,s,r=!1){const n=(0,d.n)(),o=r?1:-1;return(0,d.b)(n),(e||i)&&(0,d.a)(n,n,[e,-i]),s&&(0,d.c)(n,n,o*Ce*-s),n}const ze={createComputedParams:t=>Pe.from(t),optionalAttributes:{zoomRange:{type:s.C.SHORT,count:2,packPrecisionFactor:a.m,pack:({scaleInfo:t},{tileInfo:e})=>g(t,e)}},attributes:{pos:{type:s.C.SHORT,count:2,pack:"position",packPrecisionFactor:10},id:{type:s.C.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:s.C.UNSIGNED_BYTE,count:1,pack:({sprite:t,alignment:e,scaleSymbolsProportionally:i,overrideOutlineColor:s,colorLocked:r})=>{let o=0;return t.sdf&&(o|=b(n.o.bitset.isSDF)),e===l.i.MAP&&(o|=b(n.o.bitset.isMapAligned)),i&&(o|=b(n.o.bitset.scaleSymbolsProportionally)),s&&(o|=b(n.o.bitset.overrideOutlineColor)),r&&(o|=b(n.o.bitset.colorLocked)),o}},offset:{type:s.C.SHORT,count:2,packPrecisionFactor:4,packAlternating:{count:4,pack:({angle:t,computedWidth:e,computedHeight:i,anchorX:s,anchorY:r,offsetX:n,offsetY:o,rotateClockwise:a})=>{const c=Ie(0,n,o,-t,a),u=-(.5+s)*e,h=-(.5-r)*i,l=[u,h],p=[u+e,h],d=[u,h+i],x=[u+e,h+i];return(0,f.S)(l,l,c),(0,f.S)(p,p,c),(0,f.S)(d,d,c),(0,f.S)(x,x,c),[l,p,d,x]}}},textureUV:{type:s.C.SHORT,count:2,packPrecisionFactor:4,packAlternating:{count:4,pack:({texXmax:t,texXmin:e,texYmax:i,texYmin:s})=>[[e,s],[t,s],[e,i],[t,i]]}},color:{type:s.C.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:t})=>k(t)},outlineColor:{type:s.C.UNSIGNED_BYTE,count:4,normalized:!0,pack:({outlineColor:t})=>k(t)},sizing:{type:s.C.UNSIGNED_BYTE,count:4,pack:({rawWidth:t,rawHeight:e,outlineSize:i,referenceSize:s})=>{const r=Math.max(t,e);return[T(r,128),T(i,128),T(s,128),0]}},placementAngle:{type:s.C.UNSIGNED_BYTE,count:1,packTessellation:({placementAngle:t})=>Ne(t)},sdfDecodeCoeff:{type:s.C.UNSIGNED_SHORT,count:1,packPrecisionFactor:64,pack:({sdfDecodeCoeff:t})=>t}}};class Be extends R{constructor(){super(...arguments),this.vertexSpec=ze}getBoundsInfo(){return this.evaluatedMeshParams.boundsInfo}_write(t,e,i){const s=this.evaluatedMeshParams.sprite?.textureBinding,r=e.getDisplayId();t.recordStart(this.instanceId,this.attributeLayout,s);const n=this.evaluatedMeshParams.minPixelBuffer,o=Math.max(this.evaluatedMeshParams.computedWidth,n),a=Math.max(this.evaluatedMeshParams.computedHeight,n),c=-this.evaluatedMeshParams.anchorX*this.evaluatedMeshParams.computedWidth,u=this.evaluatedMeshParams.anchorY*this.evaluatedMeshParams.computedHeight,h=this.evaluatedMeshParams.offsetX+c,l=-this.evaluatedMeshParams.offsetY+u;if(null!=this.evaluatedMeshParams.placement)this._writePlacedMarkers(t,e,i,o,a);else if(i?.nextPath()){i.nextPoint();const e=i.x,s=i.y;t.recordBounds(e+h,s+l,o,a),this._writeQuad(t,r,e,s)}else if("esriGeometryPolygon"===e.geometryType){const i=e.readCentroidForDisplay();if(!i)return;const[s,n]=i.coords;t.recordBounds(s+h,n+l,o,a),this._writeQuad(t,r,s,n)}else if("esriGeometryPoint"===e.geometryType){const i=e.readXForDisplay(),s=e.readYForDisplay();t.recordBounds(i+h,s+l,o,a),this._writeQuad(t,r,i,s)}else e.readGeometryForDisplay()?.forEachVertex(((e,i)=>{t.recordBounds(e+h,i+l,o,a),Math.abs(e)>x.e||Math.abs(i)>x.e||this._writeQuad(t,r,e,i)}));t.recordEnd()}_writePlacedMarkers(t,e,i,s,o){const a=i??n.a7.fromFeatureSetReaderCIM(e)?.clone();if(!a)return;const c=-1,u=oe.getPlacement(a,c,this.evaluatedMeshParams.placement,(0,r.be)(1),t.id,N());if(!u)return;const h=e.getDisplayId();let l=u.next();const p=this.evaluatedMeshParams.offsetX,d=-this.evaluatedMeshParams.offsetY;for(;null!=l;){const e=l.tx,i=-l.ty;if(Math.abs(e)>x.e||Math.abs(i)>x.e){l=u.next();continue}const r=-l.getAngle();t.recordBounds(e+p,i+d,s,o),this._writeQuad(t,h,e,i,r),l=u.next()}}_writeQuad(t,e,i,s,r){const n=t.vertexCount(),o=null==r?null:{placementAngle:r};this._writeVertex(t,e,i,s,o),t.indexWrite(n+0),t.indexWrite(n+1),t.indexWrite(n+2),t.indexWrite(n+1),t.indexWrite(n+3),t.indexWrite(n+2)}}const De={createComputedParams:t=>t,optionalAttributes:{},attributes:{pos:{type:s.C.SHORT,count:2,packPrecisionFactor:10,pack:"position"},id:{type:s.C.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:s.C.UNSIGNED_BYTE,count:1,pack:t=>0},offset:{type:s.C.SHORT,count:2,packPrecisionFactor:16,packAlternating:{count:4,pack:({size:t})=>{const e=(0,r.be)(t),i=-e/2,s=-e/2;return[[i,s],[i+e,s],[i,s+e],[i+e,s+e]]}}},texCoords:{type:s.C.SHORT,count:2,packPrecisionFactor:4,packAlternating:{count:4,pack:()=>[[0,1],[1,1],[0,0],[1,0]]}},size:{type:s.C.UNSIGNED_BYTE,count:2,pack:({size:t})=>[t,t]},referenceSize:{type:s.C.UNSIGNED_BYTE,count:1,pack:({size:t})=>(0,r.be)(t)},zoomRange:{type:s.C.UNSIGNED_BYTE,count:2,pack:({scaleInfo:t},{tileInfo:e})=>g(t,e)}}};class Ae extends R{constructor(){super(...arguments),this.vertexSpec=De}_write(t,e){const i=e.getDisplayId(),s=this.evaluatedMeshParams.minPixelBuffer,n=Math.max((0,r.be)(this.evaluatedMeshParams.size),s);let o,a;if("esriGeometryPoint"===e.geometryType)o=e.readXForDisplay(),a=e.readYForDisplay();else{const t=e.readCentroidForDisplay();if(!t)return;o=t?.coords[0],a=t?.coords[1]}t.recordStart(this.instanceId,this.attributeLayout),t.recordBounds(o,a,n,n);const c=t.vertexCount();this._writeVertex(t,i,o,a),t.indexWrite(c+0),t.indexWrite(c+1),t.indexWrite(c+2),t.indexWrite(c+1),t.indexWrite(c+3),t.indexWrite(c+2),t.recordEnd()}}},68894:function(t,e,i){i.d(e,{a:function(){return l},c:function(){return k},i:function(){return u}});var s=i(98503),r=i(28373),n=i(28549);const o=128e3;let a=null,c=null;async function u(){return a||(a=h()),a}async function h(){c=await((0,s.a$)("esri-csp-restrictions")?await i.e(9990).then(i.bind(i,19990)).then((t=>t.l)):await i.e(7623).then(i.bind(i,47623)).then((t=>t.l))).default({locateFile:t=>(0,s.eK)(`esri/core/libs/libtess/${t}`)})}function l(t,e){const i=Math.max(t.length,o);return c.triangulate(t,e,i)}function p(t,e){return t.x===e.x&&t.y===e.y}function d(t){if(!t)return;const e=t.length;if(e<=1)return;let i=0;for(let s=1;s<e;s++)p(t[s],t[i])||++i===s||(t[i]=t[s]);t.length=i+1}function f(t,e){return t.x=e.y,t.y=-e.x,t}function x(t,e){return t.x=-e.y,t.y=e.x,t}function _(t,e){return t.x=e.x,t.y=e.y,t}function y(t,e){return t.x=-e.x,t.y=-e.y,t}function m(t){return Math.sqrt(t.x*t.x+t.y*t.y)}function g(t,e){return t.x*e.y-t.y*e.x}function b(t,e){return t.x*e.x+t.y*e.y}function w(t,e,i,s){return t.x=e.x*i+e.y*s,t.y=e.x*s-e.y*i,t}class k{constructor(t,e,i){this._writeVertex=t,this._writeTriangle=e,this._canUseThinTessellation=i,this._prevNormal={x:void 0,y:void 0},this._nextNormal={x:void 0,y:void 0},this._textureNormalLeft={x:0,y:1},this._textureNormalRight={x:0,y:-1},this._textureNormal={x:void 0,y:void 0},this._joinNormal={x:void 0,y:void 0},this._inner={x:void 0,y:void 0},this._outer={x:void 0,y:void 0},this._roundStart={x:void 0,y:void 0},this._roundEnd={x:void 0,y:void 0},this._startBreak={x:void 0,y:void 0},this._endBreak={x:void 0,y:void 0},this._innerPrev={x:void 0,y:void 0},this._innerNext={x:void 0,y:void 0},this._bevelStart={x:void 0,y:void 0},this._bevelEnd={x:void 0,y:void 0},this._bevelMiddle={x:void 0,y:void 0}}tessellate(t,e,i=this._canUseThinTessellation){d(t),i&&e.halfWidth<n.R&&!e.offset?this._tessellateThin(t,e):this._tessellate(t,e)}_tessellateThin(t,e){if(t.length<2)return;const i=e.wrapDistance||65535;let s=e.initialDistance||0,r=!1,n=t[0].x,o=t[0].y;const a=t.length;for(let c=1;c<a;++c){r&&(r=!1,s=0);let e=t[c].x,a=t[c].y,u=e-n,h=a-o,l=Math.sqrt(u*u+h*h);if(u/=l,h/=l,s+l>i){r=!0;const t=(i-s)/l;l=i-s,e=(1-t)*n+t*e,a=(1-t)*o+t*a,--c}const p=this._writeVertex(n,o,0,0,u,h,h,-u,0,-1,s),d=this._writeVertex(n,o,0,0,u,h,-h,u,0,1,s);s+=l;const f=this._writeVertex(e,a,0,0,u,h,h,-u,0,-1,s),x=this._writeVertex(e,a,0,0,u,h,-h,u,0,1,s);this._writeTriangle(p,d,f),this._writeTriangle(d,f,x),n=e,o=a}}_tessellate(t,e){const i=t[0],s=t[t.length-1],n=p(i,s),o=n?3:2;if(t.length<o)return;const a=e.pixelCoordRatio,c=null!=e.capType?e.capType:r.e.BUTT,u=null!=e.joinType?e.joinType:r.n.MITER,h=null!=e.miterLimit?Math.min(e.miterLimit,4):2,l=null!=e.roundLimit?Math.min(e.roundLimit,1.05):1.05,d=null!=e.halfWidth?e.halfWidth:2,k=!!e.textured;let v,S,T,P=null;const C=this._prevNormal,E=this._nextNormal;let M=-1,N=-1;const I=this._joinNormal;let z,B;const D=this._textureNormalLeft,A=this._textureNormalRight,L=this._textureNormal;let R=-1,Y=-1;const V=e.wrapDistance||65535;let U=e.initialDistance||0;const F=this._writeVertex,G=this._writeTriangle,O=(t,e,i,s,r,n)=>{const o=F(S,T,z,B,i,s,t,e,r,n,U);return R>=0&&Y>=0&&o>=0&&G(R,Y,o),R=Y,Y=o,o};n&&(v=t[t.length-2],E.x=s.x-v.x,E.y=s.y-v.y,N=m(E),E.x/=N,E.y/=N);let W=!1;for(let p=0;p<t.length;++p){if(W&&(W=!1,U=0),v&&(C.x=-E.x,C.y=-E.y,M=N,U+M>V&&(W=!0)),W){const e=(V-U)/M;M=V-U,v={x:(1-e)*v.x+e*t[p].x,y:(1-e)*v.y+e*t[p].y},--p}else v=t[p];S=v.x,T=v.y;const e=p<=0&&!W,i=p===t.length-1;if(e||(U+=M),P=i?n?t[1]:null:t[p+1],P?(E.x=P.x-S,E.y=P.y-T,N=m(E),E.x/=N,E.y/=N):(E.x=void 0,E.y=void 0),!n){if(e){x(I,E),z=I.x,B=I.y,c===r.e.SQUARE&&(O(-E.y-E.x,E.x-E.y,E.x,E.y,0,-1),O(E.y-E.x,-E.x-E.y,E.x,E.y,0,1)),c===r.e.ROUND&&(O(-E.y-E.x,E.x-E.y,E.x,E.y,-1,-1),O(E.y-E.x,-E.x-E.y,E.x,E.y,-1,1)),c!==r.e.ROUND&&c!==r.e.BUTT||(O(-E.y,E.x,E.x,E.y,0,-1),O(E.y,-E.x,E.x,E.y,0,1));continue}if(i){f(I,C),z=I.x,B=I.y,c!==r.e.ROUND&&c!==r.e.BUTT||(O(C.y,-C.x,-C.x,-C.y,0,-1),O(-C.y,C.x,-C.x,-C.y,0,1)),c===r.e.SQUARE&&(O(C.y-C.x,-C.x-C.y,-C.x,-C.y,0,-1),O(-C.y-C.x,C.x-C.y,-C.x,-C.y,0,1)),c===r.e.ROUND&&(O(C.y-C.x,-C.x-C.y,-C.x,-C.y,1,-1),O(-C.y-C.x,C.x-C.y,-C.x,-C.y,1,1));continue}}let s,o,F=-g(C,E);if(Math.abs(F)<.01)b(C,E)>0?(I.x=C.x,I.y=C.y,F=1,s=Number.MAX_VALUE,o=!0):(x(I,E),F=1,s=1,o=!1);else{I.x=(C.x+E.x)/F,I.y=(C.y+E.y)/F,s=m(I);const t=(s-1)*d*a;o=s>4||t>M&&t>N}z=I.x,B=I.y;let G=u;switch(u){case r.n.BEVEL:s<1.05&&(G=r.n.MITER);break;case r.n.ROUND:s<l&&(G=r.n.MITER);break;case r.n.MITER:s>h&&(G=r.n.BEVEL)}switch(G){case r.n.MITER:if(O(I.x,I.y,-C.x,-C.y,0,-1),O(-I.x,-I.y,-C.x,-C.y,0,1),i)break;if(k){const t=W?0:U;R=this._writeVertex(S,T,z,B,E.x,E.y,I.x,I.y,0,-1,t),Y=this._writeVertex(S,T,z,B,E.x,E.y,-I.x,-I.y,0,1,t)}break;case r.n.BEVEL:{const t=F<0;let e,s,r,n;if(t){const t=R;R=Y,Y=t,e=D,s=A}else e=A,s=D;if(o)r=t?x(this._innerPrev,C):f(this._innerPrev,C),n=t?f(this._innerNext,E):x(this._innerNext,E);else{const e=t?y(this._inner,I):_(this._inner,I);r=e,n=e}const a=t?f(this._bevelStart,C):x(this._bevelStart,C);O(r.x,r.y,-C.x,-C.y,e.x,e.y);const c=O(a.x,a.y,-C.x,-C.y,s.x,s.y);if(i)break;const u=t?x(this._bevelEnd,E):f(this._bevelEnd,E);if(o){const t=this._writeVertex(S,T,z,B,-C.x,-C.y,0,0,0,0,U);R=this._writeVertex(S,T,z,B,E.x,E.y,n.x,n.y,e.x,e.y,U),Y=this._writeVertex(S,T,z,B,E.x,E.y,u.x,u.y,s.x,s.y,U),this._writeTriangle(c,t,Y)}else{if(k){const t=this._bevelMiddle;t.x=(a.x+u.x)/2,t.y=(a.y+u.y)/2,w(L,t,-C.x,-C.y),O(t.x,t.y,-C.x,-C.y,L.x,L.y),w(L,t,E.x,E.y),R=this._writeVertex(S,T,z,B,E.x,E.y,t.x,t.y,L.x,L.y,U),Y=this._writeVertex(S,T,z,B,E.x,E.y,n.x,n.y,e.x,e.y,U)}else{const t=R;R=Y,Y=t}O(u.x,u.y,E.x,E.y,s.x,s.y)}if(t){const t=R;R=Y,Y=t}break}case r.n.ROUND:{const t=F<0;let e,r;if(t){const t=R;R=Y,Y=t,e=D,r=A}else e=A,r=D;const n=t?y(this._inner,I):_(this._inner,I);let a,c;o?(a=t?x(this._innerPrev,C):f(this._innerPrev,C),c=t?f(this._innerNext,E):x(this._innerNext,E)):(a=n,c=n);const u=t?f(this._roundStart,C):x(this._roundStart,C),h=t?x(this._roundEnd,E):f(this._roundEnd,E),l=O(a.x,a.y,-C.x,-C.y,e.x,e.y),p=O(u.x,u.y,-C.x,-C.y,r.x,r.y);if(i)break;const d=this._writeVertex(S,T,z,B,-C.x,-C.y,0,0,0,0,U);o||this._writeTriangle(R,Y,d);const m=y(this._outer,n),g=this._writeVertex(S,T,z,B,E.x,E.y,h.x,h.y,r.x,r.y,U);let v,P;const M=s>2;if(M){let e;s!==Number.MAX_VALUE?(m.x/=s,m.y/=s,e=b(C,m),e=(s*(e*e-1)+1)/e):e=-1,v=t?f(this._startBreak,C):x(this._startBreak,C),v.x+=C.x*e,v.y+=C.y*e,P=t?x(this._endBreak,E):f(this._endBreak,E),P.x+=E.x*e,P.y+=E.y*e}w(L,m,-C.x,-C.y);const N=this._writeVertex(S,T,z,B,-C.x,-C.y,m.x,m.y,L.x,L.y,U);w(L,m,E.x,E.y);const V=k?this._writeVertex(S,T,z,B,E.x,E.y,m.x,m.y,L.x,L.y,U):N,G=d,W=k?this._writeVertex(S,T,z,B,E.x,E.y,0,0,0,0,U):d;let H=-1,X=-1;if(M&&(w(L,v,-C.x,-C.y),H=this._writeVertex(S,T,z,B,-C.x,-C.y,v.x,v.y,L.x,L.y,U),w(L,P,E.x,E.y),X=this._writeVertex(S,T,z,B,E.x,E.y,P.x,P.y,L.x,L.y,U)),k?M?(this._writeTriangle(G,p,H),this._writeTriangle(G,H,N),this._writeTriangle(W,V,X),this._writeTriangle(W,X,g)):(this._writeTriangle(G,p,N),this._writeTriangle(W,V,g)):M?(this._writeTriangle(d,p,H),this._writeTriangle(d,H,X),this._writeTriangle(d,X,g)):(this._writeTriangle(d,p,N),this._writeTriangle(d,V,g)),o?(R=this._writeVertex(S,T,z,B,E.x,E.y,c.x,c.y,e.x,e.y,U),Y=g):(R=k?this._writeVertex(S,T,z,B,E.x,E.y,c.x,c.y,e.x,e.y,U):l,this._writeTriangle(R,W,g),Y=g),t){const t=R;R=Y,Y=t}break}}}}}},88623:function(t,e,i){i.d(e,{n:function(){return c}});var s,r=i(98503);(function(t){t[t.varint=0]="varint",t[t.fixed64=1]="fixed64",t[t.delimited=2]="delimited",t[t.fixed32=5]="fixed32",t[t.unknown=99]="unknown"})(s||(s={}));const n=4294967296,o=new TextDecoder("utf-8"),a=(0,r.a$)("safari")||(0,r.a$)("ios")?6:(0,r.a$)("ff")?12:32;class c{constructor(t,e,i=0,r=(t?t.byteLength:0)){this._tag=0,this._dataType=s.unknown,this._init(t,e,i,r)}_init(t,e,i,s){this._data=t,this._dataView=e,this._pos=i,this._end=s}asUnsafe(){return this}clone(){return new c(this._data,this._dataView,this._pos,this._end)}pos(){return this._pos}move(t){this._pos=t}nextTag(t){for(;;){if(this._pos===this._end)return!1;const e=this._decodeVarint();if(this._tag=e>>3,this._dataType=7&e,!t||t===this._tag)break;this.skip()}return!0}next(){if(this._pos===this._end)return!1;const t=this._decodeVarint();return this._tag=t>>3,this._dataType=7&t,!0}empty(){return this._pos>=this._end}tag(){return this._tag}getInt32(){return this._decodeVarint()}getInt64(){return this._decodeVarint()}getUInt32(){let t=4294967295;if(t=(127&this._data[this._pos])>>>0,this._data[this._pos++]<128||(t=(t|(127&this._data[this._pos])<<7)>>>0,this._data[this._pos++]<128)||(t=(t|(127&this._data[this._pos])<<14)>>>0,this._data[this._pos++]<128)||(t=(t|(127&this._data[this._pos])<<21)>>>0,this._data[this._pos++]<128)||(t=(t|(15&this._data[this._pos])<<28)>>>0,this._data[this._pos++]<128))return t;throw new Error("Varint overflow")}getUInt64(){return this._decodeVarint()}getSInt32(){const t=this.getUInt32();return t>>>1^-(1&t)}getSInt64(){return this._decodeSVarint()}getBool(){const t=0!==this._data[this._pos];return this._skip(1),t}getEnum(){return this._decodeVarint()}getFixed64(){const t=this._dataView,e=this._pos,i=t.getUint32(e,!0)+t.getUint32(e+4,!0)*n;return this._skip(8),i}getSFixed64(){const t=this._dataView,e=this._pos,i=t.getUint32(e,!0)+t.getInt32(e+4,!0)*n;return this._skip(8),i}getDouble(){const t=this._dataView.getFloat64(this._pos,!0);return this._skip(8),t}getFixed32(){const t=this._dataView.getUint32(this._pos,!0);return this._skip(4),t}getSFixed32(){const t=this._dataView.getInt32(this._pos,!0);return this._skip(4),t}getFloat(){const t=this._dataView.getFloat32(this._pos,!0);return this._skip(4),t}getString(){const t=this._getLength(),e=this._pos,i=this._toString(this._data,e,e+t);return this._skip(t),i}getBytes(){const t=this._getLength(),e=this._pos,i=this._toBytes(this._data,e,e+t);return this._skip(t),i}getLength(){return this._getLengthUnsafe()}processMessageWithArgs(t,e,i,s){const r=this.getMessage(),n=t(r,e,i,s);return r.release(),n}processMessage(t){const e=this.getMessage(),i=t(e);return e.release(),i}getMessage(){const t=this._getLength(),e=c.pool.acquire();return e._init(this._data,this._dataView,this._pos,this._pos+t),this._skip(t),e}release(){c.pool.release(this)}dataType(){return this._dataType}skip(){switch(this._dataType){case s.varint:this._decodeVarint();break;case s.fixed64:this._skip(8);break;case s.delimited:this._skip(this._getLength());break;case s.fixed32:this._skip(4);break;default:throw new Error("Invalid data type!")}}skipLen(t){this._skip(t)}_skip(t){if(this._pos+t>this._end)throw new Error("Attempt to skip past the end of buffer!");this._pos+=t}_decodeVarint(){const t=this._data;let e=this._pos,i=0,s=0;if(this._end-e>=10)do{if(s=t[e++],i|=127&s,!(128&s)||(s=t[e++],i|=(127&s)<<7,!(128&s))||(s=t[e++],i|=(127&s)<<14,!(128&s))||(s=t[e++],i|=(127&s)<<21,!(128&s))||(s=t[e++],i+=268435456*(127&s),!(128&s))||(s=t[e++],i+=34359738368*(127&s),!(128&s))||(s=t[e++],i+=4398046511104*(127&s),!(128&s))||(s=t[e++],i+=562949953421312*(127&s),!(128&s))||(s=t[e++],i+=72057594037927940*(127&s),!(128&s))||(s=t[e++],i+=0x8000000000000000*(127&s),!(128&s)))break;throw new Error("Varint too long!")}while(0);else{let r=1;for(;e!==this._end&&(s=t[e],128&s);)++e,i+=(127&s)*r,r*=128;if(e===this._end)throw new Error("Varint overrun!");++e,i+=s*r}return this._pos=e,i}_decodeSVarint(){const t=this._data;let e,i=0,s=0;const r=1&t[this._pos];if(s=t[this._pos++],i|=127&s,!(128&s)||(s=t[this._pos++],i|=(127&s)<<7,!(128&s))||(s=t[this._pos++],i|=(127&s)<<14,!(128&s))||(s=t[this._pos++],i|=(127&s)<<21,!(128&s))||(s=t[this._pos++],i+=268435456*(127&s),!(128&s))||(s=t[this._pos++],i+=34359738368*(127&s),!(128&s))||(s=t[this._pos++],i+=4398046511104*(127&s),!(128&s)))return r?-(i+1)/2:i/2;if(e=BigInt(i),s=t[this._pos++],e+=0x2000000000000n*BigInt(127&s),!(128&s)||(s=t[this._pos++],e+=0x100000000000000n*BigInt(127&s),!(128&s))||(s=t[this._pos++],e+=0x8000000000000000n*BigInt(127&s),!(128&s)))return Number(r?-(e+1n)/2n:e/2n);throw new Error("Varint too long!")}_getLength(){if(this._dataType!==s.delimited)throw new Error("Not a delimited data type!");return this._decodeVarint()}_getLengthUnsafe(){return this.getUInt32()}_toString(t,e,i){if((i=Math.min(this._end,i))-e>a){const s=t.subarray(e,i);return o.decode(s)}let s="",r="";for(let n=e;n<i;++n){const e=t[n];128&e?r+="%"+e.toString(16):(s+=decodeURIComponent(r)+String.fromCharCode(e),r="")}return r.length&&(s+=decodeURIComponent(r)),s}_toBytes(t,e,i){return i=Math.min(this._end,i),new Uint8Array(t.buffer,e,i-e)}}c.pool=new r.aB(c,void 0,(t=>{t._data=null,t._dataView=null}))}}]);
//# sourceMappingURL=2137.ca6e0de3.js.map