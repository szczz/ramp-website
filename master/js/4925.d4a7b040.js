"use strict";(self["webpackChunkramp_website"]=self["webpackChunkramp_website"]||[]).push([[4925],{92146:function(t,e,a){a.d(e,{a:function(){return ot},d:function(){return ft},f:function(){return mt}});var n=a(98503),s=a(81612),i=a(41470),r=a(30),o=a(46490),l=a(54396),c=a(40879),u=a(80774),h=a(57502),f=a(69852),m=a(42614),d=a(85047),p=a(64027);function y(t){const e=x(w(t)),a=e,s=!0,i=Math.max(e/2,5),r=Math.round((0,n.be)(t.maxPathLength)/i)+1,o=10,{density:l}=t;return{smoothing:(0,n.be)(t.smoothing),interpolate:!0,velocityScale:"flow-from"===t.flowRepresentation?1:-1,verticesPerLine:r,minSpeedThreshold:.001,segmentLength:i,maxTurnAngle:1,collisions:s,lineCollisionWidth:a,lineSpacing:o,density:l}}function x(t){return"constant"===t.kind?t.value[0]:t.values[t.values.length-1]}function g(t){const e=t.toRgba();return[e[0]/255,e[1]/255,e[2]/255,e[3]]}function _(t){return{kind:"constant",value:[.1,.1,.1,1]}}function w(t){if(!t.hasVisualVariables("size"))return{kind:"constant",value:[(0,n.be)(t.trailWidth)]};const e=t.getVisualVariablesForType("size")[0],a=[],s=[];let i;if(e.stops){for(const t of e.stops)a.push(t.value),s.push((0,n.be)(t.size));i=e.stops.length}else a.push(e.minDataValue,e.maxDataValue),s.push((0,n.be)(e.minSize),(0,n.be)(e.maxSize)),i=2;return{kind:"ramp",stops:a,values:s,count:i}}function v(t){if(!t.hasVisualVariables("color"))return{kind:"constant",value:g(t.color)};const e=t.getVisualVariablesForType("color")[0],a=[],n=[];for(const s of e.stops)a.push(s.value),Array.prototype.push.apply(n,g(s.color));return{kind:"ramp",stops:a,values:n,count:e.stops.length}}function b(t){if(!t.hasVisualVariables("opacity"))return{kind:"constant",value:[1]};const e=t.getVisualVariablesForType("opacity")[0],a=[],n=[];for(const s of e.stops)a.push(s.value),n.push(s.opacity);return{kind:"ramp",stops:a,values:n,count:e.stops.length}}function M(t,e,a,n){switch(e){case"int":t.setUniform1iv(a,n);break;case"float":t.setUniform1fv(a,n);break;case"vec2":t.setUniform2fv(a,n);break;case"vec3":t.setUniform3fv(a,n);break;case"vec4":t.setUniform4fv(a,n)}}function S(t,e,a,n){"constant"===n.kind?M(t,a,`u_${e}`,n.value):(M(t,"float",`u_${e}_stops`,n.stops),M(t,a,`u_${e}_values`,n.values),t.setUniform1i(`u_${e}_count`,n.count))}function R(t,e){let a=!0;return a=a&&t.collisions===e.collisions,a=a&&t.density===e.density,a=a&&t.interpolate===e.interpolate,a=a&&t.lineCollisionWidth===e.lineCollisionWidth,a=a&&t.lineSpacing===e.lineSpacing,a=a&&t.maxTurnAngle===e.maxTurnAngle,a=a&&t.minSpeedThreshold===e.minSpeedThreshold,a=a&&t.segmentLength===e.segmentLength,a=a&&t.smoothing===e.smoothing,a=a&&t.velocityScale===e.velocityScale,a=a&&t.verticesPerLine===e.verticesPerLine,a}function E(t,e){return t===e||null!=t&&null!=e&&t.equals(e)}function P(t,e){if(!R(t.simulationSettings,e.simulationSettings)||!E(t.timeExtent,e.timeExtent))return!1;let a=!0;return a=a&&t.loadImagery===e.loadImagery,a=a&&t.createFlowMesh===e.createFlowMesh,a=a&&t.color.kind===e.color.kind,a=a&&t.opacity.kind===e.opacity.kind,a=a&&t.size.kind===e.size.kind,a}let A=class t{constructor(t){this._params=t,this.animated=!1}isCompatible(e){if(!(e instanceof t)||!E(this._params.timeExtent,e._params.timeExtent))return!1;let a=!0;return a=a&&this._params.loadImagery===e._params.loadImagery,a=a&&this._params.color.kind===e._params.color.kind,a=a&&this._params.opacity.kind===e._params.opacity.kind,a}async load(t,e){const{extent:a,size:s}=t;(0,n.D)(e);const i=await this._params.loadImagery(a,s[0],s[1],this._params.timeExtent,e);return new T(i,{color:this._params.color,opacity:this._params.opacity})}render(t,e,a){const{context:n}=t,{program:s}=a;n.setFaceCullingEnabled(!1),n.setBlendingEnabled(!0),n.setBlendFunction(i.R.ONE,i.R.ONE_MINUS_SRC_ALPHA),n.useProgram(s),s.setUniformMatrix3fv("u_dvsMat3",e.dvsMat3),n.bindTexture(a.texture,0),s.setUniform1i("u_texture",0),s.setUniform1f("u_Min",a.min),s.setUniform1f("u_Max",a.max),S(s,"color","vec4",this._params.color),S(s,"opacity","float",this._params.opacity),n.bindVAO(a.vertexArray),n.drawArrays(i.E.TRIANGLE_STRIP,0,4)}};const k=new Map;k.set("a_position",0),k.set("a_texcoord",1);const C=new Map([["geometry",[new l.t("a_position",2,i.C.UNSIGNED_SHORT,0,8),new l.t("a_texcoord",2,i.C.UNSIGNED_SHORT,4,8)]]]),D={vsPath:"raster/flow/imagery",fsPath:"raster/flow/imagery",attributes:k};class T{constructor(t,e){this._flowData=t,this._values=e}attach(t){const{context:e}=t,{width:a,height:n}=this._flowData,l=s.E.createVertex(e,i.F.STATIC_DRAW,new Uint16Array([0,0,0,1,a,0,1,1,0,n,0,0,a,n,1,0])),c=new Map([["geometry",l]]),u=new o.o(e,k,C,c),h=[];"ramp"===this._values.color.kind&&h.push("vvColor"),"ramp"===this._values.opacity.kind&&h.push("vvOpacity");const f=t.painter.materialManager.getProgram(D,h);let m=1e6,d=-1e6;for(let s=0;s<n;s++)for(let t=0;t<a;t++)if(0!==this._flowData.mask[s*a+t]){const e=this._flowData.data[2*(s*a+t)],n=this._flowData.data[2*(s*a+t)+1],i=Math.sqrt(e*e+n*n);m=Math.min(m,i),d=Math.max(d,i)}const p=new Uint8Array(4*a*n);for(let s=0;s<n;s++)for(let t=0;t<a;t++)if(0!==this._flowData.mask[s*a+t]){const e=this._flowData.data[2*(s*a+t)],n=this._flowData.data[2*(s*a+t)+1],i=(Math.sqrt(e*e+n*n)-m)/(d-m);p[4*(s*a+t)]=255*i,p[4*(s*a+t)+1]=0,p[4*(s*a+t)+2]=0,p[4*(s*a+t)+3]=255}else p[4*(s*a+t)]=0,p[4*(s*a+t)+1]=0,p[4*(s*a+t)+2]=0,p[4*(s*a+t)+3]=0;const y=new r.p;y.internalFormat=i.G.RGBA,y.wrapMode=i.D.CLAMP_TO_EDGE,y.flipped=!0,y.width=a,y.height=n;const x=new r.m(e,y,p);this.vertexArray=u,this.program=f,this.texture=x,this.min=m,this.max=d,this._flowData=null}detach(){this.vertexArray.dispose(),this.texture.dispose()}get ready(){return this.program.compiled}}let z=class t{constructor(t){this._params=t}get animated(){return this._params.flowSpeed>0}isCompatible(e){return e instanceof t&&P(this._params,e._params)}async load(t,e){const{extent:a,size:s}=t;(0,n.D)(e);const i=await this._params.loadImagery(a,s[0],s[1],this._params.timeExtent,e),{vertexData:r,indexData:o}=await this._params.createFlowMesh("Particles",this._params.simulationSettings,i,e);return new F(r,o,{color:this._params.color,opacity:this._params.opacity,size:this._params.size})}render(t,e,a){const{context:n}=t,{program:s}=a;n.setFaceCullingEnabled(!1),n.setBlendingEnabled(!0),n.setBlendFunction(i.R.ONE,i.R.ONE_MINUS_SRC_ALPHA),n.useProgram(s),s.setUniform1f("u_time",e.time),s.setUniform1f("u_trailLength",this._params.trailLength),s.setUniform1f("u_flowSpeed",this._params.flowSpeed),s.setUniform1f("u_featheringSize",this._params.featheringSize),s.setUniform1f("u_featheringOffset",this._params.featheringOffset),s.setUniform1f("u_introFade",this._params.introFade?1:0),s.setUniform1f("u_fadeToZero",this._params.fadeToZero?1:0),s.setUniform1f("u_decayRate",this._params.decayRate),s.setUniformMatrix3fv("u_dvsMat3",e.dvsMat3),s.setUniformMatrix3fv("u_displayViewMat3",e.displayViewMat3),S(s,"color","vec4",this._params.color),S(s,"opacity","float",this._params.opacity),S(s,"size","float",this._params.size),n.bindVAO(a.vertexArray),n.drawElements(i.E.TRIANGLES,a.indexCount,i.C.UNSIGNED_INT,0)}};const O=new Map;O.set("a_xyts0",0),O.set("a_xyts1",1),O.set("a_typeIdDurationSeed",2),O.set("a_extrudeInfo",3);const I=new Map([["geometry",[new l.t("a_xyts0",4,i.C.FLOAT,0,64),new l.t("a_xyts1",4,i.C.FLOAT,16,64),new l.t("a_typeIdDurationSeed",4,i.C.FLOAT,32,64),new l.t("a_extrudeInfo",4,i.C.FLOAT,48,64)]]]),N={vsPath:"raster/flow/particles",fsPath:"raster/flow/particles",attributes:O};let F=class{constructor(t,e,a){this._vertexData=t,this._indexData=e,this._values=a}attach(t){const{context:e}=t,a=s.E.createVertex(e,i.F.STATIC_DRAW,this._vertexData),n=s.E.createIndex(e,i.F.STATIC_DRAW,this._indexData),r=new Map([["geometry",a]]),l=new o.o(e,O,I,r,n),c=[];"ramp"===this._values.color.kind&&c.push("vvColor"),"ramp"===this._values.opacity.kind&&c.push("vvOpacity"),"ramp"===this._values.size.kind&&c.push("vvSize");const u=t.painter.materialManager.getProgram(N,c);this.vertexArray=l,this.program=u,this.indexCount=this._indexData.length,this._vertexData=null,this._indexData=null}detach(){this.vertexArray.dispose()}get ready(){return this.program.compiled}},V=class t{constructor(t){this._styles=t}get animated(){return this._styles.reduce(((t,e)=>t||e.animated),!1)}isCompatible(e){if(!(e instanceof t)||this._styles.length!==e._styles.length)return!1;const a=this._styles.length;for(let t=0;t<a;t++)if(!this._styles[t].isCompatible(e._styles[t]))return!1;return!0}async load(t,e){const a=await Promise.all(this._styles.map((a=>a.load(t,e))));return new U(a)}render(t,e,a){for(let n=0;n<this._styles.length;n++)this._styles[n].render(t,e,a.resources[n])}},U=class{constructor(t){this.resources=t}attach(t){for(const e of this.resources)e.attach(t)}detach(){for(const t of this.resources)t.detach()}get ready(){return this.resources.reduce(((t,e)=>t&&e.ready),!0)}};class G{constructor(t){this._params=t}get animated(){return this._params.flowSpeed>0}isCompatible(t){return t instanceof G&&P(this._params,t._params)}async load(t,e){const{extent:a,size:s}=t;(0,n.D)(e);const i=await this._params.loadImagery(a,s[0],s[1],this._params.timeExtent,e),{vertexData:r,indexData:o}=await this._params.createFlowMesh("Streamlines",this._params.simulationSettings,i,e);return new j(r,o,{color:this._params.color,opacity:this._params.opacity,size:this._params.size})}render(t,e,a){const{context:n}=t,{program:s}=a;n.setFaceCullingEnabled(!1),n.setBlendingEnabled(!0),n.setBlendFunction(i.R.ONE,i.R.ONE_MINUS_SRC_ALPHA),n.useProgram(s),s.setUniform1f("u_time",e.time),s.setUniform1f("u_trailLength",this._params.trailLength),s.setUniform1f("u_flowSpeed",this._params.flowSpeed),s.setUniform1f("u_featheringSize",this._params.featheringSize),s.setUniform1f("u_featheringOffset",this._params.featheringOffset),s.setUniform1f("u_introFade",this._params.introFade?1:0),s.setUniform1f("u_fadeToZero",this._params.fadeToZero?1:0),s.setUniform1f("u_decayRate",this._params.decayRate),s.setUniformMatrix3fv("u_dvsMat3",e.dvsMat3),s.setUniformMatrix3fv("u_displayViewMat3",e.displayViewMat3),S(s,"color","vec4",this._params.color),S(s,"opacity","float",this._params.opacity),S(s,"size","float",this._params.size),n.bindVAO(a.vertexArray),n.drawElements(i.E.TRIANGLES,a.indexCount,i.C.UNSIGNED_INT,0)}}const L=new Map;L.set("a_positionAndSide",0),L.set("a_timeInfo",1),L.set("a_extrude",2),L.set("a_speed",3);const q=new Map([["geometry",[new l.t("a_positionAndSide",3,i.C.FLOAT,0,36),new l.t("a_timeInfo",3,i.C.FLOAT,12,36),new l.t("a_extrude",2,i.C.FLOAT,24,36),new l.t("a_speed",1,i.C.FLOAT,32,36)]]]),W={vsPath:"raster/flow/streamlines",fsPath:"raster/flow/streamlines",attributes:L};let j=class{constructor(t,e,a){this._vertexData=t,this._indexData=e,this._values=a}attach(t){const{context:e}=t,a=s.E.createVertex(e,i.F.STATIC_DRAW,this._vertexData),n=s.E.createIndex(e,i.F.STATIC_DRAW,this._indexData),r=new Map([["geometry",a]]),l=new o.o(e,L,q,r,n),c=[];"ramp"===this._values.color.kind&&c.push("vvColor"),"ramp"===this._values.opacity.kind&&c.push("vvOpacity"),"ramp"===this._values.size.kind&&c.push("vvSize");const u=t.painter.materialManager.getProgram(W,c);this.vertexArray=l,this.program=u,this.indexCount=this._indexData.length,this._vertexData=null,this._indexData=null}detach(){this.vertexArray.dispose()}get ready(){return this.program.compiled}};const B=4,K=1,H=.5,Y=!0,J=!0,Z=2.3;function $(t,e){const{flowSpeed:a,trailLength:n}=t,s=y(t);let i=null;const r={opacity:b(t),size:w(t)};let o=v(t);if("none"===t.background)r.color=o;else{"constant"===o.kind&&(o={kind:"ramp",stops:[0,1],values:[0,0,0,1,o.value[0],o.value[1],o.value[2],o.value[3]],count:2});const t={loadImagery:e.loadImagery,timeExtent:e.timeExtent,color:o,opacity:{kind:"constant",value:[1]}};i=new A(t),r.color=_()}const l={loadImagery:e.loadImagery,createFlowMesh:e.createFlowMesh,simulationSettings:s,timeExtent:e.timeExtent,trailLength:n,flowSpeed:a,featheringSize:K,featheringOffset:H,introFade:Y,fadeToZero:J,decayRate:Z,color:r.color,opacity:r.opacity,size:r.size},c="butt"===t.trailCap||x(w(t))<=B?new G(l):new z(l);return null!=i?new V([i,c]):c}class Q extends h.e{constructor(){super(...arguments),this._visualState={time:0,dvsMat3:(0,u.e)(),displayViewMat3:(0,u.e)()}}dispose(){}prepareState(t){const{context:e}=t;e.setColorMask(!0,!0,!0,!0),e.setStencilFunction(i.O.EQUAL,0,255)}draw(t,e){const{requestRender:a,allowDelayedRender:n}=t,{displayData:s}=e;if(null==s||("loaded"===s.state.name&&s.attach(t),"attached"!==s.state.name))return;const i=s.state.resources;!n||i.ready||null==a?(this._visualState.time=t.time/1e3,this._visualState.dvsMat3=e.transforms.displayViewScreenMat3,this._visualState.displayViewMat3=t.state.displayViewMat3,s.flowStyle.render(t,this._visualState,i),s.flowStyle.animated&&null!=a&&a()):a()}}class X extends h.n{constructor(){super(...arguments),this.flowStyle=null}doRender(t){super.doRender(t)}prepareRenderPasses(t){const e=t.registerRenderPass({name:"flow",brushes:[Q],target:()=>this.children,drawPhase:u.E.MAP});return[...super.prepareRenderPasses(t),e]}}class tt{constructor(t,e,a,n){this.state={name:"created"},this.flowStyle=t,this.extent=e,this.size=a,this.pixelRatio=n}async load(){const t=new AbortController;this.state={name:"loading",abortController:t};const e={extent:this.extent,size:this.size,pixelRatio:this.pixelRatio},a=await this.flowStyle.load(e,t.signal);this.state={name:"loaded",resources:a}}attach(t){if("loaded"!==this.state.name)return void n.n.getLogger("esri.views.2d.engine.flow.FlowDisplayData").error("Only loaded resources can be attached.");const e=this.state.resources;e.attach(t),this.state={name:"attached",resources:e}}detach(){if("loading"===this.state.name)return this.state.abortController.abort(),void(this.state={name:"detached"});"attached"===this.state.name&&(this.state.resources.detach(),this.state={name:"detached"})}update(t){return!!this.flowStyle.isCompatible(t.flowStyle)&&(!(!this.extent.equals(t.extent)||this.size[0]!==t.size[0]||this.size[1]!==t.size[1]||this.pixelRatio!==t.pixelRatio)&&(this.flowStyle=t.flowStyle,!0))}}class et extends m.e{constructor(){super(...arguments),this._displayData=null}get displayData(){return this._displayData}set displayData(t){this._displayData=t,this.requestRender()}clear(){null!=this._displayData&&(this._displayData.detach(),this._displayData=null,this.requestRender())}setTransform(t){const{displayData:e}=this;if(null==e)return;const a=e.extent.xmin,s=e.extent.ymax,i=[0,0];t.toScreen(i,[a,s]);const r=(e.extent.xmax-e.extent.xmin)/e.size[0]/t.resolution,o=(0,n.eI)(t.rotation),{displayViewScreenMat3:l}=this.transforms;(0,f.l)(l,[-1,1,0]),(0,f.f)(l,l,[2/(t.size[0]*t.pixelRatio),-2/(t.size[1]*t.pixelRatio),1]),(0,f.M)(l,l,[i[0],i[1],0]),(0,f.h)(l,l,o),(0,f.f)(l,l,[r*t.pixelRatio,r*t.pixelRatio,1])}_createTransforms(){return{displayViewScreenMat3:(0,u.e)()}}}const at=1.15;let nt=class extends n.aD{constructor(t){super(t),this._flowDisplayObject=new et,this._loading=null}initialize(){this.flowContainer.addChild(this._flowDisplayObject)}destroy(){this._clear(),this.flowContainer.removeAllChildren()}get updating(){return null!=this._loading}update(t){const{flowStyle:e}=this.flowContainer;if(null==e)return void this._clear();const{extent:a,rotation:s,resolution:i,pixelRatio:r}=t.state,o=it(a,s);o.expand(at);const l=[Math.round((o.xmax-o.xmin)/i),Math.round((o.ymax-o.ymin)/i)],c=new tt(e,o,l,r);if(null!=this._loading){if(this._loading.update(c))return;this._loading.detach(),this._loading=null}null!=this._flowDisplayObject.displayData&&this._flowDisplayObject.displayData.update(c)||(c.load().then((()=>{this._flowDisplayObject.clear(),this._flowDisplayObject.displayData=this._loading,this._loading=null}),(t=>{(0,n.E)(t)||(n.n.getLogger(this).error("A resource failed to load.",t),this._loading=null)})),this._loading=c)}_clear(){this._flowDisplayObject.clear(),null!=this._loading&&(this._loading.detach(),this._loading=null)}};(0,n.k)([(0,n.o)()],nt.prototype,"_loading",void 0),(0,n.k)([(0,n.o)()],nt.prototype,"flowContainer",void 0),(0,n.k)([(0,n.o)()],nt.prototype,"updating",null),nt=(0,n.k)([(0,n.A)("esri.views.2d.engine.flow.FlowStrategy")],nt);const st=nt;function it(t,e){const a=new n.bv({x:(t.xmax+t.xmin)/2,y:(t.ymax+t.ymin)/2,spatialReference:t.spatialReference}),s=t.xmax-t.xmin,i=t.ymax-t.ymin,r=Math.abs(Math.cos((0,n.eI)(e))),o=Math.abs(Math.sin((0,n.eI)(e))),l=r*s+o*i,c=o*s+r*i,u=new n.au({xmin:a.x-l/2,ymin:a.y-c/2,xmax:a.x+l/2,ymax:a.y+c/2,spatialReference:t.spatialReference});return u.centerAt(a),u}let rt=class extends n.aD{constructor(){super(...arguments),this._loadImagery=(t,e,a,n,s)=>(0,c.a)(this.layer,t,e,a,n,s),this._createFlowMesh=(t,e,a,n)=>this.layer.createFlowMesh({meshType:t,flowData:a,simulationSettings:e},{signal:n}),this.attached=!1,this.type="flow",this.timeExtent=null,this.redrawOrRefetch=async()=>{this._updateVisualization()}}get updating(){return!this.attached||this._strategy.updating}attach(){const{layer:t}=this,e=()=>{this._loadImagery=(e,a,n,s,i)=>(0,c.a)(t,e,a,n,s,i),this._updateVisualization()};"multidimensionalDefinition"in t?this.addHandles((0,n.aE)((()=>t.multidimensionalDefinition),e)):this.addHandles([(0,n.aE)((()=>t.mosaicRule),e),(0,n.aE)((()=>t.rasterFunction),e),(0,n.aE)((()=>t.definitionExpression),e)]),this.container=new X,this._strategy=new st({flowContainer:this.container}),this._updateVisualization()}detach(){this._strategy.destroy(),this.container?.removeAllChildren(),this.container=null,this.removeHandles()}update(t){t.stationary?this._strategy.update(t):this.layerView.requestUpdate()}hitTest(t){return new n.b1({attributes:{},geometry:t.clone(),layer:this.layer})}moveEnd(){}async doRefresh(){}_updateVisualization(){const t=this.layer.renderer;if(null==t||"flow"!==t.type)return;const e=$(t,{loadImagery:this._loadImagery,createFlowMesh:this._createFlowMesh,timeExtent:this.timeExtent});this.container.flowStyle=e,this.layerView.requestUpdate()}};(0,n.k)([(0,n.o)()],rt.prototype,"_strategy",void 0),(0,n.k)([(0,n.o)()],rt.prototype,"attached",void 0),(0,n.k)([(0,n.o)()],rt.prototype,"container",void 0),(0,n.k)([(0,n.o)()],rt.prototype,"layer",void 0),(0,n.k)([(0,n.o)()],rt.prototype,"layerView",void 0),(0,n.k)([(0,n.o)()],rt.prototype,"type",void 0),(0,n.k)([(0,n.o)()],rt.prototype,"updating",null),(0,n.k)([(0,n.o)()],rt.prototype,"timeExtent",void 0),rt=(0,n.k)([(0,n.A)("esri.views.2d.engine.flow.FlowView2D")],rt);const ot=rt,lt=new Float32Array([.27058823529411763,.4588235294117647,.7098039215686275,1,.396078431372549,.5372549019607843,.7215686274509804,1,.5176470588235295,.6196078431372549,.7294117647058823,1,.6352941176470588,.7058823529411765,.7411764705882353,1,.7529411764705882,.8,.7450980392156863,1,.8705882352941177,.8901960784313725,.7490196078431373,1,1,1,.7490196078431373,1,1,.8627450980392157,.6313725490196078,1,.9803921568627451,.7254901960784313,.5176470588235295,1,.9607843137254902,.596078431372549,.4117647058823529,1,.9294117647058824,.4588235294117647,.3176470588235294,1,.9098039215686274,.08235294117647059,.08235294117647059,1]),ct=new Float32Array([0,92/255,230/255,1]),ut={beaufort_ft:lt,beaufort_m:lt,beaufort_km:lt,beaufort_mi:lt,beaufort_kn:new Float32Array([.1568627450980392,.5725490196078431,.7803921568627451,1,.34901960784313724,.6352941176470588,.7294117647058823,1,.5058823529411764,.7019607843137254,.6705882352941176,1,.6274509803921569,.7607843137254902,.6078431372549019,1,.7490196078431373,.8313725490196079,.5411764705882353,1,.8549019607843137,.9019607843137255,.4666666666666667,1,.9803921568627451,.9803921568627451,.39215686274509803,1,.9882352941176471,.8352941176470589,.3254901960784314,1,.9882352941176471,.7019607843137254,.4,1,.9803921568627451,.5529411764705883,.20392156862745098,1,.9686274509803922,.43137254901960786,.16470588235294117,1,.9411764705882353,.2784313725490196,.11372549019607843,1]),classified_arrow:new Float32Array([.2196078431372549,.6588235294117647,0,1,.5450980392156862,1.2117647058823529,0,1,1,1,0,1,1,.5019607843137255,0,1,1,0,0,1]),ocean_current_m:new Float32Array([.3058823529411765,.10196078431372549,.6,1,.7019607843137254,.10588235294117647,.10196078431372549,1,.792156862745098,.5019607843137255,.10196078431372549,1,.6941176470588235,.6941176470588235,.6941176470588235,1]),ocean_current_kn:new Float32Array([0,0,0,1,0,.1450980392156863,.39215686274509803,1,.3058823529411765,.10196078431372549,.6,1,.592156862745098,0,.39215686274509803,1,.7019607843137254,.10588235294117647,.10196078431372549,1,.6941176470588235,.3058823529411765,.10196078431372549,1,.792156862745098,.5019607843137255,.10196078431372549,1,.6941176470588235,.7019607843137254,.20392156862745098,1,.6941176470588235,.6941176470588235,.6941176470588235,1]),simple_scalar:ct,single_arrow:ct,wind_speed:new Float32Array([0,0,0,1])},ht=[0,20];class ft extends h.e{constructor(){super(...arguments),this._desc={magdir:{vsPath:"raster/magdir",fsPath:"raster/magdir",attributes:new Map([["a_pos",0],["a_offset",1],["a_vv",2]])},scalar:{vsPath:"raster/scalar",fsPath:"raster/scalar",attributes:new Map([["a_pos",0],["a_offset",1],["a_vv",2]])}}}dispose(){}prepareState({context:t}){t.setBlendingEnabled(!0),t.setBlendFunctionSeparate(i.R.ONE,i.R.ONE_MINUS_SRC_ALPHA,i.R.ONE,i.R.ONE_MINUS_SRC_ALPHA),t.setColorMask(!0,!0,!0,!0),t.setStencilWriteMask(0),t.setStencilTestEnabled(!0),t.setStencilOp(i.I.KEEP,i.I.KEEP,i.I.REPLACE)}draw(t,e){if(null==e.source||0===e.source.validPixelCount)return;const{context:a,timeline:n}=t;if(n.begin(this.name),a.setStencilFunction(i.O.EQUAL,e.stencilRef,255),e.updateVectorFieldVAO(t),"scalar"===t.renderPass){const a=e.vaoData.scalar;a&&this._drawScalars(t,e,a.vao,a.elementCount)}else{const a=e.vaoData.magdir;a&&this._drawTriangles(t,e,a.vao,a.elementCount)}n.end(this.name)}_drawTriangles(t,e,a,n){const{context:s,painter:r,requestRender:o,allowDelayedRender:l}=t,{symbolizerParameters:c}=e,u=c.dataRange?["dataRange"]:[];"geographic"===c.rotationType&&u.push("rotationGeographic");const h=r.materialManager.getProgram(this._desc.magdir,u);if(l&&null!=o&&!h.compiled)return void o();s.useProgram(h);const{coordScale:f,opacity:m,transforms:d}=e;h.setUniform2fv("u_coordScale",f),h.setUniform1f("u_opacity",m),h.setUniformMatrix3fv("u_dvsMat3",d.displayViewScreenMat3);const{style:p,dataRange:y,rotation:x,symbolPercentRange:g}=c;h.setUniform4fv("u_colors",ut[p]),h.setUniform2fv("u_dataRange",y||ht),h.setUniform1f("u_rotation",x),h.setUniform2fv("u_symbolPercentRange",g);const _=this._getSymbolSize(t,e);h.setUniform2fv("u_symbolSize",_),s.bindVAO(a),s.drawElements(i.E.TRIANGLES,n,i.C.UNSIGNED_INT,0)}_drawScalars(t,e,a,n){const{context:s,painter:r,requestRender:o,allowDelayedRender:l}=t,{symbolizerParameters:c}=e,u=[];"wind_speed"===c.style?u.push("innerCircle"):c.dataRange&&u.push("dataRange"),"geographic"===c.rotationType&&u.push("rotationGeographic");const h=r.materialManager.getProgram(this._desc.scalar,u);if(l&&null!=o&&!h.compiled)return void o();s.useProgram(h);const{coordScale:f,opacity:m,transforms:d}=e;h.setUniform2fv("u_coordScale",f),h.setUniform1f("u_opacity",m),h.setUniformMatrix3fv("u_dvsMat3",d.displayViewScreenMat3);const{dataRange:p,symbolPercentRange:y}=c;h.setUniform2fv("u_dataRange",p||ht),h.setUniform2fv("u_symbolPercentRange",y);const x=this._getSymbolSize(t,e);h.setUniform2fv("u_symbolSize",x),s.bindVAO(a),s.drawElements(i.E.TRIANGLES,n,i.C.UNSIGNED_INT,0)}_getSymbolSize(t,e){const a=e.key?2**(t.displayLevel-e.key.level):e.resolution/t.state.resolution,{symbolTileSize:n}=e.symbolizerParameters;return[n/(Math.round((e.width-e.offset[0])/n)*n)/a,n/(Math.round((e.height-e.offset[1])/n)*n)/a]}}class mt extends m.e{constructor(t=null){super(),this._source=null,this._symbolizerParameters=null,this._vaoInvalidated=!0,this.coordScale=[1,1],this.height=null,this.key=null,this.offset=null,this.stencilRef=0,this.resolution=null,this.pixelRatio=1,this.x=0,this.y=0,this.rotation=0,this.rawPixelData=null,this.vaoData=null,this.width=null,this.source=t}destroy(){null!=this.vaoData&&(this.vaoData.magdir?.vao.dispose(),this.vaoData.scalar?.vao.dispose(),this.vaoData=null)}get symbolizerParameters(){return this._symbolizerParameters}set symbolizerParameters(t){JSON.stringify(this._symbolizerParameters)!==JSON.stringify(t)&&(this._symbolizerParameters=t,this.invalidateVAO())}get source(){return this._source}set source(t){this._source=t,this.invalidateVAO()}invalidateVAO(){this._vaoInvalidated||null==this.vaoData||(this.vaoData.magdir?.vao.dispose(),this.vaoData.scalar?.vao.dispose(),this.vaoData=null,this._vaoInvalidated=!0,this.requestRender())}updateVectorFieldVAO(t){if(this._vaoInvalidated){if(this._vaoInvalidated=!1,null!=this.source&&null==this.vaoData){const{style:e}=this.symbolizerParameters;switch(e){case"beaufort_ft":case"beaufort_km":case"beaufort_kn":case"beaufort_m":case"beaufort_mi":case"classified_arrow":case"ocean_current_kn":case"ocean_current_m":case"single_arrow":{const e=(0,c.b)(this.source,this.symbolizerParameters),a=this._createVectorFieldVAO(t.context,e);this.vaoData={magdir:a}}break;case"simple_scalar":{const e=(0,c._)(this.source,this.symbolizerParameters),a=this._createVectorFieldVAO(t.context,e);this.vaoData={scalar:a}}break;case"wind_speed":{const e=(0,c.b)(this.source,this.symbolizerParameters),a=this._createVectorFieldVAO(t.context,e),n=(0,c._)(this.source,this.symbolizerParameters),s=this._createVectorFieldVAO(t.context,n);this.vaoData={magdir:a,scalar:s}}}}this.ready(),this.requestRender()}}_createTransforms(){return{displayViewScreenMat3:(0,u.e)()}}setTransform(t){const e=(0,f.o)(this.transforms.displayViewScreenMat3),[a,n]=t.toScreenNoRotation([0,0],[this.x,this.y]),s=this.resolution/this.pixelRatio/t.resolution,i=s*this.width,r=s*this.height,o=Math.PI*this.rotation/180;(0,f.M)(e,e,(0,d.t)(a,n)),(0,f.M)(e,e,(0,d.t)(i/2,r/2)),(0,f.h)(e,e,-o),(0,f.M)(e,e,(0,d.t)(-i/2,-r/2)),(0,f.b)(e,e,(0,d.t)(i,r)),(0,f.i)(this.transforms.displayViewScreenMat3,t.displayViewMat3,e)}onAttach(){this.invalidateVAO()}onDetach(){this.invalidateVAO()}_createVectorFieldVAO(t,e){const{vertexData:a,indexData:n}=e,r=s.E.createVertex(t,i.F.STATIC_DRAW,new Float32Array(a)),l=s.E.createIndex(t,i.F.STATIC_DRAW,new Uint32Array(n)),c=(0,p.b)("vector-field",{geometry:[{location:0,name:"a_pos",count:2,type:i.C.FLOAT,normalized:!1},{location:1,name:"a_offset",count:2,type:i.C.FLOAT,normalized:!1},{location:2,name:"a_vv",count:2,type:i.C.FLOAT,normalized:!1}]});return{vao:new o.o(t,c.attributes,c.bufferLayouts,new Map([["geometry",r]]),l),elementCount:n.length}}}},38020:function(t,e,a){a.d(e,{C:function(){return _},D:function(){return I},I:function(){return M},K:function(){return O},V:function(){return V},a:function(){return Y},c:function(){return Z},e:function(){return L},f:function(){return $},i:function(){return j},j:function(){return g},l:function(){return J},t:function(){return q},v:function(){return x},w:function(){return r}});var n,s=a(98503),i=a(49555);function r(t,e,a){return!(0,i.J)(t,e,a)}function o(t,e,a){const n=r(t,e,a);if(n&&!(0,i._)())throw new s.s("rasterprojectionhelper-project","projection engine is not loaded");return n}(function(t){t[t.None=0]="None",t[t.North=1]="North",t[t.South=2]="South",t[t.Both=3]="Both"})(n||(n={}));const l=(t,e,a,n=0)=>{if(1===a[0])return[0,0];let s=1,i=-1,r=1,o=-1;for(let y=0;y<t.length;y+=2)isNaN(t[y])||(s=s>t[y]?t[y]:s,i=i>t[y]?i:t[y],r=r>t[y+1]?t[y+1]:r,o=o>t[y+1]?o:t[y+1]);const{cols:l,rows:c}=e,u=(i-s)/l/a[0],h=(o-r)/c/a[1],f=2*n;let m=0,d=!1,p=[0,0];for(let y=0;y<l-3;y++){for(let e=0;e<c-3;e++){const a=y*c*2+2*e,n=(t[a]+t[a+4]+t[a+4*c]+t[a+4*c+4])/4,s=(t[a+1]+t[a+5]+t[a+4*c+1]+t[a+4*c+5])/4,i=Math.abs((n-t[a+2*c+2])/u),r=Math.abs((s-t[a+2*c+3])/h);if(i+r>m&&(m=i+r,p=[i,r]),f&&m>f){d=!0;break}}if(d)break}return p},c={3395:20037508.342789244,3410:17334193.943686873,3857:20037508.342788905,3975:17367530.445161372,4087:20037508.342789244,4088:20015108.787169147,6933:17367530.445161372,32662:20037508.342789244,53001:20015086.79602057,53002:10007543.39801029,53003:20015086.79602057,53004:20015086.79602057,53016:14152803.599503474,53017:17333573.624304302,53034:20015086.79602057,53079:20015114.352186374,53080:20015114.352186374,54001:20037508.342789244,54002:10018754.171394624,54003:20037508.342789244,54004:20037508.342789244,54016:14168658.027268292,54017:17367530.44516137,54034:20037508.342789244,54079:20037508.342789244,54080:20037508.342789244,54100:20037508.342789244,54101:20037508.342789244},u=32,h=4,f=h,m=new Map,d=new Map,p=500;let y=null;async function x(){y&&(0,i._)()||((0,i._)()||await(0,i.W)(),y=await Promise.all([a.e(916),a.e(4803)]).then(a.bind(a,5498)))}function g(t,e,a){return o(t.spatialReference,e),a?(0,i.Y)(e,t.spatialReference,t):(0,i.Y)(t.spatialReference,e,t)}function _(t,e,a,n=null){const r=t.spatialReference;if(!r||!e||r.equals(e))return t;o(r,e,n);const l=a.center,c=new s.au({xmin:l.x-t.x/2,xmax:l.x+t.x/2,ymin:l.y-t.y/2,ymax:l.y+t.y/2,spatialReference:r}),u=(0,i.K)(c,e,n),h=V(e);return null==u||null!=h&&u.width>=h?w(t,r,e):{x:u.width,y:u.height}}function w(t,e,a){const n=(0,s.bq)(e)/(0,s.bq)(a);return{x:t.x*n,y:t.y*n}}function v(t,e,a){const{spatialReference:n}=a;if(!n||!e||n.equals(e))return t;if(n.isGeographic&&e.isGeographic)return w(t,n,e);if(o(n,e),!y)throw new s.s("raster-projection-helper:project-dataset-resolution","geometry engine is not loaded");let{x:r,y:l}=t;const c=(r+l)/2*(0,s.bq)(n);let u=1;c>30&&(u=30/c,r*=u,l*=u);const h=256,f=r*h/2,m=l*h/2,{x:d,y:p}=a.center,x=[];for(let s=0;s<=h;s++)x.push([d-f,p-m+s*l]);for(let s=1;s<=h;s++)x.push([d-f+s*r,p+m]);for(let s=1;s<=h;s++)x.push([d+f,p+m-s*l]);for(let s=1;s<h;s++)x.push([d+f-s*r,p-m]);x.push(x[0]);const g=new s.bC({rings:[x],spatialReference:n}),_=(0,i.K)(g,e);if(!_)return w(t,n,e);const v=_.extent,b=V(e);if(null==v||null!=b&&v.width>=b)return w(t,n,e);const M=y.planarArea(_),S=r*l*h*h,R=Math.sqrt(M/S)/u,E={x:v.width/u/h,y:v.height/u/h},P={x:r*R,y:l*R},A=E.x*E.y;return Math.abs(A-P.x*P.y)/A<.1?E:P}function b(t,e=.01){return(0,s.bq)(t)?e/(0,s.bq)(t):0}function M(t,e,a=null,n=!0){const s=t.spatialReference;if(s.equals(e))return t;o(s,e,a);const r=(0,i.K)(t,e,a);return n&&r&&S([t],[r],s,e),r}function S(t,e,a,n){const s=U(a,!0),i=U(n,!0),r=b(a,p),o=b(n,p);if(r&&null!=s&&null!=i)for(let l=0;l<t.length;l++){const a=e[l];if(!a)continue;const{x:n}=t[l],{x:c}=a;c>=i[1]-o&&Math.abs(n-s[0])<r?a.x-=i[1]-i[0]:c<=i[0]+o&&Math.abs(n-s[1])<r&&(a.x+=i[1]-i[0])}}function R(t){const{inSR:e,outSR:a,datumTransformation:n,preferPE:s}=t;if(e.equals(a)){const{points:e}=D(t,null);return e}return e.isWebMercator&&a.isWGS84||e.isWGS84&&a.isWebMercator?A(t):o(e,a,n)&&s&&(e.isGeographic||null!=k(e))?P(t):E(t)}function E(t){const{points:e}=D(t,null),{inSR:a,outSR:n,datumTransformation:r}=t,o=e.map((t=>new s.bv(t[0],t[1],a))),l=(0,i.K)(o,n,r);return r&&S(o,l,a,n),l.map((t=>t?[t.x,t.y]:[NaN,NaN]))}function P(t){const{inSR:e,outSR:a,datumTransformation:n}=t,i=k(e),{points:r,mask:o}=D(t,i);if(!e.isGeographic){const t=e.wkid?s.cq.coordsys(e.wkid):s.cq.fromString(e.isGeographic?s.cr.PE_TYPE_GEOGCS:s.cr.PE_TYPE_PROJCS,e.wkt2||e.wkt);s.cs.projToGeog(t,r.length,r)}if(null!=n&&n.steps.length){let t;if(a.isGeographic&&(t=r.map((([t])=>t>179.9955?1:t<-179.9955?-1:0))),n.steps.forEach((t=>{const e=t.wkid?s.cq.geogtran(t.wkid):s.cq.fromString(s.cr.PE_TYPE_GEOGTRAN,t.wkt);s.ct.geogToGeog(e,r.length,r,null,t.isInverse?s.cr.PE_TRANSFORM_2_TO_1:s.cr.PE_TRANSFORM_1_TO_2)})),t)for(let e=0;e<r.length;e++){const a=t[e],n=r[e][0],s=n>179.9955?1:n<-179.9955?-1:0;a&&s&&a!==s&&(r[e][0]=a>0?n+360:n-360)}}if(!a.isGeographic){const t=k(a,!0),e=null!=t&&t.isEnvelope?[t.bbox[1],t.bbox[3]]:[-90,90];T(r,e);const n=a.wkid?s.cq.coordsys(a.wkid):s.cq.fromString(a.isGeographic?s.cr.PE_TYPE_GEOGCS:s.cr.PE_TYPE_PROJCS,a.wkt2||a.wkt);s.cs.geogToProj(n,r.length,r)}let l=r;if(o&&r.length!==o.length){l=[];for(let t=0,e=0;t<o.length;t++)o[t]?l.push(r[e++]):l.push([NaN,NaN])}return l}function A(t){const{cols:e,rows:a,xres:n,yres:r,usePixelCenter:o,inSR:l,outSR:c}=t;let{xmin:u,ymax:h}=t;o&&(u+=n/2,h-=r/2);const f=[],m=[],d=Math.max(e,a);for(let y=0;y<d;y++){const t=u+n*Math.min(e,y),o=h-r*Math.min(a,y),d=(0,i.K)(new s.bv({x:t,y:o,spatialReference:l}),c);y<=e&&f.push(d.x),y<=a&&m.push(d.y)}const p=[];for(let s=0;s<e;s++)for(let t=0;t<a;t++)p.push([f[s],m[t]]);return p}function k(t,e=!1){let a=t.wkid||t.wkt2||t.wkt;if(!a||t.isGeographic)return null;if(a=String(a),m.has(a)){const t=m.get(a);return e?t?.gcs:t?.pcs}const n=t.wkid?s.cq.coordsys(t.wkid):s.cq.fromString(t.isGeographic?s.cr.PE_TYPE_GEOGCS:s.cr.PE_TYPE_PROJCS,t.wkt2||t.wkt),i=C(n,b(t,1e-4)),r=C(n,0,!0);return m.set(a,{pcs:i,gcs:r}),e?r:i}function C(t,e=0,a=!1){const n=s.cu.generate(t),i=a?t.horizonGcsGenerate():t.horizonPcsGenerate();if(!n||!i?.length)return null;let r=!1,o=i.find((t=>1===t.getInclusive()&&1===t.getKind()));if(!o){if(o=i.find((t=>1===t.getInclusive()&&0===t.getKind())),!o)return null;r=!0}const l=a?0:(2===n.getNorthPoleLocation()?1:0)|(2===n.getSouthPoleLocation()?2:0),c=n.isPannableRectangle(),u=o.getCoord();if(r)return{isEnvelope:r,isPannable:c,vertices:u,coef:null,bbox:[u[0][0]-e,u[0][1]-e,u[1][0]+e,u[1][1]+e],poleLocation:l};let h=0;const f=[];let[m,d]=u[0],[p,y]=u[0];for(let s=0,x=u.length;s<x;s++){h++,h===x&&(h=0);const[t,e]=u[s],[a,n]=u[h];if(n===e)f.push([t,a,e,n,2]);else{const s=(a-t)/(n-e||1e-4),i=t-s*e;e<n?f.push([s,i,e,n,0]):f.push([s,i,n,e,1])}m=m<t?m:t,d=d<e?d:e,p=p>t?p:t,y=y>e?y:e}return{isEnvelope:!1,isPannable:c,vertices:u,coef:f,bbox:[m,d,p,y],poleLocation:l}}function D(t,e){const a=[],{cols:n,rows:s,xres:i,yres:r,usePixelCenter:o}=t;let{xmin:l,ymax:c}=t;if(o&&(l+=i/2,c-=r/2),null==e){for(let t=0;t<n;t++)for(let e=0;e<s;e++)a.push([l+i*t,c-r*e]);return{points:a}}const u=new Uint8Array(n*s);if(e.isEnvelope){const{bbox:[t,o,h,f]}=e;for(let m=0,d=0;m<n;m++){const n=l+i*m,p=e.isPannable||n>=t&&n<=h;for(let t=0;t<s;t++,d++){const e=c-r*t;p&&e>=o&&e<=f&&(a.push([n,e]),u[d]=1)}}return{points:a,mask:u}}const h=e.coef,f=[];for(let m=0;m<s;m++){const t=c-r*m,e=[],a=[];for(let s=0;s<h.length;s++){const[n,i,r,o,l]=h[s];if(t===r&&r===o)e.push(n),e.push(i),a.push(2),a.push(2);else if(t>=r&&t<=o){const s=n*t+i;e.push(s),a.push(l)}}let n=e;if(e.length>2){let t=2===a[0]?0:a[0],s=e[0];n=[];for(let i=1;i<a.length;i++)2===a[i]&&i!==a.length-1||(a[i]!==t&&(n.push(0===t?Math.min(s,e[i-1]):Math.max(s,e[i-1])),t=a[i],s=e[i]),i===a.length-1&&n.push(0===a[i]?Math.min(s,e[i]):Math.max(s,e[i])));n.sort(((t,e)=>t-e))}else e[0]>e[1]&&(n=[e[1],e[0]]);f.push(n)}for(let m=0,d=0;m<n;m++){const t=l+i*m;for(let e=0;e<s;e++,d++){const n=c-r*e,s=f[e];if(2===s.length)t>=s[0]&&t<=s[1]&&(a.push([t,n]),u[d]=1);else if(s.length>2){let e=!1;for(let a=0;a<s.length;a+=2)if(t>=s[a]&&t<=s[a+1]){e=!0;break}e&&(a.push([t,n]),u[d]=1)}}}return{points:a,mask:u}}function T(t,e){const[a,n]=e;for(let s=0;s<t.length;s++){const e=t[s][1];(e<a||e>n)&&(t[s]=[NaN,NaN])}}function z(t,e){const a=V(t[0].spatialReference);if(t.length<2||null==a||(e=e??b(t[0].spatialReference),1===(t=t.filter((t=>t.width>e))).length))return t[0];let{xmin:n,xmax:i,ymin:r,ymax:o}=t[0];for(let s=1;s<t.length;s++){const e=t[s];i=e.xmax+a*s,r=Math.min(r,e.ymin),o=Math.max(o,e.ymax)}return new s.au({xmin:n,xmax:i,ymin:r,ymax:o,spatialReference:t[0].spatialReference})}function O(t,e,a=null,r=!0){const o=t.spatialReference;if(o.equals(e))return t;const l=L(t),c=V(o,!0),u=V(e);if(0===l||null==c||null==u){const s=F(t,e,a,r);if(null==c&&null!=u&&Math.abs(s.width-u)<b(e)&&(0,i._)()){const a=k(o);if(null!=a&&a.poleLocation===n.None&&t.width<(a.bbox[2]-a.bbox[0])/2)return N(t,e)||s}return s}const h=t.clone().normalize();if(1===h.length&&t.xmax<c&&t.xmax-c/2>b(o)){const{xmin:e,xmax:a}=t;for(let n=0;n<=l;n++){const i=0===n?e:-c/2,r=n===l?a-c*n:c/2;h[n]=new s.au({xmin:i,xmax:r,ymin:t.ymin,ymax:t.ymax,spatialReference:o})}}return z(h.map((t=>F(t,e,a,r))).filter(s.bQ))}function I(t,e,a){if("extent"===t.type){const{xmin:e,ymin:a,xmax:n,ymax:i,spatialReference:r}=t;t=new s.bC({rings:[[[e,i],[n,i],[n,a],[e,a],[e,i]]],spatialReference:r})}return t.spatialReference.equals(e)?t:(o(t.spatialReference,e,a),(0,i.K)(t,e,a))}function N(t,e){const a=V(e);if(null==a)return null;let{xmin:n,ymin:r,xmax:o,ymax:l}=t;const c=t.spatialReference,u=new s.bC({spatialReference:c,rings:[[[n,r],[o,r],[o,l],[n,l],[n,r]]]}),h=(0,i.K)(u,e);if(2!==h.rings.length||!h.rings[0].length||!h.rings[1].length)return null;const{rings:f}=h,m=b(c),d=new s.au({spatialReference:e});for(let s=0;s<2;s++){n=o=f[s][0][0],r=l=f[s][0][1];for(let t=0;t<f[s].length;t++)n=n>f[s][t][0]?f[s][t][0]:n,o=o<f[s][t][0]?f[s][t][0]:o,r=r>f[s][t][1]?f[s][t][1]:r,l=l<f[s][t][1]?f[s][t][1]:l;if(0===s)d.ymin=r,d.ymax=l,d.xmin=n,d.xmax=o;else if(d.ymin=Math.min(d.ymin,r),d.ymax=Math.max(d.ymax,l),Math.abs(o-a/2)<m)d.xmin=n,d.xmax=d.xmax+a;else{if(!(Math.abs(n+a/2)<m))return null;d.xmax=o+a}}return d}function F(t,e,a=null,n=!0,r=!0){const l=t.spatialReference;if(l.equals(e)||!e)return t;o(l,e,a);const c=(0,i.K)(t,e,a);if(r&&e.isWebMercator&&c&&(c.ymax=Math.min(20037508.342787,c.ymax),c.ymin=Math.max(-20037508.342787,c.ymin),c.ymin>=c.ymax))return null;if(!n||!c)return c;const u=U(l,!0),h=U(e,!0);if(null==u||null==h)return c;const f=b(l,.001),m=b(l,p),d=b(e,.001);if(Math.abs(c.xmin-h[0])<d&&Math.abs(c.xmax-h[1])<d){const n=Math.abs(t.xmin-u[0]),i=Math.abs(u[1]-t.xmax);if(n<f&&i>m){c.xmin=h[0];const n=[];n.push(new s.bv(t.xmax,t.ymin,l)),n.push(new s.bv(t.xmax,(t.ymin+t.ymax)/2,l)),n.push(new s.bv(t.xmax,t.ymax,l));const i=n.map((t=>M(t,e,a))).filter((t=>!isNaN(t?.x))).map((t=>t.x));c.xmax=Math.max.apply(null,i)}if(i<f&&n>m){c.xmax=h[1];const n=[];n.push(new s.bv(t.xmin,t.ymin,l)),n.push(new s.bv(t.xmin,(t.ymin+t.ymax)/2,l)),n.push(new s.bv(t.xmin,t.ymax,l));const i=n.map((t=>M(t,e,a))).filter((t=>!isNaN(t?.x))).map((t=>t.x));c.xmin=Math.min.apply(null,i)}}else{const t=b(e,.001);Math.abs(c.xmin-h[0])<t&&(c.xmin=h[0]),Math.abs(c.xmax-h[1])<t&&(c.xmax=h[1])}return c}function V(t,e=!1){if(!t)return null;const a=e?20037508.342787:20037508.342788905;return t.isWebMercator?2*a:t.wkid&&t.isGeographic?360:2*c[t.wkid]||null}function U(t,e=!1){if(t.isGeographic)return[-180,180];const a=V(t,e);return null!=a?[-a/2,a/2]:null}function G(t,e,a,n){let s=(t-e)/a;return s-Math.floor(s)!=0?s=Math.floor(s):n&&(s-=1),s}function L(t,e=!1){const a=V(t.spatialReference);if(null==a)return 0;const n=e?0:-a/2,s=b(t.spatialReference),i=!e&&Math.abs(t.xmax-a/2)<s?a/2:t.xmax,r=!e&&Math.abs(t.xmin+a/2)<s?-a/2:t.xmin;return G(i,n,a,!0)-G(r,n,a,!1)}function q(t){const e=t.storageInfo.origin.x,a=V(t.spatialReference,!0);if(null==a)return{originX:e,halfWorldWidth:null,pyramidsInfo:null};const n=a/2,{nativePixelSize:s,storageInfo:i,extent:r}=t,{maximumPyramidLevel:o,blockWidth:l,pyramidScalingFactor:c}=i;let u=s.x;const h=[],f=null!=t.transform&&"gcs-shift"===t.transform.type,m=e+(f?0:n),d=f?a-e:n-e;for(let p=0;p<=o;p++){const t=(r.xmax-e)/u/l,a=t-Math.floor(t)==0?t:Math.ceil(t),n=d/u/l,s=n-Math.floor(n)==0?n:Math.ceil(n),i=Math.floor(m/u/l),o=Math.round(m/u)%l,f=(l-Math.round(d/u)%l)%l;h.push({resolutionX:u,blockWidth:l,datasetColumnCount:a,worldColumnCountFromOrigin:s,leftMargin:o,rightPadding:f,originColumnOffset:i}),u*=c}return{originX:e,halfWorldWidth:n,pyramidsInfo:h,hasGCSSShiftTransform:f}}function W(t){if(!t||t.isGeographic)return t;const e=String(t.wkid||t.wkt2||t.wkt);let a;return d.has(e)?a=d.get(e):(a=(t.wkid?s.cq.coordsys(t.wkid):s.cq.fromString(s.cr.PE_TYPE_PROJCS,t.wkt2||t.wkt)).getGeogcs().getCode(),d.set(e,a)),new s.B({wkid:a})}function j(t){const e=t.isAdaptive&&null==t.spacing;let a=t.spacing||[u,u],n=B(t),s={cols:n.size[0]+1,rows:n.size[1]+1};const i=n.outofBoundPointCount>0&&n.outofBoundPointCount<n.offsets.length/2;let o=n.outofBoundPointCount===n.offsets.length/2||e&&i?[0,0]:l(n.offsets,s,a,f);const c=(o[0]+o[1])/2,m=t.projectedExtent.spatialReference,d=t.srcBufferExtent.spatialReference;if(e&&(i||c>f)&&(r(m,d,t.datumTransformation)&&(m.isGeographic||k(m)),a=[h,h],n=B({...t,spacing:a}),s={cols:n.size[0]+1,rows:n.size[1]+1},o=l(n.offsets,s,a,f)),n.error=o,a[0]>1&&(n.coefficients=K(n.offsets,s,i)),t.includeGCSGrid&&!m.isGeographic&&!m.isWebMercator)if(d.isGeographic)n.gcsGrid={offsets:n.offsets,coefficients:n.coefficients,spacing:a};else{const e=k(m);if(null!=e&&!e.isEnvelope){const e=W(m),r=O(t.projectedExtent,e),{offsets:o}=B({...t,srcBufferExtent:r,spacing:a}),l=K(o,s,i);n.gcsGrid={offsets:o,coefficients:l,spacing:a}}}return n}function B(t){const{projectedExtent:e,srcBufferExtent:a,pixelSize:n,datumTransformation:i,rasterTransform:r}=t,l=e.spatialReference,c=a.spatialReference,f=o(l,c),{xmin:m,ymin:d,xmax:y,ymax:x}=e,g=V(c),_=null!=g&&(t.hasWrapAround||"gcs-shift"===r?.type),w=t.spacing||[u,u],v=w[0]*n.x,M=w[1]*n.y,S=1===w[0],E=Math.ceil((y-m)/v-.1/w[0])+(S?0:1),P=Math.ceil((x-d)/M-.1/w[1])+(S?0:1),A=R({cols:E,rows:P,xmin:m,ymax:x,xres:v,yres:M,inSR:l,outSR:c,datumTransformation:i,preferPE:w[0]<=h,usePixelCenter:S}),C=[];let D,T=0;const z=S?-1:NaN,{xmin:O,xmax:I,ymax:N,width:F,height:U}=a,G=b(c,p),L=null!=g&&O>0&&I>g/2;let q=!1;if(f){const t=k(l);q=null!=t&&t.poleLocation>0}for(let o=0;o<E;o++){const t=[];for(let e=0;e<P;e++){let a=A[o*P+e];if(_&&a[0]>I&&a[0]>g/2-G?a[0]-=g:_&&0===o&&a[0]<0&&L&&!r&&(a[0]+=g),!a||isNaN(a[0])||isNaN(a[1]))C.push(z),C.push(z),t.push(null),T++;else{if(r){const t=r.inverseTransform(new s.bv({x:a[0],y:a[1],spatialReference:c}));a=[t.x,t.y]}t.push(a),o>0&&_&&D[e]&&a[0]<D[e][0]&&(a[0]+=g,q&&a[0]>I&&a[0]>g&&(a[0]-=g)),C.push((a[0]-O)/F),C.push((N-a[1])/U)}}D=t}return{offsets:C,error:null,coefficients:null,outofBoundPointCount:T,spacing:w,size:S?[E,P]:[E-1,P-1]}}function K(t,e,a){const{cols:n,rows:s}=e,i=new Float32Array((n-1)*(s-1)*2*6),r=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]),o=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(let l=0;l<n-1;l++){for(let e=0;e<s-1;e++){let a=l*s*2+2*e;const c=t[a],u=t[a+1],h=t[a+2],f=t[a+3];a+=2*s;const m=t[a],d=t[a+1],p=t[a+2],y=t[a+3];let x=0,g=12*(e*(n-1)+l);for(let t=0;t<3;t++)i[g++]=r[x++]*c+r[x++]*h+r[x++]*p;x=0;for(let t=0;t<3;t++)i[g++]=r[x++]*u+r[x++]*f+r[x++]*y;x=0;for(let t=0;t<3;t++)i[g++]=o[x++]*c+o[x++]*m+o[x++]*p;x=0;for(let t=0;t<3;t++)i[g++]=o[x++]*u+o[x++]*d+o[x++]*y}if(a)for(let t=0;t<i.length;t++)isNaN(i[t])&&(i[t]=-1)}return i}function H(t,e){const a=t.clone().normalize();return 1===a.length?a[0]:z(a,e)}function Y(t){const{spatialReference:e}=t,a=(0,s.bF)(e);if(!a)return t;const[n,i]=a.valid,r=i-n;let o=0;if(t.xmin<n){const e=n-t.xmin;o=Math.ceil(e/r)}else if(t.xmin>i){const e=t.xmin-i;o=-Math.ceil(e/r)}return new s.au({spatialReference:t.spatialReference,xmin:t.xmin+o*r,ymin:t.ymin,xmax:t.xmax+o*r,ymax:t.ymax})}function J(t,e,a){const{storageInfo:n,pixelSize:i}=e;let r=0,o=!1;const{pyramidResolutions:l}=n,c="mixed"===n.tileInfo.format?.toLowerCase()?Math.max(1,Math.min(3,n.tileInfo.dpi/96)):1,u=(t.x+t.y)/2/c;if(null!=l&&l.length){const t=l[l.length-1],n=(t.x+t.y)/2,c=(i.x+i.y)/2;if(u<=c)r=0;else if(u>=n)r=l.length,o=u/n>8;else{let t,e=c;for(let n=1;n<=l.length;n++){if(t=(l[n-1].x+l[n-1].y)/2,u<=t){u===t?r=n:"down"===a?(r=n-1,o=u/e>8):r="up"===a||u-e>t-u||u/e>2?n:n-1;break}e=t}}const h=0===r?i:l[r-1];return o&&Math.min(h.x,h.y)*(0,s.bq)(e.spatialReference)>19567&&(o=!1),{pyramidLevel:r,pyramidResolution:new s.bv({x:h.x,y:h.y,spatialReference:e.spatialReference}),excessiveReading:o}}const h=Math.log(t.x/i.x)/Math.LN2,f=Math.log(t.y/i.y)/Math.LN2,m=e.storageInfo.maximumPyramidLevel||0;r="down"===a?Math.floor(Math.min(h,f)):"up"===a?Math.ceil(Math.max(h,f)):Math.round((h+f)/2),r<0?r=0:r>m&&(o=r>m+3,r=m);const d=2**r;return{pyramidLevel:r,pyramidResolution:new s.bv({x:d*e.nativePixelSize.x,y:d*e.nativePixelSize.y,spatialReference:e.spatialReference}),excessiveReading:o}}function Z(t,e){const{pixelSize:a,extent:n}=t,s=g(n,e,!1);return O(H(n,(a.x+a.y)/16),e,s)}function $(t,e,a){const n=a?.tileSize,i=a?.alignGlobalDatasetWithAGOL,{extent:r,spatialReference:o,pixelSize:l}=t,c=v(l,e,r);if(null==c)return{projectedPixelSize:null,scales:null,srcResolutions:null,isCustomTilingScheme:!1};const u=(c.x+c.y)/2,h=(0,s.bq)(e),f=u*h*96*39.37,m=e.isGeographic?256/n*295828763.7958547:256/n*591657527.591555;let d="vector-magdir"===t.dataType||"vector-uv"===t.dataType;const p=Z(t,e),y=Math.min(Math.ceil(Math.log(Math.min(t.width,t.height)/32)/Math.LN2),Math.ceil(Math.log(m/2/f)/Math.LN2));if(!d&&i&&(e.isGeographic||e.isWebMercator)){const a=V(e);if(d=L(p)>0||null!=a&&p.width>a/4,!d&&null!=a){let e=-1;if(y<3)e=2**y*u*n;else if(t.storageInfo){const{maximumPyramidLevel:a=0,pyramidScalingFactor:s=2}=t.storageInfo;e=s**a*u*n}const s=Math.ceil(a/e);d=1===s||2===s&&a/2-p.xmax<e}}let x,g=f;const _=1.001,w=Math.min(2,Math.max(1.414,t.storageInfo?.pyramidScalingFactor||2));if(d){g=m;const a=e.isGeographic?1341104507446289e-21:.29858214164761665,n=a*(96*h*39.37),i=e.isGeographic?4326:3857;x=v({x:a,y:a},o,Z(t,new s.B({wkid:i}))),x.x*=g/n,x.y*=g/n}else{x={x:l.x,y:l.y};let t=0;for(;g<m*(_/2)&&t<y;)t++,g*=w,x.x*=w,x.y*=w;Math.max(g,m)/Math.min(g,m)<=_&&(g=m)}const b=[g],M=[{x:x.x,y:x.y}],S=70.5310735,R=Math.min(S,f)/_;for(;g>=R;)g/=w,x.x/=w,x.y/=w,b.push(g),M.push({x:x.x,y:x.y});return{projectedPixelSize:c,scales:b,srcResolutions:M,isCustomTilingScheme:!d}}},43783:function(t,e,a){a.d(e,{i:function(){return r}});a(98503);var n=a(50257);a(80774);function s(t){if(!t)return t;const{start:e,end:a}=t;return new n.p({start:null!=e?(0,n.o)(e,-e.getTimezoneOffset(),"minutes"):e,end:null!=a?(0,n.o)(a,-a.getTimezoneOffset(),"minutes"):a})}function i(t){if(!t)return t;const{start:e,end:a}=t;return new n.p({start:null!=e?(0,n.o)(e,e.getTimezoneOffset(),"minutes"):e,end:null!=a?(0,n.o)(a,a.getTimezoneOffset(),"minutes"):a})}function r(t,e,a){if(null==t?.timeInfo)return null;const{datesInUnknownTimezone:n=!1,timeOffset:r,useViewTime:o}=t;let l=t.timeExtent;n&&(l=i(l));let c=o?e&&l?e.intersection(l):e||l:l;return!c||c.isEmpty||c.isAllTime?c:(r&&(c=c.offset(-r.value,r.unit)),n&&(c=s(c)),c.equals(a)?a:c)}}}]);
//# sourceMappingURL=4925.d4a7b040.js.map