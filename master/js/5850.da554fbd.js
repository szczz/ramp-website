"use strict";(self["webpackChunkramp_website"]=self["webpackChunkramp_website"]||[]).push([[5850],{81612:function(e,t,r){r.d(t,{E:function(){return a}});var i=r(98503),n=r(30),s=r(41470);const o=()=>i.n.getLogger("esri.views.webgl.BufferObject");class a{static createIndex(e,t,r){return new a(e,s.A.ELEMENT_ARRAY_BUFFER,t,r)}static createVertex(e,t,r){return new a(e,s.A.ARRAY_BUFFER,t,r)}static createUniform(e,t,r){return new a(e,s.A.UNIFORM_BUFFER,t,r)}static createPixelPack(e,t=s.F.STREAM_READ,r){const i=new a(e,s.A.PIXEL_PACK_BUFFER,t);return r&&i.setSize(r),i}static createPixelUnpack(e,t=s.F.STREAM_DRAW,r){return new a(e,s.A.PIXEL_UNPACK_BUFFER,t,r)}static createTransformFeedback(e,t=s.F.STATIC_DRAW,r){const i=new a(e,s.A.TRANSFORM_FEEDBACK_BUFFER,t);return i.setSize(r),i}constructor(e,t,r,i){this._context=e,this.bufferType=t,this.usage=r,this._glName=null,this._size=-1,this._indexType=void 0,e.instanceCounter.increment(s.V.BufferObject,this),this._glName=this._context.gl.createBuffer(),(0,n.u)(this._context.gl),i&&this.setData(i)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get usedMemory(){if(this.bufferType===s.A.ELEMENT_ARRAY_BUFFER){if(this._indexType===s.C.UNSIGNED_INT)return 4*this._size;if(this._indexType===s.C.UNSIGNED_SHORT)return 2*this._size}return this._size}get _isVAOAware(){return this.bufferType===s.A.ELEMENT_ARRAY_BUFFER||this.bufferType===s.A.ARRAY_BUFFER}dispose(){this._context?.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(s.V.BufferObject,this),this._context=null):this._glName&&o().warn("Leaked WebGL buffer object")}setSize(e,t=null){if(this.bufferType===s.A.ELEMENT_ARRAY_BUFFER&&null!=t)switch(this._indexType=t,t){case s.C.UNSIGNED_SHORT:e*=2;break;case s.C.UNSIGNED_INT:e*=4}this._setBufferData(e)}setData(e){if(!e)return;let t=e.byteLength;this.bufferType===s.A.ELEMENT_ARRAY_BUFFER&&((0,i.cj)(e)?this._indexType=s.C.UNSIGNED_BYTE:(0,i.ck)(e)?(t/=2,this._indexType=s.C.UNSIGNED_SHORT):(0,i.cl)(e)&&(t/=4,this._indexType=s.C.UNSIGNED_INT)),this._setBufferData(t,e)}_setBufferData(e,t=null){this._size=e;const r=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const i=this._context.gl;null!=t?i.bufferData(this.bufferType,t,this.usage):i.bufferData(this.bufferType,e,this.usage),(0,n.u)(i),this._isVAOAware&&this._context.bindVAO(r)}setSubData(e,t,r,i){if(!e)return;const s=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const{gl:o}=this._context;o.bufferSubData(this.bufferType,t*e.BYTES_PER_ELEMENT,e,r,i-r),(0,n.u)(o),this._isVAOAware&&this._context.bindVAO(s)}getSubData(e,t=0,r,i){if(r<0||i<0)return;const n=l(e)?e.BYTES_PER_ELEMENT:1;if(n*((r??0)+(i??0))>e.byteLength)return;t+n*(i??0)>this.usedMemory&&o().warn("Potential problem getting subdata: requested data exceeds buffer size!");const a=this._context.gl;this.bufferType===s.A.TRANSFORM_FEEDBACK_BUFFER?(this._context.bindBuffer(this,s.A.TRANSFORM_FEEDBACK_BUFFER),a.getBufferSubData(s.A.TRANSFORM_FEEDBACK_BUFFER,t,e,r,i),this._context.unbindBuffer(s.A.TRANSFORM_FEEDBACK_BUFFER)):(this._context.bindBuffer(this,s.A.COPY_READ_BUFFER),a.getBufferSubData(s.A.COPY_READ_BUFFER,t,e,r,i),this._context.unbindBuffer(s.A.COPY_READ_BUFFER))}async getSubDataAsync(e,t=0,r,i){await this._context.clientWaitAsync(),this.getSubData(e,t,r,i)}}function l(e){return(0,i.cm)(e)}},30950:function(e,t,r){r.r(t),r.d(t,{D:function(){return Wn},F:function(){return qn},R:function(){return $n},S:function(){return Yn},a:function(){return Xn}});var i=r(98503),n=r(92611),s=r(13193),o=r(31292),a=r(36443),l=r(55532),c=r(75934),u=r(99933),h=r(88623),d=r(8891),f=r(36879),p=r(25492),m=r(56707),g=r(82691),_=r(83448),y=r(69539),v=r(39967),b=r(45160),w=r(12449),T=r(38097),x=r(36012),S=r(77485),R=r(74362),O=r(77703),A=r(93942),I=r(71807),E=r(92157),C=r(85490),M=r(90211),F=r(8460),D=r(31178),P=r(8082),N=r(90326),L=r(69852),k=r(10769),B=r(98256),j=r(81612),G=r(41470),z=r(58390),V=r(46490),U=r(40102),H=r(76005),q=r(30),Y=r(12167),X=r(1903),W=r(95229),$=r(85502),Q=r(98424),J=r(57574),Z=(r(85650),r(80152)),K=r(77678),ee=(r(7132),r(53153)),te=r(93484),re=r(76328),ie=r(55334);function ne(e){e.code.add(re.o`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}`),e.code.add(re.o`const vec4 RGBA_2_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgba2float(vec4 rgba) {
return dot(rgba, RGBA_2_FLOAT_FACTORS);
}`),e.code.add(re.o`const vec4 uninterpolatedRGBAToFloatFactors = vec4(
1.0 / 256.0,
1.0 / 256.0 / 256.0,
1.0 / 256.0 / 256.0 / 256.0,
1.0 / 256.0 / 256.0 / 256.0 / 256.0
);
float uninterpolatedRGBAToFloat(vec4 rgba) {
return (dot(round(rgba * 255.0), uninterpolatedRGBAToFloatFactors) - 0.5) * 2.0;
}`)}let se=class extends b.d{constructor(e,t){super(e,"vec4",ie.a.Draw,((r,i,n)=>r.setUniform4fv(e,t(i,n))))}},oe=class extends i.aD{constructor(e){super(e),this._removing=0,this._tiles=new o.s}destroy(){for(const e of this._tiles.values())e.remove();this._tiles.clear()}get updating(){if(this._removing>0)return!0;for(const e of this._tiles.values())if(!e.finished)return!0;return!1}async onTileTreeChange(e){const{added:t,removed:r}=e,n=this._tiles,s=[];for(const i of r){const e=n.get(i);null!=e&&(e.abort(),n.delete(i),s.push({tileId:i}))}for(const o of t)n.has(o.id)||n.set(o.id,(0,i.ca)((e=>this._addTile(o,e))));await this._removeTiles(s)}async _addTile(e,t){const r=await this.addTile(e,t);return(0,i.D)(t),r}async _removeTiles(e){this._removing++,await this.removeTiles(e),this._removing--}};(0,i.k)([(0,i.o)()],oe.prototype,"updating",null),(0,i.k)([(0,i.o)({constructOnly:!0})],oe.prototype,"addTile",void 0),(0,i.k)([(0,i.o)({constructOnly:!0})],oe.prototype,"removeTiles",void 0),(0,i.k)([(0,i.o)()],oe.prototype,"_removing",void 0),oe=(0,i.k)([(0,i.A)("esri.views.3d.layers.graphics.pipeline.Tile3DManager")],oe);let ae=class{constructor(e,t){this._index=e,this._view=t}getObjectId(){return this._view.getObjectId(this._index)}getAttribute(e){return this._view.getAttribute(this._index,e)}getAttributeAsTimestamp(e){return this._view.getAttributeAsTimestamp(this._index,e)}getAttributes(){return this._view.getAttributes(this._index)}getOptimizedGeometry(){return this._view.getOptimizedGeometry(this._index)}getCentroid(e){return this._view.getCentroid(this._index,e)}getBounds(){return this._view.getBounds(this._index)}getBoundingBox(){return this._view.getBoundingBox(this._index)}cloneWithGeometry(e){return new le(this._index,this._view,e)}},le=class extends ae{constructor(e,t,r){super(e,t),this._geometryOverride=r}getOptimizedGeometry(){return this._geometryOverride}getCentroid(e){return(0,l.n)(new c.s,this._geometryOverride,e.hasZ,e.hasM)}},ce=class{constructor(){this._storedTiles=new Map,this._pageBounds=new Map,this.events=new i.bP,this.featureAdapter=ue.shared}addTile(e){this._storedTiles.set(e.descriptor.id,e);for(const t of e.pages)this._addPage(t)}removeTile(e){const t=this._storedTiles,r=t.get(e);if(null!=r){t.delete(e);for(const e of r.pages)this._removePage(e)}}_addPage(e){const{featureCount:t}=e;if(0===t)return;const r=new a.h(9,(t=>e.getBounds(t))),i=new Array;for(let n=0;n<t;++n)i[n]=n;r.load(i),this._pageBounds.set(e,r),this.events.emit("changed")}_removePage(e){this._pageBounds.delete(e),this.events.emit("changed")}clear(){this._storedTiles.clear(),this._pageBounds.clear(),this.events.emit("changed")}forEach(e){for(const[t,r]of this._pageBounds)r.all((r=>e(new ae(r,t))))}forEachInBounds(e,t){he.minX=e[0],he.minY=e[1],he.maxX=e[2],he.maxY=e[3];for(const[r,i]of this._pageBounds)i.search(he,(e=>t(new ae(e,r))))}forEachBounds(e,t){for(const r of e)t(r.getBoundingBox())}getFullExtent(e){let t=1/0,r=1/0,i=-1/0,n=-1/0;for(const s of this._pageBounds.values()){const{minX:e,minY:o,maxX:a,maxY:l}=s.toJSON();t=Math.min(t,e),r=Math.min(r,o),i=Math.min(i,a),n=Math.min(n,l)}return{xmin:t,ymin:r,xmax:i,ymax:n,spatialReference:e}}},ue=class{getObjectId(e){return e.getObjectId()}getAttribute(e,t){return e.getAttribute(t)}getAttributeAsTimestamp(e,t){return e.getAttributeAsTimestamp(t)}getAttributes(e){return e.getAttributes()}getGeometry(e){return e.getOptimizedGeometry()}getCentroid(e,t){return e.getCentroid(t)}cloneWithGeometry(e,t){return e.cloneWithGeometry(t)}};ue.shared=new ue;const he=new a.E;let de=class{constructor(e,t){this.descriptor=e,this.pages=t}},fe=class{constructor(e){const t=new h.n(new Uint8Array(e),new DataView(e));this._reader=t,this._index=pe(t)}get featureCount(){return this._index.featureIndices.length}get exceededTransferLimit(){return this._index.exceededTransferLimit}getObjectId(e){return this.getAttribute(e,this._index.objectIdFieldName)}getAttribute(e,t){const{_index:{fieldsIndex:r,attributeIndices:i}}=this,n=r.get(t)?.index;if(null==n)return;const s=i[e*r.fields.length+n],o=this._reader;return o.move(s),ye(o)}getAttributeAsTimestamp(e,t){const r=this.getAttribute(e,t);return"string"==typeof r?new Date(r).getTime():"number"==typeof r||null==r?r:null}getAttributes(e){const{_index:{fieldsIndex:t,attributeIndices:r}}=this,i=e*t.fields.length,n=this._reader,s={};for(const o of t.fields){const e=r[i+o.index];n.move(e),s[o.name]=ye(n)}return s}getCoordinates(e,t,r=0){const i=this._reader,{transform:n,featureIndices:s}=this._index,{scale:o,translate:a}=n;i.move(s[e]),this._readCoordinates(o,a,t,r)}getOptimizedGeometry(e){const t=(0,i.aA)();return this.getCoordinates(e,t),new c.s([],t)}getCentroid(e,{hasZ:t,hasM:r}){this.getCoordinates(e,ve);const[i,n,s]=ve,o=[i,n];return t&&(o[3]=s),r&&(o[t?4:3]=0),new c.s([],o)}getBounds(e){this.getCoordinates(e,ve);const[t,r]=ve,i=new a.E;return i.minX=t,i.minY=r,i.maxX=t,i.maxY=r,i}getBoundingBox(e){this.getCoordinates(e,ve);const[t,r,n]=ve;return(0,i.gF)(t,r,n,t,r,n)}readAllObjectIds(e,t=0){const r=this._reader,{_index:i,featureCount:n}=this,{objectIdFieldName:s,attributeIndices:o,fieldsIndex:a}=i,l=a.get(s).index,c=a.fields.length;for(let u=0;u<n;++u){const i=o[u*c+l];r.move(i),e[t++]=ye(r)}return t}readAllCoordinates(e,t=0){const r=this._reader,{transform:i,featureIndices:n}=this._index,{scale:s,translate:o}=i;for(const a of n)r.move(a),t=this._readCoordinates(s,o,e,t);return t}_readCoordinates([e,t,r],[i,n,s],o,a){const l=this._reader,c=l.getLength(),u=l.pos()+c;for(;l.pos()<u&&l.next();)switch(l.tag()){case 2:{const c=l.getLength(),u=l.pos()+c;for(;l.pos()<u&&l.next();)3===l.tag()?(l.getUInt32(),o[a++]=i+e*l.getSInt64(),o[a++]=n+t*l.getSInt64(),o[a++]=s+r*l.getSInt64()):l.skip();break}default:l.skip()}return a}};function pe(e){for(;e.next();){if(2===e.tag())return me(e.getMessage());e.skip()}_e()}function me(e){for(;e.next();){if(1===e.tag())return ge(e.getMessage());e.skip()}_e()}function ge(e){let t,r,i=!1,n=!1,s=0;const o=new Array,a=new Array,l=new Array;for(;e.next();)switch(e.tag()){case 1:r=e.getString();break;case 7:0!==e.getEnum()&&_e();break;case 9:i=e.getBool()??!1;break;case 12:t=(0,d.u)(e.processMessage(p.h));break;case 13:{const t=e.processMessage(p.b);t.index=s++,o.push(t);break}case 15:{a.push(e.pos());const t=e.getUInt32(),r=e.pos()+t;for(;e.pos()<r&&e.next();)1===e.tag()&&l.push(e.pos()),e.skip();break}case 10:n=e.getBool()??!1;break;default:e.skip()}const c=new f.Z(o);return null!=t&&n&&null!=r&&c.has(r)||_e(),{transform:t,exceededTransferLimit:i,fieldsIndex:c,objectIdFieldName:r,featureIndices:a,attributeIndices:l}}function _e(){const e=new i.s("pbf-parsing-failed","Error while parsing PBF",new Error);throw console.error(e),e}function ye(e){const t=e.getLength(),r=e.pos()+t;for(;e.pos()<r&&e.next();)switch(e.tag()){case 1:return e.getString();case 2:return e.getFloat();case 3:return e.getDouble();case 4:return e.getSInt32();case 5:return e.getUInt32();case 6:return e.getInt64();case 7:return e.getUInt64();case 8:return e.getSInt64();case 9:return e.getBool();default:return e.skip(),null}return null}const ve=(0,i.aA)(),be=8e3,we=4,Te=4;let xe=class{constructor(e,t,r,i,n){this.spatialReference=e,this.url=r,this.objectIdField=i,this.capabilities=n;const{supportsMaxRecordCountFactor:s,maxRecordCount:o}=this.capabilities.query,a=s?we:1,l=(o??be)*a;this._pageSize=Math.min(be,l);const c=t.clone();c.cacheHint=!0,c.resultType="tile",c.outSpatialReference=e,c.returnGeometry=!0,c.returnZ=!0,c.maxRecordCountFactor=a,c.num=this._pageSize,c.outFields=[i],this._baseQuery=c}async fetch(e,t){const{spatialReference:r}=this,n=(0,i.dx)(e.extent,r),s=this._baseQuery.clone();s.geometry=n;const o=new Array;let a=0,l=!1,c=1;for(;!l;){const e=[];for(let i=0;i<c;++i)e.push(this._fetchPage(s,a++,t));const r=await Promise.all(e);(0,i.D)(t);for(const t of r){const e=0!==t.featureCount;l||=!t.exceededTransferLimit||!e,e&&o.push(t)}c=Math.min(c+1,Te)}return new de(e,o)}async _fetchPage(e,t,r){const n=e.clone();n.start=t*this._pageSize;const s=(await(0,u.d)(this.url,n,{signal:r})).data;return(0,i.D)(r),new fe(s)}};var Se;(function(e){e[e.Left=0]="Left",e[e.Center=1]="Center",e[e.Right=2]="Right"})(Se||(Se={}));const Re=Object.freeze({"bottom-left":(0,v.r)(0,0),bottom:(0,v.r)(.5,0),"bottom-right":(0,v.r)(1,0),left:(0,v.r)(0,.5),center:(0,v.r)(.5,.5),right:(0,v.r)(1,.5),"top-left":(0,v.r)(0,1),top:(0,v.r)(.5,1),"top-right":(0,v.r)(1,1)}),Oe={required:[]};T.b.Depth;let Ae=class extends i.aD{precompile(e){const t=this.acquireTechniques(e);return Ce(t),null!=t}consumes(){return Oe}get usedMemory(){return 0}get isDecoration(){return!1}get running(){return!1}modify(e){}get numGeometries(){return 0}get hasOccludees(){return!1}get hasEmissions(){return!1}forEachGeometry(e){}queryRenderOccludedState(e){return!1}},Ie=class extends Ae{},Ee=class extends Ae{};function Ce(e){Array.isArray(e)?e.forEach((e=>e?.release())):e?.release()}let Me=class{constructor(e,t){this._material=e,this._repository=t,this._map=new Map}dispose(){this._map.forEach(((e,t)=>{null!=e&&this._repository.release(this._material,t)}))}load(e,t,r){if(!this._material.produces.get(t)?.(r))return null;this._map.has(r)||this._map.set(r,this._repository.acquire(this._material,t,r));const i=this._map.get(r);if(null!=i){if(i.ensureResources(e)===x.O.LOADED)return i;this._repository.requestRender()}return null}},Fe=class extends b.f{constructor(e=(0,i.aA)()){super(),this.origin=e}get slicePlaneLocalOrigin(){return this.origin}};var De,Pe;(function(e){e[e.ADD=0]="ADD",e[e.UPDATE=1]="UPDATE",e[e.REMOVE=2]="REMOVE"})(De||(De={})),function(e){e[e.NONE=0]="NONE",e[e.VISIBILITY=1]="VISIBILITY",e[e.GEOMETRY=2]="GEOMETRY",e[e.TRANSFORMATION=4]="TRANSFORMATION",e[e.HIGHLIGHT=8]="HIGHLIGHT",e[e.OCCLUDEE=16]="OCCLUDEE"}(Pe||(Pe={}));let Ne=class{constructor(e=0,t=0){this.from=e,this.to=t}get numElements(){return this.to-this.from}};function Le(e){const t=new Map;e.forAll((e=>t.set(e.from,e)));let r=!0;for(;r;){r=!1;for(let i=0;i<e.length;++i){const n=e.data[i],s=t.get(n.to);if(!s)return;n.to=s.to,t.delete(s.from),e.removeUnordered(s),r=!0}}}let ke=class extends Ne{constructor(e,t,r){super(t,r),this.geometry=e}get isVisible(){return this.geometry.visible}get hasHighlights(){return this.isVisible&&this.geometry.hasHighlights}foreachHighlightGroup(e){this.isVisible&&this.geometry.foreachHighlightGroup(e)}get hasOccludees(){return null!=this.geometry.occludees}},Be=class{constructor(){this.first=0,this.count=0}},je=class{constructor(){this._numElements=0,this._instances=new Map,this.holes=new i.bX({allocator:e=>e||new Ne,deallocator:null}),this.hasHiddenInstances=!1,this.hasOccludees=!1,this.drawCommandsDirty=!0,this.highlightGroups=new Set,this.drawCommandsDefault=ze(),this.drawCommandsHighlights=new Map,this.drawCommandsOccludees=ze(),this.drawCommandsShadowHighlightRest=ze()}get numElements(){return this._numElements}get instances(){return this._instances}get hasHighlights(){return this.highlightGroups.size>0}resetInstanceSummary(){this.hasHiddenInstances=!1,this.hasOccludees=!1,this.highlightGroups.clear()}updateIfDrawCommandsDirty(e){if(this.drawCommandsDirty){this.resetInstanceSummary();for(const e of this.instances.values())this.updateDrawState(e);this.updateDrawCommands(e)}}addInstance(e,t){this.deleteInstance(e),this._instances.set(e,t),this._numElements+=t.numElements}deleteInstance(e){const t=this._instances.get(e);t&&(this._numElements-=t.numElements,this._instances.delete(e))}updateInstance(e,t,r){const i=this._instances.get(e);i&&(this._numElements-=i.numElements,i.from=t,i.to=r,this._numElements+=i.numElements)}updateDrawState(e){e.isVisible?(e.foreachHighlightGroup((e=>this.highlightGroups.add(e))),e.hasOccludees&&(this.hasOccludees=!0)):this.hasHiddenInstances=!0}updateDrawCommands(e){if(this.drawCommandsDefault.clear(),this.drawCommandsHighlights.clear(),this.drawCommandsOccludees.clear(),this.drawCommandsShadowHighlightRest.clear(),this.drawCommandsDirty=!1,0===this._instances.size)return;if(!this.needsMultipleCommands()){const t=this.drawCommandsDefault.pushNew(),r=this.holes.front();return null!=this.vao&&1===this.holes.length&&r.to===Math.floor(this.vao.byteSize/e)?(t.first=0,void(t.count=r.from)):(t.first=1/0,t.count=0,this._instances.forEach((e=>{t.first=Math.min(t.first,e.from),t.count=Math.max(t.count,e.to)})),void(t.count-=t.first))}const t=Array.from(this._instances.values()).sort(((e,t)=>e.from===t.from?e.to-t.to:e.from-t.from)),{drawCommandsHighlights:r}=this;for(const i of t)i.isVisible&&(Ve(i.hasOccludees?this.drawCommandsOccludees:this.drawCommandsDefault,i),i.hasHighlights?i.foreachHighlightGroup((e=>{let t=r.get(e);t||(t=ze(),r.set(e,t)),Ve(t,i)})):Ve(this.drawCommandsShadowHighlightRest,i))}needsMultipleCommands(){return this.hasOccludees||this.hasHighlights||this.hasHiddenInstances}};function Ge(e){return null!=e.vao}function ze(){return new i.bX({allocator:e=>e||new Be,deallocator:e=>e})}function Ve(e,t){const r=e.back();if(null==r){const r=e.pushNew();return r.first=t.from,void(r.count=t.numElements)}if(Ue(r,t)){const e=t.from-r.first+t.numElements;r.count=e}else{const r=e.pushNew();r.first=t.from,r.count=t.numElements}}function Ue(e,t){return e.first+e.count>=t.from}let He=class{constructor(e){this.origin=e,this.buffers=new Array}dispose(){this.buffers.forEach((e=>e.vao.dispose())),this.buffers.length=0}findBuffer(e){return this.buffers.find((t=>t.instances.has(e)))}},qe=class extends Ie{get _hasAnyHighlight(){return this._highlightGroups.size>0}constructor(e){super(e),this._dataByOrigin=new Map,this._drawParameters=new Fe,this._highlightGroups=new Set,this.drapedPriority=0,this._produces=new Map,this._hasOccludees=!1}destroy(){this._glMaterials=(0,i.cF)(this._glMaterials),this._dataByOrigin.forEach((e=>e.dispose())),this._dataByOrigin.clear(),this._vaoCache=null}initialize(){this.material.produces.forEach(((e,t)=>{this._produces.set(t,(t=>!(0===this._dataByOrigin.size||!(t!==T.b.Highlight&&t!==T.b.ShadowHighlight||this._hasAnyHighlight))&&e(t)))}))}initializeRenderContext(e,t){this._glMaterials=new Me(this.material,t??e.materials),this._bufferWriter=this.material.createBufferWriter(),this._vaoCache=e.renderContext.rctx.getVaoCache(this.material.vertexAttributeLocations,(0,w.t)(this._bufferWriter.vertexBufferLayout))}uninitializeRenderContext(){}get produces(){return this._produces}get hasOccludees(){return this._hasOccludees}get hasEmissions(){return this.material.hasEmissions}get isDecoration(){return this.material.parameters.isDecoration}queryRenderOccludedState(e){return this.material.queryRenderOccludedState(e)}get numGeometries(){let e=0;return this._dataByOrigin.forEach((t=>e+=t.buffers.reduce(((e,t)=>e+t.instances.size),0))),e}get usedMemory(){let e=0;return this._dataByOrigin.forEach((t=>e+=t.buffers.reduce(((e,t)=>e+t.vao.usedMemory),0))),e}forEachGeometry(e){this._dataByOrigin.forEach((t=>t.buffers.forEach((t=>t.instances.forEach((({geometry:t})=>e(t)))))))}modify(e){this._updateGeometries(e.updates),this._addAndRemoveGeometries(e.adds,e.removes),this._updateDrawCommands()}_updateGeometries(e){const t=this._bufferWriter;if(null==t)return;const r=t.vertexBufferLayout.stride/4;for(const i of e){const e=i.renderGeometry,n=this._dataByOrigin.get(e.localOrigin.id),s=n?.findBuffer(e.id);if(null==s)return;const o=s.instances.get(e.id);if(i.updateType&(Pe.GEOMETRY|Pe.TRANSFORMATION)){const i=it(t.elementCount(o.geometry.geometry.attributes)*r),n=t.vertexBufferLayout.createView(i.buffer);this._writeGeometry(e,n,0),s.vao.vertexBuffers.get("geometry").setSubData(i,o.from*r,0,o.numElements*r)}i.updateType&(Pe.HIGHLIGHT|Pe.OCCLUDEE|Pe.VISIBILITY)&&(s.drawCommandsDirty=!0)}}_computeDeltas(e,t){const r=new S.t;for(const i of e){const e=i.localOrigin;if(null==e)continue;let t=r.get(e.id,null);null==t&&(t=new Ye(e.vec3),r.set(e.id,null,t)),t.changes.push(i)}for(const i of t){const e=i.localOrigin;if(null==e)continue;const t=this._dataByOrigin.get(e.id),n=t?.findBuffer(i.id);if(null==n)continue;let s=r.get(e.id,n);null==s&&(s=new Ye(e.vec3),r.set(e.id,n,s)),s.changes.push(i)}return r}_addAndRemoveGeometries(e,t){if(null==this._bufferWriter||null==this._vaoCache)return;const{_bufferWriter:r,_dataByOrigin:n}=this,s=r.vertexBufferLayout.stride/4,o=this._computeDeltas(e,t);o.forEach(((e,t)=>{const a=e.get(null),l=a?.changes??[];o.delete(t,null);let c=n.get(t);if(e.forEach(((e,a)=>{if(o.delete(t,a),null==a)return void(0,A.s)(!1,"No VAO for removed geometries");if(a.instances.size===e.changes.length)return this._vaoCache.deleteVao(a.vao),(0,i.h)(c.buffers,a),void(0===c.buffers.length&&0===l.length&&n.delete(t));const u=a.numElements,h=a.vao.byteSize/4,d=l.reduce(((e,t)=>e+r.elementCount(t.geometry.attributes)),0),f=e.changes.reduce(((e,t)=>e+r.elementCount(t.geometry.attributes)),0),p=Math.min((u+d-f)*s,tt),m=p>h;p>Je&&p<h/2?(e.changes.forEach((({id:e})=>a.deleteInstance(e))),a.instances.forEach((({geometry:e})=>l.push(e))),this._vaoCache.deleteVao(a.vao),(0,i.h)(c.buffers,a)):m?this._applyAndRebuild(a,l,e):this._applyRemoves(a,e)})),l.length>0)for(null==c&&(c=new He(a.origin),n.set(t,c)),c.buffers.forEach((e=>this._applyAdds(e,l)));l.length>0;)c.buffers.push(this._applyAndRebuild(new je,l,null))}))}_updateDrawCommands(){this._highlightGroups.clear(),this._hasOccludees=!1,this._dataByOrigin.forEach((e=>{e.buffers.forEach((e=>{e.updateIfDrawCommandsDirty(this._bufferWriter.vertexBufferLayout.stride),e.hasHighlights&&(0,i.jf)(this._highlightGroups,e.highlightGroups),this._hasOccludees=this._hasOccludees||e.hasOccludees}))}))}_applyAndRebuild(e,t,r){if(r)for(const f of r.changes)e.deleteInstance(f.id);const i=this._bufferWriter,n=i.vertexBufferLayout.stride,s=n/4,o=Math.floor(tt/s);let a=e.numElements;for(;t.length>0;){const r=t.pop(),n=i.elementCount(r.geometry.attributes);if(a+n>o&&a>0){t.push(r);break}a+=n;const s=new ke(r,0,0);(0,A.s)(null==e.instances.get(r.id)),e.addInstance(r.id,s)}const l=a*s,c=it(l),u=i.vertexBufferLayout.createView(c.buffer);let h=0;e.resetInstanceSummary(),e.instances.forEach(((t,r)=>{this._writeGeometry(t.geometry,u,h);const n=h;h+=i.elementCount(t.geometry.geometry.attributes),e.updateInstance(r,n,h),e.updateDrawState(t)})),this._vaoCache.deleteVao(e.vao),e.vao=this._vaoCache.newVao(nt(l)),e.vao.vertexBuffers.get("geometry").setSubData(c,0,0,h*s),e.holes.clear();const d=e.holes.pushNew();return d.from=h,d.to=Math.floor(e.vao.byteSize/n),e.updateDrawCommands(n),e}_applyRemoves(e,t){if(0===t.changes.length||null==this._bufferWriter)return;for(const o of t.changes){const t=o.id,r=e.instances.get(t);if(!r)continue;e.deleteInstance(t);const i=Qe.back();if(i){if(i.to===r.from){i.to=r.to;continue}if(i.from===r.to){i.from=r.from;continue}}const n=Qe.pushNew();n.from=r.from,n.to=r.to}Le(Qe);const r=this._bufferWriter.vertexBufferLayout.stride/4,i=Qe.reduce(((e,t)=>Math.max(e,t.numElements)),0)*r,n=it(i);n.fill(0,0,i);const s=e.vao.vertexBuffers.get("geometry");Qe.forAll((e=>s.setSubData(n,e.from*r,0,e.numElements*r))),e.holes.pushArray(Qe.data,Qe.length),Qe.forAll(((e,t)=>Qe.data[t]=null)),Qe.clear(),e.drawCommandsDirty=!0}_applyAdds(e,t){if(0===t.length||null==this._bufferWriter)return;if(!Ge(e))return void this._applyAndRebuild(e,t,null);const r=this._bufferWriter,n=r.vertexBufferLayout.stride/4,s=e.numElements,o=t.reduce(((e,t)=>e+r.elementCount(t.geometry.attributes)),0),a=Math.min((s+o)*n,tt),l=4*a;if(e.vao.byteSize<nt(tt-Je)&&l>e.vao.byteSize)return void this._applyAndRebuild(e,t,null);Le(e.holes);const c=new Array;for(const i of t){const t=r.elementCount(i.geometry.attributes),n=Xe(e.holes,t);c.push(n)}const u=e.vao.vertexBuffers.get("geometry");let h=0,d=0,f=0;const p=it(a),m=r.vertexBufferLayout.createView(p.buffer);t.forEach(((t,i)=>{const s=c[i];if(null==s)return;if(f!==s){const e=f-d;e>0&&u.setSubData(p,d*n,0,e*n),d=s,h=0}const o=r.elementCount(t.geometry.attributes);this._writeGeometry(t,m,h),h+=o,f=s+o;const a=new ke(t,s,s+o);(0,A.s)(null==e.instances.get(t.id)),e.addInstance(t.id,a),e.drawCommandsDirty=!0}));const g=f-d;g>0&&u.setSubData(p,d*n,0,g*n),(0,i.kg)(t,((e,t)=>null==c[t]))}_writeGeometry(e,t,r){null!=this._bufferWriter&&((0,R.n)(We,e.transformation),We[12]-=e.localOrigin.vec3[0],We[13]-=e.localOrigin.vec3[1],We[14]-=e.localOrigin.vec3[2],(0,R.h)($e,We),(0,R.s)($e,$e),this._bufferWriter.write(We,$e,e.geometry.attributes,e.geometry.objectAndLayerIdColor,t,r))}updateAnimation(e){return this.material.update(e)}acquireTechniques(e){if(!this.material.shouldRender(e))return null;const{output:t,bind:r}=e;if(!this.material.produces.get(r.slot)?.(t))return null;const{highlightGroupName:i,slot:n}=r,s=t===T.b.ShadowHighlight,o=t===T.b.Highlight,a=o||s,l=e=>a&&(0===this._highlightGroups.size||o&&!!i&&!e.has(i));if(l(this._highlightGroups))return null;const c=t===T.b.ShadowExcludeHighlight,u=!(a||c);for(const{buffers:h}of this._dataByOrigin.values())for(const o of h){if(l(o.highlightGroups))continue;const h=s?o.drawCommandsHighlights.size>0:a?i?o.drawCommandsHighlights.get(i):o.drawCommandsHighlights.size>0:((c&&o.needsMultipleCommands()?o.drawCommandsShadowHighlightRest:o.drawCommandsDefault)||null)?.length??!1,d=u&&o.drawCommandsOccludees||null;if(h||d?.length){const i=this._glMaterials.load(e.rctx,n,t),s=i?.beginSlot(r);if(s)return s}}return null}render(e,t){const{output:r,bind:i}=e,{slot:n,highlightGroupName:s}=i,o=r===T.b.Highlight;if(o&&!s)return;const a=r===T.b.ShadowHighlight,l=o||a,c=r===T.b.ShadowExcludeHighlight,u=!(l||c),h=n===b.A.OCCLUDER_MATERIAL||n===b.A.TRANSPARENT_OCCLUDER_MATERIAL?n:null,{rctx:d}=e;d.runAppleAmdDriverHelper();const f=d.bindTechnique(t,i,this.material.parameters);for(const p of this._dataByOrigin.values())for(const e of p.buffers){if(o&&(!e.hasHighlights||!e.drawCommandsHighlights.has(s))||a&&!e.hasHighlights)continue;const r=()=>{const t=[];for(const r of e.drawCommandsHighlights.values())t.push(r);return t},n=l&&!a?e.drawCommandsHighlights.get(s)??null:null,m=a?r():l?n?[n]:st:(c&&e.needsMultipleCommands()?[e.drawCommandsShadowHighlightRest]:[e.drawCommandsDefault])||st,g=m.some((e=>e.length>0)),_=u&&e.drawCommandsOccludees||null;if(g||_?.length){if(this._drawParameters.origin=p.origin,f.bindDraw(i,this.material.parameters,this._drawParameters),t.ensureAttributeLocations(e.vao),d.bindVAO(e.vao),g)for(const e of m)d.setPipelineState(t.getPipeline(!1,h)),e.forAll((e=>d.drawArrays(t.primitiveType,e.first,e.count)));_?.length&&(d.setPipelineState(t.getPipeline(!0,h)),_.forAll((e=>d.drawArrays(t.primitiveType,e.first,e.count))))}}}get test(){}};(0,i.k)([(0,i.o)({constructOnly:!0})],qe.prototype,"material",void 0),qe=(0,i.k)([(0,i.A)("esri.views.3d.webgl-engine.materials.renderers.MergedRenderer")],qe);let Ye=class{constructor(e){this.origin=e,this.changes=new Array}};function Xe(e,t){const r=e.find((e=>e.numElements>=t));if(null==r)return null;const i=r.from;return r.from+=t,r.from>=r.to&&e.removeUnordered(r),i}const We=(0,O.e)(),$e=(0,O.e)(),Qe=new i.bX({allocator:e=>e||new Ne,deallocator:null}),Je=65536,Ze=4*Je,Ke=1024,et=16777216,tt=et/4;let rt=new Float32Array(Je);function it(e){return rt.length<e&&(rt=new Float32Array(e)),rt}function nt(e){const t=4*e;return t<=Ke?Ke:t<Ze?(0,i.b_)(t):Math.max(Math.min(Math.ceil(1.5*t/Ze)*Ze,et),t)}const st=[];let ot=class extends Ie{constructor(e){super(e),this._hasHighlights=!1,this._glMaterials=null,this._produces=new Map,this._renderGeometries=new Map,this._vaoCache=null,this._drawParameters=new Fe,this._bufferWriter=null}get produces(){return this._produces}initialize(){this._bufferWriter=this.material.createBufferWriter(),this.material.produces.forEach(((e,t)=>{this._produces.set(t,(t=>!!(t!==T.b.Highlight&&t!==T.b.ShadowHighlight||this._hasHighlights)&&e(t)))}))}destroy(){this._glMaterials.dispose();const e=this._renderGeometries.keys();for(const t of e)this.removeRenderGeometry(t)}acquireTechniques(e){const t=this.material;if(!t.shouldRender(e))return null;const{output:r,bind:i}=e;return t.produces.get(i.slot)?.(r)&&(r!==T.b.Highlight&&r!==T.b.ShadowHighlight||this._hasHighlights)?this._glMaterials.load(e.rctx,i.slot,r)?.beginSlot(i):null}render(e,t){const r=this._renderGeometries;if(0===r.size)return;const{bind:i}=e,n=i.slot===b.A.OCCLUDER_MATERIAL||i.slot===b.A.TRANSPARENT_OCCLUDER_MATERIAL?i.slot:null,s=e.rctx;s.runAppleAmdDriverHelper(),s.bindTechnique(t,i,this.material.parameters);const o=t.program;for(const[a,l]of r)this._drawParameters.origin=l.localOrigin,o.bindDraw(i,this.material.parameters,this._drawParameters),t.ensureAttributeLocations(l.vao),s.bindVAO(l.vao),s.setPipelineState(t.getPipeline(!1,n)),s.drawArrays(t.primitiveType,0,l.numElements)}initializeRenderContext(e,t){this._glMaterials=new Me(this.material,e.materials);const r=e.renderContext.rctx.getVaoCache(this.material.vertexAttributeLocations,(0,w.t)(this._bufferWriter.vertexBufferLayout));this._vaoCache=r}uninitializeRenderContext(){}addRenderGeometry(e,t,r){this.removeRenderGeometry(e);const i=this._bufferWriter.vertexBufferLayout.stride,n=this._vaoCache.newVao(nt(t.data.byteLength));n.vertexBuffers.get("geometry").setSubData(new Uint8Array(t.data),0,0,t.elementCount*i);const s={localOrigin:r,vao:n,numElements:t.elementCount};return this._renderGeometries.set(e,s),s}removeRenderGeometry(e){const t=this._renderGeometries.get(e);null!=t&&(this._vaoCache.deleteVao(t.vao),this._renderGeometries.delete(e))}};function at(e,t,r){return 2*Math.atan(Math.sqrt(t*t+r*r)*Math.tan(.5*e)/t)}function lt(e,t,r){return 2*Math.atan(Math.sqrt(t*t+r*r)*Math.tan(.5*e)/r)}function ct(e,t,r){return 2*Math.atan(t*Math.tan(.5*e)/Math.sqrt(t*t+r*r))}function ut(e,t,r){return 2*Math.atan(r*Math.tan(.5*e)/Math.sqrt(t*t+r*r))}var ht,dt,ft;(0,i.k)([(0,i.o)({constructOnly:!0})],ot.prototype,"material",void 0),ot=(0,i.k)([(0,i.A)("esri.views.3d.layers.graphics.pipeline.rendering.DirectRenderer")],ot),function(e){e[e.Default=0]="Default",e[e.Screenshot=1]="Screenshot",e[e.ObjectAndLayerID=2]="ObjectAndLayerID"}(ht||(ht={})),function(e){e[e.TOP=0]="TOP",e[e.RIGHT=1]="RIGHT",e[e.BOTTOM=2]="BOTTOM",e[e.LEFT=3]="LEFT"}(dt||(dt={}));let pt=ft=class extends i.aD{constructor(e){super(e),this._ray=(0,D.b)(),this._viewport=(0,_.r)(0,0,1,1),this._padding=(0,_.r)(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=(0,v.r)(1,1e3),this._viewDirty=!0,this._viewMatrix=(0,O.e)(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=(0,O.e)(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=(0,O.e)(),this._frustumDirty=!0,this._frustum=(0,F.H)(),this._fullViewport=(0,_.n)(),this._pixelRatio=1,this.row=0,this.column=0,this._rows=1,this._columns=1,this._center=(0,i.aA)(),this._up=(0,i.aA)(),this.relativeElevation=0}get pixelRatio(){return this._pixelRatio}set pixelRatio(e){this._pixelRatio=e>0?e:1}get rows(){return this._rows}set rows(e){this._rows=Math.max(1,e)}get columns(){return this._columns}set columns(e){this._columns=Math.max(1,e)}get eye(){return this._ray.origin}set eye(e){this._compareAndSetView(e,this._ray.origin)}get center(){return this._center}set center(e){this._compareAndSetView(e,this._center,"_center")}get ray(){return(0,E.c)(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(e){this._compareAndSetView(e,this._up,"_up")}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(e){(0,R.n)(this._viewMatrix,e),this.notifyChange("_viewMatrix"),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),(0,E.o)((0,i.aA)(),-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10])}get viewUp(){return this._ensureViewClean(),(0,E.o)((0,i.aA)(),this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9])}get viewRight(){return this._ensureViewClean(),(0,E.o)((0,i.aA)(),this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8])}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(e){this._nearFar[0]!==e&&(this._nearFar[0]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get far(){return this._nearFar[1]}set far(e){this._nearFar[1]!==e&&(this._nearFar[1]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get viewport(){return this._viewport}set viewport(e){this.x=e[0],this.y=e[1],this.width=e[2],this.height=e[3]}get screenViewport(){if(1===this.pixelRatio)return this._viewport;const e=(0,M.m)((0,_.n)(),this._viewport,1/this.pixelRatio),t=this._get("screenViewport");return t&&(0,M.L)(e,t)?t:e}get screenPadding(){if(1===this.pixelRatio)return this._padding;const e=(0,M.m)((0,_.n)(),this._padding,1/this.pixelRatio),t=this._get("screenPadding");return t&&(0,M.L)(e,t)?t:e}get x(){return this._viewport[0]}set x(e){e+=this._padding[dt.LEFT],this._viewport[0]!==e&&(this._viewport[0]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get y(){return this._viewport[1]}set y(e){e+=this._padding[dt.BOTTOM],this._viewport[1]!==e&&(this._viewport[1]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get width(){return this._viewport[2]}set width(e){this._viewport[2]!==e&&(this._viewport[2]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get height(){return this._viewport[3]}set height(e){this._viewport[3]!==e&&(this._viewport[3]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get fullWidth(){return this._viewport[2]+this._padding[dt.RIGHT]+this._padding[dt.LEFT]}set fullWidth(e){this.width=e-(this._padding[dt.RIGHT]+this._padding[dt.LEFT])}get fullHeight(){return this._viewport[3]+this._padding[dt.TOP]+this._padding[dt.BOTTOM]}set fullHeight(e){this.height=e-(this._padding[dt.TOP]+this._padding[dt.BOTTOM])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[dt.LEFT],this._fullViewport[1]=this._viewport[1]-this._padding[dt.BOTTOM],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get _aspect(){return this.width/this.height}get padding(){return this._padding}set padding(e){(0,M.E)(this._padding,e)||(this._viewport[0]+=e[dt.LEFT]-this._padding[dt.LEFT],this._viewport[1]+=e[dt.BOTTOM]-this._padding[dt.BOTTOM],this._viewport[2]-=e[dt.RIGHT]+e[dt.LEFT]-(this._padding[dt.RIGHT]+this._padding[dt.LEFT]),this._viewport[3]-=e[dt.TOP]+e[dt.BOTTOM]-(this._padding[dt.TOP]+this._padding[dt.BOTTOM]),(0,M.a)(this._padding,e),this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_padding"),this.notifyChange("_viewport"))}get viewProjectionMatrix(){return this._viewProjectionDirty&&((0,R.c)(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){return this._projectionMatrixInternal}get inverseProjectionMatrix(){return(0,R.h)((0,O.e)(),this.projectionMatrix)||this._get("inverseProjectionMatrix")||(0,O.e)()}get fov(){return this._fov}set fov(e){this._fov=e,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return ct(this._fov,this.width,this.height)}set fovX(e){this._fov=at(e,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return ut(this._fov,this.width,this.height)}set fovY(e){this._fov=lt(e,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return(0,E.p)(this.center,this.eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&((0,R.h)(this._viewInverseTransposeMatrix,this.viewMatrix),(0,R.s)(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(e){const t=2*e-1;return 2*this.near*this.far/(this.far+this.near-t*(this.far-this.near))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this.pixelRatio}get aboveGround(){return null!=this.relativeElevation&&this.relativeElevation>=0}get _projectionMatrixInternal(){const e=this.width,t=this.height,r=this.near*Math.tan(this.fovY/2)*2,i=r*this._aspect,n=r/this.rows,s=i/this.columns,o=-i/2+this.column*s,a=o+s,l=-r/2+this.row*n,c=l+n,u=(0,R.A)((0,O.e)(),o*(1+2*this._padding[dt.LEFT]/e),a*(1+2*this._padding[dt.RIGHT]/e),l*(1+2*this._padding[dt.BOTTOM]/t),c*(1+2*this._padding[dt.TOP]/t),this.near,this.far),h=this._get("projectionMatrix");return h&&(0,R.C)(h,u)?h:u}copyFrom(e){(0,E.s)(this._ray.origin,e.eye),this.center=e.center,this.up=e.up,(0,M.a)(this._viewport,e.viewport),this.notifyChange("_viewport"),(0,M.a)(this._padding,e.padding),this.notifyChange("_padding"),(0,y.r)(this._nearFar,e.nearFar),this.notifyChange("_nearFar"),this._fov=e.fov,this.row=e.row,this.column=e.column,this.rows=e.rows,this.columns=e.columns,this.relativeElevation=e.relativeElevation;const t=e;return this._viewDirty=t._viewDirty,this._viewDirty||((0,R.n)(this._viewMatrix,e.viewMatrix),this.notifyChange("_viewMatrix")),this._viewProjectionDirty=!0,this._frustumDirty=t._frustumDirty,this._frustumDirty||((0,F.N)(this._frustum,e.frustum),this._frustumDirty=!1),t._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:((0,R.n)(this._viewInverseTransposeMatrix,e.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),(0,M.a)(this._fullViewport,e.fullViewport),this.pixelRatio=e.pixelRatio,this}copyViewFrom(e){this.eye=e.eye,this.center=e.center,this.up=e.up,this.fov=e.fov}clone(){return(new ft).copyFrom(this)}equals(e){return(0,E.H)(this.eye,e.eye)&&(0,E.H)(this.center,e.center)&&(0,E.H)(this.up,e.up)&&(0,M.E)(this._viewport,e.viewport)&&(0,M.E)(this._padding,e.padding)&&(0,y.E)(this.nearFar,e.nearFar)&&this._fov===e.fov&&this.pixelRatio===e.pixelRatio&&this.relativeElevation===e.relativeElevation&&this.row===e.row&&this.column===e.column&&this.rows===e.rows&&this.columns===e.columns}almostEquals(e){const t=Math.max(1,1/this.pixelRatio,1/e.pixelRatio);if(Math.abs(e.fov-this._fov)>=.001||(0,M.x)(e.screenPadding,this.screenPadding)>=t||(0,M.x)(this.screenViewport,e.screenViewport)>=t||this.row!==e.row||this.column!==e.column||this.rows!==e.rows||this.columns!==e.columns)return!1;(0,E.R)(yt,e.eye,e.center),(0,E.R)(vt,this.eye,this.center);const r=(0,E.P)(yt,vt),i=(0,E.Z)(yt),n=(0,E.Z)(vt),s=5e-4;return r*r>=(1-1e-10)*i*n&&(0,E.X)(e.eye,this.eye)<Math.max(i,n)*s*s}computeRenderPixelSizeAt(e){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(e))}computeRenderPixelSizeAtDist(e){return e*this.perRenderPixelRatio}computeScreenPixelSizeAt(e){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(e))}_viewDirectionDistance(e){return Math.abs((0,P.f)(this.viewForward,(0,E.c)(yt,e,this.eye)))}computeScreenPixelSizeAtDist(e){return e*this.perScreenPixelRatio}computeDistanceFromRadius(e,t){return e/Math.tan(Math.min(this.fovX,this.fovY)/(2*(t||1)))}getScreenCenter(e=(0,i.iJ)()){return e[0]=(this.padding[dt.LEFT]+this.width/2)/this.pixelRatio,e[1]=(this.padding[dt.TOP]+this.height/2)/this.pixelRatio,e}getRenderCenter(e,t=.5,r=.5){return e[0]=this.padding[dt.LEFT]+this.width*t,e[1]=this.padding[dt.BOTTOM]+this.height*r,e[2]=.5,e}setGLViewport(e){const t=this.viewport,r=this.padding;e.setViewport(t[0]-r[3],t[1]-r[2],t[2]+r[1]+r[3],t[3]+r[0]+r[2])}applyProjection(e,t){e!==gt&&(0,E.s)(gt,e),gt[3]=1,(0,M.z)(gt,gt,this.projectionMatrix);const r=Math.abs(gt[3]);(0,E.g)(gt,gt,1/r);const n=this.fullViewport;t[0]=(0,i.iK)(0,n[0]+n[2],.5+.5*gt[0]),t[1]=(0,i.iK)(0,n[1]+n[3],.5+.5*gt[1]),t[2]=.5*(gt[2]+1),t[3]=r}unapplyProjection(e,t){const r=this.fullViewport;gt[0]=(e[0]/(r[0]+r[2])*2-1)*e[3],gt[1]=(e[1]/(r[1]+r[3])*2-1)*e[3],gt[2]=(2*e[2]-1)*e[3],gt[3]=e[3],null!=this.inverseProjectionMatrix&&((0,M.z)(gt,gt,this.inverseProjectionMatrix),t[0]=gt[0],t[1]=gt[1],t[2]=gt[2])}projectToScreen(e,t){return this.projectToRenderScreen(e,bt),this.renderToScreen(bt,t),t}projectToRenderScreen(e,t){if(gt[0]=e[0],gt[1]=e[1],gt[2]=e[2],gt[3]=1,(0,M.z)(gt,gt,this.viewProjectionMatrix),0===gt[3])return null;const r=gt;(0,E.g)(r,r,1/Math.abs(gt[3]));const n=this.fullViewport,s=(0,i.iK)(0,n[0]+n[2],.5+.5*r[0]),o=(0,i.iK)(0,n[1]+n[3],.5+.5*r[1]);return"x"in t?(t.x=s,t.y=o):(t[0]=s,t[1]=o,t.length>2&&(t[2]=.5*(r[2]+1))),t}unprojectFromScreen(e,t){return this.unprojectFromRenderScreen(this.screenToRender(e,bt),t)}unprojectFromRenderScreen(e,t){if((0,R.c)(_t,this.projectionMatrix,this.viewMatrix),!(0,R.h)(_t,_t))return null;const r=this.fullViewport;return gt[0]=2*(e[0]-r[0])/r[2]-1,gt[1]=2*(e[1]-r[1])/r[3]-1,gt[2]=2*e[2]-1,gt[3]=1,(0,M.z)(gt,gt,_t),0===gt[3]?null:(t[0]=gt[0]/gt[3],t[1]=gt[1]/gt[3],t[2]=gt[2]/gt[3],t)}constrainWindowSize(e,t,r,i){const n=e*this.pixelRatio,s=t*this.pixelRatio,o=Math.max(n-r/2,0),a=Math.max(this.fullHeight-s-i/2,0),l=-Math.min(n-r/2,0),c=-Math.min(this.fullHeight-s-i/2,0),u=r-l- -Math.min(this.fullWidth-n-r/2,0),h=i-c- -Math.min(s-i/2,0);return[Math.round(o),Math.round(a),Math.round(u),Math.round(h)]}computeUp(e){e===m.l.Global?this._computeUpGlobal():this._computeUpLocal()}screenToRender(e,t){const r=e[0]*this.pixelRatio,i=this.fullHeight-e[1]*this.pixelRatio;return t[0]=r,t[1]=i,t}renderToScreen(e,t){const r=e[0]/this.pixelRatio,i=(this.fullHeight-e[1])/this.pixelRatio;t[0]=r,t[1]=i}_computeUpGlobal(){(0,E.c)(yt,this.center,this.eye);const e=(0,E.r)(this.center);e<1?((0,E.o)(this._up,0,0,1),this._markViewDirty(),this.notifyChange("_up")):Math.abs((0,E.P)(yt,this.center))>.9999*(0,E.r)(yt)*e||((0,E._)(this._up,yt,this.center),(0,E._)(this._up,this._up,yt),(0,E.A)(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_computeUpLocal(){(0,E.K)(yt,this.eye,this.center),Math.abs(yt[2])<=.9999&&((0,E.g)(yt,yt,yt[2]),(0,E.o)(this._up,-yt[0],-yt[1],1-yt[2]),(0,E.A)(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_compareAndSetView(e,t,r=""){"number"==typeof e[0]&&isFinite(e[0])&&"number"==typeof e[1]&&isFinite(e[1])&&"number"==typeof e[2]&&isFinite(e[2])?(0,E.H)(e,t)||((0,E.s)(t,e),this._markViewDirty(),r.length&&this.notifyChange(r)):i.n.getLogger("esri.views.3d.webgl-engine.lib.RenderCamera").warn("RenderCamera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}_recomputeFrustum(){this._frustumDirty&&((0,F.L)(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&((0,R.X)(this._viewMatrix,this.eye,this.center,this.up),this.notifyChange("_viewMatrix"),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}};(0,i.k)([(0,i.o)()],pt.prototype,"_viewport",void 0),(0,i.k)([(0,i.o)()],pt.prototype,"_padding",void 0),(0,i.k)([(0,i.o)()],pt.prototype,"_fov",void 0),(0,i.k)([(0,i.o)()],pt.prototype,"_nearFar",void 0),(0,i.k)([(0,i.o)()],pt.prototype,"_viewDirty",void 0),(0,i.k)([(0,i.o)()],pt.prototype,"_viewMatrix",void 0),(0,i.k)([(0,i.o)()],pt.prototype,"_pixelRatio",void 0),(0,i.k)([(0,i.o)()],pt.prototype,"pixelRatio",null),(0,i.k)([(0,i.o)()],pt.prototype,"row",void 0),(0,i.k)([(0,i.o)()],pt.prototype,"column",void 0),(0,i.k)([(0,i.o)()],pt.prototype,"_rows",void 0),(0,i.k)([(0,i.o)()],pt.prototype,"rows",null),(0,i.k)([(0,i.o)()],pt.prototype,"_columns",void 0),(0,i.k)([(0,i.o)()],pt.prototype,"columns",null),(0,i.k)([(0,i.o)()],pt.prototype,"eye",null),(0,i.k)([(0,i.o)()],pt.prototype,"center",null),(0,i.k)([(0,i.o)()],pt.prototype,"_center",void 0),(0,i.k)([(0,i.o)()],pt.prototype,"up",null),(0,i.k)([(0,i.o)()],pt.prototype,"_up",void 0),(0,i.k)([(0,i.o)()],pt.prototype,"viewMatrix",null),(0,i.k)([(0,i.o)({readOnly:!0})],pt.prototype,"viewForward",null),(0,i.k)([(0,i.o)({readOnly:!0})],pt.prototype,"viewUp",null),(0,i.k)([(0,i.o)({readOnly:!0})],pt.prototype,"viewRight",null),(0,i.k)([(0,i.o)({readOnly:!0})],pt.prototype,"nearFar",null),(0,i.k)([(0,i.o)()],pt.prototype,"near",null),(0,i.k)([(0,i.o)()],pt.prototype,"far",null),(0,i.k)([(0,i.o)()],pt.prototype,"viewport",null),(0,i.k)([(0,i.o)({readOnly:!0})],pt.prototype,"screenViewport",null),(0,i.k)([(0,i.o)({readOnly:!0})],pt.prototype,"screenPadding",null),(0,i.k)([(0,i.o)()],pt.prototype,"x",null),(0,i.k)([(0,i.o)()],pt.prototype,"y",null),(0,i.k)([(0,i.o)()],pt.prototype,"width",null),(0,i.k)([(0,i.o)()],pt.prototype,"height",null),(0,i.k)([(0,i.o)()],pt.prototype,"fullWidth",null),(0,i.k)([(0,i.o)()],pt.prototype,"fullHeight",null),(0,i.k)([(0,i.o)({readOnly:!0})],pt.prototype,"_aspect",null),(0,i.k)([(0,i.o)()],pt.prototype,"padding",null),(0,i.k)([(0,i.o)({readOnly:!0})],pt.prototype,"projectionMatrix",null),(0,i.k)([(0,i.o)({readOnly:!0})],pt.prototype,"inverseProjectionMatrix",null),(0,i.k)([(0,i.o)()],pt.prototype,"fov",null),(0,i.k)([(0,i.o)()],pt.prototype,"fovX",null),(0,i.k)([(0,i.o)()],pt.prototype,"fovY",null),(0,i.k)([(0,i.o)()],pt.prototype,"viewInverseTransposeMatrix",null),(0,i.k)([(0,i.o)({readOnly:!0})],pt.prototype,"_projectionMatrixInternal",null),(0,i.k)([(0,i.o)()],pt.prototype,"relativeElevation",void 0),pt=ft=(0,i.k)([(0,i.A)("esri.views.3d.webgl.RenderCamera")],pt);const mt=pt,gt=(0,_.n)(),_t=(0,O.e)(),yt=(0,i.aA)(),vt=(0,i.aA)(),bt=(0,i.kh)();let wt=class{constructor(e,t,r){this._elementSize=t,this._buffer=j.E.createVertex(e,G.F.STATIC_DRAW),this.resize(r)}destroy(){this._buffer.dispose()}get elementSize(){return this._elementSize}get capacity(){return this._capacity}get array(){return this._array}get buffer(){return this._buffer}get usedMemory(){return this._array.byteLength+this._buffer.usedMemory}copyRange(e,t,r,i=0){const n=new Uint8Array(this.array,e*this.elementSize,(t-e)*this.elementSize);new Uint8Array(r.array,i*this.elementSize).set(n)}transferAll(){this._buffer.setData(this._array)}transferRange(e,t){const r=e*this._elementSize,i=t*this._elementSize;this._buffer.setSubData(new Uint8Array(this._array),r,r,i)}resize(e){const t=e*this._elementSize,r=new ArrayBuffer(t);this._array&&(e>=this._capacity?new Uint8Array(r).set(new Uint8Array(this._array)):new Uint8Array(r).set(new Uint8Array(this._array).subarray(0,e*this._elementSize))),this._array=r,this._buffer.setSize(t),this._capacity=e}},Tt=class{constructor(e){this.modelOriginHi=e.getField(I.e.INSTANCEMODELORIGINHI,B.i),this.modelOriginLo=e.getField(I.e.INSTANCEMODELORIGINLO,B.i),this.model=e.getField(I.e.INSTANCEMODEL,B.l),this.modelNormal=e.getField(I.e.INSTANCEMODELNORMAL,B.l),this.featureAttribute=e.getField(I.e.INSTANCEFEATUREATTRIBUTE,B.c),this.color=e.getField(I.e.INSTANCECOLOR,B.x),this.objectAndLayerIdColor=e.getField(I.e.INSTANCEOBJECTANDLAYERIDCOLOR,B.x)}},xt=class{constructor(e,t){this._rctx=e,this._instanceBufferLayout=t,this._headIndex=0,this._tailIndex=0,this._firstIndex=null,this._captureFirstIndex=!0,this._updating=!1,this._prevHeadIndex=0,this._resized=!1,this._capacity=1}destroy(){this._buffer&&this._buffer.destroy()}get buffer(){return this._buffer.buffer}get view(){return this._view}get capacity(){return this._capacity}get size(){const e=this._headIndex,t=this._tailIndex;return e>=t?e-t:e+this._capacity-t}get isEmpty(){return this._headIndex===this._tailIndex}get isFull(){return this._tailIndex===(this._headIndex+1)%this._capacity}get headIndex(){return this._headIndex}get tailIndex(){return this._tailIndex}get firstIndex(){return this._firstIndex}get usedMemory(){return this._buffer?.usedMemory??0}reset(){this._headIndex=0,this._tailIndex=0,this._firstIndex=null}startUpdateCycle(){this._captureFirstIndex=!0}beginUpdate(){(0,A.s)(!this._updating,"already updating"),this._updating=!0,this._prevHeadIndex=this._headIndex}endUpdate(){(0,A.s)(this._updating,"not updating"),this.size<i.ki*this.capacity&&this._shrink(),this._resized?(this._buffer.transferAll(),this._resized=!1):this._transferRange(this._prevHeadIndex,this._headIndex),this._updating=!1}allocateHead(){(0,A.s)(this._updating,"not updating"),this.isFull&&this._grow();const e=this.headIndex;return this._captureFirstIndex&&(this._firstIndex=e,this._captureFirstIndex=!1),this._incrementHead(),(0,A.s)(this._headIndex!==this._tailIndex,"invalid pointers"),e}freeTail(){(0,A.s)(this._updating,"not updating"),(0,A.s)(this.size>0,"invalid size");const e=this._tailIndex===this._firstIndex;this._incrementTail(),e&&(this._firstIndex=this._tailIndex)}_grow(){const e=Math.max(St,Math.floor(this._capacity*i.kj));this._resize(e)}_shrink(){const e=Math.max(St,Math.floor(this._capacity*i.kk));this._resize(e)}_resize(e){if((0,A.s)(this._updating,"not updating"),e===this._capacity)return;const t=new wt(this._rctx,this._instanceBufferLayout.stride,e);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);const e=this.size,r=this._compactInstances(t);(0,A.s)(r===e,"invalid compaction"),this._buffer.destroy(),this._tailIndex=0,this._headIndex=r,this._prevHeadIndex=0}this._resized=!0,this._capacity=e,this._buffer=t,this._view=new Tt(this._instanceBufferLayout.createView(this._buffer.array))}_compactInstances(e){const t=this._headIndex,r=this._tailIndex;return r<t?(this._buffer.copyRange(r,t,e),t-r):r>t?(this._buffer.copyRange(r,this._capacity,e),t>0&&this._buffer.copyRange(0,t,e,this._capacity-r),t+(this._capacity-r)):0}_incrementHead(e=1){this._headIndex=(this._headIndex+e)%this._capacity}_incrementTail(e=1){this._tailIndex=(this._tailIndex+e)%this._capacity}_transferRange(e,t){e<t?this._buffer.transferRange(e,t):e>t&&(t>0&&this._buffer.transferRange(0,t),this._buffer.transferRange(e,this._capacity))}};const St=64;var Rt;function Ot(e){let t=(0,C.H)().mat4f64(I.e.LOCALTRANSFORM).mat4f64(I.e.GLOBALTRANSFORM).vec4f64(I.e.BOUNDINGSPHERE).vec3f64(I.e.MODELORIGIN).mat3f(I.e.INSTANCEMODEL).mat3f(I.e.INSTANCEMODELNORMAL).vec2f(I.e.MODELSCALEFACTORS);return e.includes(I.e.FEATUREATTRIBUTE)&&(t=t.vec4f(I.e.FEATUREATTRIBUTE)),e.includes(I.e.COLOR)&&(t=t.vec4u8(I.e.COLOR)),e.includes(I.e.OBJECTANDLAYERIDCOLOR)&&(t=t.vec4u8(I.e.OBJECTANDLAYERIDCOLOR)),t=t.u8(I.e.STATE).u8(I.e.LODLEVEL),t}(function(e){e[e.ALLOCATED=1]="ALLOCATED",e[e.DEFAULT_ACTIVE=2]="DEFAULT_ACTIVE",e[e.VISIBLE=4]="VISIBLE",e[e.HIGHLIGHT=8]="HIGHLIGHT",e[e.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE",e[e.REMOVE=32]="REMOVE",e[e.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED",e[e.ACTIVE=18]="ACTIVE"})(Rt||(Rt={}));let At=class{constructor(e){this.localTransform=e.getField(I.e.LOCALTRANSFORM,B.b),this.globalTransform=e.getField(I.e.GLOBALTRANSFORM,B.b),this.modelOrigin=e.getField(I.e.MODELORIGIN,B.T),this.model=e.getField(I.e.INSTANCEMODEL,B.l),this.modelNormal=e.getField(I.e.INSTANCEMODELNORMAL,B.l),this.modelScaleFactors=e.getField(I.e.MODELSCALEFACTORS,B.u),this.boundingSphere=e.getField(I.e.BOUNDINGSPHERE,B.h),this.featureAttribute=e.getField(I.e.FEATUREATTRIBUTE,B.c),this.color=e.getField(I.e.COLOR,B.x),this.objectAndLayerIdColor=e.getField(I.e.OBJECTANDLAYERIDCOLOR,B.x),this.state=e.getField(I.e.STATE,B.d),this.lodLevel=e.getField(I.e.LODLEVEL,B.d)}},It=class extends i.aD{constructor(e,t){super(e),this.events=new i.bP,this._capacity=0,this._size=0,this._next=0,this._highlightGroupMap=new Map,this._highlightGroupMapPrev=new Map,this._layout=Ot(t),this._capacity=St,this._buffer=this._layout.createBuffer(this._capacity),this._view=new At(this._buffer)}get capacity(){return this._capacity}get size(){return this._size}get view(){return this._view}addInstance(){this._size+1>this._capacity&&this._grow();const e=this._findSlot();return this._view.state.set(e,Rt.ALLOCATED),this._size++,this.events.emit("instances-changed"),e}removeInstance(e){const t=this._view.state;(0,A.s)(e>=0&&e<this._capacity&&!!(t.get(e)&Rt.ALLOCATED),"invalid instance handle"),this._getStateFlag(e,Rt.ACTIVE)?this._setStateFlags(e,Rt.REMOVE):this.freeInstance(e),this.events.emit("instances-changed")}freeInstance(e){const t=this._view.state;(0,A.s)(e>=0&&e<this._capacity&&!!(t.get(e)&Rt.ALLOCATED),"invalid instance handle"),t.set(e,0),this._size--}setLocalTransform(e,t,r=!0){this._view.localTransform.setMat(e,t),r&&this.updateModelTransform(e)}getLocalTransform(e,t){this._view.localTransform.getMat(e,t)}setGlobalTransform(e,t,r=!0){this._view.globalTransform.setMat(e,t),r&&this.updateModelTransform(e)}getGlobalTransform(e,t){this._view.globalTransform.getMat(e,t)}updateModelTransform(e){const t=this._view,r=Ct,i=Mt;t.localTransform.getMat(e,Ft),t.globalTransform.getMat(e,Dt);const n=(0,R.c)(Dt,Dt,Ft);(0,E.o)(r,n[12],n[13],n[14]),t.modelOrigin.setVec(e,r),(0,L.n)(i,n),t.model.setMat(e,i);const s=(0,P.g)(Ct,n);s.sort(),t.modelScaleFactors.set(e,0,s[1]),t.modelScaleFactors.set(e,1,s[2]),(0,L.s)(i,i),(0,L.u)(i,i),t.modelNormal.setMat(e,i),this._setStateFlags(e,Rt.TRANSFORM_CHANGED),this.events.emit("instance-transform-changed",{index:e})}getModelTransform(e,t){const r=this._view;r.model.getMat(e,Mt),r.modelOrigin.getVec(e,Ct),t[0]=Mt[0],t[1]=Mt[1],t[2]=Mt[2],t[3]=0,t[4]=Mt[3],t[5]=Mt[4],t[6]=Mt[5],t[7]=0,t[8]=Mt[6],t[9]=Mt[7],t[10]=Mt[8],t[11]=0,t[12]=Ct[0],t[13]=Ct[1],t[14]=Ct[2],t[15]=1}applyShaderTransformation(e,t){null!=this.shaderTransformation&&this.shaderTransformation.applyTransform(this,e,t)}getCombinedModelTransform(e,t){return this.getModelTransform(e,t),null!=this.shaderTransformation&&this.shaderTransformation.applyTransform(this,e,t),t}getCombinedLocalTransform(e,t){this._view.localTransform.getMat(e,t),null!=this.shaderTransformation&&this.shaderTransformation.applyTransform(this,e,t)}getCombinedMaxScaleFactor(e){let t=this._view.modelScaleFactors.get(e,1);return null!=this.shaderTransformation&&(this.shaderTransformation.scaleFactor(Ct,this,e),t*=Math.max(Ct[0],Ct[1],Ct[2])),t}getCombinedMedianScaleFactor(e){let t=this._view.modelScaleFactors.get(e,0);return null!=this.shaderTransformation&&(this.shaderTransformation.scaleFactor(Ct,this,e),t*=Et(Ct[0],Ct[1],Ct[2])),t}getModel(e,t){this._view.model.getMat(e,t)}setFeatureAttribute(e,t){this._view.featureAttribute.setVec(e,t)}getFeatureAttribute(e,t){this._view.featureAttribute.getVec(e,t)}setColor(e,t){this._view.color.setVec(e,t)}setObjectAndLayerIdColor(e,t){this._view.objectAndLayerIdColor.setVec(e,t)}setVisible(e,t){t!==this.getVisible(e)&&(this._setStateFlag(e,Rt.VISIBLE,t),this.events.emit("instance-visibility-changed",{index:e}))}getVisible(e){return this._getStateFlag(e,Rt.VISIBLE)}setHighlight(e,t,r){let i=this._highlightGroupMap.get(e);t?(i||(i=new Set,this._highlightGroupMap.set(e,i)),i.add(r)&&(this._setStateFlag(e,Rt.HIGHLIGHT,!0),this.events.emit("instance-highlight-changed"))):i?.delete(r)&&(0===i.size&&(this._highlightGroupMap.delete(e),this._setStateFlag(e,Rt.HIGHLIGHT,!1)),this.events.emit("instance-highlight-changed"))}getHighlight(e){return this._getStateFlag(e,Rt.HIGHLIGHT)}foreachHighlightGroupPrev(e,t){this._highlightGroupMapPrev.get(e)?.forEach(t),this._highlightGroupMapPrev.delete(e)}foreachHighlightGroup(e,t){const r=this._highlightGroupMap.get(e);r?.forEach(t),r?this._highlightGroupMapPrev.set(e,new Set(r)):this._highlightGroupMapPrev.delete(e)}getState(e){return this._view.state.get(e)}getLodLevel(e){return this._view.lodLevel.get(e)}countFlags(e){let t=0;for(let r=0;r<this._capacity;++r)this.getState(r)&e&&++t;return t}_setStateFlags(e,t){const r=this._view.state;t=r.get(e)|t,r.set(e,t)}_clearStateFlags(e,t){const r=this._view.state;t=r.get(e)&~t,r.set(e,t)}_setStateFlag(e,t,r){r?this._setStateFlags(e,t):this._clearStateFlags(e,t)}_getStateFlag(e,t){return!!(this._view.state.get(e)&t)}_grow(){this._capacity=Math.max(St,Math.floor(this._capacity*i.kj)),this._buffer=this._layout.createBuffer(this._capacity).copyFrom(this._buffer),this._view=new At(this._buffer)}_findSlot(){const e=this._view.state;let t=this._next;for(;e.get(t)&Rt.ALLOCATED;)t=t+1===this._capacity?0:t+1;return this._next=t+1===this._capacity?0:t+1,t}};function Et(e,t,r){return Math.max(Math.min(e,t),Math.min(Math.max(e,t),r))}(0,i.k)([(0,i.o)({constructOnly:!0})],It.prototype,"shaderTransformation",void 0),(0,i.k)([(0,i.o)()],It.prototype,"_size",void 0),(0,i.k)([(0,i.o)({readOnly:!0})],It.prototype,"size",null),It=(0,i.k)([(0,i.A)("esri.views.3d.webgl-engine.lib.lodRendering.InstanceData")],It);const Ct=(0,i.aA)(),Mt=(0,k.e)(),Ft=(0,O.e)(),Dt=(0,O.e)();let Pt=class extends F.Y{constructor(e,t){super((e=>(0,D.T)(this._instanceData.view.boundingSphere.getVec(e,this._tmpSphere))),{maximumDepth:25}),this._instanceData=e,this._boundingSphere=t,this._tmpSphere=(0,D.E)(),this._tmpMat4=(0,O.e)()}addInstance(e){const t=this._instanceData.view.boundingSphere,r=this._instanceData.getCombinedModelTransform(e,this._tmpMat4);(0,E.E)((0,D.U)(this._tmpSphere),this._boundingSphere.center,r),this._tmpSphere[3]=this._boundingSphere.radius*(0,P.m)(r),t.setVec(e,this._tmpSphere),this.add([e])}removeInstance(e){this.remove([e])}},Nt=class{constructor(e,t){this._worldSpaceRadius=e,this._minScreenSpaceRadii=t}selectLevel(e,t,r){const i=r.computeScreenPixelSizeAt(e),n=this._worldSpaceRadius*t/i;let s=0;for(let o=1;o<this._minScreenSpaceRadii.length;++o)n>=this._minScreenSpaceRadii[o]&&(s=o);return s}},Lt=class{constructor(e){this.layerUid=e}},kt=class extends Lt{constructor(e,t){super(e),this.graphicUid=t}};function Bt(e){return null!=e?.dist}let jt=class{get ray(){return this._ray}get distanceInRenderSpace(){return null!=this.dist?((0,E.g)(zt,this.ray.direction,this.dist),(0,E.r)(zt)):null}getIntersectionPoint(e){return!!Bt(this)&&((0,E.g)(zt,this.ray.direction,this.dist),(0,E.u)(e,this.ray.origin,zt),!0)}getTransformedNormal(e){return(0,E.s)(Vt,this.normal),Vt[3]=0,(0,M.z)(Vt,Vt,this.transformation),(0,E.s)(e,Vt),(0,E.A)(e,e)}constructor(e){this.intersector=N.i.OBJECT,this.normal=(0,i.aA)(),this.transformation=(0,O.e)(),this._ray=(0,D.b)(),this.init(e)}init(e){this.dist=null,this.target=null,this.drapedLayerOrder=null,this.drapedLayerGraphicOrder=null,this.intersector=N.i.OBJECT,(0,D.v)(e,this._ray)}set(e,t,r,n,s,o,a){this.intersector=e,this.dist=r,(0,E.s)(this.normal,n??i.e_),(0,R.n)(this.transformation,s??O.o),this.target=t,this.drapedLayerOrder=o,this.drapedLayerGraphicOrder=a}copy(e){(0,D.v)(e.ray,this._ray),this.intersector=e.intersector,this.dist=e.dist,this.target=e.target,this.drapedLayerOrder=e.drapedLayerOrder,this.drapedLayerGraphicOrder=e.drapedLayerGraphicOrder,(0,E.s)(this.normal,e.normal),(0,R.n)(this.transformation,e.transformation)}};function Gt(e){return new jt(e)}const zt=(0,i.aA)(),Vt=(0,_.n)();let Ut=class extends V.o{},Ht=class extends kt{constructor(e,t,r,i,n,s){super(e,t),this.layerUid=e,this.graphicUid=t,this.geometryId=r,this.triangleNr=i,this.baseBoundingSphere=n,this.numLodLevels=s}};function qt(e,t,r,i=null){const n=e.createBufferWriter(),s=n.vertexBufferLayout,o=n.elementCount(t),a=s.createBuffer(o);return n.write(null,null,t,i,a,0),{material:e,vertexBufferLayout:s,buffer:a.buffer,elementCount:o,boundingInfo:r}}let Yt=class{constructor(e,t){const r=e.renderContext.rctx,i=t.geometry;let n=null;n=i instanceof b.r?qt(i.material,i.attributes,i.boundingInfo):i;const s=n.material;this._materials=e.materials,s.setParameters({instancedDoublePrecision:!0}),this.geometry=i,this.material=s,this.glMaterials=new Me(s,this._materials),this.vertexBufferLayout=n.vertexBufferLayout,this.vbo=j.E.createVertex(r,G.F.STATIC_DRAW,n.buffer),this.vao=new Ut(r,b.O,new Map([["geometry",(0,w.t)(n.vertexBufferLayout)]]),new Map([["geometry",this.vbo]])),this.vertexCount=n.elementCount}destroy(){this.glMaterials.dispose(),this.vbo.dispose(),this.vao.dispose()}get boundingInfo(){return this.geometry.boundingInfo}get triangleCount(){return this.vertexCount/3}intersect(e,t,r,i,n,s,o,a){if(!(this.geometry instanceof b.r))return;const l=this.geometry.id;this.material.intersect(this.geometry,e.transform.transform,e,r,i,((r,i,c,u,h)=>{if(r>=0){if(null!=t&&!t(e.rayBegin,e.rayEnd,r))return;const u=new Ht(s.layerUid,s.graphicUid(n),l,c,o,a);if((null==e.results.min.drapedLayerOrder||h>=e.results.min.drapedLayerOrder)&&(null==e.results.min.dist||r<e.results.min.dist)&&e.results.min.set(N.i.LOD,u,r,i,e.transform.transform,h),e.options.store!==N.e.MIN&&(null==e.results.max.drapedLayerOrder||h>=e.results.max.drapedLayerOrder)&&(null==e.results.max.dist||r>e.results.max.dist)&&e.results.max.set(N.i.LOD,u,r,i,e.transform.transform,h),e.options.store===N.e.ALL){const t=Gt(e.results.min.ray);t.set(N.i.LOD,u,r,i,e.transform.transform,h),e.results.all.push(t)}}}))}},Xt=class e{static async create(t,r,n){const s=await Promise.allSettled(r.components.map((e=>t.controller.schedule((()=>new Yt(t,e)),n)))),o=s.map((e=>"fulfilled"===e.status?e.value:null)).filter(i.bQ);if((0,i.fp)(n)||o.length!==s.length){o.forEach((e=>e.destroy())),(0,i.D)(n);for(const e of s)if("rejected"===e.status)throw e.reason}return new e(r.minScreenSpaceRadius,o)}constructor(e,t){this.minScreenSpaceRadius=e,this.components=t}destroy(){this.components.forEach((e=>e.destroy()))}intersect(e,t,r,i,n,s,o){this.components.forEach((a=>a.intersect(e,t,r,i,n,s,this.boundingSphere,o)))}get boundingBox(){if(null==this._boundingBox){const e=(0,i.hv)();this.components.forEach((t=>{null!=t.boundingInfo&&((0,i.gG)(e,t.boundingInfo.bbMin),(0,i.gG)(e,t.boundingInfo.bbMax))})),this._boundingBox=e}return this._boundingBox}get boundingSphere(){if(null==this._boundingSphere){const e=this.boundingBox,t=(0,i.aA)();(0,i.kl)(e,t),this._boundingSphere={center:t,radius:.5*(0,i.km)(e)}}return this._boundingSphere}get triangleCount(){return this.components.reduce(((e,t)=>e+t.triangleCount),0)}};function Wt(e,t,r,i,n){$t[0]=e.get(t,0),$t[1]=e.get(t,1),$t[2]=e.get(t,2),(0,U.t)($t,Qt,3),r.set(n,0,Qt[0]),i.set(n,0,Qt[1]),r.set(n,1,Qt[2]),i.set(n,1,Qt[3]),r.set(n,2,Qt[4]),i.set(n,2,Qt[5])}const $t=(0,i.aA)(),Qt=new Float32Array(6),Jt=e=>{const t=e.baseBoundingSphere.radius,r=e.levels.map((e=>e.minScreenSpaceRadius));return new Nt(t,r)};let Zt=class extends Ee{constructor(e,t){super(e),this.type=N.i.LOD,this.isGround=!1,this._levels=[],this._defaultRenderInstanceData=new Array,this._highlightRenderInstanceDataMap=new Map,this._instanceIndex=0,this._cycleStartIndex=0,this._slicePlane=!1,this._camera=new mt,this._updateCyclesWithStaticCamera=-1,this._needFullCycle=!1,this.produces=new Map([[b.A.OPAQUE_MATERIAL,e=>this._produces(e)],[b.A.TRANSPARENT_MATERIAL,e=>!!this._hasTransparentLevels()&&this._produces(e)]]),this._instanceData=new It({shaderTransformation:e.shaderTransformation},e.optionalFields),this.addHandles(t.registerTask(H.g.LOD_RENDERER,this))}initialize(){this._instanceBufferLayout=tr(this.optionalFields),this._glInstanceBufferLayout=(0,w.t)(this._instanceBufferLayout,1),this.addHandles([this._instanceData.events.on("instances-changed",(()=>this._requestUpdateCycle())),this._instanceData.events.on("instance-transform-changed",(({index:e})=>{this._requestUpdateCycle(),this.metadata.notifyGraphicGeometryChanged(e)})),this._instanceData.events.on("instance-visibility-changed",(({index:e})=>{this._requestUpdateCycle(!0),this.metadata.notifyGraphicVisibilityChanged(e)})),this._instanceData.events.on("instance-highlight-changed",(()=>this._requestUpdateCycle(!0)))])}get _allRenderInstanceData(){const e=[this._defaultRenderInstanceData];for(const t of this._highlightRenderInstanceDataMap)e.push(t[1]);return e}get _enableLevelSelection(){return this.symbol.levels.length>1}get levels(){return this._levels}get baseBoundingBox(){return this._levels[this._levels.length-1].boundingBox}get baseBoundingSphere(){return this._levels[this._levels.length-1].boundingSphere}get baseMaterial(){return this._levels[this._levels.length-1].components[0].material}get slicePlaneEnabled(){return this._slicePlane}set slicePlaneEnabled(e){this._slicePlane=e}get layerUid(){return this.metadata.layerUid}get instanceData(){return this._instanceData}get hasEmissions(){return this.baseMaterial.hasEmissions}get usedMemory(){return this._allRenderInstanceData.reduce(((e,t)=>t.reduce(((e,t)=>e+t.usedMemory),e)),0)}get renderStats(){const e=this._instanceData.size,t=[];return this._levels.forEach(((e,r)=>{const i=this._allRenderInstanceData[0][r].size+this._allRenderInstanceData[1][r].size,n=e.triangleCount;t.push({renderedInstances:i,renderedTriangles:i*n,trianglesPerInstance:n})})),{totalInstances:e,renderedInstances:t.reduce(((e,t)=>e+t.renderedInstances),0),renderedTriangles:t.reduce(((e,t)=>e+t.renderedTriangles),0),levels:t}}_createRenderInstanceDataArray(e=[]){const{rctx:t}=this._context.renderContext;return this.symbol.levels.map((r=>{e.push(new xt(t,this._instanceBufferLayout))})),e}async initializeRenderContext(e,t){this._context=e,this._createRenderInstanceDataArray(this._defaultRenderInstanceData);const r=await Promise.allSettled(this.symbol.levels.map((r=>Xt.create(e,r,t)))),n=r.map((e=>"fulfilled"===e.status?e.value:null)).filter(i.bQ);if((0,i.fp)(t)||n.length!==r.length){n.forEach((e=>e.destroy())),(0,i.D)(t);for(const e of r)if("rejected"===e.status)throw e.reason}this._levels=n,this._levelSelector=Jt(this)}uninitializeRenderContext(){this._invalidateOctree(),this._levels.forEach((e=>e.destroy())),this._defaultRenderInstanceData.forEach((e=>e.destroy())),this._highlightRenderInstanceDataMap.forEach((e=>e.forEach((e=>e.destroy()))))}_hasTransparentLevels(){return this._levels.some((e=>e.components.some((e=>e.material.produces.get(b.A.TRANSPARENT_MATERIAL)?.(T.b.Color)))))}hasHighlights(){return(0,i.fW)(this._highlightRenderInstanceDataMap,(e=>e.some((e=>e.size>0))))}_produces(e){return e!==T.b.Highlight&&e!==T.b.ShadowHighlight||this.hasHighlights()}prepareRender(e){if(!b.g.LOD_INSTANCE_RENDERER_DISABLE_UPDATES){if(this._enableLevelSelection){const t=e.bind.contentCamera.equals(this._camera);this._camera.copyFrom(e.bind.contentCamera),t||this._requestUpdateCycle()}this._needFullCycle&&(this.runTask(H.C),this._needFullCycle=!1)}}acquireTechniques(e){if(!this.baseMaterial.visible||!this.baseMaterial.isVisibleForOutput(e.output))return null;const t=this._getInstanceDatas(e);if(!t)return null;const r=new Array,i=this.levels;return t.forEach((t=>i.forEach((({components:i},n)=>i.forEach((i=>r.push(this._beginComponent(e,t[n],i)))))))),r}render(e,t){const r=this._getInstanceDatas(e);if(!r||null==t)return;let i=0;e.rctx.bindVAO();const n=this.levels;r.forEach((r=>n.forEach((({components:n},s)=>n.forEach((n=>this._renderComponent(e,t[i++],r[s],n,s)))))))}_getInstanceDatas(e){const{output:t,bind:r}=e,i=t===T.b.Highlight,n=!i&&t!==T.b.ShadowHighlight,s=t!==T.b.ShadowExcludeHighlight;if(n)return s?this._allRenderInstanceData:[this._defaultRenderInstanceData];if(s){if(i){const{highlightGroupName:e}=r;if(!e)return null;const t=this._highlightRenderInstanceDataMap.get(e);return t?[t]:null}const e=[];for(const t of this._highlightRenderInstanceDataMap)e.push(t[1]);return e}return null}intersect(e,t,r,n){if(!this.baseMaterial.visible||null==this._octree)return;const s=(0,i.aA)();(0,E.c)(s,n,r);const o=i=>{this._instanceData.getCombinedModelTransform(i,nr),e.transform.set(nr),(0,E.E)(sr,r,e.transform.inverse),(0,E.E)(or,n,e.transform.inverse);const s=this._instanceData.getState(i),o=this._instanceData.getLodLevel(i),a=this._levels.length;(0,A.s)(!!(s&Rt.ACTIVE),"invalid instance state"),(0,A.s)(o>=0&&o<a,"invaid lod level"),this._levels[o].intersect(e,t,sr,or,i,this.metadata,a)};this.baseMaterial.parameters.verticalOffset?this._octree.forEach(o):this._octree.forEachAlongRay(r,s,o)}notifyShaderTransformationChanged(){this._invalidateOctree(),this._requestUpdateCycle()}get _octree(){if(null==this._octreeCached){const e=this._instanceData,t=e.view?.state;if(!t)return null;this._octreeCached=new Pt(e,this.baseBoundingSphere);for(let r=0;r<e.capacity;++r)t.get(r)&Rt.ACTIVE&&this._octreeCached.addInstance(r)}return this._octreeCached}_invalidateOctree(){this._octreeCached=(0,i.C)(this._octreeCached)}queryDepthRange(e){if(null==this._octree)return{near:1/0,far:-1/0};const t=e.viewForward,r=this._octree.findClosest(t,F.Y.DepthOrder.FRONT_TO_BACK,e.frustum),i=this._octree.findClosest(t,F.Y.DepthOrder.BACK_TO_FRONT,e.frustum);if(null==r||null==i)return{near:1/0,far:-1/0};const n=e.eye,s=this._instanceData.view;s.boundingSphere.getVec(r,ir),(0,E.c)(ir,ir,n);const o=(0,E.P)(ir,t)-ir[3];s.boundingSphere.getVec(i,ir),(0,E.c)(ir,ir,n);const a=(0,E.P)(ir,t)+ir[3];return{near:Math.max(e.near,o),far:Math.min(e.far,a)}}_requestUpdateCycle(e=!1){this._updateCyclesWithStaticCamera=-1,this._cycleStartIndex=this._instanceIndex,e&&(this._needFullCycle=!0,this._context.requestRender())}_startUpdateCycle(){this._updateCyclesWithStaticCamera++,this._allRenderInstanceData.forEach((e=>e.forEach((e=>e.startUpdateCycle()))))}get running(){return this._instanceData.size>0&&this._updateCyclesWithStaticCamera<1}runTask(e){const{_enableLevelSelection:t,_camera:r,_levelSelector:n}=this;this._allRenderInstanceData.forEach((e=>e.forEach((e=>e.beginUpdate()))));const s=this._instanceData,o=s.view;let a=s.size;const l=s.capacity;let c=this._instanceIndex;const u=Math.ceil(l/500);for(let h=0;h<a&&!e.done;++h){c===this._cycleStartIndex&&this._startUpdateCycle();const h=o.state.get(c);let d=0;if(!(h&Rt.ALLOCATED)){c=c+1===l?0:c+1,a++;continue}const f=o.lodLevel.get(c);if(h&Rt.DEFAULT_ACTIVE&&this._defaultRenderInstanceData[f].freeTail(),h&Rt.HIGHLIGHT_ACTIVE&&s.foreachHighlightGroupPrev(c,(e=>{const t=this._highlightRenderInstanceDataMap.get(e);if(!t)throw new i.s("Internal error in lodRenderer");t[f].freeTail()})),h&Rt.REMOVE)s.freeInstance(c);else if(h&Rt.VISIBLE){let e=0;t&&(o.modelOrigin.getVec(c,rr),e=n.selectLevel(rr,s.getCombinedMedianScaleFactor(c),r)),d=h&~(Rt.ACTIVE|Rt.TRANSFORM_CHANGED),e>=0&&(h&Rt.HIGHLIGHT?(s.foreachHighlightGroup(c,(t=>{let r=this._highlightRenderInstanceDataMap.get(t);if(r||(r=this._createRenderInstanceDataArray(),r.forEach((e=>e.beginUpdate())),this._highlightRenderInstanceDataMap.set(t,r)),e>=r.length)throw new i.s(`LodRenderer internal error - missing lodLevel ${e}`);Kt(r[e],o,c)})),d|=Rt.HIGHLIGHT_ACTIVE):(Kt(this._defaultRenderInstanceData[e],o,c),d|=Rt.DEFAULT_ACTIVE)),o.state.set(c,d),o.lodLevel.set(c,e)}else d=h&~(Rt.ACTIVE|Rt.TRANSFORM_CHANGED),o.state.set(c,d);if(null!=this._octreeCached){const e=!!(h&Rt.ACTIVE),t=!!(d&Rt.ACTIVE);!e&&t?this._octreeCached.addInstance(c):e&&!t?this._octreeCached.removeInstance(c):e&&t&&h&Rt.TRANSFORM_CHANGED&&(this._octreeCached.removeInstance(c),this._octreeCached.addInstance(c))}c=c+1===l?0:c+1,c%u==0&&e.madeProgress()}this._instanceIndex=c,this._allRenderInstanceData.forEach((e=>e.forEach((e=>e.endUpdate())))),this._context.requestRender()}_beginComponent(e,t,r){return 0===t.size?null:r.glMaterials.load(e.rctx,e.bind.slot,e.output)?.beginSlot(e.bind)}_renderComponent(e,t,r,i,n){if(!t)return;const{bind:s,rctx:o}=e;o.runAppleAmdDriverHelper();const a=o.bindTechnique(t,s,i.material.parameters,lr);o.bindVAO(i.vao),t.ensureAttributeLocations(i.vao),b.g.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&e.output===T.b.Color&&(a.setUniform4fv("externalColor",ar[Math.min(n,ar.length-1)]),a.setUniform1i("colorMixMode",b.h.replace));const l=r.capacity,c=r.headIndex,u=r.tailIndex,h=r.firstIndex,d=this._glInstanceBufferLayout,f=(e,n)=>{(0,q.E)(o,b.O,r.buffer,d,e),o.drawArraysInstanced(t.primitiveType,0,i.vertexCount,n-e),(0,q._)(o,b.O,r.buffer,d)};i.material.parameters.transparent&&null!=h?c>u?((0,A.s)(h>=u&&h<=c,"invalid firstIndex"),f(h,c),f(u,h)):c<u&&(h<=c?((0,A.s)(h>=0&&h<=c,"invalid firstIndex"),f(h,c),f(u,l),f(0,h)):((0,A.s)(h>=u&&h<=l,"invalid firstIndex"),f(h,l),f(0,c),f(u,h))):c>u?f(u,c):c<u&&(f(0,c),f(u,l)),o.bindVAO(null)}};function Kt(e,t,r){const i=e.allocateHead();er(t,r,e.view,i)}function er(e,t,r,i){Wt(e.modelOrigin,t,r.modelOriginHi,r.modelOriginLo,i),r.model.copyFrom(i,e.model,t),r.modelNormal.copyFrom(i,e.modelNormal,t),e.color&&r.color&&r.color.copyFrom(i,e.color,t),e.objectAndLayerIdColor&&r.objectAndLayerIdColor&&r.objectAndLayerIdColor.copyFrom(i,e.objectAndLayerIdColor,t),e.featureAttribute&&r.featureAttribute&&r.featureAttribute.copyFrom(i,e.featureAttribute,t)}function tr(e){let t=(0,C.H)().vec3f(I.e.INSTANCEMODELORIGINHI).vec3f(I.e.INSTANCEMODELORIGINLO).mat3f(I.e.INSTANCEMODEL).mat3f(I.e.INSTANCEMODELNORMAL);return null!=e&&e.includes("featureAttribute")&&(t=t.vec4f(I.e.INSTANCEFEATUREATTRIBUTE)),null!=e&&e.includes("color")&&(t=t.vec4u8(I.e.INSTANCECOLOR)),null!=e&&e.includes("objectAndLayerIdColor")&&(t=t.vec4u8(I.e.INSTANCEOBJECTANDLAYERIDCOLOR)),t}(0,i.k)([(0,i.o)({constructOnly:!0})],Zt.prototype,"symbol",void 0),(0,i.k)([(0,i.o)({constructOnly:!0})],Zt.prototype,"optionalFields",void 0),(0,i.k)([(0,i.o)({constructOnly:!0})],Zt.prototype,"metadata",void 0),(0,i.k)([(0,i.o)({constructOnly:!0})],Zt.prototype,"shaderTransformation",void 0),(0,i.k)([(0,i.o)()],Zt.prototype,"_instanceData",void 0),(0,i.k)([(0,i.o)()],Zt.prototype,"_cycleStartIndex",void 0),(0,i.k)([(0,i.o)({readOnly:!0})],Zt.prototype,"_enableLevelSelection",null),(0,i.k)([(0,i.o)()],Zt.prototype,"_updateCyclesWithStaticCamera",void 0),(0,i.k)([(0,i.o)({readOnly:!0})],Zt.prototype,"running",null),Zt=(0,i.k)([(0,i.A)("esri.views.3d.webgl-engine.lib.lodRendering.LodRenderer")],Zt);const rr=(0,i.aA)(),ir=(0,_.n)(),nr=(0,O.e)(),sr=(0,i.aA)(),or=(0,i.aA)(),ar=[(0,_.r)(1,0,1,1),(0,_.r)(0,0,1,1),(0,_.r)(0,1,0,1),(0,_.r)(1,1,0,1),(0,_.r)(1,0,0,1)],lr=new b.N;let cr=class{constructor(e,t=null){this.geometry=e,this.textures=t}get material(){return this.geometry.material}get numTriangles(){return this.geometry instanceof b.r?this.geometry.indexCount/3:this.geometry.elementCount/3}};function ur(e){return e instanceof b.r?e.attributes.get(I.e.POSITION).indices.length:e.elementCount}let hr=class{constructor(e,t,r){this.components=e,this.minScreenSpaceRadius=t,this.pivotOffset=r;const n=(0,i.jp)(this.components.map((e=>e.geometry)));this.numVertices=n.reduce(((e,t)=>e+ur(t)),0)}},dr=class{constructor(e){this.levels=e,this.levels.sort(((e,t)=>e.minScreenSpaceRadius===t.minScreenSpaceRadius?e.numVertices-t.numVertices:e.minScreenSpaceRadius-t.minScreenSpaceRadius))}};function fr(e){const t=[];return e.levels.forEach((e=>e.components.forEach((e=>t.push(e.geometry.material))))),(0,i.jp)(t)}function pr(e){const t=new Array;return e.levels.forEach((e=>e.components.forEach((e=>{null!=e.textures&&t.push(...e.textures)})))),(0,i.jp)(t)}let mr=class{constructor(e){this._optionalFields=new Array,this._instanceIndexToFeatureId=new Map,this._featureIdToInstanceIndex=new Map,this._disposeResourceHandles=new Array,this._lodRendererResources=null,this.layerUid=e.layerUid,this.view=e.view,this.sharedResources=this.view.sharedSymbolResources,this.scheduler=this.view.resourceController.scheduler}async doLoad(e,t,r){(0,i.a$)("enable-feature:objectAndLayerId-rendering")&&this._optionalFields.push(I.e.OBJECTANDLAYERIDCOLOR);const n=gr((e=>t(e)),e),s=this.view._stage,o=fr(n);s.addMany(o),this._addDisposeResource((()=>s.removeMany(o)));const a=pr(n);s.addMany(a),this._addDisposeResource((()=>{a.forEach((e=>e.unload())),s.removeMany(a)})),await Promise.all(a.map((e=>this.view._stage.schedule((()=>e.load(s.renderView.renderingContext)),r)))),(0,i.D)(r);const l=await this._createLodRenderer(n,r);this._lodRendererResources={lodRenderer:l,materials:o,textures:a}}addInstances(e){const t=this._lodRendererResources;if(null==t)return;const{featureIds:r,localTransforms:i,globalTransforms:n}=e,s=t.lodRenderer;if(null==s)return;const o=s.instanceData,a=r.length;for(let l=0;l<a;++l){const e=r[l],t=o.addInstance(),s=o.view,a=16*l;s.localTransform.copyFromTypedBuffer(t,i,a),s.globalTransform.copyFromTypedBuffer(t,n,a),o.updateModelTransform(t),o.setVisible(t,!0),this._instanceIndexToFeatureId.set(t,e),this._featureIdToInstanceIndex.set(e,t)}}removeInstances(e){const t=this._lodRendererResources;if(null==t)return;const r=t?.lodRenderer,i=r.instanceData,n=this._instanceIndexToFeatureId,s=this._featureIdToInstanceIndex,o=e.length;for(let a=0;a<o;++a){const t=e[a],r=s.get(t);null!=r&&(i.removeInstance(r),n.delete(r),s.delete(t))}}_addDisposeResource(e){this._disposeResourceHandles.push(e)}async _createLodRenderer(e,t){const r=this.view._stage,i={layerUid:this.layerUid,graphicUid:e=>1,notifyGraphicGeometryChanged:e=>1,notifyGraphicVisibilityChanged:e=>1},n=new Zt({symbol:e,optionalFields:this._optionalFields,metadata:i,shaderTransformation:null},this.scheduler);return n.slicePlaneEnabled=!1,this._addDisposeResource((()=>{r.removeRenderPlugin(n),n.destroy()})),await r.addRenderPlugin(n,t),n}};function gr(e,t){const r=t.levels.map((t=>{const r=t.components.map((t=>{const r=e(t.materialId);if(!_r(r))throw new Error("LodRenderer only supports DefaultMaterial");const i=r.createBufferWriter(),n={material:r,vertexBufferLayout:i.vertexBufferLayout,buffer:t.renderGeometryBuffer.data,elementCount:t.renderGeometryBuffer.elementCount,boundingInfo:t.boundingInfo};return new cr(n)}));return new hr(r,t.minScreenSpaceRadius)}));return new dr(r)}function _r(e){return null!=e&&"materialType"in e&&"default"===e.materialType}mr=(0,i.k)([(0,i.A)("esri.views.3d.layers.graphics.pipeline.rendering.LodRenderer")],mr);const yr=128,vr=.5;function br(e){return"cross"===e||"x"===e}function wr(e,t=yr,r=t*vr,i=0){const n=Tr(e,t,r,i);return new b.C(n,{mipmap:!1,wrap:{s:G.D.CLAMP_TO_EDGE,t:G.D.CLAMP_TO_EDGE},width:t,height:t,components:4,noUnpackFlip:!0,reloadable:!0})}function Tr(e,t=yr,r=t*vr,i=0){switch(e){case"circle":default:return xr(t,r);case"square":return Sr(t,r);case"cross":return Or(t,r,i);case"x":return Ar(t,r,i);case"kite":return Rr(t,r);case"triangle":return Ir(t,r);case"arrow":return Er(t,r)}}function xr(e,t){const r=e/2-.5;return Pr(e,Fr(r,r,t/2))}function Sr(e,t){return Cr(e,t,!1)}function Rr(e,t){return Cr(e,t,!0)}function Or(e,t,r=0){return Mr(e,t,!1,r)}function Ar(e,t,r=0){return Mr(e,t,!0,r)}function Ir(e,t){return Pr(e,Dr(e/2,t,t/2))}function Er(e,t){const r=t,i=t/2,n=e/2,s=.8*r,o=Fr(n,(e-t)/2-s,Math.sqrt(s*s+i*i)),a=Dr(n,r,i);return Pr(e,((e,t)=>Math.max(a(e,t),-o(e,t))))}function Cr(e,t,r){return r&&(t/=Math.SQRT2),Pr(e,((i,n)=>{let s=i-.5*e+.25,o=.5*e-n-.75;if(r){const e=(s+o)/Math.SQRT2;o=(o-s)/Math.SQRT2,s=e}return Math.max(Math.abs(s),Math.abs(o))-.5*t}))}function Mr(e,t,r,i=0){t-=i,r&&(t*=Math.SQRT2);const n=.5*t;return Pr(e,((t,s)=>{let o,a=t-.5*e,l=.5*e-s-1;if(r){const e=(a+l)/Math.SQRT2;l=(l-a)/Math.SQRT2,a=e}return a=Math.abs(a),l=Math.abs(l),o=a>l?a>n?Math.sqrt((a-n)*(a-n)+l*l):l:l>n?Math.sqrt(a*a+(l-n)*(l-n)):a,o-=i/2,o}))}function Fr(e,t,r){return(i,n)=>{const s=i-e,o=n-t;return Math.sqrt(s*s+o*o)-r}}function Dr(e,t,r){const i=Math.sqrt(t*t+r*r);return(n,s)=>{const o=Math.abs(n-e)-r,a=s-e+t/2+.75,l=(t*o+r*a)/i,c=-a;return Math.max(l,c)}}function Pr(e,t){const r=new Uint8Array(4*e*e);for(let i=0;i<e;i++)for(let n=0;n<e;n++){const s=n+e*i;let o=t(n,i);o=o/e+.5,(0,Y.o)(o,r,4*s)}return r}function Nr(e){return e instanceof Float32Array&&e.length>=16}function Lr(e){return Array.isArray(e)&&e.length>=16}function kr(e){return Nr(e)||Lr(e)}const Br=.5;function jr(e,t){e.include(b.i),e.attributes.add(I.e.POSITION,"vec3"),e.attributes.add(I.e.NORMAL,"vec3"),e.attributes.add(I.e.CENTEROFFSETANDDISTANCE,"vec4");const r=e.vertex;(0,b.j)(r,t),(0,b.k)(r,t),r.uniforms.add(new b.l("viewport",((e,t)=>t.camera.fullViewport)),new b.m("polygonOffset",(e=>e.shaderPolygonOffset)),new b.m("cameraGroundRelative",((e,t)=>t.camera.aboveGround?1:-1))),t.hasVerticalOffset&&(0,b.p)(r),r.constants.add("smallOffsetAngle","float",.984807753012208),r.code.add(re.o`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`),r.code.add(re.o`
    float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
      float pointGroundSign = ${t.terrainDepthTest?re.o.float(0):re.o`sign(pointGroundDistance)`};
      if (pointGroundSign == 0.0) {
        pointGroundSign = cameraGroundRelative;
      }

      // cameraGroundRelative is -1 if camera is below ground, 1 if above ground
      // groundRelative is 1 if both camera and symbol are on the same side of the ground, -1 otherwise
      float groundRelative = cameraGroundRelative * pointGroundSign;

      // view angle dependent part of polygon offset emulation: we take the absolute value because the sign that is
      // dropped is instead introduced using the ground-relative position of the symbol and the camera
      if (polygonOffset > .0) {
        float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
        float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
        float factor = (1.0 - tanAlpha / viewport[2]);

        // same side of the terrain
        if (groundRelative > 0.0) {
          posView *= factor;
        }
        // opposite sides of the terrain
        else {
          posView /= factor;
        }
      }

      return groundRelative;
    }
  `),t.draped&&!t.hasVerticalOffset||(0,b.q)(r),t.draped||(r.uniforms.add(new b.m("perDistancePixelRatio",((e,t)=>Math.tan(t.camera.fovY/2)/(t.camera.fullViewport[2]/2)))),r.code.add(re.o`
    void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
      float distanceToCamera = length(posView);

      // Compute offset in world units for a half pixel shift
      float pixelOffset = distanceToCamera * perDistancePixelRatio * ${re.o.float(Br)};

      // Apply offset along normal in the direction away from the ground surface
      vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;

      // Apply the same offset also on the view space position
      vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;

      posModel += modelOffset;
      posView += viewOffset;
    }
  `)),t.screenCenterOffsetUnitsEnabled&&(0,b.w)(r),t.hasScreenSizePerspective&&(0,b.u)(r),r.code.add(re.o`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      vec3 centerOffset = centerOffsetAndDistance.xyz;
      float pointGroundDistance = centerOffsetAndDistance.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${t.draped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${t.hasScreenSizePerspective&&(t.hasVerticalOffset||t.screenCenterOffsetUnitsEnabled)?"vec3 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":""}

      ${t.hasVerticalOffset?t.hasScreenSizePerspective?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":""}

      ${t.hasVerticalOffset?re.o`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${t.screenCenterOffsetUnitsEnabled?"":re.o`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${t.screenCenterOffsetUnitsEnabled?t.hasScreenSizePerspective?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":""}

      ${t.screenCenterOffsetUnitsEnabled?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `)}let Gr=class{constructor(){this.factor=new zr,this.factorAlignment=new zr}},zr=class{constructor(){this.scale=0,this.factor=0,this.minScaleFactor=0}};function Vr(e){e.uniforms.add(new b.v("alignPixelEnabled",((e,t)=>t.alignPixelEnabled))),e.code.add(re.o`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`),e.code.add(re.o`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`)}function Ur(e,t){const{vertex:r,fragment:i}=e;e.include(b.x,t),r.include(Vr),t.terrainDepthTest&&e.varyings.add("depth","float"),r.main.add(re.o`
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      ${t.terrainDepthTest?re.o`depth = projectAux.posView.z;`:""}
      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }

    } else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  `),i.main.add(re.o`fragColor = vec4(1);
if(terrainDepthTest(depth)) {
fragColor.g = 0.5;
}`)}var Hr;function qr(e){e.vertex.uniforms.add(new b.m("renderTransparentlyOccludedHUD",((e,t)=>t.hudRenderStyle===Hr.Occluded?1:t.hudRenderStyle===Hr.NotOccluded?0:.75)),new b.l("viewport",((e,t)=>t.camera.fullViewport)),new b.y("hudVisibilityTexture",((e,t)=>t.hudVisibility?.getTexture()))),e.vertex.include(Vr),e.vertex.code.add(re.o`bool testHUDVisibility(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (renderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)}(function(e){e[e.Occluded=0]="Occluded",e[e.NotOccluded=1]="NotOccluded",e[e.Both=2]="Both",e[e.COUNT=3]="COUNT"})(Hr||(Hr={}));const Yr={occludedFadeFactor:.6};function Xr(e){const t=new b.z,r=e.signedDistanceFieldEnabled;if(t.include(jr,e),t.include(b.P,e),e.occlusionPass)return t.include(Ur,e),t;const{vertex:n,fragment:s}=t;t.include(b.i),t.include(b.D,e),t.include(b.E,e),t.include(qr),s.include(ne),s.include(b.F),t.varyings.add("vcolor","vec4"),t.varyings.add("vtc","vec2"),t.varyings.add("vsize","vec2"),t.varyings.add("voccluded","float"),n.uniforms.add(new b.l("viewport",((e,t)=>t.camera.fullViewport)),new b.G("screenOffset",((e,t)=>(0,y.o)(Jr,2*e.screenOffset[0]*t.camera.pixelRatio,2*e.screenOffset[1]*t.camera.pixelRatio))),new b.G("anchorPosition",(e=>$r(e))),new b.l("materialColor",(e=>e.color)),new b.m("materialRotation",(e=>e.rotation))),(0,b.w)(n),r&&(n.uniforms.add(new b.l("outlineColor",(e=>e.outlineColor))),s.uniforms.add(new b.l("outlineColor",(e=>Wr(e)?e.outlineColor:_.s)),new b.m("outlineSize",(e=>Wr(e)?e.outlineSize:0)))),e.horizonCullingEnabled&&n.uniforms.add(new se("pointDistanceSphere",((e,t)=>{const r=t.camera.eye,n=e.origin;return(0,_.r)(n[0]-r[0],n[1]-r[1],n[2]-r[2],i.a3.radius)}))),e.pixelSnappingEnabled&&n.include(Vr),e.hasScreenSizePerspective&&((0,b.H)(n),(0,b.u)(n)),e.debugDrawLabelBorder&&t.varyings.add("debugBorderCoords","vec4"),t.attributes.add(I.e.UV0,"vec2"),t.attributes.add(I.e.COLOR,"vec4"),t.attributes.add(I.e.SIZE,"vec2"),t.attributes.add(I.e.ROTATION,"float"),t.attributes.add(I.e.FEATUREATTRIBUTE,"vec4"),n.code.add(e.horizonCullingEnabled?re.o`bool behindHorizon(vec3 posModel) {
vec3 camToEarthCenter = pointDistanceSphere.xyz - localOrigin;
vec3 camToPos = pointDistanceSphere.xyz + posModel;
float earthRadius = pointDistanceSphere.w;
float a = dot(camToPos, camToPos);
float b = dot(camToPos, camToEarthCenter);
float c = dot(camToEarthCenter, camToEarthCenter) - earthRadius * earthRadius;
return  b > 0.0 && b < a && b * b  > a * c;
}`:re.o`bool behindHorizon(vec3 posModel) { return false; }`),n.main.add(re.o`
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      forwardObjectAndLayerIdColor();

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }

      if (behindHorizon(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }

      vec2 inputSize;
      ${(0,re.r)(e.hasScreenSizePerspective,re.o`
          inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
          vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);`,re.o`
          inputSize = size;
          vec2 screenOffsetScaled = screenOffset;`)}
      ${(0,re.r)(e.vvSize,re.o`inputSize *= vvScale(featureAttribute).xx;`)}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);
      bool visible = testHUDVisibility(posProj);
      voccluded = visible ? 0.0 : 1.0;
    `);const o=re.o`
      vec2 uv01 = floor(uv0);
      vec2 uv = uv0 - uv01;
      quadOffset.xy = (uv01 - anchorPosition) * 2.0 * combinedSize;

      ${(0,re.r)(e.hasRotation,re.o`
          float angle = radians(materialRotation + rotation);
          float cosAngle = cos(angle);
          float sinAngle = sin(angle);
          mat2 rotate = mat2(cosAngle, -sinAngle, sinAngle,  cosAngle);

          quadOffset.xy = rotate * quadOffset.xy;
        `)}

      quadOffset.xy = (quadOffset.xy + screenOffsetScaled) / viewport.zw * posProj.w;
  `,a=e.pixelSnappingEnabled?r?re.o`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:re.o`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:re.o`posProj += quadOffset;`;n.main.add(re.o`
    ${(0,re.r)(e.occlusionTestEnabled,re.o`
      if (!visible) {
        vtc = vec2(0.0);
        ${(0,re.r)(e.debugDrawLabelBorder,"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);")}
        return;
      }`)}
    ${o}
    ${e.vvColor?"vcolor = interpolateVVColor(featureAttribute.y) * materialColor;":"vcolor = color / 255.0 * materialColor;"}

    ${(0,re.r)(e.output===T.b.ObjectAndLayerIdColor,re.o`vcolor.a = 1.0;`)}

    bool alphaDiscard = vcolor.a < ${re.o.float(X.o)};
    ${(0,re.r)(r,`alphaDiscard = alphaDiscard && outlineColor.a < ${re.o.float(X.o)};`)}
    if (alphaDiscard) {
      // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    } else {
      ${a}
      gl_Position = posProj;
    }

    vtc = uv;

    ${(0,re.r)(e.debugDrawLabelBorder,re.o`debugBorderCoords = vec4(uv01, 1.5 / combinedSize);`)}
    vsize = inputSize;
  `),s.uniforms.add(new b.y("tex",(e=>e.texture))),e.occludedFragmentFade&&(s.uniforms.add(new b.y("depthMap",((e,t)=>t.mainDepth))),s.uniforms.add(new b.m("fadeFactor",(()=>Yr.occludedFadeFactor))));const l=e.debugDrawLabelBorder?re.o`(isBorder > 0.0 ? 0.0 : ${re.o.float(X.o)})`:re.o.float(X.o),c=e.output===T.b.Highlight,u=re.o`
    ${(0,re.r)(e.debugDrawLabelBorder,re.o`float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`)}

    ${(0,re.r)(e.sampleSignedDistanceFieldTexelCenter,re.o`
      float txSize = float(textureSize(tex, 0).x);
      float texelSize = 1.0 / txSize;

      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;`,re.o`vec2 samplePos = vtc;`)}

    ${r?re.o`
      vec4 fillPixelColor = vcolor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${l} ||
          fillPixelColor.a + outlinePixelColor.a < ${re.o.float(X.o)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        ${(0,re.r)(!c,re.o`fragColor = vec4(compositeColor, compositeAlpha);`)}
      } else {
        if (fillAlphaFactor < ${l}) {
          discard;
        }

        ${(0,re.r)(!c,re.o`fragColor = premultiplyAlpha(fillPixelColor);`)}
      }

      // visualize SDF:
      // fragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:re.o`
          vec4 texColor = texture(tex, vtc, -0.5);
          if (texColor.a < ${l}) {
            discard;
          }
          ${(0,re.r)(!c,re.o`fragColor = texColor * premultiplyAlpha(vcolor);`)}
          `}

    ${(0,re.r)(e.occludedFragmentFade&&!c,re.o`
        float zSample = texelFetch(depthMap, ivec2(gl_FragCoord.xy), 0).x;
        if (zSample < gl_FragCoord.z) {
          fragColor *= fadeFactor;
        }
        `)}

    ${(0,re.r)(!c&&e.debugDrawLabelBorder,re.o`fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);`)}
  `;switch(e.output){case T.b.Color:e.oitPass===b.J.ColorAlpha&&(t.outputs.add("fragColor","vec4",0),t.outputs.add("fragAlpha","float",1)),s.main.add(re.o`
        ${u}
        ${(0,re.r)(e.oitPass===b.J.FrontFace,re.o`fragColor.rgb /= fragColor.a;`)}
        ${(0,re.r)(e.oitPass===b.J.ColorAlpha,re.o`fragAlpha = fragColor.a;`)}`);break;case T.b.ObjectAndLayerIdColor:s.main.add(re.o`
        ${u}
        outputObjectAndLayerIdColor();`);break;case T.b.Highlight:t.include(b.I,e),s.main.add(re.o`
        ${u}
        outputHighlight(voccluded == 1.0);`)}return t}function Wr(e){return e.outlineColor[3]>0&&e.outlineSize>0}function $r(e,t=Jr){return e.textureIsSignedDistanceField?Qr(e.anchorPosition,e.distanceFieldBoundingBox,t):(0,y.r)(t,e.anchorPosition),t}function Qr(e,t,r){null!=t?(0,y.o)(r,e[0]*(t[2]-t[0])+t[0],e[1]*(t[3]-t[1])+t[1]):(0,y.o)(r,0,0)}const Jr=(0,v.n)(),Zr=Object.freeze(Object.defineProperty({__proto__:null,build:Xr,calculateAnchorPosForRendering:$r,shaderSettings:Yr},Symbol.toStringTag,{value:"Module"}));let Kr=class extends b.K{constructor(e,t,r){super(e,t,new b.L(Zr,(()=>Promise.resolve().then((()=>Qn)))),r),this.primitiveType=t.occlusionPass?G.E.POINTS:G.E.TRIANGLES}initializePipeline(e){const{oitPass:t,hasPolygonOffset:r,draped:i,output:n,depthTestEnabled:s}=e,o=t===b.J.NONE,a=r?ei:null,l=t===b.J.ColorAlpha,c=i||!s||l||n===T.b.Highlight?null:W.p;return(0,W.B)({blending:n===T.b.Color?o?W.o:(0,b.T)(t):null,depthTest:s&&!i?{func:G.O.LEQUAL}:null,depthWrite:c,drawBuffers:(0,b.M)(t,n),colorWrite:W.g,polygonOffset:a})}};const ei={factor:0,units:-4};let ti=class extends b.R{constructor(e){super(),this.spherical=e,this.screenCenterOffsetUnitsEnabled=!1,this.occlusionTestEnabled=!0,this.signedDistanceFieldEnabled=!1,this.sampleSignedDistanceFieldTexelCenter=!1,this.vvSize=!1,this.vvColor=!1,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.hasRotation=!1,this.debugDrawLabelBorder=!1,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.depthTestEnabled=!0,this.pixelSnappingEnabled=!0,this.draped=!1,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.occlusionPass=!1,this.occludedFragmentFade=!1,this.objectAndLayerIdColorInstanced=!1,this.horizonCullingEnabled=!0,this.textureCoordinateType=b.S.None,this.emissionSource=b.U.None,this.discardInvisibleFragments=!0,this.hasSliceInVertexProgram=!0,this.hasVvInstancing=!1}};(0,i.k)([(0,b.Q)()],ti.prototype,"screenCenterOffsetUnitsEnabled",void 0),(0,i.k)([(0,b.Q)()],ti.prototype,"occlusionTestEnabled",void 0),(0,i.k)([(0,b.Q)()],ti.prototype,"signedDistanceFieldEnabled",void 0),(0,i.k)([(0,b.Q)()],ti.prototype,"sampleSignedDistanceFieldTexelCenter",void 0),(0,i.k)([(0,b.Q)()],ti.prototype,"vvSize",void 0),(0,i.k)([(0,b.Q)()],ti.prototype,"vvColor",void 0),(0,i.k)([(0,b.Q)()],ti.prototype,"hasVerticalOffset",void 0),(0,i.k)([(0,b.Q)()],ti.prototype,"hasScreenSizePerspective",void 0),(0,i.k)([(0,b.Q)()],ti.prototype,"hasRotation",void 0),(0,i.k)([(0,b.Q)()],ti.prototype,"debugDrawLabelBorder",void 0),(0,i.k)([(0,b.Q)()],ti.prototype,"hasSlicePlane",void 0),(0,i.k)([(0,b.Q)()],ti.prototype,"hasPolygonOffset",void 0),(0,i.k)([(0,b.Q)()],ti.prototype,"depthTestEnabled",void 0),(0,i.k)([(0,b.Q)()],ti.prototype,"pixelSnappingEnabled",void 0),(0,i.k)([(0,b.Q)()],ti.prototype,"draped",void 0),(0,i.k)([(0,b.Q)()],ti.prototype,"terrainDepthTest",void 0),(0,i.k)([(0,b.Q)()],ti.prototype,"cullAboveTerrain",void 0),(0,i.k)([(0,b.Q)()],ti.prototype,"occlusionPass",void 0),(0,i.k)([(0,b.Q)()],ti.prototype,"occludedFragmentFade",void 0),(0,i.k)([(0,b.Q)()],ti.prototype,"objectAndLayerIdColorInstanced",void 0),(0,i.k)([(0,b.Q)()],ti.prototype,"horizonCullingEnabled",void 0);class ri extends b.V{constructor(e,t){super(e,Ai),this.produces=new Map([[b.A.HUD_MATERIAL,e=>(0,T.d)(e)&&!this.parameters.drawInSecondSlot],[b.A.LABEL_MATERIAL,e=>(0,T.d)(e)&&this.parameters.drawInSecondSlot],[b.A.OCCLUSION_PIXELS,()=>this.parameters.occlusionTest],[b.A.DRAPED_MATERIAL,e=>this.parameters.draped&&(0,T.d)(e)]]),this._visible=!0,this._configuration=new ti(t)}getConfiguration(e,t){return this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVerticalOffset=!!this.parameters.verticalOffset,this._configuration.hasScreenSizePerspective=!!this.parameters.screenSizePerspective,this._configuration.screenCenterOffsetUnitsEnabled="screen"===this.parameters.centerOffsetUnits,this._configuration.hasPolygonOffset=this.parameters.polygonOffset,this._configuration.draped=this.parameters.draped,this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled,this._configuration.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField,this._configuration.sampleSignedDistanceFieldTexelCenter=this.parameters.sampleSignedDistanceFieldTexelCenter,this._configuration.hasRotation=this.parameters.hasRotation,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.occlusionPass=t.slot===b.A.OCCLUSION_PIXELS,this._configuration.occludedFragmentFade=this.parameters.occludedFragmentFade,this._configuration.horizonCullingEnabled=this.parameters.horizonCullingEnabled,this._configuration.depthTestEnabled=this.parameters.depthEnabled||t.slot===b.A.OCCLUSION_PIXELS,e===T.b.Color&&(this._configuration.debugDrawLabelBorder=!!b.g.LABELS_SHOW_BORDER),this._configuration.oitPass=t.oitPass,this._configuration.terrainDepthTest=t.terrainDepthTest,this._configuration.cullAboveTerrain=t.cullAboveTerrain,this._configuration}intersect(e,t,r,n,s,o){const{options:{selectionMode:a,hud:l,excludeLabels:c},point:u,camera:h}=r,{parameters:d}=this;if(!a||!l||c&&d.isLabel||!e.visible||!u)return;const{scaleX:f,scaleY:p}=this._getScreenScale(e,h.pixelRatio);(0,L.n)(gi,t),e.attributes.has(I.e.FEATUREATTRIBUTE)&&oi(gi);const m=e.attributes.get(I.e.POSITION),g=e.attributes.get(I.e.SIZE),_=e.attributes.get(I.e.NORMAL),y=e.attributes.get(I.e.ROTATION),v=e.attributes.get(I.e.CENTEROFFSETANDDISTANCE);(0,A.s)(m.size>=3);const w=$r(d),T="screen"===this.parameters.centerOffsetUnits;for(let x=0;x<m.data.length/m.size;x++){const e=x*m.size;(0,E.o)(ci,m.data[e],m.data[e+1],m.data[e+2]),(0,E.E)(ci,ci,t),(0,E.E)(ci,ci,h.viewMatrix);const n=x*v.size;if((0,E.o)(vi,v.data[n],v.data[n+1],v.data[n+2]),!T&&(ci[0]+=vi[0],ci[1]+=vi[1],0!==vi[2])){const e=vi[2];(0,E.A)(vi,ci),(0,E.c)(ci,ci,(0,E.g)(vi,vi,e))}const s=x*_.size;if((0,E.o)(ui,_.data[s],_.data[s+1],_.data[s+2]),si(ui,gi,h,Ti),this._applyVerticalOffsetTransformationView(ci,Ti,h,li),h.applyProjection(ci,hi),hi[0]>-1){T&&(vi[0]||vi[1])&&(hi[0]+=vi[0]*h.pixelRatio,0!==vi[1]&&(hi[1]+=(0,b.W)(vi[1],li.factorAlignment)*h.pixelRatio),h.unapplyProjection(hi,ci)),hi[0]+=this.parameters.screenOffset[0]*h.pixelRatio,hi[1]+=this.parameters.screenOffset[1]*h.pixelRatio,hi[0]=Math.floor(hi[0]),hi[1]=Math.floor(hi[1]);const e=x*g.size;Ri[0]=g.data[e],Ri[1]=g.data[e+1],(0,b.X)(Ri,li.factor,Ri);const t=xi*h.pixelRatio;let n=0;d.textureIsSignedDistanceField&&(n=Math.min(d.outlineSize,.5*Ri[0])*h.pixelRatio/2),Ri[0]*=f,Ri[1]*=p;const s=x*y.size,a=d.rotation+y.data[s];if(ai(u,hi[0],hi[1],Ri,t,n,a,d,w)){const e=r.ray;if((0,E.E)(fi,ci,(0,R.h)(yi,h.viewMatrix)),hi[0]=u[0],hi[1]=u[1],h.unprojectFromRenderScreen(hi,ci)){const t=(0,i.aA)();(0,E.s)(t,e.direction);const r=1/(0,E.r)(t);(0,E.g)(t,t,r),o((0,E.p)(e.origin,ci)*r,t,-1,!0,1,fi)}}}}}intersectDraped(e,t,r,i,n,s){const o=e.attributes.get(I.e.POSITION),a=e.attributes.get(I.e.SIZE),l=e.attributes.get(I.e.ROTATION),c=this.parameters,u=$r(c),{scaleX:h,scaleY:d}=this._getScreenScale(e,e.screenToWorldRatio),f=Si*e.screenToWorldRatio;for(let p=0;p<o.data.length/o.size;p++){const t=p*o.size,r=o.data[t],m=o.data[t+1],g=p*a.size;Ri[0]=a.data[g],Ri[1]=a.data[g+1];let _=0;c.textureIsSignedDistanceField&&(_=Math.min(c.outlineSize,.5*Ri[0])*e.screenToWorldRatio/2),Ri[0]*=h,Ri[1]*=d;const y=p*l.size,v=c.rotation+l.data[y];ai(i,r,m,Ri,f,_,v,c,u)&&n(s.dist,s.normal,-1,!1)}}createBufferWriter(){return new Ci}_updateScaleInfo(e,t,r){const i=this.parameters;null!=i.screenSizePerspective?(0,b.Y)(r,t,i.screenSizePerspective,e.factor):(e.factor.scale=1,e.factor.factor=0,e.factor.minScaleFactor=0),null!=i.screenSizePerspectiveAlignment?(0,b.Y)(r,t,i.screenSizePerspectiveAlignment,e.factorAlignment):(e.factorAlignment.factor=e.factor.factor,e.factorAlignment.scale=e.factor.scale,e.factorAlignment.minScaleFactor=e.factor.minScaleFactor)}applyShaderOffsetsView(e,t,r,i,n,s,o){const a=si(t,r,n,Ti);return this._applyVerticalGroundOffsetView(e,a,n,o),this._applyVerticalOffsetTransformationView(o,a,n,s),this._applyPolygonOffsetView(o,a,i[3],n,o),this._applyCenterOffsetView(o,i,o),o}applyShaderOffsetsNDC(e,t,r,i,n){return this._applyCenterOffsetNDC(e,t,r,i),null!=n&&(0,E.s)(n,i),this._applyPolygonOffsetNDC(i,t,r,i),i}_applyPolygonOffsetView(e,t,r,n,s){const o=n.aboveGround?1:-1;let a=Math.sign(r);0===a&&(a=o);const l=o*a;if(this.parameters.shaderPolygonOffset<=0)return(0,E.s)(s,e);const c=(0,i.aP)(Math.abs(t.cosAngle),.01,1),u=1-Math.sqrt(1-c*c)/c/n.viewport[2];return(0,E.g)(s,e,l>0?u:1/u),s}_applyVerticalGroundOffsetView(e,t,r,i){const n=(0,E.r)(e),s=r.aboveGround?1:-1,o=r.computeRenderPixelSizeAtDist(n)*Br,a=(0,E.g)(ci,t.normal,s*o);return(0,E.u)(i,e,a),i}_applyVerticalOffsetTransformationView(e,t,r,i){const n=this.parameters;if(!n.verticalOffset?.screenLength){if(n.screenSizePerspective||n.screenSizePerspectiveAlignment){const r=(0,E.r)(e);this._updateScaleInfo(i,r,t.cosAngle)}else i.factor.scale=1,i.factorAlignment.scale=1;return e}const s=(0,E.r)(e),o=n.screenSizePerspectiveAlignment??n.screenSizePerspective,a=(0,b.Z)(r,s,n.verticalOffset,t.cosAngle,o);return this._updateScaleInfo(i,s,t.cosAngle),(0,E.g)(t.normal,t.normal,a),(0,E.u)(e,e,t.normal)}_applyCenterOffsetView(e,t,r){const i="screen"!==this.parameters.centerOffsetUnits;return r!==e&&(0,E.s)(r,e),i&&(r[0]+=t[0],r[1]+=t[1],t[2]&&((0,E.A)(ui,r),(0,E.u)(r,r,(0,E.g)(ui,ui,t[2])))),r}_applyCenterOffsetNDC(e,t,r,i){const n="screen"!==this.parameters.centerOffsetUnits;return i!==e&&(0,E.s)(i,e),n||(i[0]+=t[0]/r.fullWidth*2,i[1]+=t[1]/r.fullHeight*2),i}_applyPolygonOffsetNDC(e,t,r,i){const n=this.parameters.shaderPolygonOffset;if(e!==i&&(0,E.s)(i,e),n){const e=r.aboveGround?1:-1,s=e*Math.sign(t[3]);i[2]-=(s||e)*n}return i}set visible(e){this._visible=e}get visible(){const{color:e,outlineSize:t,outlineColor:r}=this.parameters,i=e[3]>=X.o||t>=X.o&&r[3]>=X.o;return this._visible&&i}createGLMaterial(e){return new ii(e)}calculateRelativeScreenBounds(e,t,r=(0,i.bS)()){return ni(this.parameters,e,t,r),r[2]=r[0]+e[0],r[3]=r[1]+e[1],r}_getScreenScale(e,t){const r=e.attributes.get(I.e.FEATUREATTRIBUTE);if(null==r)return{scaleX:t,scaleY:t};const i=(0,_.u)(r.data,wi);return(0,b._)(bi,this.parameters,i),{scaleX:bi[0]*t,scaleY:bi[1]*t}}}class ii extends b.${constructor(e){super({...e,...e.material.parameters})}beginSlot(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.acquireTechnique(Kr,e)}}function ni(e,t,r,i){i[0]=e.anchorPosition[0]*-t[0]+e.screenOffset[0]*r,i[1]=e.anchorPosition[1]*-t[1]+e.screenOffset[1]*r}function si(e,t,r,i){return kr(t)&&(t=(0,L.n)(_i,t)),(0,E.N)(i.normal,e,t),(0,E.E)(i.normal,i.normal,r.viewInverseTransposeMatrix),i.cosAngle=(0,E.P)(di,Oi),i}function oi(e){const t=e[0],r=e[1],i=e[2],n=e[3],s=e[4],o=e[5],a=e[6],l=e[7],c=e[8],u=1/Math.sqrt(t*t+r*r+i*i),h=1/Math.sqrt(n*n+s*s+o*o),d=1/Math.sqrt(a*a+l*l+c*c);return e[0]=t*u,e[1]=r*u,e[2]=i*u,e[3]=n*h,e[4]=s*h,e[5]=o*h,e[6]=a*d,e[7]=l*d,e[8]=c*d,e}function ai(e,t,r,n,s,o,a,l,c){let u=t-s-n[0]*c[0],h=u+n[0]+2*s,d=r-s-n[1]*c[1],f=d+n[1]+2*s;const p=l.distanceFieldBoundingBox;return l.textureIsSignedDistanceField&&null!=p&&(u+=n[0]*p[0],d+=n[1]*p[1],h-=n[0]*(1-p[2]),f-=n[1]*(1-p[3]),u-=o,h+=o,d-=o,f+=o),(0,y.o)(mi,t,r),(0,y.I)(pi,e,mi,(0,i.eI)(a)),pi[0]>u&&pi[0]<h&&pi[1]>d&&pi[1]<f}const li=new Gr,ci=(0,i.aA)(),ui=(0,i.aA)(),hi=(0,_.n)(),di=(0,i.aA)(),fi=(0,i.aA)(),pi=(0,v.n)(),mi=(0,v.n)(),gi=(0,k.e)(),_i=(0,k.e)(),yi=(0,O.e)(),vi=(0,i.aA)(),bi=(0,i.aA)(),wi=(0,_.n)(),Ti={normal:di,cosAngle:0},xi=1,Si=2,Ri=[0,0],Oi=(0,i.cp)(0,0,1);class Ai extends b.a0{constructor(){super(...arguments),this.renderOccluded=b.a1.Occlude,this.isDecoration=!1,this.color=(0,_.e)(1,1,1,1),this.polygonOffset=!1,this.anchorPosition=(0,v.r)(.5,.5),this.screenOffset=[0,0],this.shaderPolygonOffset=1e-5,this.textureIsSignedDistanceField=!1,this.sampleSignedDistanceFieldTexelCenter=!1,this.outlineColor=(0,_.e)(1,1,1,1),this.outlineSize=0,this.rotation=0,this.hasRotation=!1,this.vvSizeEnabled=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.hasSlicePlane=!1,this.pixelSnappingEnabled=!0,this.occlusionTest=!0,this.occludedFragmentFade=!1,this.horizonCullingEnabled=!1,this.centerOffsetUnits="world",this.drawInSecondSlot=!1,this.depthEnabled=!0,this.draped=!1,this.isLabel=!1}}const Ii=(0,C.H)().vec3f(I.e.POSITION).vec3f(I.e.NORMAL).vec2f(I.e.UV0).vec4u8(I.e.COLOR).vec2f(I.e.SIZE).f32(I.e.ROTATION).vec4f(I.e.CENTEROFFSETANDDISTANCE).vec4f(I.e.FEATUREATTRIBUTE),Ei=Ii.clone().vec4u8(I.e.OBJECTANDLAYERIDCOLOR);class Ci{constructor(){this.vertexBufferLayout=(0,b.a2)()?Ei:Ii}elementCount(e){return 6*e.get(I.e.POSITION).indices.length}write(e,t,r,i,n,s){(0,b.a3)(r.get(I.e.POSITION),e,n.position,s,6),(0,b.a4)(r.get(I.e.NORMAL),t,n.normal,s,6);const o=r.get(I.e.UV0)?.data;let a=0,l=0,c=1,u=1;o&&o.length>=4&&(a=o[0],l=o[1],c=o[2],u=o[3]),c=Math.min(1.99999,c+1),u=Math.min(1.99999,u+1);let h=r.get(I.e.POSITION).indices.length,d=s;const f=n.uv0;for(let _=0;_<h;++_)f.set(d,0,a),f.set(d,1,l),d++,f.set(d,0,c),f.set(d,1,l),d++,f.set(d,0,c),f.set(d,1,u),d++,f.set(d,0,c),f.set(d,1,u),d++,f.set(d,0,a),f.set(d,1,u),d++,f.set(d,0,a),f.set(d,1,l),d++;(0,b.a5)(r.get(I.e.COLOR),4,n.color,s,6);const{data:p,indices:m}=r.get(I.e.SIZE);h=m.length;const g=n.size;d=s;for(let _=0;_<h;++_){const e=p[2*m[_]],t=p[2*m[_]+1];for(let r=0;r<6;++r)g.set(d,0,e),g.set(d,1,t),d++}if((0,b.a6)(r.get(I.e.ROTATION),n.rotation,s,6),r.get(I.e.CENTEROFFSETANDDISTANCE)?(0,b.a7)(r.get(I.e.CENTEROFFSETANDDISTANCE),n.centerOffsetAndDistance,s,6):(0,b.a8)(n.centerOffsetAndDistance,s,6*h),r.get(I.e.FEATUREATTRIBUTE)?(0,b.a7)(r.get(I.e.FEATUREATTRIBUTE),n.featureAttribute,s,6):(0,b.a8)(n.featureAttribute,s,6*h),null!=i){const e=r.get(I.e.POSITION)?.indices;if(e){const t=e.length,r=n.getField(I.e.OBJECTANDLAYERIDCOLOR,B.x);(0,b.a9)(i,r,t,s,6)}}}}let Mi=class extends i.aD{constructor(e){super(),this.view=null,this.layerUid=null,this._renderGeometries=new Map,this._materials=new Map,this._directRenderers=new Map,this._lodRenderers=new Map,this.view=e.view,this.layerUid=e.layerUid}initialize(){}destroy(){}async executeRenderCommands(e){for(const t of e)switch(t.id){case"create-material":await this._createMaterial(t);break;case"create-direct-renderer":await this._createDirectRenderer(t);break;case"add-direct-renderer-geometry":await this._addDirectRendererGeometry(t);break;case"remove-direct-renderer-geometry":await this._removeDirectRendererGeometry(t);break;case"create-lod-renderer":await this._createLodRenderer(t);break;case"add-lod-instances":await this._addLodInstances(t);break;case"remove-lod-instances":await this._removeLodInstances(t)}}async _createMaterial(e){const{view:t}=this,{sharedSymbolResources:r}=t;if(null==r)throw new Error("No shared symbol resources found!");const{textures:n}=r,s=t.state.viewingMode===m.l.Global;let o=null;switch(e.type){case"default":o=Di(r,{physicalBasedRenderingEnabled:!0,slicePlaneEnabled:!1,castShadows:!0,isPrimitive:!0,screenSizePerspectiveEnabled:!0,doublePrecisionRequiresObfuscation:t._stage.renderView.renderingContext.driverTest.doublePrecisionRequiresObfuscation.result},s);break;case"hud":{const[e,t]=Fi(n,s);this.addHandles([(0,i.aH)((()=>(0,i.g1)(t)))]),o=e}break;default:throw new Error(`unable to create unknown material type ${e.type}`)}this._materials.set(e.materialId,o)}_getMaterial(e){return this._materials.get(e)}async _createDirectRenderer(e){const t=e.materialId,r=this._getMaterial(t);if(null==r)throw new Error(`material not found ${t}`);const{view:i}=this,n=new ot({material:r});this._directRenderers.set(t,n),i._stage.addRenderPlugin(n),i._stage.renderView.renderer.updateHasFlags()}async _addDirectRendererGeometry(e){const t=e.renderGeometryId,r=e.materialId;null!=this._renderGeometries.get(t)&&await this._removeDirectRendererGeometry({renderGeometryId:t});const i=this._directRenderers.get(r);if(null==i)return void console.error("no renderer assigned to provided material");const n=i.addRenderGeometry(t,e.renderGeometryBuffer,e.localOrigin);this._renderGeometries.set(t,{renderGeometry:n,materialId:r}),this.view._stage.renderView.requestRender()}async _removeDirectRendererGeometry(e){const t=e.renderGeometryId,r=this._renderGeometries.get(t);if(null==r)return;const i=r.materialId,n=this._directRenderers.get(i);null!=n?n.removeRenderGeometry(e.renderGeometryId):console.error("no renderer assigned to provided material")}async _createLodRenderer(e){const t=new mr({view:this.view,layerUid:this.layerUid}),r=new AbortController,i=e=>this._getMaterial(e);await t.doLoad(e.lodRenderGeometry,i,r.signal),this._lodRenderers.set(e.lodRendererId,t)}async _addLodInstances(e){const t=this._lodRenderers.get(e.lodRendererId);if(null==t)throw new Error("no lod renderer assigned to provided lod renderer Id");t.addInstances(e.data)}async _removeLodInstances(e){const t=this._lodRenderers.get(e.lodRendererId);if(null==t)throw new Error("no lod renderer assigned to provided lod renderer Id");t.removeInstances(e.featureIds)}};function Fi(e,t){const r={anchorPosition:Re.center,occlusionTest:!0,hasSlicePlane:!1},i=r,n=1;i.color=[1,0,0,1],i.outlineColor=[0,0,0,1],i.outlineSize=n;const s=null;if(null!=e){const t=e.fromData("circle-icon",(()=>wr("circle")));i.textureId=t.texture.id,i.textureIsSignedDistanceField=!0,i.sampleSignedDistanceFieldTexelCenter=br("circle")}return i.distanceFieldBoundingBox=Ni,[new ri(r,t),s]}function Di(e,t,r){const n={usePBR:t.physicalBasedRenderingEnabled,isSchematic:!0,mrrFactors:b.b,ambient:i.er,diffuse:i.er,hasSlicePlane:t.slicePlaneEnabled,hasSliceHighlight:!1,castShadows:t.castShadows,offsetTransparentBackfaces:!t.isPrimitive};return Pi(n),n.screenSizePerspective=e.screenSizePerspectiveSettings,n.externalColor=_.N,n.isInstanced=!0,new b.B(n,{spherical:r,doublePrecisionRequiresObfuscation:!0})}function Pi(e){const t=e.opacity??1,r=t<1;return e.transparent=r,e.opacity=t,e.cullFace=r?x.e.None:x.e.Back,e}Mi=(0,i.k)([(0,i.A)("esri.views.3d.layers.graphics.pipeline.rendering.FeaturePipelineRenderManager")],Mi);const Ni=[vr/2,vr/2,1-vr/2,1-vr/2];let Li=class{constructor(e){this._bufferWriter=null,this._bufferWriter=e.createBufferWriter()}createBuffer(e,t){const r=this._bufferWriter;let i=null;if(e.transformation&&t)(0,R.n)(ki,e.transformation),ki[12]-=t[0],ki[13]-=t[1],ki[14]-=t[2],i=ki;else{if(t)throw new Error("not implemented");e.transformation&&(i=e.transformation)}let n=null;i&&((0,R.h)(Bi,ki),(0,R.s)(Bi,Bi),n=Bi);const s=e.attributes,o=r.elementCount(s),a=r.vertexBufferLayout.stride/4;o>Math.floor(ji/a)&&console.warn("geometry with very large number of elements encountered");const l=r.vertexBufferLayout.createBuffer(o);return r.write(i,n,s,e.objectAndLayerIdColor,l,0),{data:l.buffer,elementCount:o}}};const ki=(0,O.e)(),Bi=(0,O.e)(),ji=4194304;let Gi=class{constructor(e){this._context=e,this._commands=[],this._transferables=new Set}createMaterial(e){const t=this._context,r=t.generateId("material");switch(e){case"default":{const e=new b.B({},{spherical:this._context.globalViewingMode,doublePrecisionRequiresObfuscation:!0}),i=new Li(e);t.registerRenderGeometryBufferWriter(r,i)}break;case"hud":{const e=Fi(null,this._context.globalViewingMode)[0],i=new Li(e);t.registerRenderGeometryBufferWriter(r,i)}}return this._commands.push({id:"create-material",type:e,materialId:r}),r}createDirectRenderer(e){const t=this._context.generateId("material-renderer");return this._commands.push({id:"create-direct-renderer",materialRendererId:t,materialId:e}),t}addDirectRendererGeometry(e,t,r){const i=t.materialId,n=this._context.getRenderGeometryBufferWriter(i);if(null==n)throw new Error(`no bufferwriter found for material ${i}`);const s=n.createBuffer(t,r);this._transferables.add(s.data),this._commands.push({id:"add-direct-renderer-geometry",renderGeometryId:e,materialId:i,renderGeometryBuffer:s,localOrigin:r})}removeDirectRendererGeometry(e){this._commands.push({id:"remove-direct-renderer-geometry",renderGeometryId:e})}createLodRenderer(e){const t=this._context.generateId("lod-renderer"),r={levels:e.levels.map((e=>({components:e.components.map((e=>{const t=e.attributes.get(I.e.POSITION);if(!t||0===t.indices.length)throw new Error("positions attribute expected");const r=3,i=(0,g.l)(t.indices.length/r),n=new b.a(i,r,t),s=this._context.getRenderGeometryBufferWriter(e.materialId);if(null==s)throw new Error("writer not found");const o=s.createBuffer(e,null);return this._transferables.add(o.data),{materialId:e.materialId,renderGeometryBuffer:o,boundingInfo:{bbMax:n.bbMax,bbMin:n.bbMin}}})),minScreenSpaceRadius:e.minScreenSpaceRadius})))};return this._commands.push({id:"create-lod-renderer",lodRendererId:t,lodRenderGeometry:r}),t}addLodInstances(e,t){this._commands.push({id:"add-lod-instances",lodRendererId:e,data:t}),this._transferables.add(t.featureIds.buffer),this._transferables.add(t.globalTransforms.buffer),this._transferables.add(t.localTransforms.buffer)}removeLodInstances(e,t){this._commands.push({id:"remove-lod-instances",lodRendererId:e,featureIds:t}),this._transferables.add(t.buffer)}async dispatch(){const e=this._commands,t=Array.from(this._transferables);this._clearCommandBuffer(),this._context.dispatchRenderCommands(e,t)}_clearCommandBuffer(){this._commands=[],this._transferables.clear()}},zi=class{constructor(e){this._idCounter=0,this._bufferWriters=new Map,this._dispatchRenderCommandsCallback=async()=>{},this.globalViewingMode=!1,this.globalViewingMode=e.viewingMode===m.l.Global,this._dispatchRenderCommandsCallback=e.dispatchRenderCommandsCallback}generateId(e=""){return`${e}${this._idCounter++}`}createEncoder(){return new Gi(this)}async dispatchRenderCommands(e,t){this._dispatchRenderCommandsCallback(e,t)}registerRenderGeometryBufferWriter(e,t){this._bufferWriters.set(e,t)}getRenderGeometryBufferWriter(e){return this._bufferWriters.get(e)}};var Vi;async function Ui(e,t){const{numFeatures:r,tile:i,partitionInfo:n}=e,{pages:s}=i;if(0===s.length||0===r)return new Uint32Array;const o=new Uint32Array(r);if(n){const e=s.reduce(((e,{featureCount:t})=>e+t),0),t=new Uint32Array(e);let i=0;for(const r of s)i=r.readAllObjectIds(t,i);const a=n.tileIndices;for(let n=0;n<r;++n){const e=t[a[n]];o[n]=e}}else{let e=0;for(const t of s)e=t.readAllObjectIds(o,e)}return o}async function Hi(e,t){const{numFeatures:r,tile:i,partitionInfo:n}=e,{pages:s}=i;if(0===s.length||0===r)return new Float64Array;const o=new Float64Array(3*r);if(n){const e=s.reduce(((e,{featureCount:t})=>e+t),0),t=new Float64Array(3*e);let i=0;for(const r of s)i=r.readAllCoordinates(t,i);const a=n.tileIndices;for(let n=0;n<r;++n){const e=a[n],r=t[3*e+0],i=t[3*e+1],s=t[3*e+2];o[3*n+0]=r,o[3*n+1]=i,o[3*n+2]=s}}else{let e=0;for(const t of s)e=t.readAllCoordinates(o,e)}return o}async function qi(e,t){await e.provision([Vi.GEOMETRY_MAP_COORDINATES],t);const{numFeatures:r,tile:i,mapCoordinates:n}=e,{pages:s}=i;if(0===s.length||0===r)return new Float64Array;const o=t.viewSpatialReference,a=t.renderSpatialReference,l=new Float64Array(3*r);if(!(0,$.n)(n,o,0,l,a,0,r))throw new Error("Failed to project coordinates");return l}async function Yi(e,t){const r=t.viewSpatialReference,n=t.renderSpatialReference,s=e.tile.descriptor.extent,o=(0,i.kn)(s),a=(0,i.aA)();return(0,Q.a)([o[0],o[1],0],r,a,n),a}(function(e){e[e.OBJECT_ID=0]="OBJECT_ID",e[e.PARTITION_ID=1]="PARTITION_ID",e[e.GEOMETRY_MAP_COORDINATES=2]="GEOMETRY_MAP_COORDINATES",e[e.GEOMETRY_RENDER_COORDINATES=3]="GEOMETRY_RENDER_COORDINATES",e[e.TILE_CENTER_RENDER_COORDINATES=4]="TILE_CENTER_RENDER_COORDINATES"})(Vi||(Vi={}));let Xi=class{constructor(e,t,r=null){this._tile=e,this._numFeatures=t,this._partitionInfo=r}get partitionInfo(){return this._partitionInfo}get tile(){return this._tile}get numFeatures(){return this._numFeatures}get tileId(){return this._tile.descriptor.id}get objectIds(){if(null==this._objectIds)throw new Error("objectIds haven't been provisioned yet");return this._objectIds}get partitionIds(){if(null==this._partitionIds)throw new Error("partitionIds haven't been provisioned yet");return this._partitionIds}get mapCoordinates(){if(null==this._mapCoordinates)throw new Error("mapCoordinates haven't been provisioned yet");return this._mapCoordinates}get renderCoordinates(){if(null==this._renderCoordinates)throw new Error("renderCoordinates haven't been provisioned yet");return this._renderCoordinates}get tileCenterRenderCoordinates(){if(null==this._tileCenterRenderCoordinates)throw new Error("tileCenterRenderCoordinates hasn't been provisioned yet");return this._tileCenterRenderCoordinates}async provision(e,t){for(const r of e)switch(r){case Vi.OBJECT_ID:if(this._objectIds)return;this._objectIds=await Ui(this);break;case Vi.PARTITION_ID:if(this._partitionIds)return;this._partitionIds=new Uint32Array(this._numFeatures);break;case Vi.GEOMETRY_MAP_COORDINATES:if(this._mapCoordinates)return;this._mapCoordinates=await Hi(this);break;case Vi.GEOMETRY_RENDER_COORDINATES:if(this._renderCoordinates)return;this._renderCoordinates=await qi(this,t);break;case Vi.TILE_CENTER_RENDER_COORDINATES:if(this._tileCenterRenderCoordinates)return;this._tileCenterRenderCoordinates=await Yi(this,t);break;default:throw new Error("not implemented")}}dispose(){if(this.partitions){for(const e of this.partitions)e.dispose();this.partitions=void 0}}};function Wi(e=i.er,t,r,n=1){const s=new Array(3);if(null==t||null==r)s[0]=1,s[1]=1,s[2]=1;else{let i,n=0;for(let o=2;o>=0;o--){const a=e[o];let l;const c=null!=a,u=0===o&&!i&&!c,h=r[o];"symbol-value"===a||u?l=0!==h?t[o]/h:1:c&&"proportional"!==a&&isFinite(a)&&(l=0!==h?a/h:1),null!=l&&(s[o]=l,i=l,n=Math.max(n,Math.abs(l)))}for(let e=2;e>=0;e--)null==s[e]?s[e]=i:0===s[e]&&(s[e]=.001*n)}for(let i=2;i>=0;i--)s[i]/=n;return(0,i.e$)(s)}function $i(e){const t=new Map;for(const[r,i]of e)t.set(r,{...i,indices:(0,g.t)(i.indices)});return t}var Qi;(function(e){function t(e,t){const r=e[t],i=e[t+1],n=e[t+2];return Math.sqrt(r*r+i*i+n*n)}function r(e,t){const r=e[t],i=e[t+1],n=e[t+2],s=1/Math.sqrt(r*r+i*i+n*n);e[t]*=s,e[t+1]*=s,e[t+2]*=s}function i(e,t,r){e[t]*=r,e[t+1]*=r,e[t+2]*=r}function n(e,t,r,i,n,s=t){(n=n||e)[s]=e[t]+r[i],n[s+1]=e[t+1]+r[i+1],n[s+2]=e[t+2]+r[i+2]}function s(e,t,r,i,n,s=t){(n=n||e)[s]=e[t]-r[i],n[s+1]=e[t+1]-r[i+1],n[s+2]=e[t+2]-r[i+2]}e.length=t,e.normalize=r,e.scale=i,e.add=n,e.subtract=s})(Qi||(Qi={}));const Ji=new Array(36);for(let Jn=0;Jn<6;Jn++)for(let e=0;e<6;e++)Ji[6*Jn+e]=Jn;const Zi=new Array(36);for(let Jn=0;Jn<6;Jn++)Zi[6*Jn]=0,Zi[6*Jn+1]=1,Zi[6*Jn+2]=2,Zi[6*Jn+3]=2,Zi[6*Jn+4]=3,Zi[6*Jn+5]=0;const Ki=(0,Z.r)(-.5,0,-.5),en=(0,Z.r)(.5,0,-.5),tn=(0,Z.r)(0,0,.5),rn=(0,Z.r)(0,.5,0),nn=(0,Z.n)(),sn=(0,Z.n)(),on=(0,Z.n)(),an=(0,Z.n)(),ln=(0,Z.n)();function cn(e,t,r,i,n=!0,s=!0){let o=0;const a=t,l=e;let c=(0,Z.r)(0,o,0),u=(0,Z.r)(0,o+l,0),h=(0,Z.r)(0,-1,0),d=(0,Z.r)(0,1,0);const f=[u,c],p=[h,d],m=r+2,g=Math.sqrt(l*l+a*a);for(let b=0;b<r;b++){const e=b*(2*Math.PI/r),t=(0,Z.r)(Math.cos(e)*a,o,Math.sin(e)*a);f.push(t);const i=(0,Z.r)(l*Math.cos(e)/g,a/g,l*Math.sin(e)/g);p.push(i)}const _=new Array,y=new Array;if(n){for(let e=3;e<f.length;e++)_.push(1),_.push(e-1),_.push(e),y.push(0),y.push(0),y.push(0);_.push(f.length-1),_.push(2),_.push(1),y.push(0),y.push(0),y.push(0)}if(s){for(let e=3;e<f.length;e++)_.push(e),_.push(e-1),_.push(0),y.push(e),y.push(e-1),y.push(1);_.push(0),_.push(2),_.push(f.length-1),y.push(1),y.push(2),y.push(p.length-1)}const v=(0,b.c)(3*m);for(let b=0;b<m;b++)v[3*b]=f[b][0],v[3*b+1]=f[b][1],v[3*b+2]=f[b][2];const w=(0,b.c)(3*m);for(let b=0;b<m;b++)w[3*b]=p[b][0],w[3*b+1]=p[b][1],w[3*b+2]=p[b][2];return[[I.e.POSITION,new K.t(v,_,3,!0)],[I.e.NORMAL,new K.t(w,y,3,!0)]]}function un(e,t){const r=(e,r,i=!1)=>({levels:e.map((e=>{const n=$i(r(e.tesselation));return i&&hn(n),{components:[{attributes:n,objectAndLayerIdColor:void 0,transformation:null,materialId:t}],minScreenSpaceRadius:e.minScreenSpaceRadius}}))});switch(e){case"cone":return r(fn,(e=>cn(1,.5,e)),!0);case"sphere":case"cube":case"inverted-cone":case"cylinder":case"tetrahedron":case"diamond":throw new Error("not implemented");default:return}}function hn(e){const t=e,r=t.get(I.e.POSITION).data,i=t.get(I.e.NORMAL).data;if(i){const t=dn(e,I.e.NORMAL).data;for(let e=0;e<i.length;e+=3){const r=i[e+1];t[e+1]=-i[e+2],t[e+2]=r}}if(r){const t=dn(e,I.e.POSITION).data;for(let e=0;e<r.length;e+=3){const i=r[e+1];t[e+1]=-r[e+2],t[e+2]=i}}}function dn(e,t){let r=e.get(t);return r&&!r.exclusive&&(r={...r,exclusive:!0,data:(0,b.o)(r.data)},e.set(t,r)),r}(0,E.c)(nn,Ki,rn),(0,E.c)(sn,Ki,en),(0,E._)(on,nn,sn),(0,E.A)(on,on),(0,E.c)(nn,en,rn),(0,E.c)(sn,en,tn),(0,E._)(an,nn,sn),(0,E.A)(an,an),(0,E.c)(nn,tn,rn),(0,E.c)(sn,tn,Ki),(0,E._)(ln,nn,sn),(0,E.A)(ln,ln),on[0],on[1],on[2],an[0],an[1],an[2],ln[0],ln[1],ln[2];const fn=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}];let pn=class extends i.aD{constructor(e){super(),this._context=e,this.lodRendererId=null,this._loaded=!1}get loaded(){return this._loaded}async load(e){const t=e.createMaterial("default"),r=un("cone",t);this.lodRendererId=e.createLodRenderer(r),this._loaded=!0}async add(e,t){if(null==this.lodRendererId)throw new Error("expected lod renderer id to not be null");await this._provisionFeatureData(e);const r=e.numFeatures,n=!0,s=(0,i.bO)((0,i.d3)("cone")),o=(0,i.e$)((0,i.d2)(s)),a=(0,i.e$)((0,i.ko)(o,{isPrimitive:n,width:100,depth:null,height:null})),l=new Float64Array(16*r),c=new Float64Array(16*r),u=e.mapCoordinates;for(let i=0;i<r;++i){const e=i,t=u[3*i+0],r=u[3*i+1],n=u[3*i+2],s=this._computeGlobalTransform(t,r,n,this._context.viewSpatialReference,_n),h=this._computeLocalTransform(a,o,gn);this._writeMatrixToTypedBuffer(l,e,h),this._writeMatrixToTypedBuffer(c,e,s)}const h={featureIds:new Uint32Array(e.objectIds),localTransforms:l,globalTransforms:c};t.addLodInstances(this.lodRendererId,h)}async remove(e,t){if(null==this.lodRendererId)return;const r=new Uint32Array(e.objectIds);t.removeLodInstances(this.lodRendererId,r)}async _provisionFeatureData(e){await e.provision([Vi.GEOMETRY_MAP_COORDINATES,Vi.OBJECT_ID],this._context)}_writeMatrixToTypedBuffer(e,t,r){let i=16*t;for(let n=0;n<16;n++)e[i++]=r[n]}_computeGlobalTransform(e,t,r,i,n){return mn[0]=e,mn[1]=t,mn[2]=r,(0,J.C)(i,mn,n,this._context.renderSpatialReference),n}_computeLocalTransform(e,t,r){return(0,R.o)(r),this._applyObjectScale(e,t,r),r}_applyObjectScale(e,t,r){const i=Wi(e,e,t,this._context.renderCoordsHelper.unitInMeters);1===i[0]&&1===i[1]&&1===i[2]||(0,R.f)(r,r,i)}};pn=(0,i.k)([(0,i.A)("esri.views.3d.layers.graphics.pipeline.symbolization.TestObjectSymbol")],pn);const mn=(0,i.aA)(),gn=(0,O.e)(),_n=(0,O.e)();let yn=class extends i.aD{constructor(e){super(),this._context=e,this.materialId=null,this._loaded=!1}get loaded(){return this._loaded}async load(e){this.materialId=e.createMaterial("hud"),e.createDirectRenderer(this.materialId),this._loaded=!0}async add(e,t){if(null==this.materialId)throw new Error("expected material not to be null");await this._provisionFeatureData(e);const{numFeatures:r,tileId:i,renderCoordinates:n,tileCenterRenderCoordinates:s}=e,o=new Float64Array([0,0,1]),a=new Float64Array([255,255,255,255]),l=new Float64Array([24,24]),c=new Float64Array([0,0,0,1]),u=new Float64Array([0,0]),h=new Float64Array([0]),d=new Uint32Array(r);for(let x=0;x<r;++x)d[x]=x;const f=new Uint32Array(r);for(let x=0;x<r;++x)f[x]=0;const p=new K.t(n,d,3,!0),m=new K.t(o,f,3,!0),g=new K.t(u,f,2,!0),_=new K.t(a,f,4,!0),y=new K.t(h,f,1,!0),v=new K.t(l,f,2,!0),b=new K.t(c,f,4,!0),w=[[I.e.POSITION,p],[I.e.NORMAL,m],[I.e.UV0,g],[I.e.COLOR,_],[I.e.ROTATION,y],[I.e.SIZE,v],[I.e.CENTEROFFSETANDDISTANCE,b]],T={attributes:$i(w),objectAndLayerIdColor:void 0,transformation:(0,O.e)(),materialId:this.materialId};t.addDirectRendererGeometry(i,T,s)}async remove(e,t){t.removeDirectRendererGeometry(e.tileId)}async _provisionFeatureData(e){await e.provision([Vi.GEOMETRY_RENDER_COORDINATES,Vi.TILE_CENTER_RENDER_COORDINATES],this._context)}};yn=(0,i.k)([(0,i.A)("esri.views.3d.layers.graphics.pipeline.symbolization.TestSymbol")],yn);class vn{constructor(e){this._symbols=new Map,this._context=e}async load(){this._symbols.set(0,new yn(this._context)),this._symbols.set(1,new pn(this._context))}async add(e,t){await this._provisionFeatureData(e,this._context);const r=this._partition(e);await Promise.all(r.map((async e=>{const r=await this._provisionSymbol(e.partitionInfo?.index,t);r&&await r.add(e,t)})))}async remove(e,t){const r=e.partitions;if(!r)throw new Error("partitioned featureset expected");await Promise.all(r.map((async e=>{const r=await this._provisionSymbol(e.partitionInfo?.index,t);r&&await r.remove(e,t)})))}async _provisionFeatureData(e,t){await e.provision([Vi.PARTITION_ID,Vi.OBJECT_ID],t)}async _provisionSymbol(e,t){if(null==e)return null;const r=this._symbols.get(e);return r?(r.loaded||await r.load(t),r):null}_partition(e){const{numFeatures:t,objectIds:r,partitionIds:i}=e,n=[[],[]];for(let s=0;s<t;++s){const e=r[s]%2;n[e].push(s),i[s]=e}return e.partitions=n.filter((e=>e.length>0)).map(((t,r)=>{const i=t.length,n={index:r,tileIndices:new Uint32Array(t)};return new Xi(e.tile,i,n)})),e.partitions}}function bn(e,t,r){return!!(0,Q.a)(e,t,wn,r.spatialReference)&&(r.x=wn[0],r.y=wn[1],r.z=wn[2],!0)}const wn=(0,i.aA)();function Tn(e){const{value:t,operations:r}=e;return{operations:r,value:r.create(t)}}function xn(e,t,r){return e.operations.setExtent(e.value,t,r.value),r}function Sn(e,t){return e.operations.getExtent(e.value,t),t}function Rn(e){return{operations:e,value:e.create()}}function On(e,t,r=Rn(e)){return r.operations=e,e.copy(t,r.value),r}function An(e){return On(D.f,(0,D.V)(0,0,0,(0,i.fJ)(e).radius))}const In=2**50;function En(){return On(z.k,(0,z.J)([0,0,0],[In,0,0],[0,In,0]))}function Cn(e,t,r){return e.operations.axisAt(e.value,t,i.cD.Z,r)}function Mn(e,t,r,i){return e.operations.axisAt(e.value,t,r,i)}function Fn(e,t,r){return e.operations.intersectRay(e.value,t,r)}function Dn(e,t,r){return e.operations.intersectRayClosestSilhouette(e.value,t,r)}function Pn(e,t){return e.operations.altitudeAt(e.value,t)}function Nn(e,t,r,i){return e.operations.setAltitudeAt(e.value,t,r,i)}function Ln(e,t,r,i){return t!==i&&(0,R.n)(i,t),(0,E.o)(Bn,i[12],i[13],i[14]),Nn(e,Bn,r,Bn),i[12]=Bn[0],i[13]=Bn[1],i[14]=Bn[2],i}function kn(e,t,r){return e.operations.elevate(e.value,t,r.value)}const Bn=(0,i.aA)();function jn(e){return"point"===e.type}class Gn{constructor(e,t,r,n){this.viewingMode=e,this.spatialReference=t,this.unitInMeters=r,this._coordinateSystem=n,this._tmpCoordinateSystem=Tn(n),this.referenceEllipsoid=(0,i.fJ)(t),this.sphericalPCPF=(0,ee.a)(t)}set extent(e){e&&xn(this._coordinateSystem,e,this._coordinateSystem)}get extent(){return Sn(this._coordinateSystem,(0,i.bS)())}getAltitude(e){return Pn(this._coordinateSystem,e)}setAltitude(e,t,r=e){return Nn(this._coordinateSystem,r,t,e)}setAltitudeOfTransformation(e,t){Ln(this._coordinateSystem,t,e,t)}worldUpAtPosition(e,t){return Cn(this._coordinateSystem,e,t)}worldBasisAtPosition(e,t,r){return Mn(this._coordinateSystem,e,t,r)}basisMatrixAtPosition(e,t){const r=this.worldBasisAtPosition(e,i.cD.X,P.c.get()),n=this.worldBasisAtPosition(e,i.cD.Y,P.c.get()),s=this.worldBasisAtPosition(e,i.cD.Z,P.c.get());return(0,R.r)(t,r[0],r[1],r[2],0,n[0],n[1],n[2],0,s[0],s[1],s[2],0,0,0,0,1),t}headingAtPosition(e,t){const r=this.worldUpAtPosition(e,P.c.get()),n=this.worldBasisAtPosition(e,i.cD.Y,P.c.get()),s=(0,P.u)(t,n,r);return(0,i.dg)(s)}intersectManifoldClosestSilhouette(e,t,r){return kn(this._coordinateSystem,t,this._tmpCoordinateSystem),Dn(this._tmpCoordinateSystem,e,r),r}intersectManifold(e,t,r){kn(this._coordinateSystem,t,this._tmpCoordinateSystem);const i=P.c.get();return Fn(this._tmpCoordinateSystem,e,i)?(0,E.s)(r,i):null}intersectInfiniteManifold(e,t,r){if(this.viewingMode===m.l.Global)return this.intersectManifold(e,t,r);kn(this._coordinateSystem,t,this._tmpCoordinateSystem);const i=this._tmpCoordinateSystem.value,n=P.c.get();return(0,P.x)(i.plane,e,n)?(0,E.s)(r,n):null}toRenderCoords(e,t,r){return jn(e)?(0,te.c)(e,t,this.spatialReference):(0,Q.a)(e,t,r,this.spatialReference)}fromRenderCoords(e,t,r=null){return jn(t)?(null!=r&&(t.spatialReference=r),bn(e,this.spatialReference,t)?t:null):(0,Q.a)(e,this.spatialReference,t,r)?t:null}static create(e,t){switch(e){case m.l.Local:return new Gn(m.l.Local,t,(0,i.bq)(t),En());case m.l.Global:return new Gn(m.l.Global,t,1,An(t))}}static renderUnitScaleFactor(e,t){return(0,i.eG)(e)/(0,i.eG)(t)}}class zn{constructor(e){this._tileFeatureData=new Map,this._context={viewSpatialReference:e.viewSpatialReference,renderSpatialReference:e.renderSpatialReference,renderCoordsHelper:Gn.create(e.viewingMode,e.renderSpatialReference)}}async add(e,t){this._featureRenderer||(this._featureRenderer=new vn(this._context),await this._featureRenderer.load());const r=this._addTileFeatureData(e);await this._featureRenderer.add(r,t)}async remove(e,t){const r=this._getFeatureSetFromTileId(e);r&&(this._featureRenderer&&this._featureRenderer.remove(r,t),this._removeTileFeatureData(e))}_getFeatureSetFromTileId(e){return this._tileFeatureData.get(e)}_addTileFeatureData(e){const t=e.descriptor.id,r=e.pages.reduce(((e,{featureCount:t})=>e+t),0),i=new Xi(e,r);return this._tileFeatureData.set(t,i),i}_removeTileFeatureData(e){const t=this._tileFeatureData.get(e);t&&(t.dispose(),this._tileFeatureData.delete(e))}}let Vn=class extends i.bP.EventedAccessor{constructor(){super(...arguments),this.remoteClient=null,this._featureStore=new ce,this._tileManager=new oe({addTile:(e,t)=>this._addTile(e,t),removeTiles:e=>this._removeTiles(e)}),this._renderCommandContext=null,this._fetcher=null,this._symbolizer=null,this._queryEngine=null,this._defaultQueryJSON=null}get updating(){return this._tileManager.updating}destroy(){this._featureStore.clear(),this._tileManager.destroy()}async setup({viewSpatialReference:e,renderSpatialReference:t,viewingMode:r,baseQuery:o,url:a,objectIdField:l,capabilities:c,fieldsIndex:u,timeInfo:h}){this._renderCommandContext=new zi({viewingMode:r,dispatchRenderCommandsCallback:(e,t)=>this.remoteClient.invoke("dispatchRenderCommands",e,{transferList:t})});const d=i.B.fromJSON(e),f=i.B.fromJSON(t);return this._fetcher=new xe(d,s.b.fromJSON(o),a,l,c),this._symbolizer=new zn({viewSpatialReference:d,renderSpatialReference:f,viewingMode:r}),this._queryEngine=new n.V({hasZ:!0,hasM:!1,geometryType:"esriGeometryPoint",objectIdField:l,fieldsIndex:u,availableFields:[l],spatialReference:e,featureStore:this._featureStore,timeInfo:h}),this._defaultQueryJSON=new s.b({outSpatialReference:d}).toJSON(),this.addHandles((0,i.aE)((()=>this.updating),(async e=>{this.emit("notify-updating",{updating:e})})),i.cR),Hn}async executeQuery(e,t){return{result:await this._queryEngine.executeQuery(this._ensureQuery(e),t)}}async executeQueryForIds(e,t){const r=await this._queryEngine.executeQueryForIdSet(this._ensureQuery(e),t);return{result:Array.from(r)}}async executeQueryForCount(e,t){return{result:await this._queryEngine.executeQueryForCount(this._ensureQuery(e),t)}}async executeQueryForExtent(e,t){return{result:await this._queryEngine.executeQueryForExtent(this._ensureQuery(e),t)}}async executeQueryForLatestObservations(e,t){return{result:await this._queryEngine.executeQueryForLatestObservations(this._ensureQuery(e),t)}}async onTileTreeChange(e){return await this._tileManager.onTileTreeChange(e),Hn}async _addTile(e,t){const r=await this._fetcher.fetch(e,t);(0,i.D)(t),this._featureStore.addTile(r);const n=this._renderCommandContext.createEncoder();return await this._symbolizer.add(r,n),await n.dispatch(),r}async _removeTiles(e){const t=this._renderCommandContext.createEncoder(),r=this._featureStore,i=this._symbolizer;for(const n of e)r.removeTile(n.tileId),await i.remove(n.tileId,t);await t.dispatch()}_ensureQuery(e){return e??this._defaultQueryJSON}};(0,i.k)([(0,i.o)()],Vn.prototype,"updating",null),Vn=(0,i.k)([(0,i.A)("esri.views.3d.layers.graphics.pipeline.Feature3DPipelineWorker")],Vn);const Un=Vn,Hn={result:void 0},qn=Object.freeze(Object.defineProperty({__proto__:null,default:Un},Symbol.toStringTag,{value:"Module"})),Yn=Object.freeze(Object.defineProperty({__proto__:null,build:b.aa},Symbol.toStringTag,{value:"Module"})),Xn=Object.freeze(Object.defineProperty({__proto__:null,build:b.ab,getRadius:b.ac},Symbol.toStringTag,{value:"Module"})),Wn=Object.freeze(Object.defineProperty({__proto__:null,build:b.ad},Symbol.toStringTag,{value:"Module"})),$n=Object.freeze(Object.defineProperty({__proto__:null,build:b.ae},Symbol.toStringTag,{value:"Module"})),Qn=Object.freeze(Object.defineProperty({__proto__:null,build:Xr,calculateAnchorPosForRendering:$r,shaderSettings:Yr},Symbol.toStringTag,{value:"Module"}))},90326:function(e,t,r){var i,n;r.d(t,{e:function(){return n},i:function(){return i}}),function(e){e[e.OBJECT=0]="OBJECT",e[e.HUD=1]="HUD",e[e.TERRAIN=2]="TERRAIN",e[e.OVERLAY=3]="OVERLAY",e[e.I3S=4]="I3S",e[e.PCL=5]="PCL",e[e.LOD=6]="LOD",e[e.VOXEL=7]="VOXEL",e[e.TILES3D=8]="TILES3D"}(i||(i={})),function(e){e[e.MIN=0]="MIN",e[e.MINMAX=1]="MINMAX",e[e.ALL=2]="ALL"}(n||(n={}))},85650:function(e,t,r){r.d(t,{a:function(){return o},b:function(){return l}});var i,n=r(98503);let s=i=class extends((0,n.a_)(n.v)){constructor(e){super(e),this.type="georeferenced",this.origin=null}};s.absolute=new i,(0,n.k)([(0,n.bk)({georeferenced:"georeferenced"},{readOnly:!0})],s.prototype,"type",void 0),(0,n.k)([(0,n.o)({type:[Number],nonNullable:!1,json:{write:!0}})],s.prototype,"origin",void 0),s=i=(0,n.k)([(0,n.A)("esri.geometry.support.MeshGeoreferencedVertexSpace")],s);const o=s;let a=class extends((0,n.a_)(n.v)){constructor(e){super(e),this.type="local",this.origin=(0,n.aA)()}};(0,n.k)([(0,n.bk)({local:"local"},{readOnly:!0})],a.prototype,"type",void 0),(0,n.k)([(0,n.o)({type:[Number],nonNullable:!0,json:{write:!0}})],a.prototype,"origin",void 0),a=(0,n.k)([(0,n.A)("esri.geometry.support.MeshLocalVertexSpace")],a);const l=a},8460:function(e,t,r){r.d(t,{H:function(){return p},L:function(){return _},N:function(){return g},Y:function(){return ne}});var i,n,s=r(98503),o=r(92157),a=r(31178),l=r(74362),c=r(90211),u=r(83448),h=r(8082),d=r(93942);function f(e){return e?{ray:(0,a.b)(e.ray),c0:e.c0,c1:e.c1}:{ray:(0,a.b)(),c0:0,c1:Number.MAX_VALUE}}function p(e){return e?[(0,h.M)(e[0]),(0,h.M)(e[1]),(0,h.M)(e[2]),(0,h.M)(e[3]),(0,h.M)(e[4]),(0,h.M)(e[5])]:[(0,h.M)(),(0,h.M)(),(0,h.M)(),(0,h.M)(),(0,h.M)(),(0,h.M)()]}function m(){return[(0,s.aA)(),(0,s.aA)(),(0,s.aA)(),(0,s.aA)(),(0,s.aA)(),(0,s.aA)(),(0,s.aA)(),(0,s.aA)()]}function g(e,t){for(let r=0;r<b;r++)(0,h.h)(e[r],t[r]);return e}function _(e,t,r,i=x){const n=(0,l.c)(h.a.get(),t,e);(0,l.h)(n,n);for(let s=0;s<w;++s){const e=(0,c.z)(h.r.get(),T[s],n);(0,o.o)(i[s],e[0]/e[3],e[1]/e[3],e[2]/e[3])}y(r,i)}function y(e,t){(0,h.p)(t[n.FAR_BOTTOM_LEFT],t[n.NEAR_BOTTOM_LEFT],t[n.NEAR_TOP_LEFT],e[i.LEFT]),(0,h.p)(t[n.NEAR_BOTTOM_RIGHT],t[n.FAR_BOTTOM_RIGHT],t[n.FAR_TOP_RIGHT],e[i.RIGHT]),(0,h.p)(t[n.FAR_BOTTOM_LEFT],t[n.FAR_BOTTOM_RIGHT],t[n.NEAR_BOTTOM_RIGHT],e[i.BOTTOM]),(0,h.p)(t[n.NEAR_TOP_LEFT],t[n.NEAR_TOP_RIGHT],t[n.FAR_TOP_RIGHT],e[i.TOP]),(0,h.p)(t[n.NEAR_BOTTOM_LEFT],t[n.NEAR_BOTTOM_RIGHT],t[n.NEAR_TOP_RIGHT],e[i.NEAR]),(0,h.p)(t[n.FAR_BOTTOM_RIGHT],t[n.FAR_BOTTOM_LEFT],t[n.FAR_TOP_LEFT],e[i.FAR])}function v(e,t){for(let r=0;r<b;r++){const i=e[r];if(i[0]*t[0]+i[1]*t[1]+i[2]*t[2]+i[3]>=t[3])return!1}return!0}new a.s((()=>f())),function(e){e[e.LEFT=0]="LEFT",e[e.RIGHT=1]="RIGHT",e[e.BOTTOM=2]="BOTTOM",e[e.TOP=3]="TOP",e[e.NEAR=4]="NEAR",e[e.FAR=5]="FAR"}(i||(i={})),function(e){e[e.NEAR_BOTTOM_LEFT=0]="NEAR_BOTTOM_LEFT",e[e.NEAR_BOTTOM_RIGHT=1]="NEAR_BOTTOM_RIGHT",e[e.NEAR_TOP_RIGHT=2]="NEAR_TOP_RIGHT",e[e.NEAR_TOP_LEFT=3]="NEAR_TOP_LEFT",e[e.FAR_BOTTOM_LEFT=4]="FAR_BOTTOM_LEFT",e[e.FAR_BOTTOM_RIGHT=5]="FAR_BOTTOM_RIGHT",e[e.FAR_TOP_RIGHT=6]="FAR_TOP_RIGHT",e[e.FAR_TOP_LEFT=7]="FAR_TOP_LEFT"}(n||(n={})),n.FAR_BOTTOM_RIGHT,n.NEAR_BOTTOM_RIGHT,n.NEAR_BOTTOM_LEFT,n.FAR_BOTTOM_LEFT,n.NEAR_BOTTOM_LEFT,n.NEAR_BOTTOM_RIGHT,n.NEAR_TOP_RIGHT,n.NEAR_TOP_LEFT,n.FAR_BOTTOM_RIGHT,n.FAR_BOTTOM_LEFT,n.FAR_TOP_LEFT,n.FAR_TOP_RIGHT,n.NEAR_BOTTOM_RIGHT,n.FAR_BOTTOM_RIGHT,n.FAR_TOP_RIGHT,n.NEAR_TOP_RIGHT,n.FAR_BOTTOM_LEFT,n.NEAR_BOTTOM_LEFT,n.NEAR_TOP_LEFT,n.FAR_TOP_LEFT,n.FAR_TOP_LEFT,n.NEAR_TOP_LEFT,n.NEAR_TOP_RIGHT,n.FAR_TOP_RIGHT;const b=6,w=8,T=[(0,u.r)(-1,-1,-1,1),(0,u.r)(1,-1,-1,1),(0,u.r)(1,1,-1,1),(0,u.r)(-1,1,-1,1),(0,u.r)(-1,-1,1,1),(0,u.r)(1,-1,1,1),(0,u.r)(1,1,1,1),(0,u.r)(-1,1,1,1)];new a.s(f);const x=m();class S{get bounds(){return this._root.bounds}get halfSize(){return this._root.halfSize}get root(){return this._root.node}get maximumObjectsPerNode(){return this._maximumObjectsPerNode}get maximumDepth(){return this._maximumDepth}get objectCount(){return this._objectCount}constructor(e,t){this.objectToBoundingSphere=e,this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._root=new R,this._objectCount=0,t&&(void 0!==t.maximumObjectsPerNode&&(this._maximumObjectsPerNode=t.maximumObjectsPerNode),void 0!==t.maximumDepth&&(this._maximumDepth=t.maximumDepth))}destroy(){this._degenerateObjects.clear(),R.clearPool(),H[0]=null,Q.prune(),re.prune()}add(e,t=e.length){this._objectCount+=t,this._grow(e,t);const r=R.acquire();for(let i=0;i<t;i++){const t=e[i];this._isDegenerate(t)?this._degenerateObjects.add(t):(r.init(this._root),this._add(t,r))}R.release(r)}remove(e,t=null){this._objectCount-=e.length;const r=R.acquire();for(const i of e){const e=t??(0,a.a)(this.objectToBoundingSphere(i),J);G(e[3])?(r.init(this._root),I(i,e,r)):this._degenerateObjects.delete(i)}R.release(r),this._shrink()}update(e,t){if(!G(t[3])&&this._isDegenerate(e))return;const r=q(e);this.remove(r,t),this.add(r)}forEachAlongRay(e,t,r){const i=(0,a.k)(e,t);O(this._root,(e=>{if(!C(i,e))return!1;const t=e.node;return t.terminals.forAll((e=>{this._intersectsObject(i,e)&&r(e)})),null!==t.residents&&t.residents.forAll((e=>{this._intersectsObject(i,e)&&r(e)})),!0}))}forEachAlongRayWithVerticalOffset(e,t,r,i){const n=(0,a.k)(e,t);O(this._root,(e=>{if(!M(n,e,i))return!1;const t=e.node;return t.terminals.forAll((e=>{this._intersectsObjectWithOffset(n,e,i)&&r(e)})),null!==t.residents&&t.residents.forAll((e=>{this._intersectsObjectWithOffset(n,e,i)&&r(e)})),!0}))}forEach(e){O(this._root,(t=>{const r=t.node;return r.terminals.forAll(e),null!==r.residents&&r.residents.forAll(e),!0})),this._degenerateObjects.forEach(e)}forEachDegenerateObject(e){this._degenerateObjects.forEach(e)}findClosest(e,t,r,i=()=>!0,n=1/0){let s=1/0,l=1/0,c=null;const u=B(e,t),h=o=>{if(--n,!i(o))return;const u=this.objectToBoundingSphere(o);if(!v(r,u))return;const h=j(e,t,(0,a.U)(u)),d=h-u[3],f=h+u[3];d<s&&(s=d,l=f,c=o)};return A(this._root,(i=>{if(n<=0||!v(r,i.bounds)||((0,o.g)(X,u,i.halfSize),(0,o.u)(X,X,(0,a.U)(i.bounds)),j(e,t,X)>l))return!1;const s=i.node;return s.terminals.forAll((e=>h(e))),null!==s.residents&&s.residents.forAll((e=>h(e))),!0}),e,t),c}forEachInDepthRange(e,t,r,i,n,s,l){let c=-1/0,u=1/0;const h={setRange:e=>{r===S.DepthOrder.FRONT_TO_BACK?(c=Math.max(c,e.near),u=Math.min(u,e.far)):(c=Math.max(c,-e.far),u=Math.min(u,-e.near))}};h.setRange(i);const d=j(t,r,e),f=B(t,r),p=B(t,-r),m=e=>{if(!l(e))return;const i=this.objectToBoundingSphere(e),o=(0,a.U)(i),f=j(t,r,o)-d,p=f-i[3],m=f+i[3];p>u||m<c||!v(s,i)||n(e,h)};A(this._root,(e=>{if(!v(s,e.bounds)||((0,o.g)(X,f,e.halfSize),(0,o.u)(X,X,(0,a.U)(e.bounds)),j(t,r,X)-d>u)||((0,o.g)(X,p,e.halfSize),(0,o.u)(X,X,(0,a.U)(e.bounds)),j(t,r,X)-d<c))return!1;const i=e.node;return i.terminals.forAll((e=>m(e))),null!==i.residents&&i.residents.forAll((e=>m(e))),!0}),t,r)}forEachNode(e){O(this._root,(t=>e(t.node,t.bounds,t.halfSize,t.depth)))}forEachNeighbor(e,t){const r=(0,a.N)(t),i=(0,a.U)(t),n=t=>{const n=this.objectToBoundingSphere(t),s=(0,a.N)(n),l=r+s;return!((0,o.v)((0,a.U)(n),i)-l*l<=0)||e(t)};let s=!0;const l=e=>{s&&(s=n(e))};O(this._root,(e=>{const t=(0,a.N)(e.bounds),n=r+t;if((0,o.v)((0,a.U)(e.bounds),i)-n*n>0)return!1;const c=e.node;return c.terminals.forAll(l),s&&null!==c.residents&&c.residents.forAll(l),s})),s&&this.forEachDegenerateObject(l)}_intersectsObject(e,t){const r=this.objectToBoundingSphere(t);return!(r[3]>0)||(0,a.H)(r,e)}_intersectsObjectWithOffset(e,t,r){const i=this.objectToBoundingSphere(t);return!(i[3]>0)||(0,a.H)(r.applyToBoundingSphere(i),e)}_add(e,t){t.advanceTo(this.objectToBoundingSphere(e))?t.node.terminals.push(e):(t.node.residents.push(e),t.node.residents.length>this._maximumObjectsPerNode&&t.depth<this._maximumDepth&&this._split(t))}_split(e){const t=e.node.residents;e.node.residents=null;for(let r=0;r<t.length;r++){const i=R.acquire().init(e);this._add(t.at(r),i),R.release(i)}}_grow(e,t){if(0!==t&&(L(e,t,(e=>this.objectToBoundingSphere(e)),Z),G(Z[3])&&!this._fitsInsideTree(Z)))if(F(this._root.node))(0,a.a)(Z,this._root.bounds),this._root.halfSize=1.25*this._root.bounds[3],this._root.updateBoundsRadiusFromHalfSize();else{const e=this._rootBoundsForRootAsSubNode(Z);this._placingRootViolatesMaxDepth(e)?this._rebuildTree(Z,e):this._growRootAsSubNode(e),R.release(e)}}_rebuildTree(e,t){(0,o.s)((0,a.U)(K),(0,a.U)(t.bounds)),K[3]=t.halfSize,L([e,K],2,(e=>e),ee);const r=R.acquire().init(this._root);this._root.initFrom(null,ee,ee[3]),this._root.increaseHalfSize(1.25),O(r,(e=>(this.add(e.node.terminals.data,e.node.terminals.length),null!==e.node.residents&&this.add(e.node.residents.data,e.node.residents.length),!0))),R.release(r)}_placingRootViolatesMaxDepth(e){const t=Math.log(e.halfSize/this._root.halfSize)*Math.LOG2E;let r=0;return O(this._root,(e=>(r=Math.max(r,e.depth),r+t<=this._maximumDepth))),r+t>this._maximumDepth}_rootBoundsForRootAsSubNode(e){const t=e[3],r=e;let i=-1/0;const n=this._root.bounds,s=this._root.halfSize;for(let a=0;a<3;a++){const e=n[a]-s-(r[a]-t),o=r[a]+t-(n[a]+s),l=Math.max(0,Math.ceil(e/(2*s))),c=Math.max(0,Math.ceil(o/(2*s)))+1,u=2**Math.ceil(Math.log(l+c)*Math.LOG2E);i=Math.max(i,u),te[a].min=l,te[a].max=c}for(let a=0;a<3;a++){let e=te[a].min,t=te[a].max;const r=(i-(e+t))/2;e+=Math.ceil(r),t+=Math.floor(r);const o=n[a]-s-e*s*2;Y[a]=o+(t+e)*s}const o=i*s;return Y[3]=o*U,R.acquire().initFrom(null,Y,o,0)}_growRootAsSubNode(e){const t=this._root.node;(0,o.s)((0,a.U)(Z),(0,a.U)(this._root.bounds)),Z[3]=this._root.halfSize,this._root.init(e),e.advanceTo(Z,null,!0),e.node.children=t.children,e.node.residents=t.residents,e.node.terminals=t.terminals}_shrink(){for(;;){const e=this._findShrinkIndex();if(-1===e)break;this._root.advance(e),this._root.depth=0}}_findShrinkIndex(){if(0!==this._root.node.terminals.length||this._root.isLeaf())return-1;let e=null;const t=this._root.node.children;let r=0,i=0;for(;i<t.length&&null==e;)r=i++,e=t[r];for(;i<t.length;)if(t[i++])return-1;return r}_isDegenerate(e){return!G(this.objectToBoundingSphere(e)[3])}_fitsInsideTree(e){const t=this._root.bounds,r=this._root.halfSize;return e[3]<=r&&e[0]>=t[0]-r&&e[0]<=t[0]+r&&e[1]>=t[1]-r&&e[1]<=t[1]+r&&e[2]>=t[2]-r&&e[2]<=t[2]+r}toJSON(){const{maximumDepth:e,maximumObjectsPerNode:t,_objectCount:r}=this,i=this._nodeToJSON(this._root.node);return{maximumDepth:e,maximumObjectsPerNode:t,objectCount:r,root:{bounds:this._root.bounds,halfSize:this._root.halfSize,depth:this._root.depth,node:i}}}_nodeToJSON(e){const t=e.children.map((e=>e?this._nodeToJSON(e):null)),r=e.residents?.map((e=>this.objectToBoundingSphere(e))),i=e.terminals?.map((e=>this.objectToBoundingSphere(e)));return{children:t,residents:r,terminals:i}}static fromJSON(e){const t=new S((e=>e),{maximumDepth:e.maximumDepth,maximumObjectsPerNode:e.maximumObjectsPerNode});return t._objectCount=e.objectCount,t._root.initFrom(e.root.node,e.root.bounds,e.root.halfSize,e.root.depth),t}}class R{constructor(){this.bounds=(0,a.E)(),this.halfSize=0,this.initFrom(null,null,0,0)}init(e){return this.initFrom(e.node,e.bounds,e.halfSize,e.depth)}initFrom(e,t,r,i=this.depth){return this.node=e??R.createEmptyNode(),t&&(0,a.a)(t,this.bounds),this.halfSize=r,this.depth=i,this}increaseHalfSize(e){this.halfSize*=e,this.updateBoundsRadiusFromHalfSize()}updateBoundsRadiusFromHalfSize(){this.bounds[3]=this.halfSize*U}advance(e){let t=this.node.children[e];t||(t=R.createEmptyNode(),this.node.children[e]=t),this.node=t,this.halfSize/=2,this.depth++;const r=z[e];return this.bounds[0]+=r[0]*this.halfSize,this.bounds[1]+=r[1]*this.halfSize,this.bounds[2]+=r[2]*this.halfSize,this.updateBoundsRadiusFromHalfSize(),this}advanceTo(e,t,r=!1){for(;;){if(this.isTerminalFor(e))return t&&t(this,-1),!0;if(this.isLeaf()){if(!r)return t&&t(this,-1),!1;this.node.residents=null}const i=this._childIndex(e);t&&t(this,i),this.advance(i)}}isLeaf(){return null!=this.node.residents}isTerminalFor(e){return e[3]>this.halfSize/2}_childIndex(e){const t=this.bounds;return(t[0]<e[0]?1:0)+(t[1]<e[1]?2:0)+(t[2]<e[2]?4:0)}static createEmptyNode(){return{children:[null,null,null,null,null,null,null,null],terminals:new s.bX({shrink:!0}),residents:new s.bX({shrink:!0})}}static acquire(){return R._pool.acquire()}static release(e){R._pool.release(e)}static clearPool(){R._pool.prune()}}function O(e,t){let r=R.acquire().init(e);const i=[r];for(;0!==i.length;){if(r=i.pop(),t(r)&&!r.isLeaf())for(let e=0;e<r.node.children.length;e++)r.node.children[e]&&i.push(R.acquire().init(r).advance(e));R.release(r)}}function A(e,t,r,i=S.DepthOrder.FRONT_TO_BACK){let n=R.acquire().init(e);const s=[n];for(k(r,i,ie);0!==s.length;){if(n=s.pop(),t(n)&&!n.isLeaf())for(let e=7;e>=0;--e){const t=ie[e];n.node.children[t]&&s.push(R.acquire().init(n).advance(t))}R.release(n)}}function I(e,t,r){Q.clear();const i=r.advanceTo(t,((e,t)=>{Q.push(e.node),Q.push(t)}))?r.node.terminals:r.node.residents;if(i.removeUnordered(e),0===i.length)for(let n=Q.length-2;n>=0&&E(Q.data[n],Q.data[n+1]);n-=2);}function E(e,t){return t>=0&&(e.children[t]=null),!!F(e)&&(null===e.residents&&(e.residents=new s.bX({shrink:!0})),!0)}function C(e,t){return N((0,a.U)(t.bounds),2*-t.halfSize,W),N((0,a.U)(t.bounds),2*t.halfSize,$),(0,d.i)(e.origin,e.direction,W,$)}function M(e,t,r){return N((0,a.U)(t.bounds),2*-t.halfSize,W),N((0,a.U)(t.bounds),2*t.halfSize,$),r.applyToMinMax(W,$),(0,d.i)(e.origin,e.direction,W,$)}function F(e){if(0!==e.terminals.length)return!1;if(null!==e.residents)return 0===e.residents.length;for(let t=0;t<e.children.length;t++)if(e.children[t])return!1;return!0}function D(e,t){e[0]=Math.min(e[0],t[0]-t[3]),e[1]=Math.min(e[1],t[1]-t[3]),e[2]=Math.min(e[2],t[2]-t[3])}function P(e,t){e[0]=Math.max(e[0],t[0]+t[3]),e[1]=Math.max(e[1],t[1]+t[3]),e[2]=Math.max(e[2],t[2]+t[3])}function N(e,t,r){r[0]=e[0]+t,r[1]=e[1]+t,r[2]=e[2]+t}function L(e,t,r,i){if(1===t){const t=r(e[0]);(0,a.a)(t,i)}else{W[0]=1/0,W[1]=1/0,W[2]=1/0,$[0]=-1/0,$[1]=-1/0,$[2]=-1/0;for(let i=0;i<t;i++){const t=r(e[i]);G(t[3])&&(D(W,t),P($,t))}(0,o.I)((0,a.U)(i),W,$,.5),i[3]=Math.max($[0]-W[0],$[1]-W[1],$[2]-W[2])/2}}function k(e,t,r){if(!re.length)for(let i=0;i<8;++i)re.push({index:0,distance:0});for(let i=0;i<8;++i){const r=z[i];re.data[i].index=i,re.data[i].distance=j(e,t,r)}re.sort(((e,t)=>e.distance-t.distance));for(let i=0;i<8;++i)r[i]=re.data[i].index}function B(e,t){let r,i=1/0;for(let n=0;n<8;++n){const s=j(e,t,V[n]);s<i&&(i=s,r=V[n])}return r}function j(e,t,r){return t*(e[0]*r[0]+e[1]*r[1]+e[2]*r[2])}function G(e){return!isNaN(e)&&e!==-1/0&&e!==1/0&&e>0}R._pool=new s.aB(R),function(e){var t;(t=e.DepthOrder||(e.DepthOrder={}))[t.FRONT_TO_BACK=1]="FRONT_TO_BACK",t[t.BACK_TO_FRONT=-1]="BACK_TO_FRONT"}(S||(S={}));const z=[(0,s.cp)(-1,-1,-1),(0,s.cp)(1,-1,-1),(0,s.cp)(-1,1,-1),(0,s.cp)(1,1,-1),(0,s.cp)(-1,-1,1),(0,s.cp)(1,-1,1),(0,s.cp)(-1,1,1),(0,s.cp)(1,1,1)],V=[(0,s.cp)(-1,-1,-1),(0,s.cp)(-1,-1,1),(0,s.cp)(-1,1,-1),(0,s.cp)(-1,1,1),(0,s.cp)(1,-1,-1),(0,s.cp)(1,-1,1),(0,s.cp)(1,1,-1),(0,s.cp)(1,1,1)],U=Math.sqrt(3),H=[null];function q(e){return H[0]=e,H}const Y=(0,a.E)(),X=(0,s.aA)(),W=(0,s.aA)(),$=(0,s.aA)(),Q=new s.bX,J=(0,a.E)(),Z=(0,a.E)(),K=(0,a.E)(),ee=(0,a.E)(),te=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],re=new s.bX,ie=[0,0,0,0,0,0,0,0],ne=S},75934:function(e,t,r){r.d(t,{a:function(){return s},e:function(){return n},s:function(){return i}});let i=class e{constructor(e=[],t=[]){this.lengths=e??[],this.coords=t??[]}static fromJSON(t){return new e(t.lengths,t.coords)}static fromRect(t){const[r,i,n,s]=t,o=n-r,a=s-i;return new e([5],[r,i,o,0,0,a,-o,0,0,-a])}get isPoint(){return 0===this.lengths.length&&this.coords.length>=2}get maxLength(){return Math.max(...this.lengths)}get size(){return this.lengths.reduce(((e,t)=>e+t))}forEachVertex(e){let t=0;this.lengths.length||e(this.coords[0],this.coords[1]);for(let r=0;r<this.lengths.length;r++){const i=this.lengths[r];for(let r=0;r<i;r++)e(this.coords[2*(r+t)],this.coords[2*(r+t)+1]);t+=i}}deltaDecode(){const e=this.clone(),{coords:t,lengths:r}=e;let i=0;for(const n of r){for(let e=1;e<n;e++)t[2*(i+e)]+=t[2*(i+e)-2],t[2*(i+e)+1]+=t[2*(i+e)-1];i+=n}return e}clone(t){if(0===this.lengths.length)return new e([],[this.coords[0],this.coords[1]]);const r=2*(0===this.lengths.length?1:this.lengths.reduce(((e,t)=>e+t))),i=this.coords.slice(0,r);return t?(t.set(i),new e(this.lengths,t)):new e(Array.from(this.lengths),Array.from(i))}};class n{constructor(e=null,t={},r,i){this.geometry=e,this.attributes=t,this.centroid=r,this.objectId=i,this.displayId=0,this.geohashX=0,this.geohashY=0}static fromJSON(e,t){const r=e.geometry?i.fromJSON(e.geometry):null,s=e.centroid?i.fromJSON(e.centroid):null,o=e.attributes[t];return new n(r,e.attributes,s,o)}weakClone(){const e=new n(this.geometry,this.attributes,this.centroid,this.objectId);return e.displayId=this.displayId,e.geohashX=this.geohashX,e.geohashY=this.geohashY,e}clone(){const e=this.geometry?.clone(),t=new n(e,{...this.attributes},this.centroid?.clone(),this.objectId);return t.displayId=this.displayId,t.geohashX=this.geohashX,t.geohashY=this.geohashY,t}}function s(e){return!!e.geometry?.coords?.length}},83258:function(e,t,r){r.d(t,{e:function(){return i}});class i{constructor(){this.objectIdFieldName=null,this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const e=new i;return e.objectIdFieldName=this.objectIdFieldName,e.globalIdFieldName=this.globalIdFieldName,e.geohashFieldName=this.geohashFieldName,e.geometryProperties=this.geometryProperties,e.geometryType=this.geometryType,e.spatialReference=this.spatialReference,e.hasZ=this.hasZ,e.hasM=this.hasM,e.features=this.features,e.fields=this.fields,e.transform=this.transform,e.exceededTransferLimit=this.exceededTransferLimit,e.uniqueIdField=this.uniqueIdField,e.queryGeometry=this.queryGeometry,e.queryGeometryType=this.queryGeometryType,e}}},36443:function(e,t,r){r.d(t,{E:function(){return R},h:function(){return s}});var i=r(98503),n=r(59885);class s{constructor(e=9,t){this._compareMinX=d,this._compareMinY=f,this._toBBox=e=>e,this._maxEntries=Math.max(4,e||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),t&&("function"==typeof t?this._toBBox=t:this._initFormat(t)),this.clear()}destroy(){this.clear(),w.prune(),T.prune(),x.prune(),S.prune()}all(e){a(this._data,e)}search(e,t){let r=this._data;const i=this._toBBox;if(v(e,r))for(w.clear();r;){for(let n=0,s=r.children.length;n<s;n++){const s=r.children[n],o=r.leaf?i(s):s;v(e,o)&&(r.leaf?t(s):y(e,o)?a(s,t):w.push(s))}r=w.pop()}}collides(e){let t=this._data;const r=this._toBBox;if(!v(e,t))return!1;for(w.clear();t;){for(let i=0,n=t.children.length;i<n;i++){const n=t.children[i],s=t.leaf?r(n):n;if(v(e,s)){if(t.leaf||y(e,s))return!0;w.push(n)}}t=w.pop()}return!1}load(e){if(!e.length)return this;if(e.length<this._minEntries){for(let t=0,r=e.length;t<r;t++)this.insert(e[t]);return this}let t=this._build(e.slice(),0,e.length-1,0);if(this._data.children.length)if(this._data.height===t.height)this._splitRoot(this._data,t);else{if(this._data.height<t.height){const e=this._data;this._data=t,t=e}this._insert(t,this._data.height-t.height-1,!0)}else this._data=t;return this}insert(e){return e&&this._insert(e,this._data.height-1),this}clear(){return this._data=new A([]),this}remove(e){if(!e)return this;let t,r=this._data,n=null,s=0,o=!1;const a=this._toBBox(e);for(x.clear(),S.clear();r||x.length>0;){if(r||(r=x.pop(),n=x.data[x.length-1],s=S.pop()??0,o=!0),r.leaf&&(t=(0,i.bY)(r.children,e,r.children.length,r.indexHint),-1!==t))return r.children.splice(t,1),x.push(r),this._condense(x),this;o||r.leaf||!y(r,a)?n?(s++,r=n.children[s],o=!1):r=null:(x.push(r),S.push(s),s=0,n=r,r=r.children[0])}return this}toJSON(){return this._data}fromJSON(e){return this._data=e,this}_build(e,t,r,i){const n=r-t+1;let s=this._maxEntries;if(n<=s){const i=new A(e.slice(t,r+1));return c(i,this._toBBox),i}i||(i=Math.ceil(Math.log(n)/Math.log(s)),s=Math.ceil(n/s**(i-1)));const o=new I([]);o.height=i;const a=Math.ceil(n/s),l=a*Math.ceil(Math.sqrt(s));b(e,t,r,l,this._compareMinX);for(let c=t;c<=r;c+=l){const t=Math.min(c+l-1,r);b(e,c,t,a,this._compareMinY);for(let r=c;r<=t;r+=a){const n=Math.min(r+a-1,t);o.children.push(this._build(e,r,n,i-1))}}return c(o,this._toBBox),o}_insert(e,t,r){const i=this._toBBox,n=r?e:i(e);x.clear();const s=o(n,this._data,t,x);for(s.children.push(e),h(s,n);t>=0&&x.data[t].children.length>this._maxEntries;)this._split(x,t),t--;l(n,x,t)}_split(e,t){const r=e.data[t],i=r.children.length,n=this._minEntries;this._chooseSplitAxis(r,n,i);const s=this._chooseSplitIndex(r,n,i);if(!s)return;const o=r.children.splice(s,r.children.length-s),a=r.leaf?new A(o):new I(o);a.height=r.height,c(r,this._toBBox),c(a,this._toBBox),t?e.data[t-1].children.push(a):this._splitRoot(r,a)}_splitRoot(e,t){this._data=new I([e,t]),this._data.height=e.height+1,c(this._data,this._toBBox)}_chooseSplitIndex(e,t,r){let i,n,s;i=n=1/0;for(let o=t;o<=r-t;o++){const t=u(e,0,o,this._toBBox),a=u(e,o,r,this._toBBox),l=_(t,a),c=p(t)+p(a);l<i?(i=l,s=o,n=c<n?c:n):l===i&&c<n&&(n=c,s=o)}return s}_chooseSplitAxis(e,t,r){const i=e.leaf?this._compareMinX:d,n=e.leaf?this._compareMinY:f;this._allDistMargin(e,t,r,i)<this._allDistMargin(e,t,r,n)&&e.children.sort(i)}_allDistMargin(e,t,r,i){e.children.sort(i);const n=this._toBBox,s=u(e,0,t,n),o=u(e,r-t,r,n);let a=m(s)+m(o);for(let l=t;l<r-t;l++){const t=e.children[l];h(s,e.leaf?n(t):t),a+=m(s)}for(let l=r-t-1;l>=t;l--){const t=e.children[l];h(o,e.leaf?n(t):t),a+=m(o)}return a}_condense(e){for(let t=e.length-1;t>=0;t--){const r=e.data[t];if(0===r.children.length)if(t>0){const n=e.data[t-1],s=n.children;s.splice((0,i.bY)(s,r,s.length,n.indexHint),1)}else this.clear();else c(r,this._toBBox)}}_initFormat(e){const t=["return a"," - b",";"];this._compareMinX=new Function("a","b",t.join(e[0])),this._compareMinY=new Function("a","b",t.join(e[1])),this._toBBox=new Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")}}function o(e,t,r,i){for(;i.push(t),!0!==t.leaf&&i.length-1!==r;){let r,i=1/0,n=1/0;for(let s=0,o=t.children.length;s<o;s++){const o=t.children[s],a=p(o),l=g(e,o)-a;l<n?(n=l,i=a<i?a:i,r=o):l===n&&a<i&&(i=a,r=o)}t=r||t.children[0]}return t}function a(e,t){let r=e;for(T.clear();r;){if(!0===r.leaf)for(const e of r.children)t(e);else T.pushArray(r.children);r=T.pop()??null}}function l(e,t,r){for(let i=r;i>=0;i--)h(t.data[i],e)}function c(e,t){u(e,0,e.children.length,t,e)}function u(e,t,r,i,n){n||(n=new A([])),n.minX=1/0,n.minY=1/0,n.maxX=-1/0,n.maxY=-1/0;for(let s,o=t;o<r;o++)s=e.children[o],h(n,e.leaf?i(s):s);return n}function h(e,t){e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY)}function d(e,t){return e.minX-t.minX}function f(e,t){return e.minY-t.minY}function p(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function m(e){return e.maxX-e.minX+(e.maxY-e.minY)}function g(e,t){return(Math.max(t.maxX,e.maxX)-Math.min(t.minX,e.minX))*(Math.max(t.maxY,e.maxY)-Math.min(t.minY,e.minY))}function _(e,t){const r=Math.max(e.minX,t.minX),i=Math.max(e.minY,t.minY),n=Math.min(e.maxX,t.maxX),s=Math.min(e.maxY,t.maxY);return Math.max(0,n-r)*Math.max(0,s-i)}function y(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function v(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function b(e,t,r,i,s){const o=[t,r];for(;o.length;){const t=o.pop(),r=o.pop();if(t-r<=i)continue;const a=r+Math.ceil((t-r)/i/2)*i;(0,n.t)(e,a,r,t,s),o.push(r,a,a,t)}}const w=new i.bX,T=new i.bX,x=new i.bX,S=new i.bX({deallocator:void 0});class R{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}}class O extends R{constructor(){super(...arguments),this.height=1,this.indexHint=new i.bZ}}class A extends O{constructor(e){super(),this.children=e,this.leaf=!0}}class I extends O{constructor(e){super(),this.children=e,this.leaf=!1}}},13193:function(e,t,r){r.r(t),r.d(t,{K:function(){return x},Q:function(){return j},a:function(){return E},b:function(){return B},c:function(){return a},m:function(){return P},s:function(){return C}});var i,n=r(98503),s=r(98089),o=r(50257);let a=i=class extends n.v{constructor(e){super(e),this.type="map-layer"}clone(){const{mapLayerId:e,gdbVersion:t}=this;return new i({mapLayerId:e,gdbVersion:t})}};var l;(0,n.k)([(0,n.bk)({mapLayer:"map-layer"})],a.prototype,"type",void 0),(0,n.k)([(0,n.o)({type:n.bp,json:{write:!0}})],a.prototype,"mapLayerId",void 0),(0,n.k)([(0,n.o)({type:String,json:{write:!0}})],a.prototype,"gdbVersion",void 0),a=i=(0,n.k)([(0,n.A)("esri.layers.support.source.MapLayerSource")],a);let c=l=class extends n.v{constructor(e){super(e),this.type="query-table"}clone(){const{workspaceId:e,query:t,oidFields:r,spatialReference:i,geometryType:n}=this,s={workspaceId:e,query:t,oidFields:r,spatialReference:i?.clone()??void 0,geometryType:n};return new l(s)}};var u;(0,n.k)([(0,n.bk)({queryTable:"query-table"})],c.prototype,"type",void 0),(0,n.k)([(0,n.o)({type:String,json:{write:!0}})],c.prototype,"workspaceId",void 0),(0,n.k)([(0,n.o)({type:String,json:{write:!0}})],c.prototype,"query",void 0),(0,n.k)([(0,n.o)({type:String,json:{write:!0}})],c.prototype,"oidFields",void 0),(0,n.k)([(0,n.o)({type:n.B,json:{write:!0}})],c.prototype,"spatialReference",void 0),(0,n.k)([(0,n.bk)(n.cB)],c.prototype,"geometryType",void 0),c=l=(0,n.k)([(0,n.A)("esri.layers.support.source.QueryTableDataSource")],c);let h=u=class extends n.v{constructor(e){super(e),this.type="raster"}clone(){const{workspaceId:e,dataSourceName:t}=this;return new u({workspaceId:e,dataSourceName:t})}};var d;(0,n.k)([(0,n.bk)({raster:"raster"})],h.prototype,"type",void 0),(0,n.k)([(0,n.o)({type:String,json:{write:!0}})],h.prototype,"dataSourceName",void 0),(0,n.k)([(0,n.o)({type:String,json:{write:!0}})],h.prototype,"workspaceId",void 0),h=u=(0,n.k)([(0,n.A)("esri.layers.support.source.RasterDataSource")],h);let f=d=class extends n.v{constructor(e){super(e),this.type="table"}clone(){const{workspaceId:e,gdbVersion:t,dataSourceName:r}=this;return new d({workspaceId:e,gdbVersion:t,dataSourceName:r})}};var p,m;(0,n.k)([(0,n.bk)({table:"table"})],f.prototype,"type",void 0),(0,n.k)([(0,n.o)({type:String,json:{write:!0}})],f.prototype,"workspaceId",void 0),(0,n.k)([(0,n.o)({type:String,json:{write:!0}})],f.prototype,"gdbVersion",void 0),(0,n.k)([(0,n.o)({type:String,json:{write:!0}})],f.prototype,"dataSourceName",void 0),f=d=(0,n.k)([(0,n.A)("esri.layers.support.source.TableDataSource")],f);const g=(0,n.g)()({esriLeftInnerJoin:"left-inner-join",esriLeftOuterJoin:"left-outer-join"});let _=p=class extends n.v{constructor(e){super(e),this.type="join-table"}readLeftTableSource(e,t,r){return v()(e,t,r)}castLeftTableSource(e){return(0,n.hN)(w(),e)}readRightTableSource(e,t,r){return v()(e,t,r)}castRightTableSource(e){return(0,n.hN)(w(),e)}clone(){const{leftTableKey:e,rightTableKey:t,leftTableSource:r,rightTableSource:i,joinType:n}=this,s={leftTableKey:e,rightTableKey:t,leftTableSource:r?.clone()??void 0,rightTableSource:i?.clone()??void 0,joinType:n};return new p(s)}};(0,n.k)([(0,n.bk)({joinTable:"join-table"})],_.prototype,"type",void 0),(0,n.k)([(0,n.o)({type:String,json:{write:!0}})],_.prototype,"leftTableKey",void 0),(0,n.k)([(0,n.o)({type:String,json:{write:!0}})],_.prototype,"rightTableKey",void 0),(0,n.k)([(0,n.o)({json:{write:!0}})],_.prototype,"leftTableSource",void 0),(0,n.k)([(0,n.u)("leftTableSource")],_.prototype,"readLeftTableSource",null),(0,n.k)([(0,n.by)("leftTableSource")],_.prototype,"castLeftTableSource",null),(0,n.k)([(0,n.o)({json:{write:!0}})],_.prototype,"rightTableSource",void 0),(0,n.k)([(0,n.u)("rightTableSource")],_.prototype,"readRightTableSource",null),(0,n.k)([(0,n.by)("rightTableSource")],_.prototype,"castRightTableSource",null),(0,n.k)([(0,n.bk)(g)],_.prototype,"joinType",void 0),_=p=(0,n.k)([(0,n.A)("esri.layers.support.source.JoinTableDataSource")],_);let y=null;function v(){return y||(y=(0,n.ej)({types:w()})),y}let b=null;function w(){return b||(b={key:"type",base:null,typeMap:{"data-layer":x,"map-layer":a}}),b}const T={key:"type",base:null,typeMap:{"join-table":_,"query-table":c,raster:h,table:f}};let x=m=class extends n.v{constructor(e){super(e),this.type="data-layer"}clone(){const{fields:e,dataSource:t}=this;return new m({fields:e,dataSource:t})}};(0,n.k)([(0,n.bk)({dataLayer:"data-layer"})],x.prototype,"type",void 0),(0,n.k)([(0,n.o)({type:[s.y],json:{write:!0}})],x.prototype,"fields",void 0),(0,n.k)([(0,n.o)({types:T,json:{write:!0}})],x.prototype,"dataSource",void 0),x=m=(0,n.k)([(0,n.A)("esri.layers.support.source.DataLayerSource")],x),x.from=(0,n.ef)(x);let S=class extends((0,n.a_)(n.v)){constructor(e){super(e),this.onFields=null,this.operator=null,this.searchTerm=null,this.searchType=null}};(0,n.k)([(0,n.o)({type:[String],json:{write:{enabled:!0,overridePolicy(){return{enabled:null!=this.onFields&&this.onFields.length>0}}}}})],S.prototype,"onFields",void 0),(0,n.k)([(0,n.o)({type:String,json:{write:!0}})],S.prototype,"operator",void 0),(0,n.k)([(0,n.o)({type:String,json:{write:!0}})],S.prototype,"searchTerm",void 0),(0,n.k)([(0,n.o)({type:String,json:{write:!0}})],S.prototype,"searchType",void 0),S=(0,n.k)([(0,n.A)("esri.rest.support.FullTextSearch")],S);const R=S;var O;const A=new n.ax({upperLeft:"upper-left",lowerLeft:"lower-left"});let I=O=class extends n.v{constructor(e){super(e),this.extent=null,this.mode="view",this.originPosition="upper-left",this.tolerance=1}clone(){return new O((0,n.f)({extent:this.extent,mode:this.mode,originPosition:this.originPosition,tolerance:this.tolerance}))}};(0,n.k)([(0,n.o)({type:n.au,json:{write:{overridePolicy(){return{enabled:"view"===this.mode}}}}})],I.prototype,"extent",void 0),(0,n.k)([(0,n.o)({type:["view","edit"],json:{write:!0}})],I.prototype,"mode",void 0),(0,n.k)([(0,n.o)({type:String,json:{read:A.read,write:A.write}})],I.prototype,"originPosition",void 0),(0,n.k)([(0,n.o)({type:Number,json:{write:{overridePolicy(){return{enabled:"view"===this.mode}}}}})],I.prototype,"tolerance",void 0),I=O=(0,n.k)([(0,n.A)("esri.rest.support.QuantizationParameters")],I);const E=I,C=new n.ax({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"});var M;const F=new n.ax({count:"count",sum:"sum",min:"min",max:"max",avg:"avg",stddev:"stddev",var:"var",exceedslimit:"exceedslimit",percentile_cont:"percentile-continuous",percentile_disc:"percentile-discrete",EnvelopeAggregate:"envelope-aggregate",CentroidAggregate:"centroid-aggregate",ConvexHullAggregate:"convex-hull-aggregate"});let D=M=class extends n.v{constructor(e){super(e),this.maxPointCount=void 0,this.maxRecordCount=void 0,this.maxVertexCount=void 0,this.onStatisticField=null,this.outStatisticFieldName=null,this.statisticType=null,this.statisticParameters=null}writeStatisticParameters(e,t){"percentile-continuous"!==this.statisticType&&"percentile-discrete"!==this.statisticType||(t.statisticParameters=(0,n.f)(e))}clone(){return new M({maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,statisticType:this.statisticType,statisticParameters:(0,n.f)(this.statisticParameters)})}};(0,n.k)([(0,n.o)({type:Number,json:{write:!0}})],D.prototype,"maxPointCount",void 0),(0,n.k)([(0,n.o)({type:Number,json:{write:!0}})],D.prototype,"maxRecordCount",void 0),(0,n.k)([(0,n.o)({type:Number,json:{write:!0}})],D.prototype,"maxVertexCount",void 0),(0,n.k)([(0,n.o)({type:String,json:{write:!0}})],D.prototype,"onStatisticField",void 0),(0,n.k)([(0,n.o)({type:String,json:{write:!0}})],D.prototype,"outStatisticFieldName",void 0),(0,n.k)([(0,n.o)({type:String,json:{read:{source:"statisticType",reader:F.read},write:{target:"statisticType",writer:F.write}}})],D.prototype,"statisticType",void 0),(0,n.k)([(0,n.o)({type:Object})],D.prototype,"statisticParameters",void 0),(0,n.k)([(0,n.q)("statisticParameters")],D.prototype,"writeStatisticParameters",null),D=M=(0,n.k)([(0,n.A)("esri.rest.support.StatisticDefinition")],D);const P=D;var N;const L=new n.ax({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let k=N=class extends n.v{static from(e){return(0,n.cG)(N,e)}constructor(e){super(e),this.aggregateIds=null,this.cacheHint=void 0,this.compactGeometryEnabled=!1,this.datumTransformation=null,this.defaultSpatialReferenceEnabled=!1,this.distance=void 0,this.dynamicDataSource=void 0,this.formatOf3DObjects=null,this.fullText=null,this.gdbVersion=null,this.geometry=null,this.geometryPrecision=void 0,this.groupByFieldsForStatistics=null,this.having=null,this.historicMoment=null,this.maxAllowableOffset=void 0,this.maxRecordCountFactor=1,this.multipatchOption=null,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.outStatistics=null,this.parameterValues=null,this.pixelSize=null,this.quantizationParameters=null,this.rangeValues=null,this.relationParameter=null,this.resultType=null,this.returnCentroid=!1,this.returnDistinctValues=!1,this.returnExceededLimitFeatures=!0,this.returnGeometry=!1,this.returnQueryGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.sourceSpatialReference=null,this.spatialRelationship="intersects",this.start=void 0,this.sqlFormat=null,this.text=null,this.timeExtent=null,this.timeReferenceUnknownClient=!1,this.units=null,this.where=null}castDatumTransformation(e){return"number"==typeof e||"object"==typeof e?e:null}writeHistoricMoment(e,t){t.historicMoment=e&&e.getTime()}writeParameterValues(e,t){if(e){const r={};for(const t in e){const i=e[t];Array.isArray(i)?r[t]=i.map((e=>e instanceof Date?e.getTime():e)):i instanceof Date?r[t]=i.getTime():r[t]=i}t.parameterValues=r}}writeStart(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10,t.where="1=1"}writeWhere(e,t){t.where=e||"1=1"}clone(){return new N((0,n.f)({aggregateIds:this.aggregateIds,cacheHint:this.cacheHint,compactGeometryEnabled:this.compactGeometryEnabled,datumTransformation:this.datumTransformation,defaultSpatialReferenceEnabled:this.defaultSpatialReferenceEnabled,distance:this.distance,fullText:this.fullText,formatOf3DObjects:this.formatOf3DObjects,gdbVersion:this.gdbVersion,geometry:this.geometry,geometryPrecision:this.geometryPrecision,groupByFieldsForStatistics:this.groupByFieldsForStatistics,having:this.having,historicMoment:null!=this.historicMoment?new Date(this.historicMoment.getTime()):null,maxAllowableOffset:this.maxAllowableOffset,maxRecordCountFactor:this.maxRecordCountFactor,multipatchOption:this.multipatchOption,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,outStatistics:this.outStatistics,parameterValues:this.parameterValues,pixelSize:this.pixelSize,quantizationParameters:this.quantizationParameters,rangeValues:this.rangeValues,relationParameter:this.relationParameter,resultType:this.resultType,returnDistinctValues:this.returnDistinctValues,returnGeometry:this.returnGeometry,returnCentroid:this.returnCentroid,returnExceededLimitFeatures:this.returnExceededLimitFeatures,returnQueryGeometry:this.returnQueryGeometry,returnM:this.returnM,returnZ:this.returnZ,dynamicDataSource:this.dynamicDataSource,sourceSpatialReference:this.sourceSpatialReference,spatialRelationship:this.spatialRelationship,start:this.start,sqlFormat:this.sqlFormat,text:this.text,timeExtent:this.timeExtent,timeReferenceUnknownClient:this.timeReferenceUnknownClient,units:this.units,where:this.where}))}};k.MAX_MAX_RECORD_COUNT_FACTOR=5,(0,n.k)([(0,n.o)({json:{write:!0}})],k.prototype,"aggregateIds",void 0),(0,n.k)([(0,n.o)({type:Boolean,json:{write:!0}})],k.prototype,"cacheHint",void 0),(0,n.k)([(0,n.o)({type:Boolean,json:{default:!1,write:!0}})],k.prototype,"compactGeometryEnabled",void 0),(0,n.k)([(0,n.o)({json:{write:!0}})],k.prototype,"datumTransformation",void 0),(0,n.k)([(0,n.by)("datumTransformation")],k.prototype,"castDatumTransformation",null),(0,n.k)([(0,n.o)({type:Boolean,json:{default:!1,write:!0}})],k.prototype,"defaultSpatialReferenceEnabled",void 0),(0,n.k)([(0,n.o)({type:Number,json:{write:{overridePolicy:e=>({enabled:e>0})}}})],k.prototype,"distance",void 0),(0,n.k)([(0,n.o)({type:x,json:{write:!0}})],k.prototype,"dynamicDataSource",void 0),(0,n.k)([(0,n.o)({type:String,json:{write:!0}})],k.prototype,"formatOf3DObjects",void 0),(0,n.k)([(0,n.o)({type:[R],json:{write:{enabled:!0,overridePolicy(){return{enabled:null!=this.fullText&&this.fullText.length>0}}}}})],k.prototype,"fullText",void 0),(0,n.k)([(0,n.o)({type:String,json:{write:!0}})],k.prototype,"gdbVersion",void 0),(0,n.k)([(0,n.o)({types:n.b2,json:{read:n.b3,write:!0}})],k.prototype,"geometry",void 0),(0,n.k)([(0,n.o)({type:Number,json:{write:!0}})],k.prototype,"geometryPrecision",void 0),(0,n.k)([(0,n.o)({type:[String],json:{write:!0}})],k.prototype,"groupByFieldsForStatistics",void 0),(0,n.k)([(0,n.o)({type:String,json:{write:!0}})],k.prototype,"having",void 0),(0,n.k)([(0,n.o)({type:Date})],k.prototype,"historicMoment",void 0),(0,n.k)([(0,n.q)("historicMoment")],k.prototype,"writeHistoricMoment",null),(0,n.k)([(0,n.o)({type:Number,json:{write:!0}})],k.prototype,"maxAllowableOffset",void 0),(0,n.k)([(0,n.o)({type:Number,cast:e=>e<1?1:e>k.MAX_MAX_RECORD_COUNT_FACTOR?k.MAX_MAX_RECORD_COUNT_FACTOR:e,json:{write:{overridePolicy:e=>({enabled:e>1})}}})],k.prototype,"maxRecordCountFactor",void 0),(0,n.k)([(0,n.o)({type:["xyFootprint"],json:{write:!0}})],k.prototype,"multipatchOption",void 0),(0,n.k)([(0,n.o)({type:Number,json:{read:{source:"resultRecordCount"}}})],k.prototype,"num",void 0),(0,n.k)([(0,n.o)({json:{write:!0}})],k.prototype,"objectIds",void 0),(0,n.k)([(0,n.o)({type:[String],json:{write:!0}})],k.prototype,"orderByFields",void 0),(0,n.k)([(0,n.o)({type:[String],json:{write:!0}})],k.prototype,"outFields",void 0),(0,n.k)([(0,n.o)({type:n.B,json:{name:"outSR",write:!0}})],k.prototype,"outSpatialReference",void 0),(0,n.k)([(0,n.o)({type:[P],json:{write:{enabled:!0,overridePolicy(){return{enabled:null!=this.outStatistics&&this.outStatistics.length>0}}}}})],k.prototype,"outStatistics",void 0),(0,n.k)([(0,n.o)({json:{write:!0}})],k.prototype,"parameterValues",void 0),(0,n.k)([(0,n.q)("parameterValues")],k.prototype,"writeParameterValues",null),(0,n.k)([(0,n.o)({type:n.bv,json:{write:!0}})],k.prototype,"pixelSize",void 0),(0,n.k)([(0,n.o)({type:E,json:{write:!0}})],k.prototype,"quantizationParameters",void 0),(0,n.k)([(0,n.o)({type:[Object],json:{write:!0}})],k.prototype,"rangeValues",void 0),(0,n.k)([(0,n.o)({type:String,json:{read:{source:"relationParam"},write:{target:"relationParam",overridePolicy(){return{enabled:"relation"===this.spatialRelationship}}}}})],k.prototype,"relationParameter",void 0),(0,n.k)([(0,n.o)({type:String,json:{write:!0}})],k.prototype,"resultType",void 0),(0,n.k)([(0,n.o)({type:Boolean,json:{default:!1,write:!0}})],k.prototype,"returnCentroid",void 0),(0,n.k)([(0,n.o)({type:Boolean,json:{default:!1,write:!0}})],k.prototype,"returnDistinctValues",void 0),(0,n.k)([(0,n.o)({type:Boolean,json:{default:!0,write:!0}})],k.prototype,"returnExceededLimitFeatures",void 0),(0,n.k)([(0,n.o)({type:Boolean,json:{write:!0}})],k.prototype,"returnGeometry",void 0),(0,n.k)([(0,n.o)({type:Boolean,json:{default:!1,write:!0}})],k.prototype,"returnQueryGeometry",void 0),(0,n.k)([(0,n.o)({type:Boolean,json:{default:!1,write:!0}})],k.prototype,"returnM",void 0),(0,n.k)([(0,n.o)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],k.prototype,"returnZ",void 0),(0,n.k)([(0,n.o)({type:n.B,json:{write:!0}})],k.prototype,"sourceSpatialReference",void 0),(0,n.k)([(0,n.bk)(C,{ignoreUnknown:!1,name:"spatialRel"})],k.prototype,"spatialRelationship",void 0),(0,n.k)([(0,n.o)({type:Number,json:{read:{source:"resultOffset"}}})],k.prototype,"start",void 0),(0,n.k)([(0,n.q)("start"),(0,n.q)("num")],k.prototype,"writeStart",null),(0,n.k)([(0,n.o)({type:String,json:{write:!0}})],k.prototype,"sqlFormat",void 0),(0,n.k)([(0,n.o)({type:String,json:{write:!0}})],k.prototype,"text",void 0),(0,n.k)([(0,n.o)({type:o.p,json:{write:!0}})],k.prototype,"timeExtent",void 0),(0,n.k)([(0,n.o)({type:Boolean,json:{default:!1,write:!0}})],k.prototype,"timeReferenceUnknownClient",void 0),(0,n.k)([(0,n.bk)(L,{ignoreUnknown:!1}),(0,n.o)({json:{write:{overridePolicy(e){return{enabled:!!e&&null!=this.distance&&this.distance>0}}}}})],k.prototype,"units",void 0),(0,n.k)([(0,n.o)({type:String,json:{write:{overridePolicy(e){return{enabled:null!=e||null!=this.start&&this.start>0}}}}})],k.prototype,"where",void 0),(0,n.k)([(0,n.q)("where")],k.prototype,"writeWhere",null),k=N=(0,n.k)([(0,n.A)("esri.rest.support.Query")],k);const B=k,j=Object.freeze(Object.defineProperty({__proto__:null,default:B},Symbol.toStringTag,{value:"Module"}))},31292:function(e,t,r){r.d(t,{s:function(){return n}});var i=r(98503);class n{constructor(e){this._observable=new i.aQ,this._map=new Map(e)}get size(){return(0,i.aR)(this._observable),this._map.size}clear(){this._map.size>0&&(this._map.clear(),this._observable.notify())}delete(e){const t=this._map.delete(e);return t&&this._observable.notify(),t}entries(){return(0,i.aR)(this._observable),this._map.entries()}forEach(e,t){(0,i.aR)(this._observable),this._map.forEach(((r,i)=>e.call(t,r,i,this)),t)}get(e){return(0,i.aR)(this._observable),this._map.get(e)}has(e){return(0,i.aR)(this._observable),this._map.has(e)}keys(){return(0,i.aR)(this._observable),this._map.keys()}set(e,t){return this._map.set(e,t),this._observable.notify(),this}values(){return(0,i.aR)(this._observable),this._map.values()}[Symbol.iterator](){return(0,i.aR)(this._observable),this._map[Symbol.iterator]()}get[Symbol.toStringTag](){return this._map[Symbol.toStringTag]}}},46490:function(e,t,r){r.d(t,{o:function(){return a}});var i=r(98503),n=r(41470),s=r(30);const o=()=>i.n.getLogger("esri.views.webgl.VertexArrayObject");let a=class{constructor(e,t,r,i,n=null){this._context=e,this._locations=t,this._layout=r,this._buffers=i,this._indexBuffer=n,this._glName=null,this._initialized=!1}get glName(){return this._glName}get context(){return this._context}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}get byteSize(){return Array.from(this._buffers.values()).reduce(((e,t)=>e+t.usedMemory),null!=this._indexBuffer?this._indexBuffer.usedMemory:0)}get layout(){return this._layout}get locations(){return this._locations}get usedMemory(){return this.byteSize+(Object.keys(this._buffers).length+(this._indexBuffer?1:0))*i.cE}dispose(){this._context?(this._context.getBoundVAO()===this&&this._context.bindVAO(null),this._buffers.forEach((e=>e.dispose())),this._buffers.clear(),this._indexBuffer=(0,i.cF)(this._indexBuffer),this.disposeVAOOnly()):(this._glName||Object.getOwnPropertyNames(this._buffers).length>0)&&o().warn("Leaked WebGL VAO")}disposeVAOOnly(){this._glName&&(this._context.gl.deleteVertexArray(this._glName),this._glName=null,this._context.instanceCounter.decrement(n.V.VertexArrayObject,this)),this._context=null}initialize(){if(this._initialized)return;const{gl:e}=this._context,t=e.createVertexArray();e.bindVertexArray(t),this._bindLayout(),e.bindVertexArray(null),this._glName=t,this._context.instanceCounter.increment(n.V.VertexArrayObject,this),this._initialized=!0}bind(){this.initialize(),this._context.gl.bindVertexArray(this.glName)}_bindLayout(){const{_buffers:e,_layout:t,_indexBuffer:r}=this;e||o().error("Vertex buffer dictionary is empty!");const i=this._context.gl;this._buffers.forEach(((e,r)=>{const i=t.get(r);i?(0,s.E)(this._context,this._locations,e,i):o().error("Vertex element descriptor is empty!")})),null!=r&&i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,r.glName)}unbind(){this.initialize(),this._context.gl.bindVertexArray(null)}}},54396:function(e,t,r){r.d(t,{t:function(){return i}});class i{constructor(e,t,r,i,n,s=!1,o=0){this.name=e,this.count=t,this.type=r,this.offset=i,this.stride=n,this.normalized=s,this.divisor=o}}},45121:function(e,t,r){r.d(t,{$:function(){return N},H:function(){return j},I:function(){return le},K:function(){return z},N:function(){return p},O:function(){return E},P:function(){return _},Q:function(){return V},U:function(){return M},a:function(){return re},b:function(){return ue},c:function(){return K},e:function(){return Y},f:function(){return te},g:function(){return oe},h:function(){return ie},i:function(){return ee},l:function(){return Z},n:function(){return X},o:function(){return W},p:function(){return ae},r:function(){return $},t:function(){return q},w:function(){return m}});var i=r(98503),n=r(75934),s=r(83258);function o(e,t){return e?t?4:3:t?3:2}const a=()=>i.n.getLogger("esri.layers.graphics.featureConversionUtils"),l={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0,esriGeometryMultiPatch:3,esriGeometryEnvelope:0},c=(e,t,r,i,n,s)=>{e[r]=n,e[r+1]=s},u=(e,t,r,i,n,s)=>{e[r]=n,e[r+1]=s,e[r+2]=t[i+2]},h=(e,t,r,i,n,s)=>{e[r]=n,e[r+1]=s,e[r+2]=t[i+3]},d=(e,t,r,i,n,s)=>{e[r]=n,e[r+1]=s,e[r+2]=t[i+2],e[r+3]=t[i+3]};function f(e,t,r,i){if(e){if(r)return t&&i?d:u;if(t&&i)return h}else if(t&&i)return u;return c}function p({scale:e,translate:t},r){return Math.round((r-t[0])/e[0])}function m({scale:e,translate:t},r){return Math.round((t[1]-r)/e[1])}function g({scale:e,translate:t},r,i){return r*e[i]+t[i]}function _(e,t,r){return e?t?r?S(e):b(e):r?T(e):y(e):null}function y(e){const t=e.coords;return{x:t[0],y:t[1]}}function v(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e}function b(e){const t=e.coords;return{x:t[0],y:t[1],z:t[2]}}function w(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e}function T(e){const t=e.coords;return{x:t[0],y:t[1],m:t[2]}}function x(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.m,e}function S(e){const t=e.coords;return{x:t[0],y:t[1],z:t[2],m:t[3]}}function R(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e.coords[3]=t.m,e}function O(e,t,r,i){let n=y;r&&i?n=S:r?n=b:i&&(n=T);for(const s of t){const{geometry:t,attributes:r}=s,i=null!=t?n(t):null;e.push({attributes:r,geometry:i})}return e}function A(e,t){return e&&t?R:e?w:t?x:v}function I(e,t,r,i,s){const o=A(r,i);for(const{geometry:a,attributes:l}of t){const t=null!=a?o(new n.s,a):null;e.push(new n.e(t,l,null,s?l[s]:void 0))}return e}function E(e,t,r=A(null!=t.z,null!=t.m)){return r(e,t)}function C(e,t,r,i){for(const{geometry:n,attributes:s}of t)e.push({attributes:s,geometry:null!=n?M(n,r,i):null});return e}function M(e,t,r){if(null==e)return null;const i=o(t,r),n=[];for(let s=0;s<e.coords.length;s+=i){const t=[];for(let r=0;r<i;r++)t.push(e.coords[s+r]);n.push(t)}return t?r?{points:n,hasZ:t,hasM:r}:{points:n,hasZ:t}:r?{points:n,hasM:r}:{points:n}}function F(e,t,r,i,s){const a=o(r,i);for(const{geometry:o,attributes:l}of t){const t=null!=o?D(new n.s,o,a):null;e.push(new n.e(t,l,null,s?l[s]:void 0))}return e}function D(e,t,r=o(t.hasZ,t.hasM)){e.lengths[0]=t.points.length;const i=e.coords;let n=0;for(const s of t.points)for(let e=0;e<r;e++)i[n++]=s[e];return e}function P(e,t,r,i){for(const{geometry:n,attributes:s}of t)e.push({attributes:s,geometry:null!=n?N(n,r,i):null});return e}function N(e,t,r){if(!e)return null;const i=o(t,r),{coords:n,lengths:s}=e,a=[];let l=0;for(const o of s){const e=[];for(let t=0;t<o;t++){const t=[];for(let e=0;e<i;e++)t.push(n[l++]);e.push(t)}a.push(e)}return t?r?{paths:a,hasZ:t,hasM:r}:{paths:a,hasZ:t}:r?{paths:a,hasM:r}:{paths:a}}function L(e,t,r,i,s){const a=o(r,i);for(const{geometry:o,attributes:l,centroid:c}of t){const t=null!=o?k(new n.s,o,a):null,r=null!=c?E(new n.s,c):null;e.push(new n.e(t,l,r,s?l[s]:void 0))}return e}function k(e,t,r=o(t.hasZ,t.hasM)){const{lengths:i,coords:n}=e;let s=0;for(const o of t.paths){for(const e of o)for(let t=0;t<r;t++)n[s++]=e[t];i.push(o.length)}return e}function B(e,t,r,i){for(const{geometry:n,attributes:s,centroid:o}of t){const t=null!=n?j(n,r,i):null;if(null!=o){const r=y(o);e.push({attributes:s,centroid:r,geometry:t})}else e.push({attributes:s,geometry:t})}return e}function j(e,t,r){if(!e)return null;const i=o(t,r),{coords:n,lengths:s}=e,a=[];let l=0;for(const o of s){const e=[];for(let t=0;t<o;t++){const t=[];for(let e=0;e<i;e++)t.push(n[l++]);e.push(t)}a.push(e)}return t?r?{rings:a,hasZ:t,hasM:r}:{rings:a,hasZ:t}:r?{rings:a,hasM:r}:{rings:a}}function G(e,t,r,i,s){for(const{geometry:o,centroid:a,attributes:l}of t){const t=null!=o?z(new n.s,o,r,i):null,c=s?l[s]:void 0;null!=a?e.push(new n.e(t,l,v(new n.s,a),c)):e.push(new n.e(t,l,null,c))}return e}function z(e,t,r=t.hasZ,i=t.hasM){return V(e,t.rings,r,i)}function V(e,t,r,i){const n=o(r,i),{lengths:s,coords:a}=e;let l=0;he(e);for(const o of t){for(const e of o)for(let t=0;t<n;t++)a[l++]=e[t];s.push(o.length)}return e}const U=[],H=[];function q(e,t,r,i,n){U[0]=e;const[s]=Y(H,U,t,r,i,n);return de(U),de(H),s}function Y(e,t,r,s,o,l){if(de(e),!r){for(const r of t){const t=l?r.attributes[l]:void 0;e.push(new n.e(null,r.attributes,null,t))}return e}switch(r){case"esriGeometryPoint":return I(e,t,s,o,l);case"esriGeometryMultipoint":return F(e,t,s,o,l);case"esriGeometryPolyline":return L(e,t,s,o,l);case"esriGeometryPolygon":case"esriGeometryMultiPatch":return G(e,t,s,o,l);default:a().error("convertToFeatureSet:unknown-geometry",new i.s(`Unable to parse unknown geometry type '${r}'`)),de(e)}return e}function X(e,t,r,i){H[0]=e,J(U,H,t,r,i);const n=U[0];return de(U),de(H),n}function W(e,t,r){if(null==e)return null;const s=new n.s;return"hasZ"in e&&null==t&&(t=e.hasZ),"hasM"in e&&null==r&&(r=e.hasM),(0,i.a8)(e)?A(t??null!=e.z,r??null!=e.m)(s,e):(0,i.a9)(e)?z(s,e,t,r):(0,i.aa)(e)?k(s,e,o(t,r)):(0,i.ab)(e)?D(s,e,o(t,r)):void a().error("convertFromGeometry:unknown-geometry",new i.s(`Unable to parse unknown geometry type '${e}'`))}function $(e,t,r,n){const s=e&&("coords"in e?e:e.geometry);if(null==s)return null;switch(t){case"esriGeometryPoint":{let e=y;return r&&n?e=S:r?e=b:n&&(e=T),e(s)}case"esriGeometryMultipoint":return M(s,r,n);case"esriGeometryPolyline":return N(s,r,n);case"esriGeometryPolygon":return j(s,r,n);default:return a().error("convertToGeometry:unknown-geometry",new i.s(`Unable to parse unknown geometry type '${t}'`)),null}}function Q(e,t){for(const r of t)e.push({attributes:r.attributes});return e}function J(e,t,r,n,s){if(de(e),null==r)return Q(e,t);switch(r){case"esriGeometryPoint":return O(e,t,n,s);case"esriGeometryMultipoint":return C(e,t,n,s);case"esriGeometryPolyline":return P(e,t,n,s);case"esriGeometryPolygon":return B(e,t,n,s);default:a().error("convertToFeatureSet:unknown-geometry",new i.s(`Unable to parse unknown geometry type '${r}'`))}return e}function Z(e){const{objectIdFieldName:t,spatialReference:r,transform:i,fields:n,hasM:s,hasZ:o,features:a,geometryType:l,exceededTransferLimit:c,uniqueIdField:u,queryGeometry:h,queryGeometryType:d}=e,f={features:J([],a,l,o,s),fields:n,geometryType:l,objectIdFieldName:t,spatialReference:r,uniqueIdField:u,queryGeometry:$(h,d,!1,!1)};return i&&(f.transform=i),c&&(f.exceededTransferLimit=c),s&&(f.hasM=s),o&&(f.hasZ=o),f}function K(e,t){const r=new s.e,{hasM:n,hasZ:o,features:l,objectIdFieldName:c,spatialReference:u,geometryType:h,exceededTransferLimit:d,transform:f,fields:p}=e;return p&&(r.fields=p),r.geometryType=h??null,r.objectIdFieldName=c??t??null,r.spatialReference=u??null,r.objectIdFieldName?(l&&Y(r.features,l,h,o,n,r.objectIdFieldName),d&&(r.exceededTransferLimit=d),n&&(r.hasM=n),o&&(r.hasZ=o),f&&(r.transform=f),r):(a().error(new i.s("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),r)}function ee(e){const{transform:t,features:r,hasM:i,hasZ:n}=e;if(!t)return e;for(const s of r)null!=s.geometry&&ae(s.geometry,s.geometry,i,n,t),null!=s.centroid&&ae(s.centroid,s.centroid,i,n,t);return e.transform=null,e}function te(e,t){const{geometryType:r,features:i,hasM:s,hasZ:o}=t;if(!e)return t;for(let a=0;a<i.length;a++){const t=i[a],l=t.weakClone();l.geometry=new n.s,re(l.geometry,t.geometry,s,o,r,e),t.centroid&&(l.centroid=new n.s,re(l.centroid,t.centroid,s,o,"esriGeometryPoint",e)),i[a]=l}return t.transform=e,t}function re(e,t,r,i,n,s,a=r,c=i){if(he(e),!t?.coords.length)return null;const u=l[n],{coords:h,lengths:d}=t,g=o(r,i),_=o(r&&a,i&&c),y=f(r,i,a,c);if(!d.length)return y(e.coords,h,0,0,p(s,h[0]),m(s,h[1])),he(e,g,0),e;let v,b,w,T,x=0,S=0,R=S;for(const o of d){if(o<u)continue;let t=0;S=R,w=v=p(s,h[x]),T=b=m(s,h[x+1]),y(e.coords,h,S,x,w,T),t++,x+=g,S+=_;for(let r=1;r<o;r++,x+=g)w=p(s,h[x]),T=m(s,h[x+1]),w===v&&T===b||(y(e.coords,h,S,x,w-v,T-b),S+=_,t++,v=w,b=T);t>=u&&(e.lengths.push(t),R=S)}return de(e.coords,R),e.coords.length?e:null}function ie(e,t,r,i,n,s,a=r,c=i){if(he(e),!t?.coords.length)return null;const u=l[n],{coords:h,lengths:d}=t,p=o(r,i),m=o(r&&a,i&&c),g=f(r,i,a,c);if(!d.length)return g(e.coords,h,0,0,h[0],h[1]),he(e,p,0),e;let _=0;const y=s*s;for(const o of d){if(o<u){_+=o*p;continue}const t=e.coords.length/m,r=_,i=_+(o-1)*p;g(e.coords,h,e.coords.length,r,h[r],h[r+1]),se(e.coords,h,p,y,g,r,i),g(e.coords,h,e.coords.length,i,h[i],h[i+1]);const n=e.coords.length/m-t;n>=u?e.lengths.push(n):de(e.coords,t*m),_+=o*p}return e.coords.length?e:null}function ne(e,t,r,i){const n=e[t],s=e[t+1],o=e[r],a=e[r+1],l=e[i],c=e[i+1];let u=o,h=a,d=l-u,f=c-h;if(0!==d||0!==f){const e=((n-u)*d+(s-h)*f)/(d*d+f*f);e>1?(u=l,h=c):e>0&&(u+=d*e,h+=f*e)}return d=n-u,f=s-h,d*d+f*f}function se(e,t,r,i,n,s,o){let a,l=i,c=0;for(let u=s+r;u<o;u+=r)a=ne(t,u,s,o),a>l&&(c=u,l=a);l>i&&(c-s>r&&se(e,t,r,i,n,s,c),n(e,t,e.length,c,t[c],t[c+1]),o-c>r&&se(e,t,r,i,n,c,o))}function oe(e,t,r,n){if(!t?.coords?.length)return null;const s=o(r,n);let a=Number.POSITIVE_INFINITY,l=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY,u=Number.NEGATIVE_INFINITY;if(t&&t.coords){const e=t.coords;for(let t=0;t<e.length;t+=s){const r=e[t],i=e[t+1];a=Math.min(a,r),c=Math.max(c,r),l=Math.min(l,i),u=Math.max(u,i)}}return(0,i.ac)(e)?(0,i.ad)(e,a,l,c,u):(0,i.ae)(a,l,c,u,e),e}function ae(e,t,r,n,s){const{coords:a,lengths:l}=t,c=o(r,n);if(!a.length)return e!==t&&he(e),e;(0,i.af)(s);const{originPosition:u,scale:h,translate:d}=s,f=fe;f.originPosition=u;const p=f.scale;p[0]=h[0]??1,p[1]=-(h[1]??1),p[2]=h[2]??1,p[3]=h[3]??1;const m=f.translate;if(m[0]=d[0]??0,m[1]=d[1]??0,m[2]=d[2]??0,m[3]=d[3]??0,!l.length){for(let t=0;t<c;++t)e.coords[t]=g(f,a[t],t);return e!==t&&he(e,c,0),e}let _=0;for(let i=0;i<l.length;i++){const t=l[i];e.lengths[i]=t;for(let i=0;i<c;++i)e.coords[_+i]=g(f,a[_+i],i);let r=e.coords[_],n=e.coords[_+1];_+=c;for(let i=1;i<t;i++,_+=c){r+=a[_]*p[0],n+=a[_+1]*p[1],e.coords[_]=r,e.coords[_+1]=n;for(let t=2;t<c;++t)e.coords[_+t]=g(f,a[_+t],t)}}return e!==t&&he(e,a.length,l.length),e}function le(e,t,r,i,n,s){if(he(e),e.lengths.push(...t.lengths),r===n&&i===s)for(let o=0;o<t.coords.length;o++)e.coords.push(t.coords[o]);else{const a=o(r,i),l=f(r,i,n,s),c=t.coords;for(let t=0;t<c.length;t+=a)l(e.coords,c,e.coords.length,t,c[t],c[t+1])}return e}function ce(e,t,r,i){let n=0,s=e[i*t],o=e[i*(t+1)];for(let a=1;a<r;a++){const r=s+e[i*(t+a)],l=o+e[i*(t+a)+1],c=(r-s)*(l+o);s=r,o=l,n+=c}return.5*n}function ue(e,t){const{coords:r,lengths:i}=e;let n=0,s=0;for(let o=0;o<i.length;o++){const e=i[o];s+=ce(r,n,e,t),n+=e}return Math.abs(s)}function he(e,t=0,r=0){de(e.lengths,r),de(e.coords,t)}function de(e,t=0){e.length!==t&&(e.length=t)}const fe={originPosition:"lowerLeft",scale:[1,1,1,1],translate:[0,0,0,0]}},12167:function(e,t,r){r.d(t,{o:function(){return n},r:function(){return s}});var i=r(98503);function n(e,t,r=0){const n=(0,i.aP)(e,0,l);for(let i=0;i<4;i++)t[r+i]=Math.floor(256*c(n*o[i]))}function s(e,t=0){let r=0;for(let i=0;i<4;i++)r+=e[t+i]*a[i];return r}const o=[1,256,65536,16777216],a=[1/256,1/65536,1/16777216,1/4294967296],l=s(new Uint8ClampedArray([255,255,255,255]));function c(e){return e-Math.floor(e)}},12449:function(e,t,r){r.d(t,{t:function(){return s}});var i=r(41470),n=r(54396);function s(e,t=0){const r=e.stride;return Array.from(e.fields.keys()).map((i=>{const s=e.fields.get(i),a=s.constructor.ElementCount,l=o(s.constructor.ElementType),c=s.offset,u=s.optional?.glNormalized??!1;return new n.t(i,a,l,c,r,u,t)}))}function o(e){const t=a[e];if(t)return t;throw new Error("BufferType not supported in WebGL")}const a={u8:i.C.UNSIGNED_BYTE,u16:i.C.UNSIGNED_SHORT,u32:i.C.UNSIGNED_INT,i8:i.C.BYTE,i16:i.C.SHORT,i32:i.C.INT,f32:i.C.FLOAT}},88623:function(e,t,r){r.d(t,{n:function(){return l}});var i,n=r(98503);(function(e){e[e.varint=0]="varint",e[e.fixed64=1]="fixed64",e[e.delimited=2]="delimited",e[e.fixed32=5]="fixed32",e[e.unknown=99]="unknown"})(i||(i={}));const s=4294967296,o=new TextDecoder("utf-8"),a=(0,n.a$)("safari")||(0,n.a$)("ios")?6:(0,n.a$)("ff")?12:32;class l{constructor(e,t,r=0,n=(e?e.byteLength:0)){this._tag=0,this._dataType=i.unknown,this._init(e,t,r,n)}_init(e,t,r,i){this._data=e,this._dataView=t,this._pos=r,this._end=i}asUnsafe(){return this}clone(){return new l(this._data,this._dataView,this._pos,this._end)}pos(){return this._pos}move(e){this._pos=e}nextTag(e){for(;;){if(this._pos===this._end)return!1;const t=this._decodeVarint();if(this._tag=t>>3,this._dataType=7&t,!e||e===this._tag)break;this.skip()}return!0}next(){if(this._pos===this._end)return!1;const e=this._decodeVarint();return this._tag=e>>3,this._dataType=7&e,!0}empty(){return this._pos>=this._end}tag(){return this._tag}getInt32(){return this._decodeVarint()}getInt64(){return this._decodeVarint()}getUInt32(){let e=4294967295;if(e=(127&this._data[this._pos])>>>0,this._data[this._pos++]<128||(e=(e|(127&this._data[this._pos])<<7)>>>0,this._data[this._pos++]<128)||(e=(e|(127&this._data[this._pos])<<14)>>>0,this._data[this._pos++]<128)||(e=(e|(127&this._data[this._pos])<<21)>>>0,this._data[this._pos++]<128)||(e=(e|(15&this._data[this._pos])<<28)>>>0,this._data[this._pos++]<128))return e;throw new Error("Varint overflow")}getUInt64(){return this._decodeVarint()}getSInt32(){const e=this.getUInt32();return e>>>1^-(1&e)}getSInt64(){return this._decodeSVarint()}getBool(){const e=0!==this._data[this._pos];return this._skip(1),e}getEnum(){return this._decodeVarint()}getFixed64(){const e=this._dataView,t=this._pos,r=e.getUint32(t,!0)+e.getUint32(t+4,!0)*s;return this._skip(8),r}getSFixed64(){const e=this._dataView,t=this._pos,r=e.getUint32(t,!0)+e.getInt32(t+4,!0)*s;return this._skip(8),r}getDouble(){const e=this._dataView.getFloat64(this._pos,!0);return this._skip(8),e}getFixed32(){const e=this._dataView.getUint32(this._pos,!0);return this._skip(4),e}getSFixed32(){const e=this._dataView.getInt32(this._pos,!0);return this._skip(4),e}getFloat(){const e=this._dataView.getFloat32(this._pos,!0);return this._skip(4),e}getString(){const e=this._getLength(),t=this._pos,r=this._toString(this._data,t,t+e);return this._skip(e),r}getBytes(){const e=this._getLength(),t=this._pos,r=this._toBytes(this._data,t,t+e);return this._skip(e),r}getLength(){return this._getLengthUnsafe()}processMessageWithArgs(e,t,r,i){const n=this.getMessage(),s=e(n,t,r,i);return n.release(),s}processMessage(e){const t=this.getMessage(),r=e(t);return t.release(),r}getMessage(){const e=this._getLength(),t=l.pool.acquire();return t._init(this._data,this._dataView,this._pos,this._pos+e),this._skip(e),t}release(){l.pool.release(this)}dataType(){return this._dataType}skip(){switch(this._dataType){case i.varint:this._decodeVarint();break;case i.fixed64:this._skip(8);break;case i.delimited:this._skip(this._getLength());break;case i.fixed32:this._skip(4);break;default:throw new Error("Invalid data type!")}}skipLen(e){this._skip(e)}_skip(e){if(this._pos+e>this._end)throw new Error("Attempt to skip past the end of buffer!");this._pos+=e}_decodeVarint(){const e=this._data;let t=this._pos,r=0,i=0;if(this._end-t>=10)do{if(i=e[t++],r|=127&i,!(128&i)||(i=e[t++],r|=(127&i)<<7,!(128&i))||(i=e[t++],r|=(127&i)<<14,!(128&i))||(i=e[t++],r|=(127&i)<<21,!(128&i))||(i=e[t++],r+=268435456*(127&i),!(128&i))||(i=e[t++],r+=34359738368*(127&i),!(128&i))||(i=e[t++],r+=4398046511104*(127&i),!(128&i))||(i=e[t++],r+=562949953421312*(127&i),!(128&i))||(i=e[t++],r+=72057594037927940*(127&i),!(128&i))||(i=e[t++],r+=0x8000000000000000*(127&i),!(128&i)))break;throw new Error("Varint too long!")}while(0);else{let n=1;for(;t!==this._end&&(i=e[t],128&i);)++t,r+=(127&i)*n,n*=128;if(t===this._end)throw new Error("Varint overrun!");++t,r+=i*n}return this._pos=t,r}_decodeSVarint(){const e=this._data;let t,r=0,i=0;const n=1&e[this._pos];if(i=e[this._pos++],r|=127&i,!(128&i)||(i=e[this._pos++],r|=(127&i)<<7,!(128&i))||(i=e[this._pos++],r|=(127&i)<<14,!(128&i))||(i=e[this._pos++],r|=(127&i)<<21,!(128&i))||(i=e[this._pos++],r+=268435456*(127&i),!(128&i))||(i=e[this._pos++],r+=34359738368*(127&i),!(128&i))||(i=e[this._pos++],r+=4398046511104*(127&i),!(128&i)))return n?-(r+1)/2:r/2;if(t=BigInt(r),i=e[this._pos++],t+=0x2000000000000n*BigInt(127&i),!(128&i)||(i=e[this._pos++],t+=0x100000000000000n*BigInt(127&i),!(128&i))||(i=e[this._pos++],t+=0x8000000000000000n*BigInt(127&i),!(128&i)))return Number(n?-(t+1n)/2n:t/2n);throw new Error("Varint too long!")}_getLength(){if(this._dataType!==i.delimited)throw new Error("Not a delimited data type!");return this._decodeVarint()}_getLengthUnsafe(){return this.getUInt32()}_toString(e,t,r){if((r=Math.min(this._end,r))-t>a){const i=e.subarray(t,r);return o.decode(i)}let i="",n="";for(let s=t;s<r;++s){const t=e[s];128&t?n+="%"+t.toString(16):(i+=decodeURIComponent(n)+String.fromCharCode(t),n="")}return n.length&&(i+=decodeURIComponent(n)),i}_toBytes(e,t,r){return r=Math.min(this._end,r),new Uint8Array(e.buffer,t,r-t)}}l.pool=new n.aB(l,void 0,(e=>{e._data=null,e._dataView=null}))},25492:function(e,t,r){r.d(t,{a:function(){return l},b:function(){return b},h:function(){return R},t:function(){return M}});var i=r(98503),n=r(88623),s=r(75934),o=r(83258);const a=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"];let l=class{constructor(e){this._options=e,this.geometryTypes=a,this._coordinatePtr=0,this._vertexDimension=0}createFeatureResult(){return new o.e}prepareFeatures(e){this._vertexDimension=2,e.hasZ&&this._vertexDimension++,e.hasM&&this._vertexDimension++}finishFeatureResult(e){if(!e?.features||!e.hasZ||!this._options.sourceSpatialReference||!e.spatialReference||(0,i.bh)(e.spatialReference,this._options.sourceSpatialReference)||e.spatialReference.vcsWkid)return;const t=(0,i.bg)(this._options.sourceSpatialReference)/(0,i.bg)(e.spatialReference);if(1!==t)for(const r of e.features){if(!(0,s.a)(r))continue;const e=r.geometry.coords;for(let r=2;r<e.length;r+=3)e[r]*=t}}addFeature(e,t){e.features.push(t)}createFeature(){return new s.e}createSpatialReference(){return{wkid:0}}createGeometry(){return new s.s}addField(e,t){e.fields.push(t)}allocateCoordinates(e){e.coords.length=e.lengths.reduce(((e,t)=>e+t),0)*this._vertexDimension,this._coordinatePtr=0}addCoordinate(e,t){e.coords[this._coordinatePtr++]=t}addCoordinatePoint(e,t){e.coords.push(t)}addLength(e,t){e.lengths.push(t)}addQueryGeometry(e,t){e.queryGeometry=t.queryGeometry,e.queryGeometryType=t.queryGeometryType}createPointGeometry(){return new s.s}};const c=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeString","esriFieldTypeDate","esriFieldTypeOID","esriFieldTypeGeometry","esriFieldTypeBlob","esriFieldTypeRaster","esriFieldTypeGUID","esriFieldTypeGlobalID","esriFieldTypeXML","esriFieldTypeBigInteger","esriFieldTypeDateOnly","esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset"],u=["sqlTypeBigInt","sqlTypeBinary","sqlTypeBit","sqlTypeChar","sqlTypeDate","sqlTypeDecimal","sqlTypeDouble","sqlTypeFloat","sqlTypeGeometry","sqlTypeGUID","sqlTypeInteger","sqlTypeLongNVarchar","sqlTypeLongVarbinary","sqlTypeLongVarchar","sqlTypeNChar","sqlTypeNVarchar","sqlTypeOther","sqlTypeReal","sqlTypeSmallInt","sqlTypeSqlXml","sqlTypeTime","sqlTypeTimestamp","sqlTypeTimestamp2","sqlTypeTinyInt","sqlTypeVarbinary","sqlTypeVarchar"],h=["upperLeft","lowerLeft"];function d(e){return e>=c.length?null:c[e]}function f(e){return e>=u.length?null:u[e]}function p(e){return e>=h.length?null:h[e]}function m(e,t){return t>=e.geometryTypes.length?null:e.geometryTypes[t]}function g(e,t,r){const i=e.asUnsafe(),n=t.createPointGeometry(r);for(;i.next();)switch(i.tag()){case 3:{const e=i.getUInt32(),r=i.pos()+e;let s=0;for(;i.pos()<r;)t.addCoordinatePoint(n,i.getSInt64(),s++);break}default:i.skip()}return n}function _(e,t,r){const i=e.asUnsafe(),n=t.createGeometry(r),s=2+(r.hasZ?1:0)+(r.hasM?1:0);for(;i.next();)switch(i.tag()){case 2:{const e=i.getUInt32(),r=i.pos()+e;let s=0;for(;i.pos()<r;)t.addLength(n,i.getUInt32(),s++);break}case 3:{const e=i.getUInt32(),r=i.pos()+e;let o=0;for(t.allocateCoordinates(n);i.pos()<r;)t.addCoordinate(n,i.getSInt64(),o),o++,o===s&&(o=0);break}default:i.skip()}return n}function y(e){const t=e.asUnsafe(),r=new s.s;let i="esriGeometryPoint";for(;t.next();)switch(t.tag()){case 2:{const e=t.getUInt32(),i=t.pos()+e;for(;t.pos()<i;)r.lengths.push(t.getUInt32());break}case 3:{const e=t.getUInt32(),i=t.pos()+e;for(;t.pos()<i;)r.coords.push(t.getSInt64());break}case 1:i=a[t.getEnum()];break;default:t.skip()}return{queryGeometry:r,queryGeometryType:i}}function v(e){const t=e.asUnsafe();for(;t.next();)switch(t.tag()){case 1:return t.getString();case 2:return t.getFloat();case 3:return t.getDouble();case 4:return t.getSInt32();case 5:return t.getUInt32();case 6:return t.getInt64();case 7:return t.getUInt64();case 8:return t.getSInt64();case 9:return t.getBool();default:return t.skip(),null}return null}function b(e){const t=e.asUnsafe(),r={type:d(0)};for(;t.next();)switch(t.tag()){case 1:r.name=t.getString();break;case 2:r.type=d(t.getEnum());break;case 3:r.alias=t.getString();break;case 4:r.sqlType=f(t.getEnum());break;case 5:t.skip();break;case 6:r.defaultValue=t.getString();break;default:t.skip()}return r}function w(e){const t={},r=e.asUnsafe();for(;r.next();)switch(r.tag()){case 1:t.name=r.getString();break;case 2:t.isSystemMaintained=r.getBool();break;default:r.skip()}return t}function T(e,t,r,i){const n=t.createFeature(r);let s=0;for(;e.next();)switch(e.tag()){case 1:{const t=i[s++].name;n.attributes[t]=e.processMessage(v);break}case 2:n.geometry=e.processMessageWithArgs(_,t,r);break;case 4:n.centroid=e.processMessageWithArgs(g,t,r);break;default:e.skip()}return n}function x(e){const t=[1,1,1,1],r=e.asUnsafe();for(;r.next();)switch(r.tag()){case 1:t[0]=r.getDouble();break;case 2:t[1]=r.getDouble();break;case 4:t[2]=r.getDouble();break;case 3:t[3]=r.getDouble();break;default:r.skip()}return t}function S(e){const t=[0,0,0,0],r=e.asUnsafe();for(;r.next();)switch(r.tag()){case 1:t[0]=r.getDouble();break;case 2:t[1]=r.getDouble();break;case 4:t[2]=r.getDouble();break;case 3:t[3]=r.getDouble();break;default:r.skip()}return t}function R(e){const t={originPosition:p(0)},r=e.asUnsafe();for(;r.next();)switch(r.tag()){case 1:t.originPosition=p(r.getEnum());break;case 2:t.scale=r.processMessage(x);break;case 3:t.translate=r.processMessage(S);break;default:r.skip()}return t}function O(e){const t={},r=e.asUnsafe();for(;r.next();)switch(r.tag()){case 1:t.shapeAreaFieldName=r.getString();break;case 2:t.shapeLengthFieldName=r.getString();break;case 3:t.units=r.getString();break;default:r.skip()}return t}function A(e,t){const r=t.createSpatialReference();for(;e.next();)switch(e.tag()){case 1:r.wkid=e.getUInt32();break;case 5:r.wkt=e.getString();break;case 2:r.latestWkid=e.getUInt32();break;case 3:r.vcsWkid=e.getUInt32();break;case 4:r.latestVcsWkid=e.getUInt32();break;default:e.skip()}return r}function I(e,t){const r=t.createFeatureResult(),i=e.asUnsafe();r.geometryType=m(t,0);let n=!1;for(;i.next();)switch(i.tag()){case 1:r.objectIdFieldName=i.getString();break;case 3:r.globalIdFieldName=i.getString();break;case 4:r.geohashFieldName=i.getString();break;case 5:r.geometryProperties=i.processMessage(O);break;case 7:r.geometryType=m(t,i.getEnum());break;case 8:r.spatialReference=i.processMessageWithArgs(A,t);break;case 10:r.hasZ=i.getBool();break;case 11:r.hasM=i.getBool();break;case 12:r.transform=i.processMessage(R);break;case 9:r.exceededTransferLimit=i.getBool();break;case 13:t.addField(r,i.processMessage(b));break;case 15:n||(t.prepareFeatures(r),n=!0),t.addFeature(r,i.processMessageWithArgs(T,t,r,r.fields));break;case 2:r.uniqueIdField=i.processMessage(w);break;default:i.skip()}return t.finishFeatureResult(r),r}function E(e,t){const r={};let i=null;for(;e.next();)switch(e.tag()){case 4:i=e.processMessageWithArgs(y);break;case 1:r.featureResult=e.processMessageWithArgs(I,t);break;default:e.skip()}return null!=i&&r.featureResult&&t.addQueryGeometry(r,i),r}function C(e,t){try{const r=new n.n(new Uint8Array(e),new DataView(e)),i={};for(;r.next();)2===r.tag()?i.queryResult=r.processMessageWithArgs(E,t):r.skip();return i}catch(r){throw new i.s("query:parsing-pbf","Error while parsing FeatureSet PBF payload",{error:r})}}function M(e,t){const r=C(e,t),i=r.queryResult.featureResult,n=r.queryResult.queryGeometry,s=r.queryResult.queryGeometryType;if(i&&i.features&&i.features.length&&i.objectIdFieldName){const e=i.objectIdFieldName;for(const t of i.features)t.attributes&&(t.objectId=t.attributes[e])}return i&&(i.queryGeometry=n,i.queryGeometryType=s),i}},93484:function(e,t,r){r.d(t,{c:function(){return o}});var i=r(98503),n=r(49555),s=r(85502);function o(e,t,r,i){if((0,n.J)(e.spatialReference,r)){a[0]=e.x,a[1]=e.y;const n=e.z;return a[2]=n??i??0,(0,s.n)(a,e.spatialReference,0,t,r,0)}const o=(0,n.H)(e,r);return!!o&&(t[0]=o?.x,t[1]=o?.y,t[2]=o?.z??i??0,!0)}const a=(0,i.aA)()},98424:function(e,t,r){r.d(t,{a:function(){return a},e:function(){return s},n:function(){return o}});var i=r(98503),n=(r(85502),r(93484));function s(e,t,r,i){return{x:e,y:t,z:r,hasZ:null!=r,hasM:!1,spatialReference:i,type:"point"}}function o(e,t,r,i,n){e.x=t,e.y=r,e.z=i,e.hasZ=null!=i,e.spatialReference=n}function a(e,t,r,i,s){return!(null==t||null==i||e.length<2)&&(l.x=e[0],l.y=e[1],l.z=e[2],l.spatialReference=t,(0,n.c)(l,r,i,s))}const l=s(0,0,0,i.B.WGS84)},99933:function(e,t,r){r.d(t,{S:function(){return m},c:function(){return h},d:function(){return f},f:function(){return d},p:function(){return p},t:function(){return a},x:function(){return g}});var i=r(98503),n=r(58469),s=r(25492),o=r(6488);function a(e){const t={};for(const r in e){if("declaredClass"===r)continue;const i=e[r];if(null!=i&&"function"!=typeof i)if(Array.isArray(i)){t[r]=[];for(let e=0;e<i.length;e++)t[r][e]=a(i[e])}else"object"==typeof i?i.toJSON&&(t[r]=JSON.stringify(i)):t[r]=i}return t}const l="Layer does not support extent calculation.";function c(e,t){if(t&&"extent"===e.type)return`${e.xmin},${e.ymin},${e.xmax},${e.ymax}`;if(t&&"point"===e.type)return`${e.x},${e.y}`;const r=e.toJSON();return delete r.spatialReference,JSON.stringify(r)}function u(e,t){const r=e.geometry,n=e.toJSON();delete n.compactGeometryEnabled,delete n.defaultSpatialReferenceEnabled;const s=n;let o,a,l;if(null!=r&&(a=r.spatialReference,l=(0,i.bn)(a),s.geometryType=(0,i.aW)(r),s.geometry=c(r,e.compactGeometryEnabled),s.inSR=l),n.groupByFieldsForStatistics&&(s.groupByFieldsForStatistics=n.groupByFieldsForStatistics.join(",")),n.objectIds&&(s.objectIds=n.objectIds.join(",")),n.orderByFields&&(s.orderByFields=n.orderByFields.join(",")),!n.outFields||!n.returnDistinctValues&&(t?.returnCountOnly||t?.returnExtentOnly||t?.returnIdsOnly)?delete s.outFields:n.outFields.includes("*")?s.outFields="*":s.outFields=n.outFields.join(","),n.outSR?(s.outSR=(0,i.bn)(n.outSR),o=e.outSpatialReference):r&&(n.returnGeometry||n.returnCentroid)&&(s.outSR=s.inSR,o=a),n.returnGeometry&&delete n.returnGeometry,n.outStatistics&&(s.outStatistics=JSON.stringify(n.outStatistics)),n.fullText&&(s.fullText=JSON.stringify(n.fullText)),n.pixelSize&&(s.pixelSize=JSON.stringify(n.pixelSize)),n.quantizationParameters&&(e.defaultSpatialReferenceEnabled&&null!=a&&null!=e.quantizationParameters?.extent&&a.equals(e.quantizationParameters.extent.spatialReference)&&delete n.quantizationParameters.extent.spatialReference,s.quantizationParameters=JSON.stringify(n.quantizationParameters)),n.parameterValues&&(s.parameterValues=JSON.stringify(n.parameterValues)),n.rangeValues&&(s.rangeValues=JSON.stringify(n.rangeValues)),n.dynamicDataSource&&(s.layer=JSON.stringify({source:n.dynamicDataSource}),delete n.dynamicDataSource),n.timeExtent){const e=n.timeExtent,{start:t,end:r}=e;null==t&&null==r||(s.time=t===r?t:`${t??"null"},${r??"null"}`),delete n.timeExtent}return e.defaultSpatialReferenceEnabled&&null!=a&&null!=o&&a.equals(o)&&(s.defaultSR=s.inSR,delete s.inSR,delete s.outSR),s}async function h(e,t,r,i){const n=null!=t.timeExtent&&t.timeExtent.isEmpty?{data:{features:[]}}:await _(e,t,"json",i);return(0,o.t)(t,r,n.data),n}async function d(e,t,r,i){if(null!=t.timeExtent&&t.timeExtent.isEmpty)return{data:r.createFeatureResult()};const n=await f(e,t,i),o=n;return o.data=(0,s.t)(n.data,r),o}function f(e,t,r){return _(e,t,"pbf",r)}function p(e,t,r){return null!=t.timeExtent&&t.timeExtent.isEmpty?Promise.resolve({data:{objectIds:[]}}):_(e,t,"json",r,{returnIdsOnly:!0})}function m(e,t,r){return null!=t.timeExtent&&t.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):_(e,t,"json",r,{returnIdsOnly:!0,returnCountOnly:!0})}async function g(e,t,r){if(null!=t.timeExtent&&t.timeExtent.isEmpty)return{data:{count:0,extent:null}};const i=await _(e,t,"json",r,{returnExtentOnly:!0,returnCountOnly:!0}),n=i.data;if(n.hasOwnProperty("extent"))return i;if(n.features)throw new Error(l);if(n.hasOwnProperty("count"))throw new Error(l);return i}async function _(e,t,r,s={},o={}){const l="string"==typeof e?(0,i.I)(e):e,c=t.geometry?[t.geometry]:[],h=await(0,n.R)(c,null,{signal:s.signal}),d=h?.[0];null!=d&&((t=t.clone()).geometry=d);const f=a({...l.query,f:r,...o,...u(t,o)});return(0,i.U)((0,i.Z)(l.path,y(t,o)?"query3d":"query"),{...s,responseType:"pbf"===r?"array-buffer":"json",query:{...f,...s.query}})}function y(e,t){return null!=e.formatOf3DObjects&&!(t.returnCountOnly||t.returnExtentOnly||t.returnIdsOnly)}},6488:function(e,t,r){r.d(t,{t:function(){return n}});var i=r(49555);function n(e,t,r){if(!r?.features||!r.hasZ)return;const n=(0,i.o)(r.geometryType,t,e.outSpatialReference);if(null!=n)for(const i of r.features)n(i.geometry)}},80152:function(e,t,r){function i(){return new Float32Array(3)}function n(e){const t=new Float32Array(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function s(e,t,r){const i=new Float32Array(3);return i[0]=e,i[1]=t,i[2]=r,i}function o(e,t){return new Float32Array(e,t,3)}function a(){return i()}function l(){return s(1,1,1)}function c(){return s(1,0,0)}function u(){return s(0,1,0)}function h(){return s(0,0,1)}r.d(t,{n:function(){return i},r:function(){return s},t:function(){return n}});const d=a(),f=l(),p=c(),m=u(),g=h();Object.freeze(Object.defineProperty({__proto__:null,ONES:f,UNIT_X:p,UNIT_Y:m,UNIT_Z:g,ZEROS:d,clone:n,create:i,createView:o,fromValues:s,ones:l,unitX:c,unitY:u,unitZ:h,zeros:a},Symbol.toStringTag,{value:"Module"}))}}]);
//# sourceMappingURL=5850.da554fbd.js.map