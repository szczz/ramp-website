"use strict";(self["webpackChunkramp_website"]=self["webpackChunkramp_website"]||[]).push([[7848],{87848:function(e,t,i){i.r(t),i.d(t,{default:function(){return p}});var n=i(98503),a=i(20455);const r=30,o=20,s=16,l=12,m=8,h=32,c=32,f=350,u=20,g="Montserrat, BlinkMacSystemFont, Segoe UI, Helvetica, Arial, sans-serif";class p extends n.F{get config(){return this.$iApi.fixture.get("export").config?.legend}async make(e){const t=this.$iApi.geo.layer.allLayersOnMap().filter((e=>!e.isCosmetic));if(0===t.length)return new a.a.fabric.Group([],{originX:"left"});const i=Math.min(t.length,Math.floor(e.width/(f+u))||1),n=(e.width-(i-1)*u)/i;let h=0;const c=(await Promise.all(this._makeSegments(t,n))).map((({title:e,items:t},i)=>{i>0&&(h+=r),e.top=h,h+=e.height+o;const n=t.map((({title:i,items:n},a)=>{const r=[];return i&&!(1===t.length&&i.text===e.text)&&(a>0&&(h+=s),i.top=h,h+=i.height+l,r.push(i)),n.forEach((e=>{e.top=h,h+=e.height+m})),[...r,...n].filter((e=>e))}));return new a.a.fabric.Group([e,...n.flat()])})).flat(),g=this._makeColumns(c,n,i);return Promise.resolve(g)}_makeColumns(e,t,i){let n=0,r=0,o=0;const s=e[e.length-1].aCoords.bl.y/i;return e.forEach(((a,l)=>{const m=l!==e.length-1?e[l+1].top-a.top:a.height,h=o>s*(n+1),c=0!==r&&m>s,f=i-n>e.length-l;(h||c||f)&&n<i&&(++n,r=0),a.left=n*(t+u),a.top=r,r+=m,o+=m})),new a.a.fabric.Group(e,{originX:"left"})}_makeSegments(e,t){return e.map((async e=>{const i=new a.a.fabric.Textbox(e.name,{fontSize:24,fontFamily:g,width:t}),n=this._getLayerTreeIds(e);let r=[];return r=e.supportsSublayers?await Promise.all(this._makeSegmentChunks(n,e,t)):await Promise.all(this._makeSegmentChunks([-1],e,t)),{title:i,items:r}}))}_makeSegmentChunks(e,t,i){const n=t;return e.map((async e=>{const t=-1===e?n:n.getSublayer(e);if(!t)return{title:new a.a.fabric.Textbox("ERROR",{fontSize:20,fontFamily:g,width:i}),items:[]};await Promise.all(t.legend.map((e=>e.drawPromise)));const r=t.legend,o=new a.a.fabric.Textbox(t.name,{fontSize:20,fontFamily:g,width:i}),s=await Promise.all(this._makeChunkItems(r,i));return{title:o,items:s}}))}_makeChunkItems(e,t){return e.map((async e=>{const i=(await b(a.a.fabric.loadSVGFromString)(e.svgcode))[0];if(e.esriStandard){i.originY="center",i.top=h/2;const n=new a.a.fabric.Textbox(e.label,{fontSize:12,fontFamily:g,originY:"center",left:c+20,top:h/2,width:t-c-20});return new a.a.fabric.Group([i,n],{height:h})}{const n=new a.a.fabric.Textbox(e.label,{fontSize:12,fontFamily:g,originY:"center",left:0,top:h/2,width:t}),r=Number(e.imgWidth),o=Number(e.imgHeight),s=Math.min(1,t/r);return i&&(i.originY="center",i.top=o*s/2+h,i.scaleToHeight(o*s),i.scaleToWidth(r*s)),new a.a.fabric.Group([n,i].filter(Boolean),{height:o*s+h})}}))}_getLayerTreeIds(e){const t=[],i=[...e.sublayers];for(;i.length>0;){const e=i.shift();e&&(e.visibility&&t.push(e.layerIdx),i.push(...e.sublayers))}return t}}const b=e=>t=>new Promise((i=>{e(t,(e=>{i(e)}))}))}}]);
//# sourceMappingURL=7848.9b187497.js.map