"use strict";(self["webpackChunkramp_website"]=self["webpackChunkramp_website"]||[]).push([[5054],{65054:function(e,l,t){t.r(l),t.d(l,{default:function(){return d}});var r=t(98503);class n extends r.F{_parseConfig(e){const l=e?.headerControls?.slice()??["wizard","layerReorder","groupToggle","visibilityToggle"];if((0,r.fL)(this.$vApp.$pinia).headerControls=l,!e||!e.root.children)return;(0,r.fL)(this.$vApp.$pinia).multilineItems=e.multilineItems?.enabled??!0;const t=[1,2,3,4,5,6];e.multilineItems?.maxLines&&t.includes(e.multilineItems?.maxLines)?(0,r.fL)(this.$vApp.$pinia).maxLines=e.multilineItems.maxLines:(0,r.fL)(this.$vApp.$pinia).maxLines=3,this.handlePanelWidths(["legend"]),this.handlePanelTeleports(["legend"]);const n=this.getLayerFixtureConfigs();e.root.children.forEach((e=>{e.layerLegendConfigs=n,this.addItem(e)})),this.$iApi.geo.layer.allLayers().forEach((e=>{this.updateLegend(e)}))}createItem(e,l){let t;void 0===e.layerId?t=new r.g6(this.$iApi,e,l):(void 0!==e.sublayerIndex&&(e.layerId=`${e.layerId}-${e.sublayerIndex}`),t=new r.g7(this.$iApi,e,l));const n=e.children;return n&&n.forEach((l=>{void 0!==e.layerLegendConfigs&&(l.layerLegendConfigs=e.layerLegendConfigs),t.children.push(this.createItem(l,t))})),t}addItem(e,l){const t=e instanceof r.g8?e:this.createItem(e,l);return this._insertItem(t,l),t}async addLayerItem(e,l){const t=new r.g7(this.$iApi,{layerId:e.id,sublayerIndex:e.isSublayer?e.layerIdx:void 0,name:e.name},l);return this._insertItem(t,l),this.updateLegend(e),t}get config(){return super.config}getLegend(){return(0,r.fL)(this.$vApp.$pinia).children||[]}getLegendConfig(){return{root:{children:this.getLegend().map((e=>e.getConfig()))}}}getItem(e){const l=this.getLegend();let t;return l.some((l=>(t=this.searchTreeFirst(l,(l=>l.uid===e)),void 0!==t))),t}getLayerItem(e){let l,t,n;return"string"==typeof e?(t=e,l=e):(t=e.id,l=e.uid),this.getLegend().some((e=>(n=this.searchTreeFirst(e,(e=>e instanceof r.g7&&(e.layerId===t||e.uid===l))),void 0!==n))),n}getAllExpanded(e){const l=e??!0;return this.searchLegend((e=>e.children.length>0&&e.expanded===l))}getAllVisible(e){const l=e??!0;return this.searchLegend((e=>e.visibility===l))}getLayerBoundItems(e){let l="";const t=e instanceof r.g9?e:this.$iApi.geo.layer.getLayer(e);return t?(l=t.isSublayer?t.parentLayer?.id||"":t.id,this.searchLegend((e=>e instanceof r.g7&&(e.layerId===l||e.parentLayerId===l)))):[]}updateLegend(e){const l=(e,l)=>{const t=this.getLayerItem(e);l?(t&&e instanceof r.g9&&(t.layer=e),t?.error()):t?.load(e instanceof r.g9?e:void 0)};e.loadPromise().then((()=>{let t=this.getLayerItem(e);if(e.layerType===r.ga.MAPIMAGE){const r=n=>{if(n.isLayerRoot&&!n.isLogicalLayer)t=this.getLayerItem(e),l(e,!1),t&&!t.treeGrown&&(n.children.map((l=>this._treeWalker(e,l))).map((e=>this.addItem(e,t))),t.treeGrown=!0),n.children.forEach((e=>r(e)));else if(n.isLayerRoot||n.isLogicalLayer)n.isLogicalLayer&&l(this._treeWalker(e,n).layer,!1);else{if(t=this.getLayerItem(`${e.id}-${n.layerIdx}`),t){const l=t.getConfig();delete l.layerId,delete l.sublayerIndex,delete l.children,l.name||delete l.name;const r={...this._treeWalker(e,n),...l},i=this.createItem(r);this._replaceItem(t,i)}n.children.forEach((e=>r(e)))}};r(e.getLayerTree())}else l(e,!1)})).catch((()=>{l(e,!0),e.supportsSublayers&&e.config.sublayers.forEach((t=>{l(`${e.id}-${t.index}`,!0)}))}))}expandItems(e,l){const t=this.getLegend(),r=void 0===l?t:l.children;void 0!==l&&this._toggleState(l,{expanded:e}),r.forEach((l=>{this._toggleState(l,{expanded:e})}))}showItems(e,l){const t=this.getLegend(),r=void 0===l?t:l.children;void 0!==l&&this._toggleState(l,{visibility:e}),r.forEach((l=>{this._toggleState(l,{visibility:e})}))}reloadLayerItem(e){const l=this.getLayerBoundItems(e);return l.forEach((e=>e.reload())),l.length>0}removeItem(e){const l="string"==typeof e?this.getItem(e):e;return void 0!==l&&this._deleteItem(l)}removeLayerItem(e){const l=this.getLayerItem(e);return void 0!==l&&this._deleteItem(l)}searchTreeFirst(e,l){if(l(e))return e;{let t;return e.children.some((e=>(t=this.searchTreeFirst(e,l),void 0!==t))),t}}searchTreeAll(e,l){const t=[],r=[e];for(;r.length>0;){const e=r.shift();e&&l(e)&&t.push(e),e&&r.push(...e.children)}return t}searchLegend(e){return this.getLegend().map((l=>this.searchTreeAll(l,e))).flat()}_toggleState(e,l){const t=l.visibility,r=l.expanded;void 0!==t&&e.toggleVisibility(t),void 0!==r&&e.children.length>0&&e.toggleExpanded(r),e.children&&e.children.length>0&&e.children.forEach((e=>{this._toggleState(e,l)}))}_insertItem(e,l){(0,r.fL)(this.$vApp.$pinia).addItem({item:e,parent:l})}_deleteItem(e){const l=(0,r.fL)(this.$vApp.$pinia),t=e=>{e.children.length>0&&e.children.forEach((e=>{t(e)})),e instanceof r.g7&&e.handlers.forEach((e=>this.$iApi.event.off(e))),l.removeItem(e)};return t(e),!0}_replaceItem(e,l){(0,r.fL)(this.$vApp.$pinia).replaceItem({oldItem:e,newItem:l})}_treeWalker(e,l,t){const r=(l=>{const t=[e];for(;t.length>0;){const e=t.shift();if(e&&e.uid===l)return e;e&&t.push(...e.sublayers)}})(l.uid),n={};return l.isLayerRoot&&!l.isLogicalLayer?(n.layer=r,n.name=r.name,n.children=l.children.map((l=>this._treeWalker(e,l,t)))):l.isLayerRoot||l.isLogicalLayer?l.isLogicalLayer&&(n.layer=r,n.name=r.name,n.layerId=r.id,n.sublayerIndex=e.isSublayer?e.layerIdx:void 0):(n.name=l.name,n.children=l.children.map((l=>this._treeWalker(e,l,t)))),{...n,...t}}}const i=(0,r.dM)({__name:"nav-button",setup(e){const{t:l}=(0,r.dN)(),t=(0,r.e2)("iApi"),n=()=>{t.panel.toggle("legend")};return(e,t)=>{const i=(0,r.dR)("mapnav-button");return(0,r.dU)(),(0,r.dV)(i,{onClickFunction:n,tooltip:(0,r.e0)(l)("legend.title")},{default:(0,r.dW)((()=>t[0]||(t[0]=[(0,r.dX)("svg",{class:"fill-current w-32 h-20",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},[(0,r.dX)("path",{d:"M0 0h24v24H0z",fill:"none"}),(0,r.dX)("path",{d:"M11.99 18.54l-7.37-5.73L3 14.07l9 7 9-7-1.63-1.27-7.38 5.74zM12 16l7.36-5.73L21 9l-9-7-9 7 1.63 1.27L12 16z"})],-1)]))),_:1},8,["tooltip"])}}}),a={en:{"legend.title":"Legend","legend.header.addlayer":"Add Layer","legend.header.reorderlayers":"Reorder Layers","legend.header.groups":"Toggle Groups","legend.header.groups.expand":"Expand All","legend.header.groups.collapse":"Collapse All","legend.header.visible":"Toggle Visibility","legend.header.visible.show":"Show All","legend.header.visible.hide":"Hide All","legend.group.expand":"Expand Group","legend.group.collapse":"Collapse Group","legend.visibility.showLayer":"Show layer","legend.visibility.hideLayer":"Hide layer","legend.visibility.showSymbol":"Show symbol","legend.visibility.hideSymbol":"Hide symbol","legend.visibility.showGroup":"Show group","legend.visibility.hideGroup":"Hide group","legend.symbology.expand":"Expand legend","legend.symbology.hide":"Hide legend","legend.symbology.loading":"Loading...","legend.layer.data":"Show more data","legend.layer.data.only":"Layer not on map","legend.layer.offscale":"Layer out of scale","legend.layer.zoomToVisible":"Zoom to visible scale","legend.layer.options":"More options","legend.layer.controls.metadata":"Metadata","legend.layer.controls.settings":"Settings","legend.layer.controls.datatable":"Datatable","legend.layer.controls.symbology":"Legend","legend.layer.controls.boundaryzoom":"Zoom to Layer Boundary","legend.layer.controls.cancel":"Cancel","legend.layer.controls.remove":"Remove","legend.layer.controls.reload":"Reload","legend.layer.controls.reloadDisabled":"Layer cannot be reloaded","legend.alert.symbologyExpanded":"Layer legend expanded","legend.alert.symbologyCollapsed":"Layer legend collapsed","legend.alert.groupExpanded":"Legend group expanded","legend.alert.groupCollapsed":"Legend group collapsed","legend.alert.layerAdded":"{name} layer added to legend","legend.alert.layerRemoved":"{name} layer removed from legend"},fr:{"legend.title":"Légende","legend.header.addlayer":"Ajouter une couche","legend.header.reorderlayers":"Réorganiser les couches","legend.header.groups":"Basculer les Groupes","legend.header.groups.expand":"Élargir les groupes","legend.header.groups.collapse":"Réduire les groupes","legend.header.visible":"Basculer la Visibilité","legend.header.visible.show":"Montrer tout","legend.header.visible.hide":"Cacher tout","legend.group.expand":"Développer un groupe","legend.group.collapse":"Réduire un groupe","legend.visibility.showLayer":"Afficher la couche","legend.visibility.hideLayer":"Masquer la couche","legend.visibility.showSymbol":"Afficher le symbole","legend.visibility.hideSymbol":"Masquer le symbole","legend.visibility.showGroup":"Afficher le groupe","legend.visibility.hideGroup":"Masquer le groupe","legend.symbology.expand":"Développer la légende","legend.symbology.hide":"Masquer la légende","legend.symbology.loading":"Chargement en cours...","legend.layer.data":"Afficher plus de données","legend.layer.data.only":"Couche non visualisable","legend.layer.offscale":"Couche hors de portée","legend.layer.zoomToVisible":"Zoom sur l'échelle visible","legend.layer.options":"Plus d'options","legend.layer.controls.metadata":"Métadonnées","legend.layer.controls.settings":"Paramètres","legend.layer.controls.datatable":"Tableau de données","legend.layer.controls.symbology":"Légende","legend.layer.controls.boundaryzoom":"Zoomer à la limite","legend.layer.controls.cancel":"Annuler","legend.layer.controls.remove":"Retirer","legend.layer.controls.reload":"Recharger","legend.layer.controls.reloadDisabled":"Le calque ne peut pas être rechargé","legend.alert.symbologyExpanded":"Légende de la couche développée","legend.alert.symbologyCollapsed":"Légende de la couche réduite","legend.alert.groupExpanded":"Groupe de légende développé","legend.alert.groupCollapsed":"Groupe de légende réduit","legend.alert.layerAdded":"{name} couche ajoutée à la légende","legend.alert.layerRemoved":"Couche {name} retiré de la légende"}};class d extends n{added(){this.$iApi.component("legend-nav-button",i),this.$iApi.panel.register({legend:{screens:{"legend-screen":()=>(0,r.f6)(t.e(6622).then(t.bind(t,26622)))},style:{width:"350px"},alertName:"legend.title",button:{tooltip:"legend.title",icon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none" /><path d="M11.99 18.54l-7.37-5.73L3 14.07l9 7 9-7-1.63-1.27-7.38 5.74zM12 16l7.36-5.73L21 9l-9-7-9 7 1.63 1.27L12 16z" /></svg>'}}},{i18n:{messages:a}}),this._parseConfig(void 0!==this.config?JSON.parse(JSON.stringify(this.config)):void 0);const e=this.$vApp.$watch((()=>this.config),(e=>this._parseConfig(void 0!==e?JSON.parse(JSON.stringify(e)):void 0)));this.removed=()=>{e(),this.$iApi.fixture.exists("appbar")&&(0,r.f7)(this.$vApp.$pinia).removeButton("legend"),this.$iApi.fixture.exists("mapnav")&&(0,r.f8)(this.$vApp.$pinia).removeItem("legend"),(0,r.fL)().$reset(),this.$iApi.panel.remove("legend")}}}}}]);
//# sourceMappingURL=5054.a49305e1.js.map