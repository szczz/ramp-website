"use strict";(self["webpackChunkramp_website"]=self["webpackChunkramp_website"]||[]).push([[1303,3297,3567,5948,8241],{18696:function(e,t,r){r.d(t,{i:function(){return s}});var n=r(98503);function i(e){return"portalItem"in e}const s=e=>{let t=class extends e{get apiKey(){return this._isOverridden("apiKey")?this._get("apiKey"):i(this)?this.portalItem?.apiKey:null}set apiKey(e){null!=e?this._override("apiKey",e):(this._clearOverride("apiKey"),this.clear("apiKey","user"))}};return(0,n.k)([(0,n.o)({type:String})],t.prototype,"apiKey",null),t=(0,n.k)([(0,n.A)("esri.layers.mixins.APIKeyMixin")],t),t}},36313:function(e,t,r){r.d(t,{l:function(){return s}});var n=r(98503),i=r(5948);const s=e=>{let t=class extends e{get title(){if(this._get("title")&&"defaults"!==this.originOf("title"))return this._get("title");if(this.url){const e=(0,i.d)(this.url);if(null!=e&&e.title)return e.title}return this._get("title")||""}set title(e){this._set("title",e)}set url(e){this._set("url",(0,i.y)(e,n.n.getLogger(this)))}};return(0,n.k)([(0,n.o)()],t.prototype,"title",null),(0,n.k)([(0,n.o)({type:String})],t.prototype,"url",null),t=(0,n.k)([(0,n.A)("esri.layers.mixins.ArcGISService")],t),t}},99907:function(e,t,r){r.d(t,{e:function(){return i}});var n=r(98503);const i=e=>{let t=class extends e{constructor(){super(...arguments),this.customParameters=null}};return(0,n.k)([(0,n.o)({type:Object,json:{write:{overridePolicy:e=>({enabled:!!(e&&Object.keys(e).length>0)})}}})],t.prototype,"customParameters",void 0),t=(0,n.k)([(0,n.A)("esri.layers.mixins.CustomParametersMixin")],t),t}},904:function(e,t,r){r.d(t,{d:function(){return o}});var n,i=r(98503),s=r(98089);const a=new i.ax({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh","":null});let l=n=class extends i.v{constructor(e){super(e),this.displayFieldName=null,this.exceededTransferLimit=!1,this.features=[],this.fields=null,this.geometryType=null,this.hasM=!1,this.hasZ=!1,this.queryGeometry=null,this.spatialReference=null}readFeatures(e,t){const r=i.B.fromJSON(t.spatialReference),n=[];for(let s=0;s<e.length;s++){const t=e[s],a=i.b1.fromJSON(t),l=t.geometry?.spatialReference;null==a.geometry||l||(a.geometry.spatialReference=r);const o=t.aggregateGeometries,u=a.aggregateGeometries;if(o&&null!=u)for(const e in u){const t=u[e],n=o[e],i=n?.spatialReference;null==t||i||(t.spatialReference=r)}n.push(a)}return n}writeGeometryType(e,t,r,n){if(e)return void a.write(e,t,r,n);const{features:i}=this;if(i)for(const s of i)if(null!=s?.geometry)return void a.write(s.geometry.type,t,r,n)}readQueryGeometry(e,t){if(!e)return null;const r=!!e.spatialReference,n=(0,i.b3)(e);return n&&!r&&t.spatialReference&&(n.spatialReference=i.B.fromJSON(t.spatialReference)),n}writeSpatialReference(e,t){if(e)return void(t.spatialReference=e.toJSON());const{features:r}=this;if(r)for(const n of r)if(n&&null!=n.geometry&&n.geometry.spatialReference)return void(t.spatialReference=n.geometry.spatialReference.toJSON())}clone(){return new n(this.cloneProperties())}cloneProperties(){return(0,i.f)({displayFieldName:this.displayFieldName,exceededTransferLimit:this.exceededTransferLimit,features:this.features,fields:this.fields,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,queryGeometry:this.queryGeometry,spatialReference:this.spatialReference,transform:this.transform})}toJSON(e){const t=this.write();if(t.features&&Array.isArray(e)&&e.length>0)for(let r=0;r<t.features.length;r++){const n=t.features[r];if(n.geometry){const t=e?.[r];n.geometry=t?.toJSON()||n.geometry}}return t}quantize(e){const{scale:[t,r],translate:[n,i]}=e,s=e=>Math.round((e-n)/t),a=e=>Math.round((i-e)/r),l=this.features,o=this._getQuantizationFunction(this.geometryType,s,a);for(let u=0,c=l.length;u<c;u++)o?.(l[u].geometry)||(l.splice(u,1),u--,c--);return this.transform=e,this}unquantize(){const{geometryType:e,features:t,transform:r}=this;if(!r)return this;const{translate:[n,i],scale:[s,a]}=r,l=e=>e*s+n,o=e=>i-e*a;let u=null,c=null;if(this.hasZ&&null!=r?.scale?.[2]){const{translate:[,,e],scale:[,,t]}=r;u=r=>r*t+e}if(this.hasM&&null!=r?.scale?.[3]){const{translate:[,,,e],scale:[,,,t]}=r;c=r=>null==r?r:r*t+e}const d=this._getHydrationFunction(e,l,o,u,c);for(const{geometry:h}of t)null!=h&&d&&d(h);return this.transform=null,this}_quantizePoints(e,t,r){let n,i;const s=[];for(let a=0,l=e.length;a<l;a++){const l=e[a];if(a>0){const e=t(l[0]),a=r(l[1]);e===n&&a===i||(s.push([e-n,a-i]),n=e,i=a)}else n=t(l[0]),i=r(l[1]),s.push([n,i])}return s.length>0?s:null}_getQuantizationFunction(e,t,r){return"point"===e?e=>(e.x=t(e.x),e.y=r(e.y),e):"polyline"===e||"polygon"===e?e=>{const n=(0,i.a9)(e)?e.rings:e.paths,s=[];for(let i=0,a=n.length;i<a;i++){const e=n[i],a=this._quantizePoints(e,t,r);a&&s.push(a)}return s.length>0?((0,i.a9)(e)?e.rings=s:e.paths=s,e):null}:"multipoint"===e?e=>{const n=this._quantizePoints(e.points,t,r);return n&&n.length>0?(e.points=n,e):null}:"extent"===e?e=>e:null}_getHydrationFunction(e,t,r,n,s){return"point"===e?e=>{e.x=t(e.x),e.y=r(e.y),n&&(e.z=n(e.z))}:"polyline"===e||"polygon"===e?e=>{const a=(0,i.a9)(e)?e.rings:e.paths;let l,o;for(let n=0,i=a.length;n<i;n++){const e=a[n];for(let n=0,i=e.length;n<i;n++){const i=e[n];n>0?(l+=i[0],o+=i[1]):(l=i[0],o=i[1]),i[0]=t(l),i[1]=r(o)}}if(n&&s)for(let t=0,r=a.length;t<r;t++){const e=a[t];for(let t=0,r=e.length;t<r;t++){const r=e[t];r[2]=n(r[2]),r[3]=s(r[3])}}else if(n)for(let t=0,r=a.length;t<r;t++){const e=a[t];for(let t=0,r=e.length;t<r;t++){const r=e[t];r[2]=n(r[2])}}else if(s)for(let t=0,r=a.length;t<r;t++){const e=a[t];for(let t=0,r=e.length;t<r;t++){const r=e[t];r[2]=s(r[2])}}}:"extent"===e?e=>{e.xmin=t(e.xmin),e.ymin=r(e.ymin),e.xmax=t(e.xmax),e.ymax=r(e.ymax),n&&null!=e.zmax&&null!=e.zmin&&(e.zmax=n(e.zmax),e.zmin=n(e.zmin)),s&&null!=e.mmax&&null!=e.mmin&&(e.mmax=s(e.mmax),e.mmin=s(e.mmin))}:"multipoint"===e?e=>{const i=e.points;let a,l;for(let n=0,s=i.length;n<s;n++){const e=i[n];n>0?(a+=e[0],l+=e[1]):(a=e[0],l=e[1]),e[0]=t(a),e[1]=r(l)}if(n&&s)for(let t=0,r=i.length;t<r;t++){const e=i[t];e[2]=n(e[2]),e[3]=s(e[3])}else if(n)for(let t=0,r=i.length;t<r;t++){const e=i[t];e[2]=n(e[2])}else if(s)for(let t=0,r=i.length;t<r;t++){const e=i[t];e[2]=s(e[2])}}:null}};(0,i.k)([(0,i.o)({type:String,json:{write:!0}})],l.prototype,"displayFieldName",void 0),(0,i.k)([(0,i.o)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],l.prototype,"exceededTransferLimit",void 0),(0,i.k)([(0,i.o)({type:[i.b1],json:{write:!0}})],l.prototype,"features",void 0),(0,i.k)([(0,i.u)("features")],l.prototype,"readFeatures",null),(0,i.k)([(0,i.o)({type:[s.y],json:{write:!0}})],l.prototype,"fields",void 0),(0,i.k)([(0,i.o)({type:["point","multipoint","polyline","polygon","extent","mesh"],json:{read:{reader:a.read}}})],l.prototype,"geometryType",void 0),(0,i.k)([(0,i.q)("geometryType")],l.prototype,"writeGeometryType",null),(0,i.k)([(0,i.o)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],l.prototype,"hasM",void 0),(0,i.k)([(0,i.o)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],l.prototype,"hasZ",void 0),(0,i.k)([(0,i.o)({types:i.b2,json:{write:!0}})],l.prototype,"queryGeometry",void 0),(0,i.k)([(0,i.u)("queryGeometry")],l.prototype,"readQueryGeometry",null),(0,i.k)([(0,i.o)({type:i.B,json:{write:!0}})],l.prototype,"spatialReference",void 0),(0,i.k)([(0,i.q)("spatialReference")],l.prototype,"writeSpatialReference",null),(0,i.k)([(0,i.o)({json:{write:!0}})],l.prototype,"transform",void 0),l=n=(0,i.k)([(0,i.A)("esri.rest.support.FeatureSet")],l),l.prototype.toJSON.isDefaultToJSON=!0;const o=l},69949:function(e,t,r){r.d(t,{p:function(){return a}});var n=r(98503);const i=new n.ax({esriFeatureEditToolAutoCompletePolygon:"auto-complete-polygon",esriFeatureEditToolCircle:"circle",esriFeatureEditToolEllipse:"ellipse",esriFeatureEditToolFreehand:"freehand",esriFeatureEditToolLine:"line",esriFeatureEditToolNone:"none",esriFeatureEditToolPoint:"point",esriFeatureEditToolPolygon:"polygon",esriFeatureEditToolRectangle:"rectangle",esriFeatureEditToolArrow:"arrow",esriFeatureEditToolTriangle:"triangle",esriFeatureEditToolLeftArrow:"left-arrow",esriFeatureEditToolRightArrow:"right-arrow",esriFeatureEditToolUpArrow:"up-arrow",esriFeatureEditToolDownArrow:"down-arrow"});let s=class extends((0,n.a_)(n.v)){constructor(e){super(e),this.name=null,this.description=null,this.drawingTool=null,this.prototype=null,this.thumbnail=null}};(0,n.k)([(0,n.o)({json:{write:!0}})],s.prototype,"name",void 0),(0,n.k)([(0,n.o)({json:{write:!0}})],s.prototype,"description",void 0),(0,n.k)([(0,n.o)({json:{read:i.read,write:i.write}})],s.prototype,"drawingTool",void 0),(0,n.k)([(0,n.o)({json:{write:!0}})],s.prototype,"prototype",void 0),(0,n.k)([(0,n.o)({json:{write:!0}})],s.prototype,"thumbnail",void 0),s=(0,n.k)([(0,n.A)("esri.layers.support.FeatureTemplate")],s);const a=s},29344:function(e,t,r){r.d(t,{n:function(){return l}});var n=r(98503),i=r(98089),s=r(69949);let a=class extends((0,n.a_)(n.v)){constructor(e){super(e),this.id=null,this.name=null,this.domains=null,this.templates=null}readDomains(e){const t={};for(const r of Object.keys(e))t[r]=(0,i.i)(e[r]);return t}writeDomains(e,t){const r={};for(const n of Object.keys(e))e[n]&&(r[n]=e[n]?.toJSON());t.domains=r}};(0,n.k)([(0,n.o)({json:{write:!0}})],a.prototype,"id",void 0),(0,n.k)([(0,n.o)({json:{write:!0}})],a.prototype,"name",void 0),(0,n.k)([(0,n.o)({json:{write:!0}})],a.prototype,"domains",void 0),(0,n.k)([(0,n.u)("domains")],a.prototype,"readDomains",null),(0,n.k)([(0,n.q)("domains")],a.prototype,"writeDomains",null),(0,n.k)([(0,n.o)({type:[s.p],json:{write:!0}})],a.prototype,"templates",void 0),a=(0,n.k)([(0,n.A)("esri.layers.support.FeatureType")],a);const l=a},21303:function(e,t,r){r.d(t,{v:function(){return d}});var n,i=r(98503);const s=(0,i.g)()({orthometric:"gravity-related-height",gravity_related_height:"gravity-related-height",ellipsoidal:"ellipsoidal"}),a=s.jsonValues.slice();(0,i.h)(a,"orthometric");const l=(0,i.g)()({meter:"meters",foot:"feet","us-foot":"us-feet","clarke-foot":"clarke-feet","clarke-yard":"clarke-yards","clarke-link":"clarke-links","sears-yard":"sears-yards","sears-foot":"sears-feet","sears-chain":"sears-chains","benoit-1895-b-chain":"benoit-1895-b-chains","indian-yard":"indian-yards","indian-1937-yard":"indian-1937-yards","gold-coast-foot":"gold-coast-feet","sears-1922-truncated-chain":"sears-1922-truncated-chains","50-kilometers":"50-kilometers","150-kilometers":"150-kilometers"});let o=n=class extends i.v{constructor(e){super(e),this.heightModel="gravity-related-height",this.heightUnit="meters",this.vertCRS=null}writeHeightModel(e,t,r){return s.write(e,t,r)}readHeightModel(e,t,r){return s.read(e)||(r?.messages&&r.messages.push(c(e,{context:r})),null)}readHeightUnit(e,t,r){return l.read(e)||(r?.messages&&r.messages.push(u(e,{context:r})),null)}readHeightUnitService(e,t,r){return(0,i.Y)(e)||l.read(e)||(r?.messages&&r.messages.push(u(e,{context:r})),null)}readVertCRS(e,t){return t.vertCRS||t.ellipsoid||t.geoid}clone(){return new n({heightModel:this.heightModel,heightUnit:this.heightUnit,vertCRS:this.vertCRS})}equals(e){return!!e&&(this===e||this.heightModel===e.heightModel&&this.heightUnit===e.heightUnit&&this.vertCRS===e.vertCRS)}static deriveUnitFromSR(e,t){const r=(0,i.$)(t);return new n({heightModel:e.heightModel,heightUnit:r??void 0,vertCRS:e.vertCRS})}write(e,t){return t={origin:"web-scene",...t},super.write(e,t)}static fromJSON(e){if(!e)return null;const t=new n;return t.read(e,{origin:"web-scene"}),t}};function u(e,t){return new i.z("height-unit:unsupported",`Height unit of value '${e}' is not supported`,t)}function c(e,t){return new i.z("height-model:unsupported",`Height model of value '${e}' is not supported`,t)}(0,i.k)([(0,i.o)({type:s.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:a,default:"ellipsoidal"}}}})],o.prototype,"heightModel",void 0),(0,i.k)([(0,i.q)("web-scene","heightModel")],o.prototype,"writeHeightModel",null),(0,i.k)([(0,i.u)(["web-scene","service"],"heightModel")],o.prototype,"readHeightModel",null),(0,i.k)([(0,i.o)({type:l.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:l.jsonValues,write:l.write}}}})],o.prototype,"heightUnit",void 0),(0,i.k)([(0,i.u)("web-scene","heightUnit")],o.prototype,"readHeightUnit",null),(0,i.k)([(0,i.u)("service","heightUnit")],o.prototype,"readHeightUnitService",null),(0,i.k)([(0,i.o)({type:String,constructOnly:!0,json:{origins:{"web-scene":{write:!0}}}})],o.prototype,"vertCRS",void 0),(0,i.k)([(0,i.u)("service","vertCRS",["vertCRS","ellipsoid","geoid"])],o.prototype,"readVertCRS",null),o=n=(0,i.k)([(0,i.A)("esri.geometry.HeightModelInfo")],o);const d=o},81519:function(e,t,r){r.d(t,{e:function(){return u}});var n=r(98503);const i=-3,s=i-1;var a;(function(e){e[e.ALL=0]="ALL",e[e.SOME=1]="SOME"})(a||(a={}));class l{get size(){return this._size}constructor(e=10485760){this._maxSize=e,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new n.bX,this._users=new n.bX}destroy(){this.clearAll(),this._removeFuncs.clear(),this._users.clear(),this._db=null}register(e){this._users.push(e)}deregister(e){this._users.removeUnordered(e)}registerRemoveFunc(e,t){this._removeFuncs.push([e,t])}deregisterRemoveFunc(e){this._removeFuncs.filterInPlace((t=>t[0]!==e))}get maxSize(){return this._maxSize}set maxSize(e){this._maxSize=Math.max(e,-1),this._checkSize()}getSize(e,t){return this._db.get(e.id+t)?.size??0}put(e,t,r,n,l){t=e.id+t;const u=this._db.get(t);if(u&&(this._size-=u.size,e.size-=u.size,this._db.delete(t),u.entry!==r&&this._notifyRemove(t,u.entry,u.size,a.ALL)),n>this._maxSize)return void this._notifyRemove(t,r,n,a.ALL);if(void 0===r)return void console.warn("Refusing to cache undefined entry ");if(!n||n<0)return console.warn(`Refusing to cache entry with size ${n} for key ${t}`),void this._notifyRemove(t,r,0,a.ALL);const c=1+Math.max(l,s)-i;this._db.set(t,new o(r,n,c)),this._size+=n,e.size+=n,this._checkSize()}updateSize(e,t,r,n){t=e.id+t;const i=this._db.get(t);if(i&&i.entry===r){for(this._size-=i.size,e.size-=i.size;n>this._maxSize;){const e=this._notifyRemove(t,r,n,a.SOME);if(!(null!=e&&e>0))return void this._db.delete(t);n=e}i.size=n,this._size+=n,e.size+=n,this._checkSize()}}pop(e,t){t=e.id+t;const r=this._db.get(t);if(r)return this._size-=r.size,e.size-=r.size,this._db.delete(t),++this._hit,r.entry;++this._miss}get(e,t){t=e.id+t;const r=this._db.get(t);if(void 0!==r)return this._db.delete(t),r.lives=r.lifetime,this._db.set(t,r),++this._hit,r.entry;++this._miss}peek(e,t){const r=this._db.get(e.id+t);return r?++this._hit:++this._miss,r?.entry}get performanceInfo(){const e={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},t={},r=new Array;this._db.forEach(((e,n)=>{const i=e.lifetime;r[i]=(r[i]||0)+e.size,this._users.forAll((r=>{const{id:i,name:s}=r;if(n.startsWith(i)){const r=t[s]||0;t[s]=r+e.size}}))}));const n={};this._users.forAll((e=>{const r=e.name;if("hitRate"in e&&"number"==typeof e.hitRate&&!isNaN(e.hitRate)&&e.hitRate>0){const i=t[r]||0;t[r]=i,n[r]=Math.round(100*e.hitRate)+"%"}else n[r]="0%"}));const s=Object.keys(t);s.sort(((e,r)=>t[r]-t[e])),s.forEach((r=>e[r]=Math.round(t[r]/2**20)+"MB / "+n[r]));for(let a=r.length-1;a>=0;--a){const t=r[a];t&&(e["Priority "+(a+i-1)]=Math.round(t/this._size*100)+"%")}return e}resetStats(){this._hit=this._miss=0,this._users.forAll((e=>e.resetHitRate()))}clear(e){const t=e.id;this._db.forEach(((e,r)=>{r.startsWith(t)&&(this._size-=e.size,this._db.delete(r),this._notifyRemove(r,e.entry,e.size,a.ALL))})),e.size=0}clearAll(){this._db.forEach(((e,t)=>this._notifyRemove(t,e.entry,e.size,a.ALL))),this._users.forAll((e=>e.size=0)),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(e,t,r,n){let i;return this._removeFuncs.some((s=>{if(e.startsWith(s[0])){const e=s[1](t,n,r);return"number"==typeof e&&(i=e),!0}return!1})),i}_checkSize(){this._users.forAll((e=>this._checkSizeLimits(e))),this._checkSizeLimits()}_checkSizeLimits(e){const t=e??this;if(t.maxSize<0||t.size<=t.maxSize)return;const r=e?.id;let n=!0;for(;n;){n=!1;for(const[i,s]of this._db)if(0===s.lifetime&&(!r||i.startsWith(r))){if(this._purgeItem(i,s,e),t.size<=.9*t.maxSize)return;n||=this._db.has(i)}}for(const[i,s]of this._db)if((!r||i.startsWith(r))&&(this._purgeItem(i,s,e),t.size<=.9*t.maxSize))return}_purgeItem(e,t,r=this._users.find((t=>e.startsWith(t.id)))){if(this._db.delete(e),t.lives<=1){this._size-=t.size,r&&(r.size-=t.size);const n=this._notifyRemove(e,t.entry,t.size,a.SOME);null!=n&&n>0&&(this._size+=n,r&&(r.size+=n),t.lives=t.lifetime,t.size=n,this._db.set(e,t))}else--t.lives,this._db.set(e,t)}}class o{constructor(e,t,r){this.entry=e,this.size=t,this.lifetime=r,this.lives=r}}class u{constructor(e,t){this._storage=new l,this.id="",this.name="",this.size=0,this._storage.maxSize=e,this._storage.register(this),t&&this._storage.registerRemoveFunc("",t)}destroy(){this._storage.deregister(this),this._storage.destroy()}put(e,t,r=1){this._storage.put(this,e,t,r,1)}pop(e){return this._storage.pop(this,e)}get(e){return this._storage.get(this,e)}clear(){this._storage.clearAll()}get maxSize(){return this._storage.maxSize}set maxSize(e){this._storage.maxSize=e}resetHitRate(){}}},28252:function(e,t,r){r.d(t,{f:function(){return o}});var n=r(98503),i=r(50257);async function s(e){const t="portalItem"in e?e:{portalItem:e},{fromItem:i}=await Promise.all([r.e(2031),r.e(7489)]).then(r.bind(r,67489)).then((e=>e.p));try{return await i(t)}catch(s){const e=t?.portalItem,r=e?.id||"unset",i=e?.portal?.url||n.H.portalUrl;throw n.n.getLogger("esri.layers.support.fromPortalItem").error("#fromPortalItem()","Failed to create layer from portal item (portal: '"+i+"', id: '"+r+"')",s),s}}let a=0,l=class extends(n.bP.EventedMixin((0,n.da)(n.e))){constructor(){super(...arguments),this.attributionDataUrl=null,this.fullExtent=new n.au(-180,-90,180,90,n.B.WGS84),this.id=Date.now().toString(16)+"-layer-"+a++,this.legendEnabled=!0,this.listMode="show",this.opacity=1,this.parent=null,this.persistenceEnabled=!1,this.popupEnabled=!0,this.attributionVisible=!0,this.spatialReference=n.B.WGS84,this.title=null,this.type=null,this.url=null,this.visibilityTimeExtent=null,this.visible=!0}static async fromArcGISServerUrl(e){const t="string"==typeof e?{url:e}:e;return(await Promise.all([r.e(2031),r.e(8529)]).then(r.bind(r,58529))).fromUrl(t)}static fromPortalItem(e){return s(e)}initialize(){this.when().catch((e=>{(0,n.E)(e)||n.n.getLogger(this).error("#load()",`Failed to load layer (title: '${this.title??"no title"}', id: '${this.id??"no id"}')`,{error:e})}))}destroy(){const e=this.parent;if(e){const t=this;"layers"in e&&e.layers.includes(t)?e.layers.remove(t):"tables"in e&&e.tables.includes(t)?e.tables.remove(t):"baseLayers"in e&&e.baseLayers.includes(t)?e.baseLayers.remove(t):"referenceLayers"in e&&e.referenceLayers.includes(t)&&e.referenceLayers.remove(t),this._set("parent",null)}}get effectiveVisible(){let e=this.visible;const t=this.parent;return e&&t&&"effectiveVisible"in t&&(e&&=t.effectiveVisible),e}get hasAttributionData(){return null!=this.attributionDataUrl}get parsedUrl(){return(0,n.I)(this.url)}async fetchAttributionData(){const e=this.attributionDataUrl;if(this.hasAttributionData&&e)return(await(0,n.U)(e,{query:{f:"json"},responseType:"json"})).data;throw new n.s("layer:no-attribution-data","Layer does not have attribution data")}};(0,n.k)([(0,n.o)({type:String})],l.prototype,"attributionDataUrl",void 0),(0,n.k)([(0,n.o)({readOnly:!0})],l.prototype,"effectiveVisible",null),(0,n.k)([(0,n.o)({type:n.au})],l.prototype,"fullExtent",void 0),(0,n.k)([(0,n.o)({readOnly:!0})],l.prototype,"hasAttributionData",null),(0,n.k)([(0,n.o)({type:String,clonable:!1})],l.prototype,"id",void 0),(0,n.k)([(0,n.o)({type:Boolean,nonNullable:!0})],l.prototype,"legendEnabled",void 0),(0,n.k)([(0,n.o)({type:["show","hide","hide-children"]})],l.prototype,"listMode",void 0),(0,n.k)([(0,n.o)({type:Number,range:{min:0,max:1},nonNullable:!0})],l.prototype,"opacity",void 0),(0,n.k)([(0,n.o)({clonable:!1})],l.prototype,"parent",void 0),(0,n.k)([(0,n.o)({readOnly:!0})],l.prototype,"parsedUrl",null),(0,n.k)([(0,n.o)({type:Boolean,readOnly:!0})],l.prototype,"persistenceEnabled",void 0),(0,n.k)([(0,n.o)({type:Boolean})],l.prototype,"popupEnabled",void 0),(0,n.k)([(0,n.o)({type:Boolean})],l.prototype,"attributionVisible",void 0),(0,n.k)([(0,n.o)({type:n.B})],l.prototype,"spatialReference",void 0),(0,n.k)([(0,n.o)({type:String})],l.prototype,"title",void 0),(0,n.k)([(0,n.o)({readOnly:!0,json:{read:!1}})],l.prototype,"type",void 0),(0,n.k)([(0,n.o)()],l.prototype,"url",void 0),(0,n.k)([(0,n.o)({type:i.p})],l.prototype,"visibilityTimeExtent",void 0),(0,n.k)([(0,n.o)({type:Boolean,nonNullable:!0})],l.prototype,"visible",void 0),l=(0,n.k)([(0,n.A)("esri.layers.Layer")],l);const o=l},25035:function(e,t,r){r.d(t,{p:function(){return a}});var n,i=r(98503);let s=n=class extends i.v{constructor(e){super(e),this.floorField=null,this.viewAllMode=!1,this.viewAllLevelIds=new i.V}clone(){return new n({floorField:this.floorField,viewAllMode:this.viewAllMode,viewAllLevelIds:this.viewAllLevelIds})}};(0,i.k)([(0,i.o)({type:String,json:{write:!0}})],s.prototype,"floorField",void 0),(0,i.k)([(0,i.o)({json:{read:!1,write:!1}})],s.prototype,"viewAllMode",void 0),(0,i.k)([(0,i.o)({json:{read:!1,write:!1}})],s.prototype,"viewAllLevelIds",void 0),s=n=(0,i.k)([(0,i.A)("esri.layers.support.LayerFloorInfo")],s);const a=s},50293:function(e,t,r){r.d(t,{j:function(){return a}});var n=r(98503),i=r(2031),s=r(83297);const a=e=>{let t=class extends e{constructor(){super(...arguments),this.resourceReferences={portalItem:null,paths:[]},this.userHasEditingPrivileges=!0,this.userHasFullEditingPrivileges=!1,this.userHasUpdateItemPrivileges=!1}destroy(){this.portalItem=(0,n.C)(this.portalItem),this.resourceReferences.portalItem=null,this.resourceReferences.paths.length=0}set portalItem(e){e!==this._get("portalItem")&&(this.removeOrigin("portal-item"),this._set("portalItem",e))}readPortalItem(e,t,r){if(t.itemId)return new i["default"]({id:t.itemId,portal:r?.portal})}writePortalItem(e,t){e?.id&&(t.itemId=e.id)}async loadFromPortal(e,t){if(this.portalItem?.id)try{const{load:i}=await Promise.all([r.e(3338),r.e(1128)]).then(r.bind(r,21128));return(0,n.D)(t),await i({instance:this,supportedTypes:e.supportedTypes,validateItem:e.validateItem,supportsData:e.supportsData,layerModuleTypeMap:e.layerModuleTypeMap},t)}catch(i){throw(0,n.E)(i)||n.n.getLogger(this).warn(`Failed to load layer (${this.title}, ${this.id}) portal item (${this.portalItem.id})\n  ${i}`),i}}async finishLoadEditablePortalLayer(e){this._set("userHasEditingPrivileges",await this._fetchUserHasEditingPrivileges(e).catch((e=>((0,n.G)(e),!0))))}async setUserPrivileges(e,t){if(!n.H.userPrivilegesApplied)return this.finishLoadEditablePortalLayer(t);if(this.url)try{const{features:{edit:r,fullEdit:n},content:{updateItem:i}}=await this._fetchUserPrivileges(e,t);this._set("userHasEditingPrivileges",r),this._set("userHasFullEditingPrivileges",n),this._set("userHasUpdateItemPrivileges",i)}catch(r){(0,n.G)(r)}}async _fetchUserPrivileges(e,t){let r=this.portalItem;if(!e||!r||!r.loaded||r.sourceUrl)return this._fetchFallbackUserPrivileges(t);const a=e===r.id;if(a&&r.portal.user)return(0,s.E)(r);let l,o;if(a)l=r.portal.url;else try{l=await(0,n.J)(this.url,t)}catch(h){(0,n.G)(h)}if(!l||!(0,n.W)(l,r.portal.url))return this._fetchFallbackUserPrivileges(t);try{const e=null!=t?t.signal:null;o=await(n.K?.getCredential(`${l}/sharing`,{prompt:!1,signal:e}))}catch(h){(0,n.G)(h)}const u=!0,c=!1,d=!1;if(!o)return{features:{edit:u,fullEdit:c},content:{updateItem:d}};try{if(a?await r.reload():(r=new i["default"]({id:e,portal:{url:l}}),await r.load(t)),r.portal.user)return(0,s.E)(r)}catch(h){(0,n.G)(h)}return{features:{edit:u,fullEdit:c},content:{updateItem:d}}}async _fetchFallbackUserPrivileges(e){let t=!0;try{t=await this._fetchUserHasEditingPrivileges(e)}catch(r){(0,n.G)(r)}return{features:{edit:t,fullEdit:!1},content:{updateItem:!1}}}async _fetchUserHasEditingPrivileges(e){const t=this.url?n.K?.findCredential(this.url):null;if(!t)return!0;const r=l.credential===t?l.user:await this._fetchEditingUser(e);return l.credential=t,l.user=r,null==r?.privileges||r.privileges.includes("features:user:edit")}async _fetchEditingUser(e){const t=this.portalItem?.portal?.user;if(t)return t;const r=n.K?.findServerInfo(this.url??"");if(!r?.owningSystemUrl)return null;const i=`${r.owningSystemUrl}/sharing/rest`,s=n.b.getDefault();if(s&&s.loaded&&(0,n.L)(s.restUrl)===(0,n.L)(i))return s.user;const a=`${i}/community/self`,l=null!=e?e.signal:null,o=await(0,n._)((0,n.U)(a,{authMode:"no-prompt",query:{f:"json"},signal:l}));return o.ok?n.M.fromJSON(o.value.data):null}read(e,t){t&&(t.layer=this),super.read(e,t)}write(e,t){const r=t?.portal,i=this.portalItem?.id&&(this.portalItem.portal||n.b.getDefault());return r&&i&&!(0,n.N)(i.restUrl,r.restUrl)?(t.messages&&t.messages.push(new n.s("layer:cross-portal",`The layer '${this.title} (${this.id})' cannot be persisted because it refers to an item on a different portal than the one being saved to. To save, set layer.portalItem to null or save to the same portal as the item associated with the layer`,{layer:this})),null):super.write(e,{...t,layer:this})}};return(0,n.k)([(0,n.o)({type:i["default"]})],t.prototype,"portalItem",null),(0,n.k)([(0,n.u)("web-document","portalItem",["itemId"])],t.prototype,"readPortalItem",null),(0,n.k)([(0,n.q)("web-document","portalItem",{itemId:{type:String}})],t.prototype,"writePortalItem",null),(0,n.k)([(0,n.o)({clonable:!1})],t.prototype,"resourceReferences",void 0),(0,n.k)([(0,n.o)({type:Boolean,readOnly:!0})],t.prototype,"userHasEditingPrivileges",void 0),(0,n.k)([(0,n.o)({type:Boolean,readOnly:!0})],t.prototype,"userHasFullEditingPrivileges",void 0),(0,n.k)([(0,n.o)({type:Boolean,readOnly:!0})],t.prototype,"userHasUpdateItemPrivileges",void 0),t=(0,n.k)([(0,n.A)("esri.layers.mixins.PortalLayer")],t),t},l={credential:null,user:null}},64295:function(e,t,r){r.d(t,{p:function(){return l}});var n=r(98503);const i=new n.ax({esriRelCardinalityOneToOne:"one-to-one",esriRelCardinalityOneToMany:"one-to-many",esriRelCardinalityManyToMany:"many-to-many"}),s=new n.ax({esriRelRoleOrigin:"origin",esriRelRoleDestination:"destination"});let a=class extends((0,n.a_)(n.v)){constructor(e){super(e),this.cardinality=null,this.composite=null,this.id=null,this.keyField=null,this.keyFieldInRelationshipTable=null,this.name=null,this.relatedTableId=null,this.relationshipTableId=null,this.role=null}};(0,n.k)([(0,n.o)({json:{read:i.read,write:i.write}})],a.prototype,"cardinality",void 0),(0,n.k)([(0,n.o)({json:{read:!0,write:!0}})],a.prototype,"composite",void 0),(0,n.k)([(0,n.o)({json:{read:!0,write:!0}})],a.prototype,"id",void 0),(0,n.k)([(0,n.o)({json:{read:!0,write:!0}})],a.prototype,"keyField",void 0),(0,n.k)([(0,n.o)({json:{read:!0,write:!0}})],a.prototype,"keyFieldInRelationshipTable",void 0),(0,n.k)([(0,n.o)({json:{read:!0,write:!0}})],a.prototype,"name",void 0),(0,n.k)([(0,n.o)({json:{read:!0,write:!0}})],a.prototype,"relatedTableId",void 0),(0,n.k)([(0,n.o)({json:{read:!0,write:!0}})],a.prototype,"relationshipTableId",void 0),(0,n.k)([(0,n.o)({json:{read:s.read,write:s.write}})],a.prototype,"role",void 0),a=(0,n.k)([(0,n.A)("esri.layers.support.Relationship")],a);const l=a},22676:function(e,t,r){r.d(t,{r:function(){return i}});var n=r(98503);let i=class e{constructor(e,t,r=""){this.major=e,this.minor=t,this._context=r}lessThan(e,t){return this.major<e||e===this.major&&this.minor<t}greaterEqual(e,t){return!this.lessThan(e,t)}validate(e){if(this.major!==e.major){const t=this._context&&this._context+":",r=this._context&&this._context+" ";throw new n.s(t+"unsupported-version",`Required major ${r}version is '${this.major}', but got '\${version.major}.\${version.minor}'`,{version:e})}}clone(){return new e(this.major,this.minor,this._context)}static parse(t,r=""){const[i,s]=t.split("."),a=/^\s*\d+\s*$/;if(!i?.match||!a.test(i))throw new n.s((r&&r+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:t});if(!s?.match||!a.test(s))throw new n.s((r&&r+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:t});const l=parseInt(i,10),o=parseInt(s,10);return new e(l,o,r)}}},5948:function(e,t,r){r.d(t,{C:function(){return g},S:function(){return _},b:function(){return m},d:function(){return c},g:function(){return f},h:function(){return d},m:function(){return h},p:function(){return u},w:function(){return p},y:function(){return y}});var n=r(98503);const i={mapserver:"MapServer",imageserver:"ImageServer",featureserver:"FeatureServer",knowledgegraphserver:"KnowledgeGraphServer",sceneserver:"SceneServer",streamserver:"StreamServer",vectortileserver:"VectorTileServer","3dtilesserver":"3DTilesServer",videoserver:"VideoServer"},s=Object.values(i),a=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/rest\\/services\\/(.+?)\\/(${s.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),l=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/([^/\\n]+)\\/(${s.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),o=/(.*?)\/(?:layers\/)?(\d+)\/?$/i;function u(e){return a.test(e)}function c(e){if(null==e)return null;const t=(0,n.I)(e),r=t?.path.match(a)||t?.path.match(l);if(!r)return null;const[,s,o,u,c]=r,d=o.indexOf("/");return{title:h(-1!==d?o.slice(d+1):o),serverType:i[u.toLowerCase()],sublayer:null!=c&&""!==c?parseInt(c,10):null,url:{path:s}}}function d(e){const t=(0,n.I)(e).path.match(o);return t?{serviceUrl:t[1],sublayerId:Number(t[2])}:null}function h(e){return(e=e.replaceAll(/\s*[/_]+\s*/g," "))[0].toUpperCase()+e.slice(1)}function p(e,t){const r=[];if(e){const t=c(e);null!=t&&t.title&&r.push(t.title)}if(t){const e=h(t);r.push(e)}if(2===r.length){if(r[0].toLowerCase().includes(r[1].toLowerCase()))return r[0];if(r[1].toLowerCase().includes(r[0].toLowerCase()))return r[1]}return r.join(" - ")}function f(e){let t=(0,n.X)(e,!0);return!!t&&(t=t.toLowerCase(),t.endsWith(".arcgis.com")&&(t.startsWith("services")||t.startsWith("tiles")||t.startsWith("features")))}function y(e,t){return e&&(0,n.Q)((0,n.S)(e,t))}function _(e){let{url:t}=e;if(!t)return{url:t};t=(0,n.S)(t,e.logger);const r=(0,n.I)(t),i=c(r.path);let s;if(null!=i)null!=i.sublayer&&null==e.layer.layerId&&(s=i.sublayer),t=i.url.path;else if(e.nonStandardUrlAllowed){const e=d(r.path);null!=e&&(t=e.serviceUrl,s=e.sublayerId)}return{url:(0,n.Q)(t),layerId:s}}function g(e,t,r,i,s){(0,n.T)(t,i,"url",s),i.url&&null!=e.layerId&&(i.url=(0,n.Z)(i.url,r,e.layerId.toString()))}function m(e){if(!e)return!1;const t=e.toLowerCase(),r=t.includes("/services/"),n=t.includes("/mapserver/wmsserver"),i=t.includes("/imageserver/wmsserver"),s=t.includes("/wmsserver");return r&&(n||i||s)}},25209:function(e,t,r){r.d(t,{c:function(){return c},e:function(){return i},o:function(){return a},u:function(){return u}});let n=1e-6;function i(){return n}function s(e){n=e}const a=Math.random,l=Math.PI/180,o=180/Math.PI;function u(e){return e*l}function c(e){return e*o}function d(e,t){return Math.abs(e-t)<=n*Math.max(1,Math.abs(e),Math.abs(t))}Object.freeze(Object.defineProperty({__proto__:null,RANDOM:a,equals:d,getEpsilon:i,setEpsilon:s,toDegree:c,toRadian:u},Symbol.toStringTag,{value:"Module"}))},49329:function(e,t,r){r.d(t,{n:function(){return n},o:function(){return i}});r(98503);function n(e){}function i(e){return()=>e}},65944:function(e,t,r){r.d(t,{d:function(){return f},p:function(){return h},s:function(){return d},y:function(){return p}});var n=r(98503);const i=new Set(["esri.Color","esri.portal.Portal","esri.symbols.support.Symbol3DAnchorPosition2D","esri.symbols.support.Symbol3DAnchorPosition3D"]);function s(e){return e instanceof n.aD}function a(e){return e instanceof n.V?Object.keys(e.items):s(e)?(0,n.bf)(e).keys():e?Object.keys(e):[]}function l(e,t){return e instanceof n.V?e.items[t]:e[t]}function o(e,t){return!(!Array.isArray(e)||!Array.isArray(t))&&e.length!==t.length}function u(e){return e?e.declaredClass:null}function c(e,t){const r=e.diff;if(r&&"function"==typeof r)return r(e,t);const n=a(e),d=a(t);if(0===n.length&&0===d.length)return;if(!n.length||!d.length||o(e,t))return{type:"complete",oldValue:e,newValue:t};const h=d.filter((e=>!n.includes(e))),p=n.filter((e=>!d.includes(e))),f=n.filter((r=>d.includes(r)&&l(e,r)!==l(t,r))).concat(h,p).sort(),y=u(e);if(y&&i.has(y)&&f.length)return{type:"complete",oldValue:e,newValue:t};let _;const g=s(e)&&s(t);for(const i of f){const n=l(e,i),s=l(t,i);let a;if((g||"function"!=typeof n&&"function"!=typeof s)&&n!==s&&(null!=n||null!=s)){if(r&&r[i]&&"function"==typeof r[i])a=r[i]?.(n,s);else if(n instanceof Date&&s instanceof Date){if(n.getTime()===s.getTime())continue;a={type:"complete",oldValue:n,newValue:s}}else a="object"==typeof n&&"object"==typeof s&&u(n)===u(s)?c(n,s):{type:"complete",oldValue:n,newValue:s};null!=a&&(null!=_?_.diff[i]=a:_={type:"partial",diff:{[i]:a}})}}return _}function d(e,t){return h(e,t)}function h(e,t){if(null==e)return!1;const r=t.split(".");let n=e;for(const i of r){if("complete"===n.type)return!0;if("partial"!==n.type)return!1;{const e=n.diff[i];if(!e)return!1;n=e}}return!0}function p(e,t){if(!e)return!1;if("partial"===e.type){const r=Object.keys(e.diff);return 1===r.length&&r[0]===t}return!1}function f(e,t){if("function"!=typeof e&&"function"!=typeof t&&(null!=e||null!=t))return null==e||null==t||"object"==typeof e&&"object"==typeof t&&u(e)!==u(t)?{type:"complete",oldValue:e,newValue:t}:c(e,t)}},20344:function(e,t,r){r.r(t),r.d(t,{B:function(){return C},E:function(){return H},L:function(){return v},M:function(){return J},N:function(){return U},O:function(){return Q},R:function(){return R},T:function(){return B},a:function(){return T},b:function(){return L},c:function(){return S},d:function(){return I},e:function(){return A},f:function(){return N},g:function(){return ee},k:function(){return F},q:function(){return Y}});var n=r(98503),i=r(14435),s=r(54525),a=r(49647),l=r(17113),o=r(88820),u=r(16473),c=r(98089),d=r(36879),h=r(76180),p=r(55420),f=r(66015),y=r(13193),_=r(29344),g=r(28252),m=r(2031);let w=class{constructor(){this.declaredRootClass="esri.arcade.featureSetCollection",this._layerById={},this._layerByName={}}add(e,t,r){this._layerById[t]=r,this._layerByName[e]=r}async featureSetByName(e,t=!0,r=["*"]){return void 0===this._layerByName[e]?null:this._layerByName[e]}async featureSetById(e,t=!0,r=["*"]){return void 0===this._layerById[e]?null:this._layerById[e]}castToText(e=!1){return"object, FeatureSetCollection"}};class S extends s.C{constructor(e){super(e),this.declaredClass="esri.arcade.featureset.actions.AttributeFilter",this._maxProcessing=1e3,this._parent=e.parentfeatureset,e.whereclause instanceof l.Z?(this._whereclause=e.whereclause,this._whereClauseFunction=null):(this._whereClauseFunction=e.whereclause,this._whereclause=null)}_initialiseFeatureSet(){null!==this._parent?(this.fields=this._parent.fields.slice(),this.geometryType=this._parent.geometryType,this.objectIdField=this._parent.objectIdField,this.globalIdField=this._parent.globalIdField,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField=this._parent.typeIdField,this.types=this._parent.types,this.subtypeField=this._parent.subtypeField,this.subtypes=this._parent.subtypes):(this.fields=[],this.typeIdField="",this.subtypeField="",this.objectIdField="",this.globalIdField="",this.spatialReference=new n.B({wkid:4326}),this.geometryType=a.N.point)}async _getSet(e){if(null===this._wset){await this._ensureLoaded();const t=await this._parent._getFilteredSet("",null,this._whereclause,null,e);return this._checkCancelled(e),null!==this._whereClauseFunction?this._wset=new s.t(t._candidates.slice().concat(t._known.slice()),[],t._ordered,this._clonePageDefinition(t.pagesDefinition)):this._wset=new s.t(t._candidates.slice(),t._known.slice(),t._ordered,this._clonePageDefinition(t.pagesDefinition)),this._wset}return this._wset}_isInFeatureSet(e){let t=this._parent?._isInFeatureSet(e);return t===a.s.NotInFeatureSet?t:(t=this._idstates[e],void 0===t?a.s.Unknown:t)}_getFeature(e,t,r){return this._parent._getFeature(e,t,r)}_getFeatures(e,t,r,n){return this._parent._getFeatures(e,t,r,n)}_featureFromCache(e){return this._parent._featureFromCache(e)}executeWhereClause(e){return this._whereclause?.testFeature(e)??!1}async executeWhereClauseDeferred(e){if(null!==this._whereClauseFunction){const t=this._whereClauseFunction(e);return(0,n.aO)(t),t}return this.executeWhereClause(e)}async _fetchAndRefineFeatures(e,t,r){const n=new s.t([],e,!1,null),i=Math.min(t,e.length);if(await(this._parent?._getFeatures(n,-1,i,r)),this._checkCancelled(r),null==this._whereClauseFunction){for(let t=0;t<i;t++){const r=this._parent?._featureFromCache(e[t]);!0===this.executeWhereClause(r)?this._idstates[e[t]]=a.s.InFeatureSet:this._idstates[e[t]]=a.s.NotInFeatureSet}return"success"}const l=[];for(let s=0;s<i;s++){const t=this._parent?._featureFromCache(e[s]);l.push(await this.executeWhereClauseDeferred(t))}for(let s=0;s<t;s++)!0===l[s]?this._idstates[e[s]]=a.s.InFeatureSet:this._idstates[e[s]]=a.s.NotInFeatureSet;return"success"}async _getFilteredSet(e,t,r,n,i){null!==this._whereClauseFunction||(null!==r?null!==this._whereclause&&(r=(0,s.g)(this._whereclause,r)):r=this._whereclause),await this._ensureLoaded();const a=await this._parent._getFilteredSet(e,t,r,n,i);let l;return this._checkCancelled(i),l=null!==this._whereClauseFunction?new s.t(a._candidates.slice().concat(a._known.slice()),[],a._ordered,this._clonePageDefinition(a.pagesDefinition)):new s.t(a._candidates.slice(),a._known.slice(),a._ordered,this._clonePageDefinition(a.pagesDefinition)),l}async _stat(e,t,r,n,i,a,l){if(null!==this._whereClauseFunction)return null===i&&""===r&&null===n?this._manualStat(e,t,a,l):{calculated:!1};let o=this._whereclause;null!==i&&null!==this._whereclause&&(o=(0,s.g)(this._whereclause,i));const u=await this._parent._stat(e,t,r,n,o,a,l);return!1===u.calculated?null===i&&""===r&&null===n?this._manualStat(e,t,a,l):{calculated:!1}:u}async _canDoAggregates(e,t,r,n,i){return null===this._whereClauseFunction&&(null!==i?null!==this._whereclause&&(i=(0,s.g)(this._whereclause,i)):i=this._whereclause,null!==this._parent&&this._parent._canDoAggregates(e,t,r,n,i))}async _getAggregatePagesDataSourceDefinition(e,t,r,n,i,a,l){if(null===this._parent)throw new s.s(s.a.NeverReach);return null!==i?null!==this._whereclause&&(i=(0,s.g)(this._whereclause,i)):i=this._whereclause,this._parent._getAggregatePagesDataSourceDefinition(e,t,r,n,i,a,l)}static registerAction(){s.C._featuresetFunctions.filter=function(e){if("function"==typeof e)return new S({parentfeatureset:this,whereclause:e});let t=null;return e instanceof l.Z&&(t=e),new S({parentfeatureset:this,whereclause:t})}}getFieldsIndex(){return this._parent.getFieldsIndex()}}class b{constructor(e){this.field=e,this.sqlRewritable=!1}postInitialization(e,t){}}let F=class extends b{constructor(e){super(e),this.sqlRewritable=!0}extractValue(e){return e.attributes[this.field.name]}rewriteSql(e){return{rewritten:this.sqlRewritable,where:e}}},I=class extends b{constructor(e,t,r){super((0,a.y)(e)),this.originalField=e,this.sqlRewritable=!0,this.field.name=t,this.field.alias=r}rewriteSql(e,t){return{rewritten:this.sqlRewritable,where:(0,s.p)(e,this.field.name,this.originalField.name,t.getFieldsIndex())}}extractValue(e){return e.attributes[this.originalField.name]}};class C extends b{constructor(e,t,r){super(e),this.codefield=t,this.lkp=r,this.reverseLkp={};for(const n in r)this.reverseLkp[r[n]]=n;this.sqlRewritable=!0}rewriteSql(e,t){const r=this.evaluateNodeToWhereClause(e.parseTree,a.l.Standardised,this.field.name,this.codefield instanceof l.Z?(0,s.b)(this.codefield,a.l.Standardised):this.codefield,e.parameters);return r.includes(C.BADNESS)?{rewritten:!1,where:e}:{rewritten:this.sqlRewritable,where:l.Z.create(r,{fieldsIndex:t._parent.getFieldsIndex(),timeZone:t.dateFieldsTimeZoneDefaultUTC})}}evaluateNodeToWhereClause(e,t,r=null,n=null,i){let o,u,c,d;switch(e.type){case"interval":return(0,s.F)(this.evaluateNodeToWhereClause(e.value,t,r,n,i),e.qualifier,e.op);case"case-expression":{let n=" CASE ";"simple"===e.format&&(n+=this.evaluateNodeToWhereClause(e.operand,t,r,C.BADNESS,i));for(let s=0;s<e.clauses.length;s++)n+=" WHEN "+this.evaluateNodeToWhereClause(e.clauses[s].operand,t,r,C.BADNESS,i)+" THEN "+this.evaluateNodeToWhereClause(e.clauses[s].value,t,r,C.BADNESS,i);return null!==e.else&&(n+=" ELSE "+this.evaluateNodeToWhereClause(e.else,t,r,C.BADNESS,i)),n+=" END ",n}case"parameter":{const r=i[e.value.toLowerCase()];if("string"==typeof r)return"'"+r.toString().replaceAll("'","''")+"'";if((0,a.f)(r))return(0,s.I)(r,t);if((0,a.d)(r))return(0,s.I)(r,t);if((0,a.F)(r))return(0,s.A)(r,t);if((0,a.g)(r))return(0,s.S)(r,t);if((0,a.T)(r))return(0,s.E)(r,t);if(Array.isArray(r)){const e=[];for(let n=0;n<r.length;n++)"string"==typeof r[n]?e.push("'"+r[n].toString().replaceAll("'","''")+"'"):(0,a.f)(r[n])||(0,a.d)(r[n])?e.push((0,s.I)(r[n],t)):(0,a.F)(r[n])?e.push((0,s.A)(r[n],t)):(0,a.g)(r[n])?e.push((0,s.S)(r[n],t)):(0,a.T)(r[n])?e.push((0,s.E)(r[n],t)):e.push(r[n].toString());return e}return r.toString()}case"expression-list":u=[];for(const s of e.value)u.push(this.evaluateNodeToWhereClause(s,t,r,n,i));return u;case"unary-expression":return" ( NOT "+this.evaluateNodeToWhereClause(e.expr,t,r,C.BADNESS,i)+" ) ";case"binary-expression":switch(e.operator){case"AND":return" ("+this.evaluateNodeToWhereClause(e.left,t,r,n,i)+" AND "+this.evaluateNodeToWhereClause(e.right,t,r,n,i)+") ";case"OR":return" ("+this.evaluateNodeToWhereClause(e.left,t,r,n,i)+" OR "+this.evaluateNodeToWhereClause(e.right,t,r,n,i)+") ";case"IS":if("null"!==e.right.type)throw new l.n(l.a.UnsupportedIsRhs);return" ("+this.evaluateNodeToWhereClause(e.left,t,r,n,i)+" IS NULL )";case"ISNOT":if("null"!==e.right.type)throw new l.n(l.a.UnsupportedIsRhs);return" ("+this.evaluateNodeToWhereClause(e.left,t,r,n,i)+" IS NOT NULL )";case"IN":if(o=[],"expression-list"===e.right.type){if("column-reference"===e.left.type&&e.left.column.toUpperCase()===this.field.name.toUpperCase()){const s=[];let a=!0;for(const t of e.right.value){if("string"!==t.type){a=!1;break}if(void 0===this.lkp[t.value]){a=!1;break}s.push(this.lkp[t.value].toString())}if(a)return" ("+this.evaluateNodeToWhereClause(e.left,t,r,n,i)+" IN ("+s.join(",")+")) "}return o=this.evaluateNodeToWhereClause(e.right,t,r,n,i)," ("+this.evaluateNodeToWhereClause(e.left,t,r,n,i)+" IN ("+o.join(",")+")) "}return d=this.evaluateNodeToWhereClause(e.right,t,r,n,i),Array.isArray(d)?" ("+this.evaluateNodeToWhereClause(e.left,t,r,n,i)+" IN ("+d.join(",")+")) ":" ("+this.evaluateNodeToWhereClause(e.left,t,r,n,i)+" IN ("+d+")) ";case"NOT IN":if(o=[],"expression-list"===e.right.type){if("column-reference"===e.left.type&&e.left.column.toUpperCase()===this.field.name.toUpperCase()){const s=[];let a=!0;for(const t of e.right.value){if("string"!==t.type){a=!1;break}if(void 0===this.lkp[t.value]){a=!1;break}s.push(this.lkp[t.value].toString())}if(a)return" ("+this.evaluateNodeToWhereClause(e.left,t,r,n,i)+" NOT IN ("+s.join(",")+")) "}return o=this.evaluateNodeToWhereClause(e.right,t,r,n,i)," ("+this.evaluateNodeToWhereClause(e.left,t,r,n,i)+" NOT IN ("+o.join(",")+")) "}return d=this.evaluateNodeToWhereClause(e.right,t,r,n,i),Array.isArray(d)?" ("+this.evaluateNodeToWhereClause(e.left,t,r,n,i)+" NOT IN ("+d.join(",")+")) ":" ("+this.evaluateNodeToWhereClause(e.left,t,r,n,i)+" NOT IN ("+d+")) ";case"BETWEEN":return c=this.evaluateNodeToWhereClause(e.right,t,r,C.BADNESS,i)," ("+this.evaluateNodeToWhereClause(e.left,t,r,C.BADNESS,i)+" BETWEEN "+c[0]+" AND "+c[1]+" ) ";case"NOTBETWEEN":return c=this.evaluateNodeToWhereClause(e.right,t,r,C.BADNESS,i)," ("+this.evaluateNodeToWhereClause(e.left,t,r,C.BADNESS,i)+" NOT BETWEEN "+c[0]+" AND "+c[1]+" ) ";case"LIKE":return""!==e.escape?" ("+this.evaluateNodeToWhereClause(e.left,t,r,C.BADNESS,i)+" LIKE "+this.evaluateNodeToWhereClause(e.right,t,r,C.BADNESS,i)+" ESCAPE '"+e.escape+"') ":" ("+this.evaluateNodeToWhereClause(e.left,t,r,C.BADNESS,i)+" LIKE "+this.evaluateNodeToWhereClause(e.right,t,r,C.BADNESS,i)+") ";case"NOT LIKE":return""!==e.escape?" ("+this.evaluateNodeToWhereClause(e.left,t,r,C.BADNESS,i)+" NOT LIKE "+this.evaluateNodeToWhereClause(e.right,t,r,C.BADNESS,i)+" ESCAPE '"+e.escape+"') ":" ("+this.evaluateNodeToWhereClause(e.left,t,r,C.BADNESS,i)+" NOT LIKE "+this.evaluateNodeToWhereClause(e.right,t,r,C.BADNESS,i)+") ";case"<>":case"=":if("column-reference"===e.left.type&&"string"===e.right.type){if(e.left.column.toUpperCase()===this.field.name.toUpperCase()&&void 0!==this.lkp[e.right.value.toString()])return" ("+n+" "+e.operator+" "+this.lkp[e.right.value.toString()].toString()+") "}else if("column-reference"===e.right.type&&"string"===e.left.type&&e.right.column.toUpperCase()===this.field.name.toUpperCase())return" ("+this.lkp[e.right.value.toString()].toString()+" "+e.operator+" "+n+") ";return" ("+this.evaluateNodeToWhereClause(e.left,t,r,C.BADNESS,i)+" "+e.operator+" "+this.evaluateNodeToWhereClause(e.right,t,r,C.BADNESS,i)+") ";case"<":case">":case">=":case"<=":case"*":case"-":case"+":case"/":case"||":return" ("+this.evaluateNodeToWhereClause(e.left,t,r,C.BADNESS,i)+" "+e.operator+" "+this.evaluateNodeToWhereClause(e.right,t,r,C.BADNESS,i)+") "}case"null":return"null";case"boolean":return!0===e.value?"1":"0";case"string":return"'"+e.value.toString().replaceAll("'","''")+"'";case"timestamp":return`timestamp '${e.value}'`;case"date":return`date '${e.value}'`;case"time":return`time '${e.value}'`;case"number":return e.value.toString();case"current-time":return(0,s.L)(e.mode,t);case"current-user":return"CURRENT_USER";case"column-reference":return r&&r.toLowerCase()===e.column.toLowerCase()?"("+n+")":(0,s.h)(e.column);case"data-type":return e.value;case"function":{const n=this.evaluateNodeToWhereClause(e.args,t,r,C.BADNESS,i);return(0,s.T)(e.name,n,t)}}throw new l.n(l.a.UnsupportedSyntax,{node:e.type})}extractValue(e){return this.codefield instanceof l.Z?this.reverseLkp[l.Z.convertValueToStorageFormat(this.codefield.calculateValueCompiled(e))]:this.reverseLkp[e.attributes[this.codefield]]}}C.BADNESS="_!!!_BAD_LKP_!!!!";class v extends b{constructor(e,t){super(e),this._sql=t}rewriteSql(e,t){return{rewritten:!0,where:(0,s.p)(e,this.field.name,(0,s.b)(this._sql,a.l.Standardised),t.getFieldsIndex())}}extractValue(e){return l.Z.convertValueToStorageFormat(this._sql.calculateValueCompiled(e),this.field.type)}}let R=class extends s.C{static findField(e,t){for(const r of e)if(r.name.toLowerCase()===t.toString().toLowerCase())return r;return null}constructor(e){super(e),this._calcFunc=null,this.declaredClass="esri.arcade.featureset.actions.Adapted",this.adaptedFields=[],this._extraFilter=null,this._extraFilter=e.extraFilter,this._parent=e.parentfeatureset,this._maxProcessing=30,this.adaptedFields=e.adaptedFields}_initialiseFeatureSet(){null!==this._parent?(this.geometryType=this._parent.geometryType,this.objectIdField=this._parent.objectIdField,this.globalIdField=this._parent.globalIdField,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField=this._parent.typeIdField,this.types=this._parent.types):(this.spatialReference=new n.B({wkid:4326}),this.objectIdField="",this.globalIdField="",this.geometryType=a.N.point,this.typeIdField="",this.types=null,this.subtypeField=null,this.subtypes=null),this.fields=[];for(const e of this.adaptedFields)e.postInitialization(this,this._parent),this.fields.push(e.field)}async _getSet(e){if(null===this._wset){await this._ensureLoaded();let t=null;return t=this._extraFilter?await this._getFilteredSet("",null,null,null,e):await(this._parent?._getSet(e)),this._checkCancelled(e),(0,n.af)(t),this._wset=new s.t(t._candidates.slice(),t._known.slice(),t._ordered,this._clonePageDefinition(t.pagesDefinition)),this._wset}return this._wset}_isInFeatureSet(e){return this._parent._isInFeatureSet(e)}async _getFeatures(e,t,r,i){const a=[];-1!==t&&void 0===this._featureCache[t]&&a.push(t);const l=this._maxQueryRate();if(!0===this._checkIfNeedToExpandKnownPage(e,l))return await this._expandPagedSet(e,l,0,0,i),this._getFeatures(e,t,r,i);let u=0;for(let n=e._lastFetchedIndex;n<e._known.length&&(u++,u<=r&&(e._lastFetchedIndex+=1),!(void 0===this._featureCache[e._known[n]]&&(e._known[n]!==t&&a.push(e._known[n]),a.length>=l)));n++);if(0===a.length)return"success";e=new s.t([],a,e._ordered,null);const c=Math.min(a.length,r);await(this._parent?._getFeatures(e,-1,c,i)),this._checkCancelled(i);const d=[];for(let n=0;n<c;n++){const e=this._parent?._featureFromCache(a[n]);void 0!==e&&d.push({geometry:e.geometry,attributes:e.attributes,id:a[n]})}for(const s of d){const e=[];for(const t of this.adaptedFields)e[t.field.name]=t.extractValue(s);this._featureCache[s.id]=new n.b1({attributes:e,geometry:(0,o.c)(s.geometry)})}return"success"}async _fetchAndRefineFeatures(){throw new s.s(s.a.NeverReach)}async _getFilteredSet(e,t,r,n,i){let a=!1;const l=this._reformulateWithoutAdaptions(r);a=l.cannot,r=l.where;let o=!1;if(null!==n){o=!0;const e=[];for(const t of this.adaptedFields)if(!(t instanceof F)&&!0===n.scanForField(t.field.name)){if(!(t instanceof I)){n=null,o=!1;break}e.push({field:t.field.name,newfield:t.originalField.name})}n&&e.length>0&&(n=n.replaceFields(e))}null!==r?null!==this._extraFilter&&(r=(0,s.g)(this._extraFilter,r)):r=this._extraFilter,await this._ensureLoaded();const u=await this._parent._getFilteredSet(e,t,r,n,i);let c;return this._checkCancelled(i),c=!0===a?new s.t(u._candidates.slice().concat(u._known.slice()),[],!0===o&&u._ordered,this._clonePageDefinition(u.pagesDefinition)):new s.t(u._candidates.slice(),u._known.slice(),!0===o&&u._ordered,this._clonePageDefinition(u.pagesDefinition)),c}_reformulateWithoutAdaptions(e){const t={cannot:!1,where:e};if(null!==e)for(const r of this.adaptedFields)if(!0===(0,s.D)(e,r.field.name)){const n=r.rewriteSql(e,this);if(!0!==n.rewritten){t.cannot=!0,t.where=null;break}t.where=n.where}return t}async _stat(e,t,r,n,i,a,l){let o=!1,u=this._reformulateWithoutAdaptions(t);if(o=u.cannot,t=u.where,u=this._reformulateWithoutAdaptions(i),o=o||u.cannot,null!==(i=u.where)?null!==this._extraFilter&&(i=(0,s.g)(this._extraFilter,i)):i=this._extraFilter,!0===o)return null===i&&""===r&&null===n?this._manualStat(e,t,a,l):{calculated:!1};const c=await this._parent._stat(e,t,r,n,i,a,l);return!1===c.calculated?null===i&&""===r&&null===n?this._manualStat(e,t,a,l):{calculated:!1}:c}async _canDoAggregates(e,t,r,n,i){if(null===this._parent)return!1;for(let s=0;s<e.length;s++)for(const t of this.adaptedFields)if(e[s].toLowerCase()===t.field.name.toLowerCase()&&!(t instanceof F))return!1;const a=[];for(let s=0;s<t.length;s++){const e=t[s];if(null!==e.workingexpr){const t=this._reformulateWithoutAdaptions(e.workingexpr);if(t.cannot)return!1;const r=e.clone();r.workingexpr=t.where,a.push(r)}else a.push(e)}const l=this._reformulateWithoutAdaptions(i);return!l.cannot&&(null!==(i=l.where)?null!==this._extraFilter&&(i=(0,s.g)(this._extraFilter,i)):i=this._extraFilter,this._parent._canDoAggregates(e,a,r,n,i))}async _getAggregatePagesDataSourceDefinition(e,t,r,n,i,a,l){if(null===this._parent)throw new s.s(s.a.NeverReach);const o=[];for(let c=0;c<t.length;c++){const e=t[c];if(null!==e.workingexpr){const t=this._reformulateWithoutAdaptions(e.workingexpr);if(t.cannot)throw new s.s(s.a.NeverReach);const r=e.clone();r.workingexpr=t.where,o.push(r)}else o.push(e)}const u=this._reformulateWithoutAdaptions(i);if(u.cannot)throw new s.s(s.a.NeverReach);return null!==(i=u.where)?null!==this._extraFilter&&(i=(0,s.g)(this._extraFilter,i)):i=this._extraFilter,this._parent._getAggregatePagesDataSourceDefinition(e,o,r,n,i,a,l)}};function E(e,t){return e===t?0:null===e?-1:null===t?1:e<t?-1:1}class A{constructor(e){const t=e.split(",");this._fields=[],this._directions=[];for(let r=0;r<t.length;r++){const e=t[r].match(/\S+/g);this._fields.push(e[0]),2===e.length?"asc"===e[1].toLowerCase()?this._directions.push(1):this._directions.push(0):this._directions.push(1)}}constructClause(){let e="";for(let t=0;t<this._fields.length;t++)0!==t&&(e+=","),e+=this._fields[t],1===this._directions[t]?e+=" ASC":e+=" DESC";return e}order(e){e.sort(((e,t)=>{for(let r=0;r<this._fields.length;r++){const n=this.featureValue(e.feature,this._fields[r],r),i=this.featureValue(t.feature,this._fields[r],r);let s=0;if(s=1===this._directions[r]?E(n,i):-1*E(n,i),0!==s)return s}return 0}))}scanForField(e){for(let t=0;t<this._fields.length;t++)if(this._fields[t].toLowerCase().trim()===e.toLowerCase().trim())return!0;return!1}replaceFields(e){let t="";for(let r=0;r<this._fields.length;r++){0!==r&&(t+=",");let n=this._fields[r];for(const t of e)if(n.toLowerCase()===t.field.toLowerCase()){n=t.newfield;break}t+=n,1===this._directions[r]?t+=" ASC":t+=" DESC"}return new A(t)}featureValue(e,t,r){const n=e.attributes[t];if(void 0!==n)return n;for(const i in e.attributes)if(t.toLowerCase()===i.toLowerCase())return this._fields[r]=i,e.attributes[i];return null}}let T=class e extends s.C{constructor(e){super(e),this._orderbyclause=null,this.declaredClass="esri.arcade.featureset.actions.OrderBy",this._maxProcessing=100,this._orderbyclause=e.orderbyclause,this._parent=e.parentfeatureset}async _getSet(e){if(null===this._wset){await this._ensureLoaded();const t=await this._getFilteredSet("",null,null,this._orderbyclause,e);return this._checkCancelled(e),this._wset=t,this._wset}return this._wset}async manualOrderSet(e,t){const r=await this.getIdColumnDictionary(e,[],-1,t);this._orderbyclause?.order(r);const n=new s.t([],[],!0,null);for(let i=0;i<r.length;i++)n._known.push(r[i].id);return n}async getIdColumnDictionary(e,t,r,n){if(r<e._known.length-1){const s=this._maxQueryRate();if("GETPAGES"===e._known[r+1])return await(0,i.a3)(this._parent._expandPagedSet(e,s,0,0,n)),this.getIdColumnDictionary(e,t,r,n);let a=r+1;const l=[];for(;a<e._known.length&&"GETPAGES"!==e._known[a];)l.push(e._known[a]),a++;r+=l.length;const o=await(0,i.a3)(this._parent._getFeatureBatch(l,n));this._checkCancelled(n);for(const e of o)t.push({id:e.attributes[this.objectIdField],feature:e});return this.getIdColumnDictionary(e,t,r,n)}return e._candidates.length>0?(await(0,i.a3)(this._refineSetBlock(e,this._maxProcessingRate(),n)),this._checkCancelled(n),this.getIdColumnDictionary(e,t,r,n)):t}_isInFeatureSet(e){return this._parent._isInFeatureSet(e)}_getFeatures(e,t,r,n){return this._parent._getFeatures(e,t,r,n)}_featureFromCache(e){if(void 0===this._featureCache[e]){const t=this._parent._featureFromCache(e);return void 0===t?void 0:null===t?null:(this._featureCache[e]=t,t)}return this._featureCache[e]}async _fetchAndRefineFeatures(){throw new s.s(s.a.NeverReach)}async _getFilteredSet(e,t,r,n,i){await this._ensureLoaded();const a=await this._parent._getFilteredSet(e,t,r,null===n?this._orderbyclause:n,i);this._checkCancelled(i);const l=new s.t(a._candidates.slice(),a._known.slice(),a._ordered,this._clonePageDefinition(a.pagesDefinition));let o=!0;if(a._candidates.length>0&&(o=!1),!1===l._ordered){let e=await this.manualOrderSet(l,i);return!1===o&&(null===t&&null===r||(e=new s.t(e._candidates.slice().concat(e._known.slice()),[],e._ordered,this._clonePageDefinition(e.pagesDefinition)))),e}return l}static registerAction(){s.C._featuresetFunctions.orderBy=function(t){return""===t?this:new e({parentfeatureset:this,orderbyclause:new A(t)})}}getFieldsIndex(){return this._parent.getFieldsIndex()}};function x(e){if("function"===e.parseTree.type){if(0===e.parseTree.args.value.length)return{name:e.parseTree.name,expr:null};if(e.parseTree.args.value.length>1)throw new l.n(l.a.MissingStatisticParameters);const t=l.Z.create((0,s.m)(e.parseTree.args.value[0],a.l.Standardised,e.parameters),{fieldsIndex:e.fieldsIndex,timeZone:e.timeZone,currentUser:e.currentUser});return{name:e.parseTree.name,expr:t}}return null}let M=class e{constructor(){this.field="",this.tofieldname="",this.typeofstat="MIN",this.workingexpr=null}clone(){const t=new e;return t.field=this.field,t.tofieldname=this.tofieldname,t.typeofstat=this.typeofstat,t.workingexpr=this.workingexpr,t}static parseStatField(t,r,n,i){const s=new e;s.field=t;const a=l.Z.create(r,{fieldsIndex:n,timeZone:i}),o=x(a);if(null===o)throw new l.n(l.a.UnsupportedSqlFunction,{function:""});const u=o.name.toUpperCase().trim();if("MIN"===u){if(s.typeofstat="MIN",s.workingexpr=o.expr,null===a)throw new l.n(l.a.InvalidFunctionParameters,{function:"min"})}else if("MAX"===u){if(s.typeofstat="MAX",s.workingexpr=o.expr,null===a)throw new l.n(l.a.InvalidFunctionParameters,{function:"max"})}else if("COUNT"===u)s.typeofstat="COUNT",s.workingexpr=o.expr;else if("STDEV"===u){if(s.typeofstat="STDDEV",s.workingexpr=o.expr,null===a)throw new l.n(l.a.InvalidFunctionParameters,{function:"stdev"})}else if("SUM"===u){if(s.typeofstat="SUM",s.workingexpr=o.expr,null===a)throw new l.n(l.a.InvalidFunctionParameters,{function:"sum"})}else if("MEAN"===u){if(s.typeofstat="AVG",s.workingexpr=o.expr,null===a)throw new l.n(l.a.InvalidFunctionParameters,{function:u})}else if("AVG"===u){if(s.typeofstat="AVG",s.workingexpr=o.expr,null===a)throw new l.n(l.a.InvalidFunctionParameters,{function:"avg"})}else{if("VAR"!==u)throw new l.n(l.a.UnsupportedSqlFunction,{function:u});if(s.typeofstat="VAR",s.workingexpr=o.expr,null===a)throw new l.n(l.a.InvalidFunctionParameters,{function:"var"})}return s}toStatisticsName(){switch(this.typeofstat.toUpperCase()){case"MIN":return"min";case"MAX":return"max";case"SUM":return"sum";case"COUNT":default:return"count";case"VAR":return"var";case"STDDEV":return"stddev";case"AVG":return"avg"}}};function P(e){if(!e)return"COUNT";switch(e.toLowerCase()){case"max":return"MAX";case"var":case"variance":return"VAR";case"avg":case"average":case"mean":return"AVG";case"min":return"MIN";case"sum":return"SUM";case"stdev":case"stddev":return"STDDEV";case"count":return"COUNT"}return"COUNT"}let k=class e extends s.C{constructor(e){super(e),this._decodedStatsfield=[],this._decodedGroupbyfield=[],this._candosimplegroupby=!0,this.phsyicalgroupbyfields=[],this.objectIdField="ROW__ID",this._internalObjectIdField="ROW__ID",this._adaptedFields=[],this.declaredClass="esri.arcade.featureset.actions.Aggregate",this._uniqueIds=1,this._maxQuery=10,this._maxProcessing=10,this._parent=e.parentfeatureset,this._config=e}isTable(){return!0}async _getSet(e){if(null===this._wset){const t=await this._getFilteredSet("",null,null,null,e);return this._wset=t,this._wset}return this._wset}_isInFeatureSet(){return a.s.InFeatureSet}_nextUniqueName(e){for(;1===e["T"+this._uniqueIds.toString()];)this._uniqueIds++;const t="T"+this._uniqueIds.toString();return e[t]=1,t}_convertToEsriFieldType(e){return e}_initialiseFeatureSet(){const e={};let t=!1,r=1;const i=this._parent?this._parent.getFieldsIndex():new d.Z([]);for(this.objectIdField="ROW__ID",this.globalIdField="";!1===t;){let e=!1;for(let t=0;t<this._config.groupbyfields.length;t++)if(this._config.groupbyfields[t].name.toLowerCase()===this.objectIdField.toLowerCase()){e=!0;break}if(!1===e)for(let t=0;t<this._config.statsfields.length;t++)if(this._config.statsfields[t].name.toLowerCase()===this.objectIdField.toLowerCase()){e=!0;break}!1===e?t=!0:(this.objectIdField="ROW__ID"+r.toString(),r++)}for(const n of this._config.statsfields){const e=new M;e.field=n.name,e.tofieldname=n.name,e.workingexpr=n.expression instanceof l.Z?n.expression:l.Z.create(n.expression,{fieldsIndex:i,timeZone:this.dateFieldsTimeZoneDefaultUTC}),e.typeofstat=P(n.statistic),this._decodedStatsfield.push(e)}this._decodedGroupbyfield=[];for(const n of this._config.groupbyfields){const e={name:n.name,singlefield:null,tofieldname:n.name,expression:n.expression instanceof l.Z?n.expression:l.Z.create(n.expression,{fieldsIndex:i,timeZone:this.dateFieldsTimeZoneDefaultUTC}),sqlType:null};this._decodedGroupbyfield.push(e)}if(null!==this._parent){this.geometryType=this._parent.geometryType,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField="";for(const t of this._parent.fields)e[t.name.toUpperCase()]=1;this.types=null,this.subtypes=null,this.subtypeField=""}else this.geometryType=a.N.point,this.typeIdField="",this.types=null,this.subtypes=null,this.subtypeField="",this.spatialReference=new n.B({wkid:4326});this.fields=[];const o=new M;o.field=this._nextUniqueName(e),o.tofieldname=this.objectIdField,o.workingexpr=l.Z.create(this._parent.objectIdField,{fieldsIndex:this._parent.getFieldsIndex(),timeZone:this.dateFieldsTimeZoneDefaultUTC}),o.typeofstat="MIN",this._decodedStatsfield.push(o);for(const n of this._decodedGroupbyfield){const t=new c.y;if(n.name=this._nextUniqueName(e),t.name=n.tofieldname,t.alias=t.name,(0,s.O)(n.expression)){const e=this._parent.getField((0,s.b)(n.expression,a.l.Standardised));if(!e)throw new s.s(s.a.AggregationFieldNotFound);n.name=e.name,n.singlefield=e.name,this.phsyicalgroupbyfields.push(e.name),t.type=e.type,n.sqlType=e.type}else{t.type=this._convertToEsriFieldType((0,s.w)(n.expression,this._parent.fields));const e=new c.y;e.name=n.name,e.alias=e.name,this.phsyicalgroupbyfields.push(n.name),this._adaptedFields.push(new v(e,n.expression)),this._candosimplegroupby=!1,n.sqlType=t.type}this.fields.push(t)}if(this._adaptedFields.length>0)for(const n of this._parent.fields)this._adaptedFields.push(new F(n));for(let n=0;n<this._decodedStatsfield.length;n++){const t=new c.y;let r=null;const i=this._decodedStatsfield[n];i.field=this._nextUniqueName(e),i.tofieldname===this.objectIdField&&(this._internalObjectIdField=i.field),t.name=i.tofieldname,t.alias=t.name;const l=null!==i.workingexpr&&(0,s.O)(i.workingexpr)?(0,s.b)(i.workingexpr,a.l.Standardised):"";switch(this._decodedStatsfield[n].typeofstat){case"SUM":if(""!==l){if(r=this._parent.getField(l),!r)throw new s.s(s.a.AggregationFieldNotFound);t.type=r.type}else t.type="double";break;case"MIN":case"MAX":if(""!==l){if(r=this._parent.getField(l),!r)throw new s.s(s.a.AggregationFieldNotFound);t.type=r.type}else t.type="double";break;case"COUNT":t.type="integer";break;case"STDDEV":case"VAR":case"AVG":if(""!==l&&(r=this._parent.getField(l),!r))throw new s.s(s.a.AggregationFieldNotFound);t.type="double"}this.fields.push(t)}}async _canDoAggregates(){return!1}async _getFeatures(e,t,r,n){-1!==t&&this._featureCache[t];const i=this._maxQuery;return!0===this._checkIfNeedToExpandKnownPage(e,i)?(await this._expandPagedSet(e,i,0,0,n),this._getFeatures(e,t,r,n)):"success"}async _getFilteredSet(e,t,r,n,i){if(""!==e)return new s.t([],[],!0,null);let a=null;const l={ordered:!1,nowhereclause:!1};if(await this._ensureLoaded(),null!==r)for(let u=0;u<this._decodedStatsfield.length;u++)if(!0===(0,s.D)(r,this._decodedStatsfield[u].tofieldname)){l.nowhereclause=!0,r=null;break}if(null!==n){l.ordered=!0;for(let e=0;e<this._decodedStatsfield.length;e++)if(!0===n.scanForField(this._decodedStatsfield[e].tofieldname)){n=null,l.ordered=!1;break}if(null!==n)for(const e of this._decodedGroupbyfield)if(null===e.singlefield&&!0===n.scanForField(e.tofieldname)){n=null,l.ordered=!1;break}}if(!1!==this._candosimplegroupby&&await this._parent._canDoAggregates(this.phsyicalgroupbyfields,this._decodedStatsfield,"",null,null)){let e=null;r&&(e=this._reformulateWhereClauseWithoutGroupByFields(r));let t=null;n&&(t=this._reformulateOrderClauseWithoutGroupByFields(n));const o=await this._parent._getAggregatePagesDataSourceDefinition(this.phsyicalgroupbyfields,this._decodedStatsfield,"",null,e,t,this._internalObjectIdField);return this._checkCancelled(i),a=!0===l.nowhereclause?new s.t(o._candidates.slice().concat(o._known.slice()),[],!0===l.ordered&&o._ordered,this._clonePageDefinition(o.pagesDefinition)):new s.t(o._candidates.slice(),o._known.slice(),!0===l.ordered&&o._ordered,this._clonePageDefinition(o.pagesDefinition)),a}let o=this._parent;if(this._adaptedFields.length>0&&(o=new R({parentfeatureset:this._parent,adaptedFields:this._adaptedFields,extraFilter:null})),!0===l.nowhereclause)a=new s.t(["GETPAGES"],[],!1,{aggregatefeaturesetpagedefinition:!0,resultOffset:0,resultRecordCount:this._maxQuery,internal:{fullyResolved:!1,workingItem:null,type:"manual",iterator:null,set:[],subfeatureset:new T({parentfeatureset:o,orderbyclause:new A(this.phsyicalgroupbyfields.join(",")+","+this._parent.objectIdField+" ASC")})}});else{let e=o;if(null!==r){let t=null;r&&(t=this._reformulateWhereClauseWithoutGroupByFields(r)),e=new S({parentfeatureset:e,whereclause:t})}a=new s.t(["GETPAGES"],[],!1,{aggregatefeaturesetpagedefinition:!0,resultOffset:0,resultRecordCount:this._maxQuery,internal:{fullyResolved:!1,workingItem:null,type:"manual",iterator:null,set:[],subfeatureset:new T({parentfeatureset:e,orderbyclause:new A(this.phsyicalgroupbyfields.join(",")+","+this._parent.objectIdField+" ASC")})}})}return a}_reformulateWhereClauseWithoutStatsFields(e){for(const t of this._decodedStatsfield)e=(0,s.p)(e,t.tofieldname,(0,s.b)(t.workingexpr,a.l.Standardised),this._parent.getFieldsIndex());return e}_reformulateWhereClauseWithoutGroupByFields(e){for(const t of this._decodedGroupbyfield)t.tofieldname!==t.name&&(e=(0,s.p)(e,t.tofieldname,(0,s.b)(t.expression,a.l.Standardised),this._parent.getFieldsIndex()));return e}_reformulateOrderClauseWithoutGroupByFields(e){const t=[];for(const r of this._decodedGroupbyfield)r.tofieldname!==r.name&&t.push({field:r.tofieldname,newfield:r.name});return t.length>0?e.replaceFields(t):e}_clonePageDefinition(e){return null===e?null:!0===e.aggregatefeaturesetpagedefinition?{aggregatefeaturesetpagedefinition:!0,resultRecordCount:e.resultRecordCount,resultOffset:e.resultOffset,internal:e.internal}:this._parent._clonePageDefinition(e)}async _refineSetBlock(e,t,r){return!0===this._checkIfNeedToExpandCandidatePage(e,this._maxQuery)?(await this._expandPagedSet(e,this._maxQuery,0,0,r),this._refineSetBlock(e,t,r)):(this._checkCancelled(r),e._candidates.length,this._refineKnowns(e,t),e._candidates.length,e._candidates.length,e)}_expandPagedSet(e,t,r,n,i){return this._expandPagedSetFeatureSet(e,t,r,n,i)}async _getPhysicalPage(e,t,r){if(!0===e.pagesDefinition.aggregatefeaturesetpagedefinition)return this._sequentialGetPhysicalItem(e,e.pagesDefinition.resultRecordCount,r,[]);const i=await this._getAgregagtePhysicalPage(e,t,r);for(const s of i){const e={geometry:s.geometry,attributes:{}},t={};for(const r in s.attributes)t[r.toLowerCase()]=s.attributes[r];for(const r of this._decodedGroupbyfield)e.attributes[r.tofieldname]=t[r.name.toLowerCase()];for(const r of this._decodedStatsfield)e.attributes[r.tofieldname]=t[r.field.toLowerCase()];this._featureCache[e.attributes[this.objectIdField]]=new n.b1(e)}return i.length}_sequentialGetPhysicalItem(e,t,r,n){return new Promise(((i,s)=>{null===e.pagesDefinition.internal.iterator&&(e.pagesDefinition.internal.iterator=e.pagesDefinition.internal.subfeatureset.iterator(r)),!0===e.pagesDefinition.internal.fullyResolved||0===t?i(n.length):this._nextAggregateItem(e,t,r,n,(s=>{null===s?i(n.length):(t-=1,i(this._sequentialGetPhysicalItem(e,t,r,n)))}),s)}))}_nextAggregateItem(e,t,r,n,s,a){try{(0,i.a3)(e.pagesDefinition.internal.iterator.next()).then((i=>{if(null===i)if(null!==e.pagesDefinition.internal.workingItem){const t=this._calculateAndAppendAggregateItem(e.pagesDefinition.internal.workingItem);n.push(t),e.pagesDefinition.internal.workingItem=null,e.pagesDefinition.internal.set.push(t.attributes[this.objectIdField]),e.pagesDefinition.internal.fullyResolved=!0,s(null)}else e.pagesDefinition.internal.fullyResolved=!0,s(null);else{const l=this._generateAggregateHash(i);if(null===e.pagesDefinition.internal.workingItem)e.pagesDefinition.internal.workingItem={features:[i],id:l};else{if(l!==e.pagesDefinition.internal.workingItem.id){const r=this._calculateAndAppendAggregateItem(e.pagesDefinition.internal.workingItem);return n.push(r),e.pagesDefinition.internal.workingItem=null,e.pagesDefinition.internal.set.push(r.attributes[this.objectIdField]),t-=1,e.pagesDefinition.internal.workingItem={features:[i],id:l},void s(r)}e.pagesDefinition.internal.workingItem.features.push(i)}this._nextAggregateItem(e,t,r,n,s,a)}}),a)}catch(l){a(l)}}_calculateFieldStat(e,t,r){const n=[];for(const i of e.features)if(null!==t.workingexpr){const e=t.workingexpr.calculateValue(i);null!==e&&(e instanceof o.n||e instanceof o.a?n.push(e.toNumber()):e instanceof l.r?n.push(e.toMilliseconds()):n.push(e))}else n.push(null);r.attributes[t.tofieldname]=(0,l.u)(t.typeofstat,[n])}_calculateAndAppendAggregateItem(e){const t={attributes:{},geometry:null};for(const n of this._decodedGroupbyfield){const r=n.singlefield?e.features[0].attributes[n.singlefield]:l.Z.convertValueToStorageFormat(n.expression.calculateValue(e.features[0]),n.sqlType);t.attributes[n.tofieldname]=r}for(const n of this._decodedStatsfield)this._calculateFieldStat(e,n,t);const r=[];for(let n=0;n<this._decodedStatsfield.length;n++)r.push(this._calculateFieldStat(e,this._decodedStatsfield[n],t));return this._featureCache[t.attributes[this.objectIdField]]=new n.b1({attributes:t.attributes,geometry:t.geometry}),t}_generateAggregateHash(e){let t="";for(const r of this._decodedGroupbyfield){const n=r.singlefield?e.attributes[r.singlefield]:r.expression.calculateValue(e);t+=null==n?":":":"+n.toString()}return(0,u.x)(t,u.n.String)}async _stat(){return{calculated:!1}}async getFeatureByObjectId(){return null}static registerAction(){s.C._featuresetFunctions.groupby=function(t,r){return new e({parentfeatureset:this,groupbyfields:t,statsfields:r})}}};class L extends s.C{constructor(e){super(e),this._topnum=0,this.declaredClass="esri.arcade.featureset.actions.Top",this._countedin=0,this._maxProcessing=100,this._topnum=e.topnum,this._parent=e.parentfeatureset}async _getSet(e){if(null===this._wset){await this._ensureLoaded();const t=await this._parent._getSet(e);return this._wset=new s.t(t._candidates.slice(),t._known.slice(),!1,this._clonePageDefinition(t.pagesDefinition)),this._setKnownLength(this._wset)>this._topnum&&(this._wset._known=this._wset._known.slice(0,this._topnum)),this._setKnownLength(this._wset)>=this._topnum&&(this._wset._candidates=[]),this._wset}return this._wset}_setKnownLength(e){return e._known.length>0&&"GETPAGES"===e._known[e._known.length-1]?e._known.length-1:e._known.length}_isInFeatureSet(e){const t=this._parent._isInFeatureSet(e);if(t===a.s.NotInFeatureSet)return t;const r=this._idstates[e];return r===a.s.InFeatureSet||r===a.s.NotInFeatureSet?r:t===a.s.InFeatureSet&&void 0===r?this._countedin<this._topnum?(this._idstates[e]=a.s.InFeatureSet,this._countedin++,a.s.InFeatureSet):(this._idstates[e]=a.s.NotInFeatureSet,a.s.NotInFeatureSet):a.s.Unknown}async _expandPagedSet(e,t,r,n,i){if(null===this._parent)throw new s.s(s.a.NotImplemented);if(t>this._topnum&&(t=this._topnum),this._countedin>=this._topnum&&e.pagesDefinition.internal.set.length<=e.pagesDefinition.resultOffset){let t=e._known.length;return t>0&&"GETPAGES"===e._known[t-1]&&(e._known.length=t-1),t=e._candidates.length,t>0&&"GETPAGES"===e._candidates[t-1]&&(e._candidates.length=t-1),"success"}const a=await this._parent._expandPagedSet(e,t,r,n,i);return this._setKnownLength(e)>this._topnum&&(e._known.length=this._topnum),this._setKnownLength(e)>=this._topnum&&(e._candidates.length=0),a}async _getFeatures(e,t,r,n){const i=[],a=this._maxQueryRate();if(!0===this._checkIfNeedToExpandKnownPage(e,a))return await this._expandPagedSet(e,a,0,0,n),this._getFeatures(e,t,r,n);-1!==t&&void 0===this._featureCache[t]&&i.push(t);let l=0;for(let s=e._lastFetchedIndex;s<e._known.length&&(l++,l<=r&&(e._lastFetchedIndex+=1),!(void 0===this._featureCache[e._known[s]]&&(e._known[s]!==t&&i.push(e._known[s]),i.length>a)));s++);if(0===i.length)return"success";const o=new s.t([],i,!1,null),u=Math.min(i.length,r);await this._parent._getFeatures(o,-1,u,n);for(let s=0;s<u;s++){const e=this._parent._featureFromCache(i[s]);void 0!==e&&(this._featureCache[i[s]]=e)}return"success"}async _getFilteredSet(e,t,r,n,i){await this._ensureLoaded();const a=await this._getSet(i);return new s.t(a._candidates.slice().concat(a._known.slice()),[],!1,this._clonePageDefinition(a.pagesDefinition))}_refineKnowns(e,t){let r=0,n=null;const i=[];for(let s=0;s<e._candidates.length;s++){const l=this._isInFeatureSet(e._candidates[s]);if(l===a.s.InFeatureSet){if(e._known.push(e._candidates[s]),r+=1,null===n?n={start:s,end:s}:n.end===s-1?n.end=s:(i.push(n),n={start:s,end:s}),e._known.length>=this._topnum)break}else if(l===a.s.NotInFeatureSet)null===n?n={start:s,end:s}:n.end===s-1?n.end=s:(i.push(n),n={start:s,end:s}),r+=1;else if(l===a.s.Unknown)break;if(r>=t)break}null!==n&&i.push(n);for(let s=i.length-1;s>=0;s--)e._candidates.splice(i[s].start,i[s].end-i[s].start+1);this._setKnownLength(e)>this._topnum&&(e._known=e._known.slice(0,this._topnum)),this._setKnownLength(e)>=this._topnum&&(e._candidates=[])}async _stat(){return{calculated:!1}}async _canDoAggregates(){return!1}static registerAction(){s.C._featuresetFunctions.top=function(e){return new L({parentfeatureset:this,topnum:e})}}getFieldsIndex(){return this._parent.getFieldsIndex()}}class O extends s.C{constructor(e){super(e),this.declaredClass="esri.arcade.featureset.sources.FeatureLayerDynamic",this._removeGeometry=!1,this._overrideFields=null,this.formulaCredential=null,this._pageJustIds=!1,this._requestStandardised=!1,this._useDefinitionExpression=!0,e.spatialReference&&(this.spatialReference=e.spatialReference),this._transparent=!0,this._maxProcessing=1e3,this._layer=e.layer,this._wset=null,void 0!==e.outFields&&(this._overrideFields=e.outFields),void 0!==e.includeGeometry&&(this._removeGeometry=!1===e.includeGeometry)}_maxQueryRate(){return a.D}end(){return this._layer}optimisePagingFeatureQueries(e){this._pageJustIds=e}get urlQueryPath(){return this._layer.parsedUrl.path||""}convertQueryToLruCacheKey(e){const t=this.urlQueryPath+","+(0,a.J)(e.toJSON());return(0,u.x)(t,u.n.String)}async loadImpl(){return!0===this._layer.loaded?(this._initialiseFeatureSet(),this):(await this._layer.load(),this._initialiseFeatureSet(),this)}_initialiseFeatureSet(){if(null==this.spatialReference&&(this.spatialReference=this._layer.spatialReference),this.geometryType=this._layer.geometryType??"",this.fields=this._layer.fields.slice(),this.hasZ=!0===this._layer?.capabilities?.data?.supportsZ,this.hasM=!0===this._layer?.capabilities?.data?.supportsM,null!==this._overrideFields)if(1===this._overrideFields.length&&"*"===this._overrideFields[0])this._overrideFields=null;else{const e=[],t=[];for(const r of this.fields)if("oid"===r.type)e.push(r),t.push(r.name);else for(const n of this._overrideFields)if(n.toLowerCase()===r.name.toLowerCase()){e.push(r),t.push(r.name);break}this.fields=e,this._overrideFields=t}if(this._layer.source&&this._layer.source.sourceJSON){const e=this._layer.source.sourceJSON.currentVersion;!0===this._layer.source.sourceJSON.useStandardizedQueries?(this._databaseType=a.l.StandardisedNoInterval,null!=e&&e>=10.61&&(this._databaseType=a.l.Standardised)):null!=e&&(e>=10.5&&(this._databaseType=a.l.StandardisedNoInterval,this._requestStandardised=!0),e>=10.61&&(this._databaseType=a.l.Standardised))}this.objectIdField=this._layer.objectIdField;for(const e of this.fields)"global-id"===e.type&&(this.globalIdField=e.name);this.subtypeField=this._layer.subtypeField??"",this.subtypes=this._layer.subtypes,this.typeIdField=("typeIdField"in this._layer?this._layer.typeIdField:null)??"",this.types="types"in this._layer?this._layer.types:null}_isInFeatureSet(){return a.s.InFeatureSet}async _refineSetBlock(e){return e}_candidateIdTransform(e){return e}async _getSet(e){if(null===this._wset){await this._ensureLoaded();const t=await this._getFilteredSet("",null,null,null,e);return this._wset=t,t}return this._wset}async _runDatabaseProbe(e){await this._ensureLoaded();const t=new y.b;this.datesInUnknownTimezone&&(t.timeReferenceUnknownClient=!0),t.where=e.replace("OBJECTID",this._layer.objectIdField);try{return await this._layer.queryObjectIds(t),!0}catch{return!1}}_canUsePagination(){return!(!this._layer.capabilities||!this._layer.capabilities.query||!0!==this._layer.capabilities.query.supportsPagination)}_cacheableFeatureSetSourceKey(){return this._layer.url}get gdbVersion(){return this._layer&&this._layer.capabilities&&this._layer.capabilities.data&&this._layer.capabilities.data.isVersioned?this._layer.gdbVersion||"SDE.DEFAULT":""}nativeCapabilities(){return{title:this._layer.title??"",source:this,canQueryRelated:!0,capabilities:this._layer.capabilities,databaseType:this._databaseType,requestStandardised:this._requestStandardised}}_createQuery(){const e=this._layer.createQuery();return e.returnZ=this.hasZ,e.returnM=this.hasM,this.datesInUnknownTimezone&&(e.timeReferenceUnknownClient=!0),this._requestStandardised&&(e.sqlFormat="standard"),this._useDefinitionExpression?"subtype-group"===this._layer.type&&(e.where=this._layer.definitionExpression):e.where=null,e}executeQuery(e,t){const r="execute"===t?this._layer.queryFeatures.bind(this._layer):"executeForCount"===t?this._layer.queryFeatureCount.bind(this._layer):this._layer.queryObjectIds.bind(this._layer);let n=null;if(this.recentlyUsedQueries){const t=this.convertQueryToLruCacheKey(e);n=this.recentlyUsedQueries.getFromCache(t),null===n&&(n=r(e),this.recentlyUsedQueries.addToCache(t,n),n=n.catch((e=>{throw this.recentlyUsedQueries?.removeFromCache(t),e})))}return this.featureSetQueryInterceptor&&this.featureSetQueryInterceptor.preLayerQueryCallback({layer:this._layer,query:e,method:t}),null===n&&(n=r(e)),n}async _getFilteredSet(e,t,r,i,a){const l=await this.databaseType();if(this.isTable()&&t&&null!==e&&""!==e)return new s.t([],[],!0,null);if(this._canUsePagination())return this._getFilteredSetUsingPaging(e,t,r,i,a);let o="",u=!1;null!==i&&this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsOrderBy&&(o=i.constructClause(),u=!0);const c=this._createQuery();c.where=(0,n.bt)(c.where,null===r?null===t?"1=1":"":(0,s.b)(r,l)),c.spatialRelationship=this._makeRelationshipEnum(e),c.outSpatialReference=this.spatialReference,c.orderByFields=""!==o?o.split(","):null,c.geometry=null===t?null:t,c.relationParameter=this._makeRelationshipParam(e);let d=await this.executeQuery(c,"executeForIds");return null===d&&(d=[]),this._checkCancelled(a),new s.t([],d,u,null)}_expandPagedSet(e,t,r,n,i){return this._expandPagedSetFeatureSet(e,t,r,n,i)}async _getFilteredSetUsingPaging(e,t,r,n,i){let a="",l=!1;null!==n&&this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsOrderBy&&(a=n.constructClause(),l=!0);const o=await this.databaseType(),u=null===r?null===t?"1=1":"":(0,s.b)(r,o);let c=this._maxQueryRate();const d=this._layer.capabilities?.query.maxRecordCount;null!=d&&d<c&&(c=d);let h=null;if(!0===this._pageJustIds)h=new s.t([],["GETPAGES"],l,{spatialRel:this._makeRelationshipEnum(e),relationParam:this._makeRelationshipParam(e),outFields:this._layer.objectIdField,resultRecordCount:c,resultOffset:0,geometry:null===t?null:t,where:u,orderByFields:a,returnGeometry:!1,returnIdsOnly:"false",internal:{set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}});else{let r=!0;!0===this._removeGeometry&&(r=!1);const n=this._overrideFields??this._fieldsIncludingObjectId(["*"]);h=new s.t([],["GETPAGES"],l,{spatialRel:this._makeRelationshipEnum(e),relationParam:this._makeRelationshipParam(e),outFields:n.join(","),resultRecordCount:c,resultOffset:0,geometry:null===t?null:t,where:u,orderByFields:a,returnGeometry:r,returnIdsOnly:"false",internal:{set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}})}return await this._expandPagedSet(h,c,0,1,i),h}_clonePageDefinition(e){return null===e?null:!0!==e.groupbypage?{groupbypage:!1,spatialRel:e.spatialRel,relationParam:e.relationParam,outFields:e.outFields,resultRecordCount:e.resultRecordCount,resultOffset:e.resultOffset,geometry:e.geometry,where:e.where,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}:{groupbypage:!0,spatialRel:e.spatialRel,relationParam:e.relationParam,outFields:e.outFields,resultRecordCount:e.resultRecordCount,useOIDpagination:e.useOIDpagination,generatedOid:e.generatedOid,groupByFieldsForStatistics:e.groupByFieldsForStatistics,resultOffset:e.resultOffset,outStatistics:e.outStatistics,geometry:e.geometry,where:e.where,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}}async _getPhysicalPage(e,t,r){const i=e.pagesDefinition.internal.lastRetrieved,s=i,a=e.pagesDefinition.internal.lastPage,l=this._createQuery();l.spatialRelationship=e.pagesDefinition.spatialRel,l.relationParameter=e.pagesDefinition.relationParam,l.outFields=e.pagesDefinition.outFields.split(","),l.num=e.pagesDefinition.resultRecordCount,l.start=e.pagesDefinition.internal.lastPage,l.geometry=e.pagesDefinition.geometry,l.where=(0,n.bt)(l.where,e.pagesDefinition.where),l.orderByFields=""!==e.pagesDefinition.orderByFields?e.pagesDefinition.orderByFields.split(","):null,l.returnGeometry=e.pagesDefinition.returnGeometry,l.outSpatialReference=this.spatialReference;const o=await this.executeQuery(l,"execute");if(this._checkCancelled(r),e.pagesDefinition.internal.lastPage!==a)return"done";const u=this._layer.objectIdField;for(let n=0;n<o.features.length;n++)e.pagesDefinition.internal.set[s+n]=o.features[n].attributes[u];if(!1===this._pageJustIds)for(let n=0;n<o.features.length;n++)this._featureCache[o.features[n].attributes[u]]=o.features[n];return(void 0===o.exceededTransferLimit&&o.features.length!==e.pagesDefinition.resultRecordCount||!1===o.exceededTransferLimit)&&(e.pagesDefinition.internal.fullyResolved=!0),e.pagesDefinition.internal.lastRetrieved=i+o.features.length,e.pagesDefinition.internal.lastPage+=e.pagesDefinition.resultRecordCount,"done"}_fieldsIncludingObjectId(e){if(null===e)return[this.objectIdField];const t=e.slice();if(t.includes("*"))return t;let r=!1;for(const n of t)if(n.toUpperCase()===this.objectIdField.toUpperCase()){r=!0;break}return!1===r&&t.push(this.objectIdField),t}async _getFeatures(e,t,r,n){const i=[];if(-1!==t&&void 0===this._featureCache[t]&&i.push(t),!0===this._checkIfNeedToExpandKnownPage(e,this._maxProcessingRate()))return await this._expandPagedSet(e,this._maxProcessingRate(),0,0,n),this._getFeatures(e,t,r,n);let a=0;for(let s=e._lastFetchedIndex;s<e._known.length;s++){if(e._lastFetchedIndex+=1,a++,void 0===this._featureCache[e._known[s]]){let r=!1;if(null!==this._layer._mode&&void 0!==this._layer._mode){const t=this._layer._mode;if(void 0!==t._featureMap[e._known[s]]){const n=t._featureMap[e._known[s]];null!==n&&(r=!0,this._featureCache[e._known[s]]=n)}}if(!1===r&&(e._known[s]!==t&&i.push(e._known[s]),i.length>=this._maxProcessingRate()-1))break}if(a>=r&&0===i.length)break}if(0===i.length)return"success";const l=this._createQuery();l.objectIds=i,l.outFields=this._overrideFields??this._fieldsIncludingObjectId(["*"]),l.returnGeometry=!0,!0===this._removeGeometry&&(l.returnGeometry=!1),l.outSpatialReference=this.spatialReference;const o=await this.executeQuery(l,"execute");if(this._checkCancelled(n),void 0!==o.error)throw new s.s(s.a.RequestFailed,{reason:o.error});const u=this._layer.objectIdField;for(let s=0;s<o.features.length;s++)this._featureCache[o.features[s].attributes[u]]=o.features[s];return"success"}async _getDistinctPages(e,t,r,i,a,l,o,u,c){await this._ensureLoaded();const d=await this.databaseType();let h=r.parseTree.column;const p=this._layer.fields??[];for(let n=0;n<p.length;n++)if(p[n].name.toLowerCase()===h.toLowerCase()){h=p[n].name;break}const f=this._createQuery();f.where=(0,n.bt)(f.where,null===l?null===a?"1=1":"":(0,s.b)(l,d)),f.spatialRelationship=this._makeRelationshipEnum(i),f.relationParameter=this._makeRelationshipParam(i),f.geometry=null===a?null:a,f.returnDistinctValues=!0,f.returnGeometry=!1,f.outFields=[h];const y=await this.executeQuery(f,"execute");if(this._checkCancelled(c),!y.hasOwnProperty("features"))throw new s.s(s.a.InvalidStatResponse);let _=!1;for(let n=0;n<p.length;n++)if(p[n].name===h){"date"===p[n].type&&(_=!0);break}for(let n=0;n<y.features.length;n++){if(_){const e=y.features[n].attributes[h];null!==e?u.push(new Date(e)):u.push(e)}else u.push(y.features[n].attributes[h]);if(u.length>=o)break}return 0===y.features.length?u:y.features.length===this._layer.capabilities?.query.maxRecordCount&&u.length<o?{calculated:!0,result:await this._getDistinctPages(e+y.features.length,t,r,i,a,l,o,u,c)}:u}async _distinctStat(e,t,r,n,i,s,a){return{calculated:!0,result:await this._getDistinctPages(0,e,t,r,n,i,s,[],a)}}isTable(){return this._layer.isTable||null===this._layer.geometryType||"table"===this._layer.type||""===this._layer.geometryType||"esriGeometryNull"===this._layer.geometryType}async _countstat(e,t,r,i){const a=await this.databaseType();if(this.isTable()&&r&&null!==t&&""!==t)return{calculated:!0,result:0};const l=this._createQuery();return l.where=(0,n.bt)(l.where,null===i?null===r?"1=1":"":(0,s.b)(i,a)),l.spatialRelationship=this._makeRelationshipEnum(t),l.relationParameter=this._makeRelationshipParam(t),l.geometry=null===r?null:r,l.returnGeometry=!1,{calculated:!0,result:await this.executeQuery(l,"executeForCount")}}async _stats(e,t,r,i,a,l,o){await this._ensureLoaded();const u=this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsSqlExpression,c=this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsStatistics,d=this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsDistinct;if("count"===e)return d?this._countstat(e,r,i,a):{calculated:!1};if(!1===c||!1===(0,s.O)(t)&&!1===u||!1===t.isStandardized)return""!==r||null!==a?{calculated:!1}:this._manualStat(e,t,l,o);if("distinct"===e)return!1===d?""!==r||null!==a?{calculated:!1}:this._manualStat(e,t,l,o):this._distinctStat(e,t,r,i,a,l,o);const h=await this.databaseType();if(this.isTable()&&i&&null!==r&&""!==r)return{calculated:!0,result:null};const p=this._createQuery();p.where=(0,n.bt)(p.where,null===a?null===i?"1=1":"":(0,s.b)(a,h)),p.spatialRelationship=this._makeRelationshipEnum(r),p.relationParameter=this._makeRelationshipParam(r),p.geometry=null===i?null:i;const f=new y.m;f.statisticType=(0,s.c)(e),f.onStatisticField=(0,s.b)(t,h),f.outStatisticFieldName="ARCADE_STAT_RESULT",p.returnGeometry=!1;let _="ARCADE_STAT_RESULT";p.outStatistics=[f];const g=await this.executeQuery(p,"execute");if(!g.hasOwnProperty("features")||0===g.features.length)throw new s.s(s.a.InvalidStatResponse);let m=!1;const w=g.fields??[];for(let n=0;n<w.length;n++)if("ARCADE_STAT_RESULT"===w[n].name.toUpperCase()){_=w[n].name,"date"===w[n].type&&(m=!0);break}if(m){let e=g.features[0].attributes[_];return null!==e&&(e=new Date(g.features[0].attributes[_])),{calculated:!0,result:e}}return{calculated:!0,result:g.features[0].attributes[_]}}_stat(e,t,r,n,i,s,a){return this._stats(e,t,r,n,i,s,a)}async _canDoAggregates(e,t){await this._ensureLoaded();let r=!1;const n=this._layer.capabilities?.query,i=!0===n?.supportsSqlExpression;if(null!=n&&!0===n.supportsStatistics&&!0===n.supportsOrderBy&&(r=!0),r)for(let a=0;a<t.length-1;a++)(!1===t[a].workingexpr?.isStandardized||!1===(0,s.O)(t[a].workingexpr)&&!1===i)&&(r=!1);return!1!==r}_makeRelationshipEnum(e){if(e.includes("esriSpatialRelRelation"))return"relation";switch(e){case"esriSpatialRelRelation":return"relation";case"esriSpatialRelIntersects":return"intersects";case"esriSpatialRelContains":return"contains";case"esriSpatialRelOverlaps":return"overlaps";case"esriSpatialRelWithin":return"within";case"esriSpatialRelTouches":return"touches";case"esriSpatialRelCrosses":return"crosses";case"esriSpatialRelEnvelopeIntersects":return"envelope-intersects"}return e}_makeRelationshipParam(e){return e.includes("esriSpatialRelRelation")?e.split(":")[1]:""}async _getAggregatePagesDataSourceDefinition(e,t,r,n,i,a,l){await this._ensureLoaded();const o=await this.databaseType();let u="",c=!1,d=!1;null!==a&&this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsOrderBy&&(u=a.constructClause(),d=!0),this._layer.capabilities&&this._layer.capabilities.query&&!1===this._layer.capabilities.query.supportsPagination&&(d=!1,c=!0,u=this._layer.objectIdField);const h=[];for(let g=0;g<t.length;g++){const e=new y.m;e.onStatisticField=null!==t[g].workingexpr?(0,s.b)(t[g].workingexpr,o):"",e.outStatisticFieldName=t[g].field,e.statisticType=t[g].toStatisticsName(),h.push(e)}""===u&&(u=e.join(","));let p=this._maxQueryRate();const f=this._layer.capabilities?.query.maxRecordCount;null!=f&&f<p&&(p=f);const _=null===i?null===n?"1=1":"":(0,s.b)(i,o);return new s.t([],["GETPAGES"],d,{groupbypage:!0,spatialRel:this._makeRelationshipEnum(r),relationParam:this._makeRelationshipParam(r),outFields:["*"],useOIDpagination:c,generatedOid:l,resultRecordCount:p,resultOffset:0,groupByFieldsForStatistics:e,outStatistics:h,geometry:null===n?null:n,where:_,orderByFields:u,returnGeometry:!1,returnIdsOnly:!1,internal:{lastMaxId:-1,set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}})}async _getAgregagtePhysicalPage(e,t,r){let i=e.pagesDefinition.where;!0===e.pagesDefinition.useOIDpagination&&(i=(0,n.bt)(i,e.pagesDefinition.generatedOid+">"+e.pagesDefinition.internal.lastMaxId.toString()));const a=e.pagesDefinition.internal.lastRetrieved,l=a,o=e.pagesDefinition.internal.lastPage,u=this._createQuery();if(u.where=(0,n.bt)(u.where,i),u.spatialRelationship=e.pagesDefinition.spatialRel,u.relationParameter=e.pagesDefinition.relationParam,u.outFields=e.pagesDefinition.outFields,u.outStatistics=e.pagesDefinition.outStatistics,u.geometry=e.pagesDefinition.geometry,u.groupByFieldsForStatistics=e.pagesDefinition.groupByFieldsForStatistics,u.num=e.pagesDefinition.resultRecordCount,u.start=e.pagesDefinition.internal.lastPage,u.returnGeometry=e.pagesDefinition.returnGeometry,u.orderByFields=""!==e.pagesDefinition.orderByFields?e.pagesDefinition.orderByFields.split(","):null,this.isTable()&&u.geometry&&u.spatialRelationship)return[];const c=await this.executeQuery(u,"execute");if(this._checkCancelled(r),!c.hasOwnProperty("features"))throw new s.s(s.a.InvalidStatResponse);const d=[];if(e.pagesDefinition.internal.lastPage!==o)return[];c.features.length>0&&void 0===c.features[0].attributes[e.pagesDefinition.generatedOid]&&(e.pagesDefinition.generatedOid=e.pagesDefinition.generatedOid.toLowerCase());for(let n=0;n<c.features.length;n++)e.pagesDefinition.internal.set[l+n]=c.features[n].attributes[e.pagesDefinition.generatedOid];for(let s=0;s<c.features.length;s++)d.push(new n.b1({attributes:c.features[s].attributes,geometry:null}));return!0===e.pagesDefinition.useOIDpagination?0===c.features.length?e.pagesDefinition.internal.fullyResolved=!0:e.pagesDefinition.internal.lastMaxId=c.features[c.features.length-1].attributes[e.pagesDefinition.generatedOid]:(void 0===c.exceededTransferLimit&&c.features.length!==e.pagesDefinition.resultRecordCount||!1===c.exceededTransferLimit)&&(e.pagesDefinition.internal.fullyResolved=!0),e.pagesDefinition.internal.lastRetrieved=a+c.features.length,e.pagesDefinition.internal.lastPage+=e.pagesDefinition.resultRecordCount,d}static create(e,t,r,n,i){const s=new p["default"]({url:e,outFields:null===t?["*"]:t});return new O({layer:s,spatialReference:r,lrucache:n,interceptor:i})}relationshipMetaData(){return this._layer&&this._layer.source&&this._layer.source.sourceJSON?.relationships?this._layer.source.sourceJSON.relationships:[]}serviceUrl(){return(0,a.k)(this._layer.parsedUrl.path)}async queryAttachments(e,t,r,n,i){function s(e){const t=e.capabilities;return t?.data.supportsAttachment&&t?.operations.supportsQueryAttachments}const a=this._layer;if(s(a)){const s={objectIds:[e],returnMetadata:i};(t&&t>0||r&&r>0)&&(s.size=[t&&t>0?t:0,r&&r>0?r:t+1]),n&&n.length>0&&(s.attachmentTypes=n),this.featureSetQueryInterceptor&&this.featureSetQueryInterceptor.preLayerQueryCallback({layer:a,query:s,method:"attachments"});const l=await a.queryAttachments(new f.c(s)),o=[];return l&&l[e]&&l[e].forEach((t=>{const r=this._layer.parsedUrl.path+"/"+e.toString()+"/attachments/"+t.id.toString();let n=null;i&&t.exifInfo&&(n=h.N.convertJsonToArcade(t.exifInfo,"system",!0)),o.push(new h.h(t.id,t.name,t.contentType,t.size,r,n,t.keywords??null))})),o}return[]}async queryRelatedFeatures(e){const t={f:"json",relationshipId:e.relationshipId.toString(),definitionExpression:e.where,outFields:e.outFields?.join(","),returnGeometry:e.returnGeometry.toString()};void 0!==e.resultOffset&&null!==e.resultOffset&&(t.resultOffset=e.resultOffset.toString()),void 0!==e.resultRecordCount&&null!==e.resultRecordCount&&(t.resultRecordCount=e.resultRecordCount.toString()),e.orderByFields&&(t.orderByFields=e.orderByFields.join(",")),e.objectIds&&e.objectIds.length>0&&(t.objectIds=e.objectIds.join(",")),e.outSpatialReference&&(t.outSR=(0,n.bn)(e.outSpatialReference)),this.featureSetQueryInterceptor&&this.featureSetQueryInterceptor.preRequestCallback({layer:this._layer,queryPayload:t,method:"relatedrecords",url:this._layer.parsedUrl.path+"/queryRelatedRecords"});const r=await(0,n.U)(this._layer.parsedUrl.path+"/queryRelatedRecords",{responseType:"json",query:t});if(r.data){const e={},t=r.data;if(t?.relatedRecordGroups){const r=t.spatialReference;for(const i of t.relatedRecordGroups){const s=i.objectId,a=[];for(const e of i.relatedRecords){e.geometry&&(e.geometry.spatialReference=r);const t=new n.b1({geometry:e.geometry?(0,n.b3)(e.geometry):null,attributes:e.attributes});a.push(t)}e[s]={features:a,exceededTransferLimit:!0===t.exceededTransferLimit}}}return e}throw new s.s(s.a.InvalidRequest)}async getFeatureByObjectId(e,t){const r=this._createQuery();r.outFields=t,r.returnGeometry=!1,r.outSpatialReference=this.spatialReference,r.where=(0,n.bt)(r.where,this.objectIdField+"="+e.toString()),this.featureSetQueryInterceptor&&this.featureSetQueryInterceptor.preLayerQueryCallback({layer:this._layer,query:r,method:"execute"});const i=await this._layer.queryFeatures(r);return 1===i.features.length?i.features[0]:null}async getIdentityUser(){await this.load();const e=n.K?.findCredential(this._layer.url);return e?e.userId:null}async getOwningSystemUrl(){await this.load();const e=n.K?.findServerInfo(this._layer.url);if(e)return e.owningSystemUrl;let t=this._layer.url;const r=t.toLowerCase().indexOf("/rest/services");if(t=r>-1?t.slice(0,r):t,t){t+="/rest/info";try{const e=await(0,n.U)(t,{query:{f:"json"}});let r="";return e.data?.owningSystemUrl&&(r=e.data.owningSystemUrl),r}catch{return""}}return""}getDataSourceFeatureSet(){const e=new O({layer:this._layer,spatialReference:this.spatialReference??void 0,outFields:this._overrideFields??void 0,includeGeometry:!this._removeGeometry,lrucache:this.recentlyUsedQueries??void 0,interceptor:this.featureSetQueryInterceptor??void 0});return e._useDefinitionExpression=!1,e}get preferredTimeZone(){return this._layer.preferredTimeZone??null}get dateFieldsTimeZone(){return this._layer.dateFieldsTimeZone??null}get datesInUnknownTimezone(){return this._layer.datesInUnknownTimezone??!1}get editFieldsInfo(){return this._layer.editFieldsInfo??null}get timeInfo(){return this._layer.timeInfo??null}async getFeatureSetInfo(){if(this.fsetInfo)return this.fsetInfo;let e=null,t="serviceItemId"in this._layer?this._layer.serviceItemId:null;const r=this._layer.parsedUrl.path;if(r){const i=await(0,n.U)(r,{responseType:"json",query:{f:"json"}});e=i?.data?.name??null,t=i?.data?.serviceItemId??null}const i=this._layer.title&&null!==(this._layer.parent??null);return this.featureSetInfo={layerId:this._layer.layerId,layerName:""===e?null:e,itemId:""===t?null:t,serviceLayerUrl:""===r?null:r,webMapLayerId:i?this._layer.id??null:null,webMapLayerTitle:i?this._layer.title??null:null,className:null,objectClassId:null},this.fsetInfo}}class N extends s.C{constructor(e){super(e),this.declaredClass="esri.arcade.featureset.sources.FeatureLayerMemory",this._removeGeometry=!1,this._overrideFields=null,this._forceIsTable=!1,e.spatialReference&&(this.spatialReference=e.spatialReference),this._transparent=!0,this._maxProcessing=1e3,this._layer=e.layer,this._wset=null,!0===e.isTable&&(this._forceIsTable=!0),void 0!==e.outFields&&(this._overrideFields=e.outFields),void 0!==e.includeGeometry&&(this._removeGeometry=!1===e.includeGeometry)}_maxQueryRate(){return a.D}end(){return this._layer}optimisePagingFeatureQueries(){}async loadImpl(){return!0===this._layer.loaded?(this._initialiseFeatureSet(),this):(await this._layer.load(),this._initialiseFeatureSet(),this)}get gdbVersion(){return""}_initialiseFeatureSet(){if(null==this.spatialReference&&(this.spatialReference=this._layer.spatialReference),this.geometryType=this._layer.geometryType??"",this.fields=this._layer.fields.slice(),null!==this._overrideFields)if(1===this._overrideFields.length&&"*"===this._overrideFields[0])this._overrideFields=null;else{const e=[],t=[];for(const r of this.fields)if("oid"===r.type)e.push(r),t.push(r.name);else for(const n of this._overrideFields)if(n.toLowerCase()===r.name.toLowerCase()){e.push(r),t.push(r.name);break}this.fields=e,this._overrideFields=t}this.objectIdField=this._layer.objectIdField;for(const e of this.fields)"global-id"===e.type&&(this.globalIdField=e.name);this._databaseType=a.l.Standardised,this.hasZ=!0===this._layer?.capabilities?.data?.supportsZ,this.hasM=!0===this._layer?.capabilities?.data?.supportsM,this.subtypeField=("subtypeField"in this._layer?this._layer.subtypeField:null)??"",this.subtypes="subtypes"in this._layer?this._layer.subtypes:null,this.typeIdField=("typeIdField"in this._layer?this._layer.typeIdField:null)??"",this.types="types"in this._layer?this._layer.types:null}isTable(){return this._forceIsTable||"isTable"in this._layer&&this._layer.isTable||"table"===this._layer.type||!this._layer.geometryType}_isInFeatureSet(){return a.s.InFeatureSet}_candidateIdTransform(e){return e}async _getSet(e){if(null===this._wset){await this._ensureLoaded();const t=await this._getFilteredSet("",null,null,null,e);return this._wset=t,t}return this._wset}_changeFeature(e){const t={};for(const r of this.fields)t[r.name]=e.attributes[r.name];return new n.b1({geometry:!0===this._removeGeometry?null:e.geometry,attributes:t})}async _getFilteredSet(e,t,r,i,l){let o="",u=!1;if(null!==i&&(o=i.constructClause(),u=!0),this.isTable()&&t&&null!==e&&""!==e)return new s.t([],[],!0,null);const c=this._layer.createQuery();c.returnZ=this.hasZ,c.returnM=this.hasM,c.where=(0,n.bt)(c.where,null===r?null===t?"1=1":"":(0,s.b)(r,a.l.Standardised)),c.spatialRelationship=this._makeRelationshipEnum(e),c.outSpatialReference=this.spatialReference,c.orderByFields=""!==o?o.split(","):null,c.geometry=null===t?null:t,c.returnGeometry=!0,c.relationParameter=this._makeRelationshipParam(e);const d=await this._layer.queryFeatures(c);if(null===d)return new s.t([],[],u,null);this._checkCancelled(l);const h=[];return d.features.forEach((e=>{const t=e.attributes[this._layer.objectIdField];h.push(t),this._featureCache[t]=this._changeFeature(e)})),new s.t([],h,u,null)}_makeRelationshipEnum(e){if(e.includes("esriSpatialRelRelation"))return"relation";switch(e){case"esriSpatialRelRelation":return"relation";case"esriSpatialRelIntersects":return"intersects";case"esriSpatialRelContains":return"contains";case"esriSpatialRelOverlaps":return"overlaps";case"esriSpatialRelWithin":return"within";case"esriSpatialRelTouches":return"touches";case"esriSpatialRelCrosses":return"crosses";case"esriSpatialRelEnvelopeIntersects":return"envelope-intersects"}return e}_makeRelationshipParam(e){return e.includes("esriSpatialRelRelation")?e.split(":")[1]:""}async _queryAllFeatures(){if(this._wset)return this._wset;const e=new y.b;if(e.where="1=1",await this._ensureLoaded(),this._layer.source&&this._layer.source.items){const e=[];return this._layer.source.items.forEach((t=>{const r=t.attributes[this._layer.objectIdField];e.push(r),this._featureCache[r]=this._changeFeature(t)})),this._wset=new s.t([],e,!1,null),this._wset}e.returnZ=this.hasZ,e.returnM=this.hasM;const t=await this._layer.queryFeatures(e),r=[];return t.features.forEach((e=>{const t=e.attributes[this._layer.objectIdField];r.push(t),this._featureCache[t]=this._changeFeature(e)})),this._wset=new s.t([],r,!1,null),this._wset}async _getFeatures(e,t,r){const n=[];-1!==t&&void 0===this._featureCache[t]&&n.push(t);for(let i=e._lastFetchedIndex;i<e._known.length&&(e._lastFetchedIndex+=1,!(void 0===this._featureCache[e._known[i]]&&(e._known[i]!==t&&n.push(e._known[i]),n.length>r)));i++);if(0===n.length)return"success";throw new s.s(s.a.MissingFeatures)}async _refineSetBlock(e){return e}async _stat(){return{calculated:!1}}async _canDoAggregates(){return!1}relationshipMetaData(){return[]}static _cloneAttr(e){const t={};for(const r in e)t[r]=e[r];return t}nativeCapabilities(){return{title:this._layer.title??"",canQueryRelated:!1,source:this,capabilities:this._layer.capabilities,databaseType:this._databaseType,requestStandardised:!0}}static create(e,t){let r=e.layerDefinition.objectIdField;const i=e.layerDefinition.typeIdField??"",s=[];if(e.layerDefinition.types)for(const n of e.layerDefinition.types)s.push(_.n.fromJSON(n));let a=e.layerDefinition.geometryType;void 0===a&&(a=e.featureSet.geometryType||"");let l=e.featureSet.features;const o=t.toJSON();if(!r){let t=!1;for(const n of e.layerDefinition.fields)if("oid"===n.type||"esriFieldTypeOID"===n.type){r=n.name,t=!0;break}if(!1===t){let t="FID",n=!0,i=0;for(;n;){let r=!0;for(const n of e.layerDefinition.fields)if(n.name===t){r=!1;break}!0===r?n=!1:(i++,t="FID"+i.toString())}e.layerDefinition.fields.push({type:"esriFieldTypeOID",name:t,alias:t});const s=[];for(let r=0;r<l.length;r++)s.push({geometry:e.featureSet.features[r].geometry,attributes:e.featureSet.features[r].attributes?this._cloneAttr(e.featureSet.features[r].attributes):{}}),s[r].attributes[t]=r;l=s,r=t}}const u=[];for(const n of e.layerDefinition.fields)n instanceof c.y?u.push(n):u.push(c.y.fromJSON(n));let d=a;switch(d||(d=""),d){case"esriGeometryPoint":d="point";break;case"esriGeometryPolyline":d="polyline";break;case"esriGeometryPolygon":d="polygon";break;case"esriGeometryEnvelope":d="extent";break;case"esriGeometryMultipoint":d="multipoint";break;case"":case"esriGeometryNull":d="esriGeometryNull"}if("esriGeometryNull"!==d)for(const c of l)c.geometry&&!(c.geometry instanceof n.cH)&&(c.geometry.type=d,void 0===c.geometry.spatialReference&&(c.geometry.spatialReference=o));else for(const n of l)n.geometry&&(n.geometry=null);const h={outFields:["*"],source:l,fields:u,hasZ:!0===e?.layerDefinition?.hasZ||!0===e?.featureSet?.hasZ,hasM:!0===e?.layerDefinition?.hasM||!0===e?.featureSet?.hasM,types:s,typeIdField:i,objectIdField:r,spatialReference:t},f="esriGeometryNull"===d||null===d;f||(h.geometryType=d);const y=new p["default"](h);return e?.layerDefinition?.subtypeField&&e?.layerDefinition?.subtypes&&y.read({subtypes:e.layerDefinition.subtypes,subtypeField:e.layerDefinition.subtypeField}),new N({layer:y,spatialReference:t,isTable:f})}async queryAttachments(){return[]}async getFeatureByObjectId(e){const t=new y.b;t.where=this.objectIdField+"="+e.toString(),t.returnZ=this.hasZ,t.returnM=this.hasM;const r=await this._layer.queryFeatures(t);return 1===r.features.length?r.features[0]:null}async getOwningSystemUrl(){return""}async getIdentityUser(){return""}get preferredTimeZone(){return"preferredTimeZone"in this._layer?this._layer.preferredTimeZone:null}get dateFieldsTimeZone(){return"dateFieldsTimeZone"in this._layer?this._layer.dateFieldsTimeZone:null}get datesInUnknownTimezone(){return"datesInUnknownTimezone"in this._layer&&this._layer.datesInUnknownTimezone}get editFieldsInfo(){return"editFieldsInfo"in this._layer?this._layer.editFieldsInfo:null}get timeInfo(){return this._layer?.timeInfo}async getFeatureSetInfo(){const e=this._layer.title&&this._layer.parent;return this.fsetInfo??{layerId:null,layerName:null,itemId:null,serviceLayerUrl:null,webMapLayerId:e?this._layer.id??null:null,webMapLayerTitle:e?this._layer.title??null:null,className:null,objectClassId:null}}}class D extends s.C{constructor(e){super(e),this.declaredClass="esri.arcade.featureset.sources.FeatureLayerRelated",this._findObjectId=-1,this._requestStandardised=!1,this._removeGeometry=!1,this._overrideFields=null,this.featureObjectId=null,e.spatialReference&&(this.spatialReference=e.spatialReference),this._transparent=!0,this._maxProcessing=1e3,this._layer=e.layer,this._wset=null,this._findObjectId=e.objectId,this.featureObjectId=e.objectId,this.relationship=e.relationship,this._relatedLayer=e.relatedLayer,void 0!==e.outFields&&(this._overrideFields=e.outFields),void 0!==e.includeGeometry&&(this._removeGeometry=!1===e.includeGeometry)}_maxQueryRate(){return a.D}end(){return this._layer}optimisePagingFeatureQueries(){}async loadImpl(){return await Promise.all([this._layer.load(),this._relatedLayer?.load()]),this._initialiseFeatureSet(),this}nativeCapabilities(){return this._relatedLayer.nativeCapabilities()}_initialiseFeatureSet(){if(null==this.spatialReference&&(this.spatialReference=this._layer.spatialReference),this.geometryType=this._relatedLayer.geometryType,this.fields=this._relatedLayer.fields.slice(),this.hasZ=this._relatedLayer.hasZ,this.hasM=this._relatedLayer.hasM,null!==this._overrideFields)if(1===this._overrideFields.length&&"*"===this._overrideFields[0])this._overrideFields=null;else{const e=[],t=[];for(const r of this.fields)if("oid"===r.type)e.push(r),t.push(r.name);else for(const n of this._overrideFields)if(n.toLowerCase()===r.name.toLowerCase()){e.push(r),t.push(r.name);break}this.fields=e,this._overrideFields=t}const e=this._layer.nativeCapabilities();e&&(this._databaseType=e.databaseType,this._requestStandardised=e.requestStandardised),this.objectIdField=this._relatedLayer.objectIdField,this.globalIdField=this._relatedLayer.globalIdField,this.hasM=this._relatedLayer.supportsM,this.hasZ=this._relatedLayer.supportsZ,this.typeIdField=this._relatedLayer.typeIdField,this.types=this._relatedLayer.types,this.subtypeField=this._relatedLayer.subtypeField,this.subtypes=this._relatedLayer.subtypes}async databaseType(){return await this._relatedLayer.databaseType(),this._databaseType=this._relatedLayer._databaseType,this._databaseType}isTable(){return this._relatedLayer.isTable()}_isInFeatureSet(){return a.s.InFeatureSet}_candidateIdTransform(e){return e}async _getSet(e){if(null===this._wset){await this._ensureLoaded();const t=await this._getFilteredSet("",null,null,null,e);return this._wset=t,t}return this._wset}_changeFeature(e){const t={};for(const r of this.fields)t[r.name]=e.attributes[r.name];return new n.b1({geometry:!0===this._removeGeometry?null:e.geometry,attributes:t})}async _getFilteredSet(e,t,r,n,i){if(await this.databaseType(),this.isTable()&&t&&null!==e&&""!==e)return new s.t([],[],!0,null);const a=this._layer.nativeCapabilities();if(!1===a.canQueryRelated)return new s.t([],[],!0,null);if(a.capabilities?.queryRelated.supportsPagination)return this._getFilteredSetUsingPaging(e,t,r,n,i);let l="",o=!1;null!==n&&!0===a.capabilities?.queryRelated.supportsOrderBy&&(l=n.constructClause(),o=!0);const u=new f.d;u.objectIds=[this._findObjectId];const c=null!==this._overrideFields?this._overrideFields:this._fieldsIncludingObjectId(this._relatedLayer.fields?this._relatedLayer.fields.map((e=>e.name)):["*"]);u.outFields=c,u.relationshipId=this.relationship.id,u.where="1=1";let d=!0;!0===this._removeGeometry&&(d=!1),u.returnGeometry=d,this._requestStandardised&&(u.sqlFormat="standard"),u.outSpatialReference=this.spatialReference,u.orderByFields=""!==l?l.split(","):null;const h=await a.source.queryRelatedFeatures(u);this._checkCancelled(i);const p=h[this._findObjectId]?h[this._findObjectId].features:[],y=[];for(let s=0;s<p.length;s++)this._featureCache[p[s].attributes[this._relatedLayer.objectIdField]]=p[s],y.push(p[s].attributes[this._relatedLayer.objectIdField]);const _=t&&null!==e&&""!==e,g=null!=r;return new s.t(_||g?y:[],_||g?[]:y,o,null)}_fieldsIncludingObjectId(e){if(null===e)return[this.objectIdField];const t=e.slice();if(t.includes("*"))return t;let r=!1;for(const n of t)if(n.toUpperCase()===this.objectIdField.toUpperCase()){r=!0;break}return!1===r&&t.push(this.objectIdField),t}async _getFilteredSetUsingPaging(e,t,r,n,i){let a="",l=!1;const o=this._layer.nativeCapabilities();null!==n&&!0===o.capabilities?.queryRelated.supportsOrderBy&&(a=n.constructClause(),l=!0),await this.databaseType();const u="1=1";let c=this._maxQueryRate();const d=o.capabilities?.query.maxRecordCount;null!=d&&d<c&&(c=d);const h=t&&null!==e&&""!==e,p=null!=r;let f=null,y=!0;!0===this._removeGeometry&&(y=!1);const _=null!==this._overrideFields?this._overrideFields:this._fieldsIncludingObjectId(this._relatedLayer.fields?this._relatedLayer.fields.map((e=>e.name)):["*"]);return f=new s.t(h||p?["GETPAGES"]:[],h||p?[]:["GETPAGES"],l,{outFields:_.join(","),resultRecordCount:c,resultOffset:0,objectIds:[this._findObjectId],where:u,orderByFields:a,returnGeometry:y,returnIdsOnly:"false",internal:{set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}}),await this._expandPagedSet(f,c,0,0,i),f}_expandPagedSet(e,t,r,n,i){return this._expandPagedSetFeatureSet(e,t,r,n,i)}_clonePageDefinition(e){return null===e?null:!0!==e.groupbypage?{groupbypage:!1,outFields:e.outFields,resultRecordCount:e.resultRecordCount,resultOffset:e.resultOffset,where:e.where,objectIds:e.objectIds,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}:{groupbypage:!0,outFields:e.outFields,resultRecordCount:e.resultRecordCount,useOIDpagination:e.useOIDpagination,generatedOid:e.generatedOid,groupByFieldsForStatistics:e.groupByFieldsForStatistics,resultOffset:e.resultOffset,outStatistics:e.outStatistics,geometry:e.geometry,where:e.where,objectIds:e.objectIds,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}}async _getPhysicalPage(e,t,r){const n=e.pagesDefinition.internal.lastRetrieved,i=n,s=e.pagesDefinition.internal.lastPage,a=this._layer.nativeCapabilities(),l=new f.d;!0===this._requestStandardised&&(l.sqlFormat="standard"),l.relationshipId=this.relationship.id,l.objectIds=e.pagesDefinition.objectIds,l.resultOffset=e.pagesDefinition.internal.lastPage,l.resultRecordCount=e.pagesDefinition.resultRecordCount,l.outFields=e.pagesDefinition.outFields.split(","),l.where=e.pagesDefinition.where,l.orderByFields=""!==e.pagesDefinition.orderByFields?e.pagesDefinition.orderByFields.split(","):null,l.returnGeometry=e.pagesDefinition.returnGeometry,l.outSpatialReference=this.spatialReference;const o=await a.source.queryRelatedFeatures(l);if(this._checkCancelled(r),e.pagesDefinition.internal.lastPage!==s)return 0;const u=o[this._findObjectId]?o[this._findObjectId].features:[];for(let d=0;d<u.length;d++)e.pagesDefinition.internal.set[i+d]=u[d].attributes[this._relatedLayer.objectIdField];for(let d=0;d<u.length;d++)this._featureCache[u[d].attributes[this._relatedLayer.objectIdField]]=u[d];const c=!o[this._findObjectId]||!1===o[this._findObjectId].exceededTransferLimit;return u.length!==e.pagesDefinition.resultRecordCount&&c&&(e.pagesDefinition.internal.fullyResolved=!0),e.pagesDefinition.internal.lastRetrieved=n+u.length,e.pagesDefinition.internal.lastPage+=e.pagesDefinition.resultRecordCount,u.length}async _getFeatures(e,t,r,n){const i=[];-1!==t&&void 0===this._featureCache[t]&&i.push(t);const a=this._maxQueryRate();if(!0===this._checkIfNeedToExpandKnownPage(e,a))return await this._expandPagedSet(e,a,0,0,n),this._getFeatures(e,t,r,n);let l=0;for(let s=e._lastFetchedIndex;s<e._known.length&&(l++,l<=r&&(e._lastFetchedIndex+=1),!("GETPAGES"!==e._known[s]&&void 0===this._featureCache[e._known[s]]&&(e._known[s]!==t&&i.push(e._known[s]),i.length>r)))&&!(l>=r&&0===i.length);s++);if(0===i.length)return"success";throw new s.s(s.a.MissingFeatures)}async _refineSetBlock(e,t,r){return e}async _stat(e,t,r,n,i,s,a){return{calculated:!1}}get gdbVersion(){return this._relatedLayer.gdbVersion}async _canDoAggregates(e,t,r,n,i){return!1}relationshipMetaData(){return this._relatedLayer.relationshipMetaData()}serviceUrl(){return this._relatedLayer.serviceUrl()}queryAttachments(e,t,r,n,i){return this._relatedLayer.queryAttachments(e,t,r,n,i)}getFeatureByObjectId(e,t){return this._relatedLayer.getFeatureByObjectId(e,t)}getOwningSystemUrl(){return this._relatedLayer.getOwningSystemUrl()}getIdentityUser(){return this._relatedLayer.getIdentityUser()}getDataSourceFeatureSet(){return this._relatedLayer}get preferredTimeZone(){return this._relatedLayer?.preferredTimeZone??null}get dateFieldsTimeZone(){return this._relatedLayer?.dateFieldsTimeZone??null}get datesInUnknownTimezone(){return this._relatedLayer?.datesInUnknownTimezone}get editFieldsInfo(){return this._relatedLayer?.editFieldsInfo??null}get timeInfo(){return this._relatedLayer?.timeInfo??null}async getFeatureSetInfo(){return this.fsetInfo??this._layer.featureSetInfo}}function G(){null===s.d.applicationCache&&(s.d.applicationCache=new s.d)}async function j(e,t,r){if(s.d.applicationCache){const r=s.d.applicationCache.getLayerInfo(e);if(r){const n=await r;return new p["default"]({url:e,outFields:t,sourceJSON:n})}const i=new p["default"]({url:e,outFields:t}),a=(async()=>(await i.load(),i.sourceJSON))();if(s.d.applicationCache){s.d.applicationCache.setLayerInfo(e,a);try{return await a,i}catch(n){throw s.d.applicationCache.clearLayerInfo(e),n}}return await a,i}if(null!=r){const i=r.getCachedLayerMetadata(e);if(i){const r=await i;return new p["default"]({url:e,outFields:t,sourceJSON:r})}const s=new p["default"]({url:e,outFields:t}),a=(async()=>(await s.load(),s.sourceJSON))();r.setCachedLayerMetadata(e,a);try{return await a,s}catch(n){throw r.removeCachedLayerMetadata(e,a),n}}return new p["default"]({url:e,outFields:t})}async function U(e,t,r,n,i,s=null){return B(await j(e,["*"],i),t,r,n,i,s)}function B(e,t=null,r=null,n=!0,i=null,s=null){switch(e.type){case"catalog-footprint":return B(e.parent,t,r,n,i,s);case"subtype-sublayer":{const a=B(e.parent,t,r,n,i,s);return a.filter(l.Z.create(e.parent.subtypeField+"="+e.subtypeCode.toString(),{fieldsIndex:e.parent.fieldsIndex,timeZone:a.dateFieldsTimeZoneDefaultUTC}))}case"csv":case"geojson":case"wfs":return new N({layer:e,spatialReference:t,outFields:r,includeGeometry:n,lrucache:i,interceptor:s});case"catalog":case"feature":case"oriented-imagery":case"subtype-group":{const a={layer:e,spatialReference:t,outFields:r,includeGeometry:n,lrucache:i,interceptor:s};return!e.url&&e.source?new N(a):new O(a)}default:throw new Error(`Unsupported layer type: ${e.type}`)}}async function q(e){if(null!==s.d.applicationCache){const t=s.d.applicationCache.getLayerInfo(e);if(null!==t)return t}const t=(async()=>{const t=await(0,n.U)(e,{responseType:"json",query:{f:"json"}});return t.data?t.data:null})();if(null!==s.d.applicationCache){s.d.applicationCache.setLayerInfo(e,t);try{return await t}catch(r){throw s.d.applicationCache.clearLayerInfo(e),r}}return t}async function W(e,t){const r="QUERYDATAELEMTS:"+t.toString()+":"+e;if(null!==s.d.applicationCache){const e=s.d.applicationCache.getLayerInfo(r);if(null!==e)return e}const i=(async()=>{const r=await(0,n.U)(e+"/queryDataElements",{method:"post",responseType:"json",query:{layers:JSON.stringify([t.toString()]),f:"json"}});if(r.data){const e=r.data;if(e.layerDataElements?.[0])return e.layerDataElements[0]}throw new s.s(s.a.DataElementsNotFound)})();if(null!==s.d.applicationCache){s.d.applicationCache.setLayerInfo(r,i);try{return await i}catch(a){throw s.d.applicationCache.clearLayerInfo(r),a}}return i}async function z(e,t){if(null!==s.d.applicationCache){const t=s.d.applicationCache.getLayerInfo(e);if(null!==t)return t}if(null!=t){const r=t.getCachedServiceMetadata(e);if(null!=r)return r}const r=(async()=>{const t=await(0,n.U)(e,{responseType:"json",query:{f:"json"}});if(t.data){const e=t.data;return e.layers||(e.layers=[]),e.tables||(e.tables=[]),e}return{layers:[],tables:[]}})();if(null!==s.d.applicationCache){s.d.applicationCache.setLayerInfo(e,r);try{return await r}catch(i){throw s.d.applicationCache.clearLayerInfo(e),i}}if(null!=t){t.setCachedServiceMetadata(e,r);try{return await r}catch(i){throw t.removeCachedServiceMetadata(e,r),i}}return r}async function Q(e,t){const r={metadata:null,networkId:-1,unVersion:3,terminals:[],queryelem:null,layerNameLkp:{},lkp:null},n=await z(e,null);if(r.metadata=n,void 0!==n.controllerDatasetLayers?.utilityNetworkLayerId&&null!==n.controllerDatasetLayers.utilityNetworkLayerId){if(n.layers)for(const e of n.layers)r.layerNameLkp[e.id]=e.name;if(n.tables)for(const e of n.tables)r.layerNameLkp[e.id]=e.name;const i=n.controllerDatasetLayers.utilityNetworkLayerId;r.networkId=i;const s=await W(e,i);if(s){r.queryelem=s,r.queryelem?.dataElement&&void 0!==r.queryelem.dataElement.schemaGeneration&&(r.unVersion=r.queryelem.dataElement.schemaGeneration),r.lkp={},r.queryelem.dataElement.domainNetworks||(r.queryelem.dataElement.domainNetworks=[]);for(const e of r.queryelem.dataElement.domainNetworks){for(const t of e.edgeSources??[]){const e={layerId:t.layerId,sourceId:t.sourceId,className:r.layerNameLkp[t.layerId]??null};e.className&&(r.lkp[e.className]=e)}for(const t of e.junctionSources??[]){const e={layerId:t.layerId,sourceId:t.sourceId,className:r.layerNameLkp[t.layerId]??null};e.className&&(r.lkp[e.className]=e)}}if(r.queryelem.dataElement.terminalConfigurations)for(const e of r.queryelem.dataElement.terminalConfigurations)for(const t of e.terminals)r.terminals.push({terminalId:t.terminalId,terminalName:t.terminalName});const n=await q(e+"/"+i);if(void 0!==n.systemLayers?.associationsTableId&&null!==n.systemLayers.associationsTableId){const i=[];r.unVersion>=4&&(i.push("STATUS"),i.push("PERCENTALONG"));let s=await U(e+"/"+n.systemLayers.associationsTableId.toString(),t,["OBJECTID","FROMNETWORKSOURCEID","TONETWORKSOURCEID","FROMGLOBALID","TOGLOBALID","TOTERMINALID","FROMTERMINALID","ASSOCIATIONTYPE","ISCONTENTVISIBLE","GLOBALID",...i],!1,null,null);return await s.load(),r.unVersion>=4&&(s=s.filter(l.Z.create("STATUS NOT IN (1, 2, 3, 4, 5, 6, 7, 9, 10, 11, 12, 13, 14, 15, 17, 18, 19, 20, 21, 22, 23, 25, 26, 27, 28, 29, 30, 31, 33, 34, 35, 36, 37, 38, 39, 41, 42, 43, 44, 45, 46, 47, 49, 50, 51, 52, 53, 54, 55, 57, 58, 59, 60, 61, 62, 63)",{fieldsIndex:s.getFieldsIndex(),timeZone:s.dateFieldsTimeZoneDefaultUTC})),await s.load()),{lkp:r.lkp,associations:s,unVersion:r.unVersion,terminals:r.terminals}}return{associations:null,unVersion:r.unVersion,lkp:null,terminals:[]}}return{associations:null,unVersion:r.unVersion,lkp:null,terminals:[]}}return{associations:null,unVersion:r.unVersion,lkp:null,terminals:[]}}async function H(e,t,r,n=null,i=null,s=!0,a=null,l=null){let o=e.serviceUrl();if(!o)return null;o="/"===o.charAt(o.length-1)?o+t.relatedTableId.toString():o+"/"+t.relatedTableId.toString();const u=await U(o,n,i,s,a,l);return new D({layer:e,relatedLayer:u,relationship:t,objectId:r,spatialReference:n,outFields:i,includeGeometry:s,lrucache:a,interceptor:l})}S.registerAction(),k.registerAction(),T.registerAction(),s.f.registerAction(),L.registerAction();class Z extends w{constructor(e,t=null,r=null,n=null){super(),this._map=e,this._overrideSpatialReference=t,this._lrucache=r,this._interceptor=n,this._instantLayers=[]}_makeAndAddFeatureSet(e,t=!0,r=null){const n=B(e,this._overrideSpatialReference,null===r?["*"]:r,t,this._lrucache,this._interceptor);return this._instantLayers.push({featureset:n,opitem:e,includeGeometry:t,outFields:JSON.stringify(r)}),n}async featureSetByName(e,t=!0,r=null){if(n.e.isLoadable(this._map)&&!this._map.loaded)return await this._map.load(),this.featureSetByName(e,t,r);null===r&&(r=["*"]),r=(r=r.slice()).sort();const i=JSON.stringify(r);for(let n=0;n<this._instantLayers.length;n++){const r=this._instantLayers[n];if(r.opitem.title===e&&r.includeGeometry===t&&r.outFields===i)return this._instantLayers[n].featureset}const s=this._map.allLayers.find((t=>(0,a.j)(t)&&t.title===e));if(null!=s)return this._makeAndAddFeatureSet(s,t,r);if(this._map.tables){const n=this._map.tables.find((t=>t.title===e));if(null!=n){if(n instanceof p["default"])return this._makeAndAddFeatureSet(n,t,r);if(null==n._materializedTable){const e=n.outFields?n:{...n,outFields:["*"]};n._materializedTable=new p["default"](e)}return await n._materializedTable.load(),this._makeAndAddFeatureSet(n._materializedTable,t,r)}}return null}async featureSetById(e,t=!0,r=["*"]){if(n.e.isLoadable(this._map)&&!this._map.loaded)return await this._map.load(),this.featureSetById(e,t,r);null===r&&(r=["*"]),r=(r=r.slice()).sort();const i=JSON.stringify(r);for(let n=0;n<this._instantLayers.length;n++){const r=this._instantLayers[n];if(r.opitem.id===e&&r.includeGeometry===t&&r.outFields===i)return this._instantLayers[n].featureset}const s=this._map.allLayers.find((t=>(0,a.j)(t)&&t.id===e));if(s)return this._makeAndAddFeatureSet(s,t,r);if(this._map.tables){const n=this._map.tables.find((t=>t.id===e));if(null!=n){if(n instanceof p["default"])return this._makeAndAddFeatureSet(n,t,r);if(null==n._materializedTable){const e={...n,outFields:["*"]};n._materializedTable=new p["default"](e)}return await n._materializedTable.load(),this._makeAndAddFeatureSet(n._materializedTable,t,r)}}return null}}class V extends w{constructor(e,t=null,r=null,n=null){super(),this._url=e,this._overrideSpatialReference=t,this._lrucache=r,this._interceptor=n,this.metadata=null,this._instantLayers=[]}get url(){return this._url}_makeAndAddFeatureSet(e,t=!0,r=null){const n=B(e,this._overrideSpatialReference,null===r?["*"]:r,t,this._lrucache);return this._instantLayers.push({featureset:n,opitem:e,includeGeometry:t,outFields:JSON.stringify(r)}),n}async _loadMetaData(){const e=await z(this._url,this._lrucache);return this.metadata=e,e}load(){return this._loadMetaData()}clone(){return new V(this._url,this._overrideSpatialReference,this._lrucache,this._interceptor)}async featureSetByName(e,t=!0,r=null){null===r&&(r=["*"]),r=(r=r.slice()).sort();const n=JSON.stringify(r);for(let a=0;a<this._instantLayers.length;a++){const r=this._instantLayers[a];if(r.opitem.title===e&&r.includeGeometry===t&&r.outFields===n)return this._instantLayers[a].featureset}const i=await this._loadMetaData();let s=null;for(const a of i.layers??[])a.name===e&&(s=a);if(!s)for(const a of i.tables??[])a.name===e&&(s=a);if(s){const e=await j(this._url+"/"+s.id,["*"],this._lrucache);return this._makeAndAddFeatureSet(e,t,r)}return null}async featureSetById(e,t=!0,r=["*"]){null===r&&(r=["*"]),r=(r=r.slice()).sort();const n=JSON.stringify(r);e=null!=e?e.toString():"";for(let a=0;a<this._instantLayers.length;a++){const r=this._instantLayers[a];if(r.opitem.id===e&&r.includeGeometry===t&&r.outFields===n)return this._instantLayers[a].featureset}const i=await this._loadMetaData();let s=null;for(const a of i.layers??[])null!==a.id&&void 0!==a.id&&a.id.toString()===e&&(s=a);if(!s)for(const a of i.tables??[])null!==a.id&&void 0!==a.id&&a.id.toString()===e&&(s=a);if(s){const e=await j(this._url+"/"+s.id,["*"],this._lrucache);return this._makeAndAddFeatureSet(e,t,r)}return null}}function K(e,t,r=null,n=null){return new Z(e,t,r,n)}function $(e,t,r=null,n=null){return new V(e,t,r,n)}function J(e,t,r,n,s){if(null===e)return null;if((0,i.K)(e)){switch(t){case"datasource":return e.getDataSourceFeatureSet();case"parent":return e;case"root":return e.getRootFeatureSet()}return null}if(e instanceof g.f&&(0,a.M)(e)){const i=e;switch(t){case"datasource":return B(i,s,i.outFields,!0,r,n).getDataSourceFeatureSet();case"parent":case"root":return B(i,s,i.outFields,!0,r,n)}return null}if((0,i.a4)(e)){switch(t){case"datasource":return B(e.parent,s,e.parent.outFields,!0,r,n).getDataSourceFeatureSet();case"parent":case"root":return B(e,s,e.parent.outFields,!0,r,n)}return null}return null}async function Y(e,t,r,n,i,a,l,o=null){if(s.d.applicationCache){const u=s.d.applicationCache.getLayerInfo(e+":"+a.url);if(u)return X(await u,t,r,n,i,l,o)}if(null!=l){const s=l.getCachedPortalItem(a.url,e);if(null!=s)return await X(await s,t,r,n,i,l,o)}const u=new m["default"]({id:e,portal:a}).load();s.d.applicationCache?s.d.applicationCache.setLayerInfo(e+":"+a.url,u):l?.setCachedPortalItem(a.url,e,u);try{return await X(await u,t,r,n,i,l,o)}catch(c){throw s.d.applicationCache&&s.d.applicationCache.clearLayerInfo(e+":"+a.url),l?.removeCachedPortalItem(a.url,e,u),c}}async function X(e,t,r,n,i,s,l){let o;if("Feature Service"===e.type||"Map Service"===e.type)o=await j((0,a.k)(e.url??"")+"/"+t,["*"],s);else{if(t)throw new Error(`layerId=${t} provided for ${e.type} item`);if(null!=s){const t=s.getCachedPortalItemLayer(e.portal.url,e.id);if(null!=t)o=await t;else{const t=g.f.fromPortalItem(e);s.setCachedPortalItemLayer(e.portal.url,e.id,t);try{o=await t}catch(u){throw s.removeCachedPortalItemLayer(e.portal.url,e.id,t),u}}}else o=await g.f.fromPortalItem(e)}return B(o,r,n,i,s,l)}const ee=Object.freeze(Object.defineProperty({__proto__:null,constructAssociationMetaDataFeatureSetFromUrl:Q,constructFeatureSet:B,constructFeatureSetFromPortalItem:Y,constructFeatureSetFromRelationship:H,constructFeatureSetFromUrl:U,convertToFeatureSet:J,createFeatureSetCollectionFromMap:K,createFeatureSetCollectionFromService:$,initialiseMetaDataCache:G},Symbol.toStringTag,{value:"Module"}))},35513:function(e,t,r){r.d(t,{a:function(){return o},c:function(){return a},e:function(){return l},f:function(){return c},l:function(){return d},u:function(){return h}});var n=r(98503),i=r(90211),s=r(83448);const a=2.4;function l(e){return(0,n.bd)(e*a)}function o(e){return(0,n.be)(e)/a}function u(e,t,r,s){let{color:a,ratio:l}=t,{color:o,ratio:u}=r;u===l&&(1===u?l-=1e-6:u+=1e-6);const c=(0,n.aP)((s-l)/(u-l),0,1);(0,i._)(e,a.toArray(),o.toArray(),c)}function c(e){const t=new Uint8ClampedArray(2048);if(e=e.filter((({ratio:e})=>e>=0&&e<=1)).sort(((e,t)=>e.ratio-t.ratio)).map((({color:e,ratio:t})=>({color:e,ratio:Math.max(t,.001)}))),e.length<1)return t;let r=e[0],n=e[0],i=1;const a=(0,s.n)();for(let s=0;s<512;s++){const l=(s+.5)/512;for(;l>n.ratio&&i<e.length;)r=n,n=e[i++];u(a,r,n,l),t.set(a,4*s)}return t}function d(e,t,r){const n=Math.sqrt(e**2+t**2)/r;return n>1?0:3/(Math.PI*r**2)*(1-n**2)**2}function h(e){return"function"==typeof e?e:e?t=>+t[e]:()=>1}},68116:function(e,t,r){r.d(t,{E:function(){return m},_:function(){return C},f:function(){return _},g:function(){return g},p:function(){return p},u:function(){return f},x:function(){return y}});var n=r(98503);const i="__begin__",s="__end__",a=new RegExp(i,"ig"),l=new RegExp(s,"ig"),o=new RegExp("^"+i,"i"),u=new RegExp(s+"$","i"),c='"',d=c+" + ",h=" + "+c;function p(e){return e.replaceAll(new RegExp("\\[","g"),"{").replaceAll(new RegExp("\\]","g"),"}")}function f(e){return e.replaceAll(new RegExp("\\{","g"),"[").replaceAll(new RegExp("\\}","g"),"]")}function y(e){const t={expression:"",type:"none"};return e.labelExpressionInfo?e.labelExpressionInfo.value?(t.expression=e.labelExpressionInfo.value,t.type="conventional"):e.labelExpressionInfo.expression&&(t.expression=e.labelExpressionInfo.expression,t.type="arcade"):null!=e.labelExpression&&(t.expression=p(e.labelExpression),t.type="conventional"),t}function _(e){const t=y(e);if(!t)return null;switch(t.type){case"conventional":return m(t.expression);case"arcade":return t.expression}return null}function g(e){const t=y(e);if(!t)return null;switch(t.type){case"conventional":return S(t.expression);case"arcade":return C(t.expression)}return null}function m(e){let t;return e?(t=(0,n.r)(e,(e=>i+'$feature["'+e+'"]'+s)),t=o.test(t)?t.replace(o,""):c+t,t=u.test(t)?t.replace(u,""):t+c,t=t.replaceAll(a,d).replaceAll(l,h)):t='""',t}const w=/^\s*\{([^}]+)\}\s*$/i;function S(e){return e?.match(w)?.[1].trim()||null}const b=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])(.+)(\2)\]));?\s*$/i,F=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])(.+)(\2)\]));?\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(\1|\3)(\5)\s*\));?\s*$/i,I=/^\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(.+)(\1)\s*\));?\s*$/i;function C(e){if(!e)return null;let t=b.exec(e)||F.exec(e);return t?t[1]||t[3]:(t=I.exec(e),t?t[2]:null)}},74362:function(e,t,r){r.d(t,{A:function(){return O},B:function(){return Z},C:function(){return V},D:function(){return k},G:function(){return K},H:function(){return $},I:function(){return T},O:function(){return x},P:function(){return P},X:function(){return j},b:function(){return _},c:function(){return p},f:function(){return y},g:function(){return I},h:function(){return c},i:function(){return f},j:function(){return M},n:function(){return s},o:function(){return l},p:function(){return F},q:function(){return S},r:function(){return a},s:function(){return o}});var n=r(98503),i=r(25209);function s(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function a(e,t,r,n,i,s,a,l,o,u,c,d,h,p,f,y,_){return e[0]=t,e[1]=r,e[2]=n,e[3]=i,e[4]=s,e[5]=a,e[6]=l,e[7]=o,e[8]=u,e[9]=c,e[10]=d,e[11]=h,e[12]=p,e[13]=f,e[14]=y,e[15]=_,e}function l(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function o(e,t){if(e===t){const r=t[1],n=t[2],i=t[3],s=t[6],a=t[7],l=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=n,e[9]=s,e[11]=t[14],e[12]=i,e[13]=a,e[14]=l}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function u(e,t){return c(e,t)||l(e),e}function c(e,t){const r=t[0],n=t[1],i=t[2],s=t[3],a=t[4],l=t[5],o=t[6],u=t[7],c=t[8],d=t[9],h=t[10],p=t[11],f=t[12],y=t[13],_=t[14],g=t[15],m=r*l-n*a,w=r*o-i*a,S=r*u-s*a,b=n*o-i*l,F=n*u-s*l,I=i*u-s*o,C=c*y-d*f,v=c*_-h*f,R=c*g-p*f,E=d*_-h*y,A=d*g-p*y,T=h*g-p*_;let x=m*T-w*A+S*E+b*R-F*v+I*C;return x?(x=1/x,e[0]=(l*T-o*A+u*E)*x,e[1]=(i*A-n*T-s*E)*x,e[2]=(y*I-_*F+g*b)*x,e[3]=(h*F-d*I-p*b)*x,e[4]=(o*R-a*T-u*v)*x,e[5]=(r*T-i*R+s*v)*x,e[6]=(_*S-f*I-g*w)*x,e[7]=(c*I-h*S+p*w)*x,e[8]=(a*A-l*R+u*C)*x,e[9]=(n*R-r*A-s*C)*x,e[10]=(f*F-y*S+g*m)*x,e[11]=(d*S-c*F-p*m)*x,e[12]=(l*v-a*E-o*C)*x,e[13]=(r*E-n*v+i*C)*x,e[14]=(y*w-f*b-_*m)*x,e[15]=(c*b-d*w+h*m)*x,e):null}function d(e,t){const r=t[0],n=t[1],i=t[2],s=t[3],a=t[4],l=t[5],o=t[6],u=t[7],c=t[8],d=t[9],h=t[10],p=t[11],f=t[12],y=t[13],_=t[14],g=t[15];return e[0]=l*(h*g-p*_)-d*(o*g-u*_)+y*(o*p-u*h),e[1]=-(n*(h*g-p*_)-d*(i*g-s*_)+y*(i*p-s*h)),e[2]=n*(o*g-u*_)-l*(i*g-s*_)+y*(i*u-s*o),e[3]=-(n*(o*p-u*h)-l*(i*p-s*h)+d*(i*u-s*o)),e[4]=-(a*(h*g-p*_)-c*(o*g-u*_)+f*(o*p-u*h)),e[5]=r*(h*g-p*_)-c*(i*g-s*_)+f*(i*p-s*h),e[6]=-(r*(o*g-u*_)-a*(i*g-s*_)+f*(i*u-s*o)),e[7]=r*(o*p-u*h)-a*(i*p-s*h)+c*(i*u-s*o),e[8]=a*(d*g-p*y)-c*(l*g-u*y)+f*(l*p-u*d),e[9]=-(r*(d*g-p*y)-c*(n*g-s*y)+f*(n*p-s*d)),e[10]=r*(l*g-u*y)-a*(n*g-s*y)+f*(n*u-s*l),e[11]=-(r*(l*p-u*d)-a*(n*p-s*d)+c*(n*u-s*l)),e[12]=-(a*(d*_-h*y)-c*(l*_-o*y)+f*(l*h-o*d)),e[13]=r*(d*_-h*y)-c*(n*_-i*y)+f*(n*h-i*d),e[14]=-(r*(l*_-o*y)-a*(n*_-i*y)+f*(n*o-i*l)),e[15]=r*(l*h-o*d)-a*(n*h-i*d)+c*(n*o-i*l),e}function h(e){const t=e[0],r=e[1],n=e[2],i=e[3],s=e[4],a=e[5],l=e[6],o=e[7],u=e[8],c=e[9],d=e[10],h=e[11],p=e[12],f=e[13],y=e[14],_=e[15];return(t*a-r*s)*(d*_-h*y)-(t*l-n*s)*(c*_-h*f)+(t*o-i*s)*(c*y-d*f)+(r*l-n*a)*(u*_-h*p)-(r*o-i*a)*(u*y-d*p)+(n*o-i*l)*(u*f-c*p)}function p(e,t,r){const n=t[0],i=t[1],s=t[2],a=t[3],l=t[4],o=t[5],u=t[6],c=t[7],d=t[8],h=t[9],p=t[10],f=t[11],y=t[12],_=t[13],g=t[14],m=t[15];let w=r[0],S=r[1],b=r[2],F=r[3];return e[0]=w*n+S*l+b*d+F*y,e[1]=w*i+S*o+b*h+F*_,e[2]=w*s+S*u+b*p+F*g,e[3]=w*a+S*c+b*f+F*m,w=r[4],S=r[5],b=r[6],F=r[7],e[4]=w*n+S*l+b*d+F*y,e[5]=w*i+S*o+b*h+F*_,e[6]=w*s+S*u+b*p+F*g,e[7]=w*a+S*c+b*f+F*m,w=r[8],S=r[9],b=r[10],F=r[11],e[8]=w*n+S*l+b*d+F*y,e[9]=w*i+S*o+b*h+F*_,e[10]=w*s+S*u+b*p+F*g,e[11]=w*a+S*c+b*f+F*m,w=r[12],S=r[13],b=r[14],F=r[15],e[12]=w*n+S*l+b*d+F*y,e[13]=w*i+S*o+b*h+F*_,e[14]=w*s+S*u+b*p+F*g,e[15]=w*a+S*c+b*f+F*m,e}function f(e,t,r){const n=r[0],i=r[1],s=r[2];if(t===e)e[12]=t[0]*n+t[4]*i+t[8]*s+t[12],e[13]=t[1]*n+t[5]*i+t[9]*s+t[13],e[14]=t[2]*n+t[6]*i+t[10]*s+t[14],e[15]=t[3]*n+t[7]*i+t[11]*s+t[15];else{const r=t[0],a=t[1],l=t[2],o=t[3],u=t[4],c=t[5],d=t[6],h=t[7],p=t[8],f=t[9],y=t[10],_=t[11];e[0]=r,e[1]=a,e[2]=l,e[3]=o,e[4]=u,e[5]=c,e[6]=d,e[7]=h,e[8]=p,e[9]=f,e[10]=y,e[11]=_,e[12]=r*n+u*i+p*s+t[12],e[13]=a*n+c*i+f*s+t[13],e[14]=l*n+d*i+y*s+t[14],e[15]=o*n+h*i+_*s+t[15]}return e}function y(e,t,r){const n=r[0],i=r[1],s=r[2];return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*s,e[9]=t[9]*s,e[10]=t[10]*s,e[11]=t[11]*s,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function _(e,t,r,n){let a=n[0],l=n[1],o=n[2],u=Math.sqrt(a*a+l*l+o*o);if(u<=(0,i.e)())return void s(e,t);u=1/u,a*=u,l*=u,o*=u;const c=Math.sin(r),d=Math.cos(r),h=1-d,p=t[0],f=t[1],y=t[2],_=t[3],g=t[4],m=t[5],w=t[6],S=t[7],b=t[8],F=t[9],I=t[10],C=t[11],v=a*a*h+d,R=l*a*h+o*c,E=o*a*h-l*c,A=a*l*h-o*c,T=l*l*h+d,x=o*l*h+a*c,M=a*o*h+l*c,P=l*o*h-a*c,k=o*o*h+d;e[0]=p*v+g*R+b*E,e[1]=f*v+m*R+F*E,e[2]=y*v+w*R+I*E,e[3]=_*v+S*R+C*E,e[4]=p*A+g*T+b*x,e[5]=f*A+m*T+F*x,e[6]=y*A+w*T+I*x,e[7]=_*A+S*T+C*x,e[8]=p*M+g*P+b*k,e[9]=f*M+m*P+F*k,e[10]=y*M+w*P+I*k,e[11]=_*M+S*P+C*k,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15])}function g(e,t,r){const n=Math.sin(r),i=Math.cos(r),s=t[4],a=t[5],l=t[6],o=t[7],u=t[8],c=t[9],d=t[10],h=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=s*i+u*n,e[5]=a*i+c*n,e[6]=l*i+d*n,e[7]=o*i+h*n,e[8]=u*i-s*n,e[9]=c*i-a*n,e[10]=d*i-l*n,e[11]=h*i-o*n,e}function m(e,t,r){const n=Math.sin(r),i=Math.cos(r),s=t[0],a=t[1],l=t[2],o=t[3],u=t[8],c=t[9],d=t[10],h=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*i-u*n,e[1]=a*i-c*n,e[2]=l*i-d*n,e[3]=o*i-h*n,e[8]=s*n+u*i,e[9]=a*n+c*i,e[10]=l*n+d*i,e[11]=o*n+h*i,e}function w(e,t,r){const n=Math.sin(r),i=Math.cos(r),s=t[0],a=t[1],l=t[2],o=t[3],u=t[4],c=t[5],d=t[6],h=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*i+u*n,e[1]=a*i+c*n,e[2]=l*i+d*n,e[3]=o*i+h*n,e[4]=u*i-s*n,e[5]=c*i-a*n,e[6]=d*i-l*n,e[7]=h*i-o*n,e}function S(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function b(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function F(e,t,r){if(0===t)return l(e);let n=r[0],s=r[1],a=r[2],o=Math.sqrt(n*n+s*s+a*a);if(o<=(0,i.e)())return null;o=1/o,n*=o,s*=o,a*=o;const u=Math.sin(t),c=Math.cos(t),d=1-c;return e[0]=n*n*d+c,e[1]=s*n*d+a*u,e[2]=a*n*d-s*u,e[3]=0,e[4]=n*s*d-a*u,e[5]=s*s*d+c,e[6]=a*s*d+n*u,e[7]=0,e[8]=n*a*d+s*u,e[9]=s*a*d-n*u,e[10]=a*a*d+c,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function I(e,t){const r=Math.sin(t),n=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function C(e,t){const r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function v(e,t){const r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function R(e,t,r){const n=t[0],i=t[1],s=t[2],a=t[3],l=n+n,o=i+i,u=s+s,c=n*l,d=n*o,h=n*u,p=i*o,f=i*u,y=s*u,_=a*l,g=a*o,m=a*u;return e[0]=1-(p+y),e[1]=d+m,e[2]=h-g,e[3]=0,e[4]=d-m,e[5]=1-(c+y),e[6]=f+_,e[7]=0,e[8]=h+g,e[9]=f-_,e[10]=1-(c+p),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function E(e,t){const r=A,n=-t[0],i=-t[1],s=-t[2],a=t[3],l=t[4],o=t[5],u=t[6],c=t[7],d=n*n+i*i+s*s+a*a;return d>0?(r[0]=2*(l*a+c*n+o*s-u*i)/d,r[1]=2*(o*a+c*i+u*n-l*s)/d,r[2]=2*(u*a+c*s+l*i-o*n)/d):(r[0]=2*(l*a+c*n+o*s-u*i),r[1]=2*(o*a+c*i+u*n-l*s),r[2]=2*(u*a+c*s+l*i-o*n)),R(e,t,r),e}const A=(0,n.aA)();function T(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function x(e,t){const r=t[0],n=t[1],i=t[2],s=t[4],a=t[5],l=t[6],o=t[8],u=t[9],c=t[10];return e[0]=Math.sqrt(r*r+n*n+i*i),e[1]=Math.sqrt(s*s+a*a+l*l),e[2]=Math.sqrt(o*o+u*u+c*c),e}function M(e,t){const r=t[0]+t[5]+t[10];let n=0;return r>0?(n=2*Math.sqrt(r+1),e[3]=.25*n,e[0]=(t[6]-t[9])/n,e[1]=(t[8]-t[2])/n,e[2]=(t[1]-t[4])/n):t[0]>t[5]&&t[0]>t[10]?(n=2*Math.sqrt(1+t[0]-t[5]-t[10]),e[3]=(t[6]-t[9])/n,e[0]=.25*n,e[1]=(t[1]+t[4])/n,e[2]=(t[8]+t[2])/n):t[5]>t[10]?(n=2*Math.sqrt(1+t[5]-t[0]-t[10]),e[3]=(t[8]-t[2])/n,e[0]=(t[1]+t[4])/n,e[1]=.25*n,e[2]=(t[6]+t[9])/n):(n=2*Math.sqrt(1+t[10]-t[0]-t[5]),e[3]=(t[1]-t[4])/n,e[0]=(t[8]+t[2])/n,e[1]=(t[6]+t[9])/n,e[2]=.25*n),e}function P(e,t,r,n){const i=t[0],s=t[1],a=t[2],l=t[3],o=i+i,u=s+s,c=a+a,d=i*o,h=i*u,p=i*c,f=s*u,y=s*c,_=a*c,g=l*o,m=l*u,w=l*c,S=n[0],b=n[1],F=n[2];return e[0]=(1-(f+_))*S,e[1]=(h+w)*S,e[2]=(p-m)*S,e[3]=0,e[4]=(h-w)*b,e[5]=(1-(d+_))*b,e[6]=(y+g)*b,e[7]=0,e[8]=(p+m)*F,e[9]=(y-g)*F,e[10]=(1-(d+f))*F,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function k(e,t,r,n,i){const s=t[0],a=t[1],l=t[2],o=t[3],u=s+s,c=a+a,d=l+l,h=s*u,p=s*c,f=s*d,y=a*c,_=a*d,g=l*d,m=o*u,w=o*c,S=o*d,b=n[0],F=n[1],I=n[2],C=i[0],v=i[1],R=i[2],E=(1-(y+g))*b,A=(p+S)*b,T=(f-w)*b,x=(p-S)*F,M=(1-(h+g))*F,P=(_+m)*F,k=(f+w)*I,L=(_-m)*I,O=(1-(h+y))*I;return e[0]=E,e[1]=A,e[2]=T,e[3]=0,e[4]=x,e[5]=M,e[6]=P,e[7]=0,e[8]=k,e[9]=L,e[10]=O,e[11]=0,e[12]=r[0]+C-(E*C+x*v+k*R),e[13]=r[1]+v-(A*C+M*v+L*R),e[14]=r[2]+R-(T*C+P*v+O*R),e[15]=1,e}function L(e,t){const r=t[0],n=t[1],i=t[2],s=t[3],a=r+r,l=n+n,o=i+i,u=r*a,c=n*a,d=n*l,h=i*a,p=i*l,f=i*o,y=s*a,_=s*l,g=s*o;return e[0]=1-d-f,e[1]=c+g,e[2]=h-_,e[3]=0,e[4]=c-g,e[5]=1-u-f,e[6]=p+y,e[7]=0,e[8]=h+_,e[9]=p-y,e[10]=1-u-d,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function O(e,t,r,n,i,s,a){const l=1/(r-t),o=1/(i-n),u=1/(s-a);return e[0]=2*s*l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*s*o,e[6]=0,e[7]=0,e[8]=(r+t)*l,e[9]=(i+n)*o,e[10]=(a+s)*u,e[11]=-1,e[12]=0,e[13]=0,e[14]=a*s*2*u,e[15]=0,e}function N(e,t,r,n,i){const s=1/Math.tan(t/2);let a;return e[0]=s/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=i&&i!==1/0?(a=1/(n-i),e[10]=(i+n)*a,e[14]=2*i*n*a):(e[10]=-1,e[14]=-2*n),e}function D(e,t,r,n){const i=Math.tan(t.upDegrees*Math.PI/180),s=Math.tan(t.downDegrees*Math.PI/180),a=Math.tan(t.leftDegrees*Math.PI/180),l=Math.tan(t.rightDegrees*Math.PI/180),o=2/(a+l),u=2/(i+s);return e[0]=o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=u,e[6]=0,e[7]=0,e[8]=-(a-l)*o*.5,e[9]=(i-s)*u*.5,e[10]=n/(r-n),e[11]=-1,e[12]=0,e[13]=0,e[14]=n*r/(r-n),e[15]=0,e}function G(e,t,r,n,i,s,a){const l=1/(t-r),o=1/(n-i),u=1/(s-a);return e[0]=-2*l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*u,e[11]=0,e[12]=(t+r)*l,e[13]=(i+n)*o,e[14]=(a+s)*u,e[15]=1,e}function j(e,t,r,n){const s=t[0],a=t[1],o=t[2];let u=s-r[0],c=a-r[1],d=o-r[2];const h=(0,i.e)();if(Math.abs(u)<h&&Math.abs(c)<h&&Math.abs(d)<h)return void l(e);let p=1/Math.sqrt(u*u+c*c+d*d);u*=p,c*=p,d*=p;const f=n[0],y=n[1],_=n[2];let g=y*d-_*c,m=_*u-f*d,w=f*c-y*u;p=Math.sqrt(g*g+m*m+w*w),p?(p=1/p,g*=p,m*=p,w*=p):(g=0,m=0,w=0);let S=c*w-d*m,b=d*g-u*w,F=u*m-c*g;p=Math.sqrt(S*S+b*b+F*F),p?(p=1/p,S*=p,b*=p,F*=p):(S=0,b=0,F=0),e[0]=g,e[1]=S,e[2]=u,e[3]=0,e[4]=m,e[5]=b,e[6]=c,e[7]=0,e[8]=w,e[9]=F,e[10]=d,e[11]=0,e[12]=-(g*s+m*a+w*o),e[13]=-(S*s+b*a+F*o),e[14]=-(u*s+c*a+d*o),e[15]=1}function U(e,t,r,n){const i=t[0],s=t[1],a=t[2],l=n[0],o=n[1],u=n[2];let c=i-r[0],d=s-r[1],h=a-r[2],p=c*c+d*d+h*h;p>0&&(p=1/Math.sqrt(p),c*=p,d*=p,h*=p);let f=o*h-u*d,y=u*c-l*h,_=l*d-o*c;return p=f*f+y*y+_*_,p>0&&(p=1/Math.sqrt(p),f*=p,y*=p,_*=p),e[0]=f,e[1]=y,e[2]=_,e[3]=0,e[4]=d*_-h*y,e[5]=h*f-c*_,e[6]=c*y-d*f,e[7]=0,e[8]=c,e[9]=d,e[10]=h,e[11]=0,e[12]=i,e[13]=s,e[14]=a,e[15]=1,e}function B(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function q(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+e[6]**2+e[7]**2+e[8]**2+e[9]**2+e[10]**2+e[11]**2+e[12]**2+e[13]**2+e[14]**2+e[15]**2)}function W(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e[9]=t[9]+r[9],e[10]=t[10]+r[10],e[11]=t[11]+r[11],e[12]=t[12]+r[12],e[13]=t[13]+r[13],e[14]=t[14]+r[14],e[15]=t[15]+r[15],e}function z(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e[9]=t[9]-r[9],e[10]=t[10]-r[10],e[11]=t[11]-r[11],e[12]=t[12]-r[12],e[13]=t[13]-r[13],e[14]=t[14]-r[14],e[15]=t[15]-r[15],e}function Q(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12]*r,e[13]=t[13]*r,e[14]=t[14]*r,e[15]=t[15]*r,e}function H(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e[4]=t[4]+r[4]*n,e[5]=t[5]+r[5]*n,e[6]=t[6]+r[6]*n,e[7]=t[7]+r[7]*n,e[8]=t[8]+r[8]*n,e[9]=t[9]+r[9]*n,e[10]=t[10]+r[10]*n,e[11]=t[11]+r[11]*n,e[12]=t[12]+r[12]*n,e[13]=t[13]+r[13]*n,e[14]=t[14]+r[14]*n,e[15]=t[15]+r[15]*n,e}function Z(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function V(e,t){if(e===t)return!0;const r=e[0],n=e[1],s=e[2],a=e[3],l=e[4],o=e[5],u=e[6],c=e[7],d=e[8],h=e[9],p=e[10],f=e[11],y=e[12],_=e[13],g=e[14],m=e[15],w=t[0],S=t[1],b=t[2],F=t[3],I=t[4],C=t[5],v=t[6],R=t[7],E=t[8],A=t[9],T=t[10],x=t[11],M=t[12],P=t[13],k=t[14],L=t[15],O=(0,i.e)();return Math.abs(r-w)<=O*Math.max(1,Math.abs(r),Math.abs(w))&&Math.abs(n-S)<=O*Math.max(1,Math.abs(n),Math.abs(S))&&Math.abs(s-b)<=O*Math.max(1,Math.abs(s),Math.abs(b))&&Math.abs(a-F)<=O*Math.max(1,Math.abs(a),Math.abs(F))&&Math.abs(l-I)<=O*Math.max(1,Math.abs(l),Math.abs(I))&&Math.abs(o-C)<=O*Math.max(1,Math.abs(o),Math.abs(C))&&Math.abs(u-v)<=O*Math.max(1,Math.abs(u),Math.abs(v))&&Math.abs(c-R)<=O*Math.max(1,Math.abs(c),Math.abs(R))&&Math.abs(d-E)<=O*Math.max(1,Math.abs(d),Math.abs(E))&&Math.abs(h-A)<=O*Math.max(1,Math.abs(h),Math.abs(A))&&Math.abs(p-T)<=O*Math.max(1,Math.abs(p),Math.abs(T))&&Math.abs(f-x)<=O*Math.max(1,Math.abs(f),Math.abs(x))&&Math.abs(y-M)<=O*Math.max(1,Math.abs(y),Math.abs(M))&&Math.abs(_-P)<=O*Math.max(1,Math.abs(_),Math.abs(P))&&Math.abs(g-k)<=O*Math.max(1,Math.abs(g),Math.abs(k))&&Math.abs(m-L)<=O*Math.max(1,Math.abs(m),Math.abs(L))}function K(e){const t=(0,i.e)(),r=e[0],n=e[1],s=e[2],a=e[4],l=e[5],o=e[6],u=e[8],c=e[9],d=e[10];return Math.abs(1-(r*r+a*a+u*u))<=t&&Math.abs(1-(n*n+l*l+c*c))<=t&&Math.abs(1-(s*s+o*o+d*d))<=t}function $(e){return 1===e[0]&&0===e[1]&&0===e[2]&&0===e[4]&&1===e[5]&&0===e[6]&&0===e[8]&&0===e[9]&&1===e[10]}const J=p,Y=z;Object.freeze(Object.defineProperty({__proto__:null,add:W,adjoint:d,copy:s,determinant:h,equals:V,exactEquals:Z,frob:q,fromQuat:L,fromQuat2:E,fromRotation:F,fromRotationTranslation:R,fromRotationTranslationScale:P,fromRotationTranslationScaleOrigin:k,fromScaling:b,fromTranslation:S,fromXRotation:I,fromYRotation:C,fromZRotation:v,frustum:O,getRotation:M,getScaling:x,getTranslation:T,hasIdentityRotation:$,identity:l,invert:c,invertOrIdentity:u,isOrthoNormal:K,lookAt:j,mul:J,multiply:p,multiplyScalar:Q,multiplyScalarAndAdd:H,ortho:G,perspective:N,perspectiveFromFieldOfView:D,rotate:_,rotateX:g,rotateY:m,rotateZ:w,scale:y,set:a,str:B,sub:Y,subtract:z,targetTo:U,translate:f,transpose:o},Symbol.toStringTag,{value:"Module"}))},92113:function(e,t,r){function n(){const e=new Float32Array(16);return e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function i(e){const t=new Float32Array(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function s(e,t,r,n,i,s,a,l,o,u,c,d,h,p,f,y){const _=new Float32Array(16);return _[0]=e,_[1]=t,_[2]=r,_[3]=n,_[4]=i,_[5]=s,_[6]=a,_[7]=l,_[8]=o,_[9]=u,_[10]=c,_[11]=d,_[12]=h,_[13]=p,_[14]=f,_[15]=y,_}function a(e,t){return new Float32Array(e,t,16)}r.d(t,{e:function(){return n}});const l=n();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:l,clone:i,create:n,createView:a,fromValues:s},Symbol.toStringTag,{value:"Module"}))},83297:function(e,t,r){r.d(t,{E:function(){return p},a:function(){return u},c:function(){return o},f:function(){return h},i:function(){return a},l:function(){return d},s:function(){return l},u:function(){return c}});var n=r(49555),i=r(98503);async function s(e){const t=e.spatialReference;if(t.isWGS84)return e.clone();if(t.isWebMercator)return(0,i.a0)(e);const r=i.B.WGS84;return await(0,n.N)(t,r),(0,n.K)(e,r)}function a(e,t){if(!l(e,t)){const r=e.typeKeywords;r?r.push(t):e.typeKeywords=[t]}}function l(e,t){return!!e.typeKeywords?.includes(t)}function o(e){return l(e,h.HOSTED_SERVICE)}function u(e,t){const r=e.typeKeywords;if(r){const e=r.indexOf(t);e>-1&&r.splice(e,1)}}function c(e,t,r){r?a(e,t):u(e,t)}async function d(e){const t=e.clone().normalize();let r;if(t.length>1)for(const n of t)r?n.width>r.width&&(r=n):r=n;else r=t[0];return s(r)}const h={DEVELOPER_BASEMAP:"DeveloperBasemap",JSAPI:"ArcGIS API for JavaScript",METADATA:"Metadata",MULTI_LAYER:"Multilayer",SINGLE_LAYER:"Singlelayer",TABLE:"Table",HOSTED_SERVICE:"Hosted Service",LOCAL_SCENE:"ViewingMode-Local",TILED_IMAGERY:"Tiled Imagery",GROUP_LAYER_MAP:"Map",ORIENTED_IMAGERY_LAYER:"OrientedImageryLayer"};function p(e){const{portal:t,isOrgItem:r,itemControl:n}=e,i=t.user?.privileges;let s=!i||i.includes("features:user:edit"),a=!!r&&!!i?.includes("features:user:fullEdit");const l="update"===n||"admin"===n;return l?a=s=!0:a&&(s=!0),{features:{edit:s,fullEdit:a},content:{updateItem:l}}}},85502:function(e,t,r){r.r(t),r.d(t,{E:function(){return Z},F:function(){return p},G:function(){return h},L:function(){return d},N:function(){return c},d:function(){return u},e:function(){return H},i:function(){return i},l:function(){return Q},n:function(){return te},p:function(){return re},t:function(){return s}});var n=r(98503);const i=Math.PI/180,s=/(?:SPHEROID|ELLIPSOID)\[([^\]]+)]/i,a=n.a3.radius,l=n.a3.eccentricitySquared,o={a1:a*l,a2:a*l*a*l,a3:a*l*l/2,a4:a*l*a*l*2.5,a5:a*l+a*l*l/2,a6:1-l},u={4267:{a:6378206.4,f:1/294.9786982},4269:{a:6378137,f:1/298.257222101},4326:{a:n.a3.radius,f:n.a3.flattening},4490:{a:6378137,f:1/298.257222101},104900:{a:2439700,f:0},104901:{a:6051e3,f:0},104902:{a:6051800,f:0},104903:{a:n.fs.radius,f:n.fs.flattening},104904:{a:3393400,f:1/192.0430107526882},104905:{a:n.ft.radius,f:n.ft.flattening},104906:{a:6200,f:0},104907:{a:11100,f:0},104908:{a:71492e3,f:.06487439154031222},104909:{a:8200,f:0},104910:{a:83500,f:0},104911:{a:1e4,f:0},104912:{a:2409300,f:0},104913:{a:15e3,f:0},104914:{a:4e4,f:0},104915:{a:1562090,f:0},104916:{a:2632345,f:0},104917:{a:85e3,f:0},104918:{a:1821460,f:0},104919:{a:5e3,f:0},104920:{a:12e3,f:0},104921:{a:3e4,f:3},104922:{a:18e3,f:0},104923:{a:14e3,f:0},104924:{a:49300,f:0},104925:{a:60268e3,f:1/10.2079945799458},104926:{a:16e3,f:0},104927:{a:9500,f:0},104928:{a:56e4,f:0},104929:{a:249400,f:0},104930:{a:59500,f:0},104931:{a:16e3,f:0},104932:{a:133e3,f:0},104933:{a:718e3,f:0},104934:{a:888e3,f:0},104935:{a:1986300,f:0},104936:{a:1e4,f:0},104937:{a:41900,f:0},104938:{a:11e4,f:0},104939:{a:50100,f:0},104940:{a:764e3,f:0},104941:{a:11e3,f:0},104942:{a:529800,f:0},104943:{a:2575e3,f:0},104944:{a:25559e3,f:1/43.61604095563141},104945:{a:578900,f:0},104946:{a:33e3,f:0},104947:{a:21e3,f:0},104948:{a:13e3,f:0},104949:{a:31e3,f:0},104950:{a:27e3,f:0},104951:{a:42e3,f:0},104952:{a:235800,f:0},104953:{a:761400,f:0},104954:{a:15e3,f:0},104955:{a:54e3,f:0},104956:{a:77e3,f:0},104957:{a:27e3,f:0},104958:{a:788900,f:0},104959:{a:584700,f:0},104960:{a:24764e3,f:.01708124697141011},104961:{a:74e3,f:0},104962:{a:79e3,f:0},104963:{a:104e3,f:.14423076923076922},104964:{a:29e3,f:0},104965:{a:17e4,f:0},104966:{a:208e3,f:0},104967:{a:4e4,f:0},104968:{a:1352600,f:0},104969:{a:1195e3,f:0},104970:{a:593e3,f:0},104971:{a:n.ft.radius,f:0},104972:{a:47e4,f:0},104973:{a:255e3,f:0},104974:{a:2439400,f:0}};var c;(function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.SPHERICAL_ECEF=1]="SPHERICAL_ECEF",e[e.WGS84=2]="WGS84",e[e.WEB_MERCATOR=3]="WEB_MERCATOR",e[e.WGS84_ECEF=4]="WGS84_ECEF",e[e.CGCS2000=5]="CGCS2000",e[e.SPHERICAL_MARS_PCPF=6]="SPHERICAL_MARS_PCPF",e[e.GCSMARS2000=7]="GCSMARS2000",e[e.SPHERICAL_MOON_PCPF=8]="SPHERICAL_MOON_PCPF",e[e.GCSMOON2000=9]="GCSMOON2000",e[e.LON_LAT=10]="LON_LAT",e[e.PLATE_CARREE=11]="PLATE_CARREE"})(c||(c={}));const d={[c.WGS84]:{[c.CGCS2000]:f,[c.GCSMARS2000]:null,[c.GCSMOON2000]:null,[c.LON_LAT]:f,[c.SPHERICAL_ECEF]:M,[c.SPHERICAL_MARS_PCPF]:null,[c.SPHERICAL_MOON_PCPF]:null,[c.UNKNOWN]:null,[c.WEB_MERCATOR]:w,[c.PLATE_CARREE]:S,[c.WGS84]:f,[c.WGS84_ECEF]:j},[c.CGCS2000]:{[c.CGCS2000]:f,[c.GCSMARS2000]:null,[c.GCSMOON2000]:null,[c.LON_LAT]:f,[c.SPHERICAL_ECEF]:M,[c.SPHERICAL_MARS_PCPF]:null,[c.SPHERICAL_MOON_PCPF]:null,[c.UNKNOWN]:null,[c.WEB_MERCATOR]:w,[c.PLATE_CARREE]:S,[c.WGS84]:f,[c.WGS84_ECEF]:j},[c.GCSMARS2000]:{[c.CGCS2000]:null,[c.GCSMARS2000]:f,[c.GCSMOON2000]:null,[c.LON_LAT]:f,[c.SPHERICAL_ECEF]:null,[c.SPHERICAL_MARS_PCPF]:x,[c.SPHERICAL_MOON_PCPF]:null,[c.UNKNOWN]:null,[c.WEB_MERCATOR]:null,[c.PLATE_CARREE]:null,[c.WGS84]:null,[c.WGS84_ECEF]:null},[c.GCSMOON2000]:{[c.CGCS2000]:null,[c.GCSMARS2000]:null,[c.GCSMOON2000]:f,[c.LON_LAT]:f,[c.SPHERICAL_ECEF]:null,[c.SPHERICAL_MARS_PCPF]:null,[c.SPHERICAL_MOON_PCPF]:T,[c.UNKNOWN]:null,[c.WEB_MERCATOR]:null,[c.PLATE_CARREE]:null,[c.WGS84]:null,[c.WGS84_ECEF]:null},[c.WEB_MERCATOR]:{[c.CGCS2000]:y,[c.GCSMARS2000]:null,[c.GCSMOON2000]:null,[c.LON_LAT]:y,[c.SPHERICAL_ECEF]:_,[c.SPHERICAL_MARS_PCPF]:null,[c.SPHERICAL_MOON_PCPF]:null,[c.UNKNOWN]:null,[c.WEB_MERCATOR]:f,[c.PLATE_CARREE]:F,[c.WGS84]:y,[c.WGS84_ECEF]:g},[c.WGS84_ECEF]:{[c.CGCS2000]:U,[c.GCSMARS2000]:null,[c.GCSMOON2000]:null,[c.LON_LAT]:U,[c.SPHERICAL_ECEF]:B,[c.SPHERICAL_MARS_PCPF]:null,[c.SPHERICAL_MOON_PCPF]:null,[c.UNKNOWN]:null,[c.WEB_MERCATOR]:q,[c.PLATE_CARREE]:I,[c.WGS84]:U,[c.WGS84_ECEF]:f},[c.SPHERICAL_ECEF]:{[c.CGCS2000]:O,[c.GCSMARS2000]:null,[c.GCSMOON2000]:null,[c.LON_LAT]:O,[c.SPHERICAL_ECEF]:f,[c.SPHERICAL_MARS_PCPF]:null,[c.SPHERICAL_MOON_PCPF]:null,[c.UNKNOWN]:null,[c.WEB_MERCATOR]:N,[c.PLATE_CARREE]:C,[c.WGS84]:O,[c.WGS84_ECEF]:D},[c.SPHERICAL_MARS_PCPF]:{[c.CGCS2000]:null,[c.GCSMARS2000]:L,[c.GCSMOON2000]:null,[c.LON_LAT]:L,[c.SPHERICAL_ECEF]:null,[c.SPHERICAL_MARS_PCPF]:f,[c.SPHERICAL_MOON_PCPF]:null,[c.UNKNOWN]:null,[c.WEB_MERCATOR]:null,[c.PLATE_CARREE]:null,[c.WGS84]:null,[c.WGS84_ECEF]:null},[c.SPHERICAL_MOON_PCPF]:{[c.CGCS2000]:null,[c.GCSMARS2000]:null,[c.GCSMOON2000]:k,[c.LON_LAT]:k,[c.SPHERICAL_ECEF]:null,[c.SPHERICAL_MARS_PCPF]:null,[c.SPHERICAL_MOON_PCPF]:f,[c.UNKNOWN]:null,[c.WEB_MERCATOR]:null,[c.PLATE_CARREE]:null,[c.WGS84]:null,[c.WGS84_ECEF]:null},[c.UNKNOWN]:{[c.CGCS2000]:null,[c.GCSMARS2000]:null,[c.GCSMOON2000]:null,[c.LON_LAT]:null,[c.SPHERICAL_ECEF]:null,[c.SPHERICAL_MARS_PCPF]:null,[c.SPHERICAL_MOON_PCPF]:null,[c.UNKNOWN]:f,[c.WEB_MERCATOR]:null,[c.PLATE_CARREE]:null,[c.WGS84]:null,[c.WGS84_ECEF]:null},[c.LON_LAT]:{[c.CGCS2000]:f,[c.GCSMARS2000]:f,[c.GCSMOON2000]:f,[c.LON_LAT]:f,[c.SPHERICAL_ECEF]:M,[c.SPHERICAL_MARS_PCPF]:x,[c.SPHERICAL_MOON_PCPF]:T,[c.UNKNOWN]:null,[c.WEB_MERCATOR]:w,[c.PLATE_CARREE]:S,[c.WGS84]:f,[c.WGS84_ECEF]:j},[c.PLATE_CARREE]:{[c.CGCS2000]:b,[c.GCSMARS2000]:null,[c.GCSMOON2000]:null,[c.LON_LAT]:b,[c.SPHERICAL_ECEF]:v,[c.SPHERICAL_MARS_PCPF]:null,[c.SPHERICAL_MOON_PCPF]:null,[c.UNKNOWN]:null,[c.WEB_MERCATOR]:R,[c.PLATE_CARREE]:f,[c.WGS84]:b,[c.WGS84_ECEF]:E}};function h(e,t,r=z()){return null==e||null==t?null:W(e,t,r).projector}function p(e,t){return e?t.spatialReference===e?t.spatialReferenceId:(t.spatialReference=e,"metersPerUnit"in t&&(t.metersPerUnit=(0,n.bq)(e,1)),(0,n.fv)(e)?t.spatialReferenceId=c.SPHERICAL_ECEF:(0,n.cb)(e)?t.spatialReferenceId=c.WGS84:(0,n.cL)(e)?t.spatialReferenceId=c.WEB_MERCATOR:(0,n.fw)(e)?t.spatialReferenceId=c.PLATE_CARREE:e.wkt===n.c4.wkt?t.spatialReferenceId=c.WGS84_ECEF:e.wkid===n.fx.CGCS2000?t.spatialReferenceId=c.CGCS2000:e.wkt===n.c2.wkt?t.spatialReferenceId=c.SPHERICAL_MARS_PCPF:e.wkt===n.c3.wkt?t.spatialReferenceId=c.SPHERICAL_MOON_PCPF:(0,n.eD)(e)?t.spatialReferenceId=c.GCSMARS2000:(0,n.eE)(e)?t.spatialReferenceId=c.GCSMOON2000:t.spatialReferenceId=c.UNKNOWN):c.UNKNOWN}function f(e,t,r,n){e!==r&&(r[n++]=e[t++],r[n++]=e[t++],r[n]=e[t])}function y(e,t,r,n){r[n]=K*(e[t]/Y),r[n+1]=K*(J-2*Math.atan(Math.exp(-e[t+1]/Y))),r[n+2]=e[t+2]}function _(e,t,r,n){const i=e[t]/Y,s=J-2*Math.atan(Math.exp(-e[t+1]/Y)),a=Y+e[t+2],l=Math.cos(s)*a;r[n]=Math.cos(i)*l,r[n+1]=Math.sin(i)*l,r[n+2]=Math.sin(s)*a}function g(e,t,r,n){y(e,t,r,n),j(r,n,r,n)}function m(e,t,r,i,s){const a=.4999999*$,l=(0,n.aP)(V*e[t+1],-a,a),o=Math.sin(l);r[i++]=V*e[t]*s.radius,r[i++]=s.halfSemiMajorAxis*Math.log((1+o)/(1-o)),r[i]=e[t+2]}function w(e,t,r,i){m(e,t,r,i,n.a3)}function S(e,t,r,n){r[n]=e[t]*X,r[n+1]=e[t+1]*X,r[n+2]=e[t+2]}function b(e,t,r,n){r[n]=e[t]*ee,r[n+1]=e[t+1]*ee,r[n+2]=e[t+2]}function F(e,t,r,n){y(e,t,r,n),S(r,n,r,n)}function I(e,t,r,n){U(e,t,r,n),S(r,n,r,n)}function C(e,t,r,n){O(e,t,r,n),S(r,n,r,n)}function v(e,t,r,n){b(e,t,r,n),M(r,n,r,n)}function R(e,t,r,n){b(e,t,r,n),w(r,n,r,n)}function E(e,t,r,n){b(e,t,r,n),j(r,n,r,n)}function A(e,t,r,n,i){const s=i+e[t+2],a=V*e[t+1],l=V*e[t],o=Math.cos(a)*s;r[n]=Math.cos(l)*o,r[n+1]=Math.sin(l)*o,r[n+2]=Math.sin(a)*s}function T(e,t,r,i){A(e,t,r,i,n.fs.radius)}function x(e,t,r,i){A(e,t,r,i,n.ft.radius)}function M(e,t,r,i){A(e,t,r,i,n.a3.radius)}function P(e,t,r,i,s){const a=e[t],l=e[t+1],o=e[t+2],u=Math.sqrt(a*a+l*l+o*o),c=(0,n.fu)(o/(0===u?1:u)),d=Math.atan2(l,a);r[i++]=K*d,r[i++]=K*c,r[i]=u-s}function k(e,t,r,i){P(e,t,r,i,n.fs.radius)}function L(e,t,r,i){P(e,t,r,i,n.ft.radius)}function O(e,t,r,i){P(e,t,r,i,n.a3.radius)}function N(e,t,r,n){O(e,t,r,n),w(r,n,r,n)}function D(e,t,r,n){O(e,t,r,n),j(r,n,r,n)}function G(e,t,r,n,i){const s=V*e[t],a=V*e[t+1],l=e[t+2],o=Math.sin(a),u=Math.cos(a),c=i.radius/Math.sqrt(1-i.eccentricitySquared*o*o);r[n++]=(c+l)*u*Math.cos(s),r[n++]=(c+l)*u*Math.sin(s),r[n++]=(c*(1-i.eccentricitySquared)+l)*o}function j(e,t,r,i){G(e,t,r,i,n.a3)}function U(e,t,r,i){const s=o,a=e[t],l=e[t+1],u=e[t+2];let c,d,h,p,f,y,_,g,m,w,S,b,F,I,C,v,R,E,A,T,x;c=Math.abs(u),d=a*a+l*l,h=Math.sqrt(d),p=d+u*u,f=Math.sqrt(p),T=Math.atan2(l,a),y=u*u/p,_=d/p,I=s.a2/f,C=s.a3-s.a4/f,_>.3?(g=c/f*(1+_*(s.a1+I+y*C)/f),A=Math.asin(g),w=g*g,m=Math.sqrt(1-w)):(m=h/f*(1-y*(s.a5-I-_*C)/f),A=Math.acos(m),w=1-m*m,g=Math.sqrt(w)),S=1-n.a3.eccentricitySquared*w,b=n.a3.radius/Math.sqrt(S),F=s.a6*b,I=h-b*m,C=c-F*g,R=m*I+g*C,v=m*C-g*I,E=v/(F/S+R),A+=E,x=R+v*E/2,u<0&&(A=-A),r[i++]=K*T,r[i++]=K*A,r[i]=x}function B(e,t,r,n){U(e,t,r,n),M(r,n,r,n)}function q(e,t,r,n){U(e,t,r,n),w(r,n,r,n)}function W(e,t,r){if(null==e||null==t||r.source.spatialReference===e&&r.dest.spatialReference===t)return r;const i=p(e,r.source),s=p(t,r.dest);return i===c.UNKNOWN&&s===c.UNKNOWN?(0,n.bh)(e,t)?r.projector=f:r.projector=null:r.projector=d[i][s],r}function z(){return{source:{spatialReference:null,spatialReferenceId:c.UNKNOWN,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:c.UNKNOWN,metersPerUnit:1},projector:f}}const Q={spatialReference:null,spatialReferenceId:c.UNKNOWN},H={spatialReference:null,spatialReferenceId:c.UNKNOWN},Z=z(),V=(0,n.eI)(1),K=(0,n.dg)(1),$=Math.PI,J=.5*$,Y=n.a3.radius,X=Y*$/180,ee=180/(Y*$);function te(e,t,r,n,i,s,a=Math.floor(e.length/3)){const l=h(t,i,Z);if(null==l)return!1;if(l===f){if(e===n&&r===s)return!0;const t=r+3*a;for(let i=r,a=s;i<t;i++,a++)n[a]=e[i];return!0}const o=r+3*a;for(let u=r,c=s;u<o;u+=3,c+=3)l(e,u,n,c);return!0}const re=Object.freeze(Object.defineProperty({__proto__:null,projectBuffer:te},Symbol.toStringTag,{value:"Module"}))},49555:function(e,t,r){r.r(t),r.d(t,{B:function(){return I},H:function(){return O},J:function(){return D},K:function(){return R},L:function(){return G},N:function(){return j},O:function(){return E},Q:function(){return U},V:function(){return A},W:function(){return v},X:function(){return T},Y:function(){return x},_:function(){return b},a:function(){return Z},o:function(){return c},p:function(){return X},s:function(){return u}});var n=r(98503),i=r(85502);function s(e,t,r,n,s,l){return a[0]=e,a[1]=t,a[2]=r,(0,i.n)(a,n,0,s,l,0)}const a=(0,n.aA)();let l=0;class o{static fromGE(e){const t=new o;return t._wkt=e.wkt,t._wkid=e.wkid,t._isInverse=e.isInverse,t}constructor(e){this.uid=l++,e?(this._wkt=null!=e.wkt?e.wkt:null,this._wkid=null!=e.wkid?e.wkid:-1,this._isInverse=null!=e.isInverse&&!0===e.isInverse):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}get wkt(){return this._wkt}set wkt(e){this._wkt=e,this.uid=l++}get wkid(){return this._wkid}set wkid(e){this._wkid=e,this.uid=l++}get isInverse(){return this._isInverse}set isInverse(e){this._isInverse=e,this.uid=l++}getInverse(){const e=new o;return e._wkt=this.wkt,e._wkid=this._wkid,e._isInverse=!this.isInverse,e}}let u=class e{static cacheKey(e,t){return[e.wkid?.toString()??"-1",e.wkt?.toString()??"",e.wkt2?.toString()??"",t.wkid?.toString()??"-1",t.wkt?.toString()??"",t.wkt2?.toString()??""].join()}static fromGE(t){const r=new e;let n="";for(const e of t.steps){const t=o.fromGE(e);r.steps.push(t),n+=t.uid.toString()+","}return r._cachedProjection={},r._gtlistentry=null,r._chain=n,r}constructor(e){if(this.steps=[],this._cachedProjection={},this._chain="",this._gtlistentry=null,e?.steps)for(const t of e.steps)t instanceof o?this.steps.push(t):this.steps.push(new o({wkid:t.wkid,wkt:t.wkt,isInverse:t.isInverse}))}getInverse(){const t=new e;t.steps=[];for(let e=this.steps.length-1;e>=0;e--){const r=this.steps[e];t.steps.push(r.getInverse())}return t}getGTListEntry(){let e="";for(const t of this.steps)e+=t.uid.toString()+",";return e!==this._chain&&(this._gtlistentry=null,this._cachedProjection={},this._chain=e),this._gtlistentry}assignCachedGe(t,r,n){this._cachedProjection[e.cacheKey(t,r)]=n}getCachedGeTransformation(t,r){let n="";for(const e of this.steps)n+=e.uid.toString()+",";n!==this._chain&&(this._gtlistentry=null,this._cachedProjection={},this._chain=n);const i=this._cachedProjection[e.cacheKey(t,r)];return void 0===i?null:i}};function c(e,t,r){if(null==t||null==r||r.vcsWkid||(0,n.bh)(t,r)||(0,n.gK)(t)||(0,n.gK)(r))return null;const i=(0,n.bg)(t)/(0,n.bg)(r);if(1===i)return null;switch(e){case"point":case"esriGeometryPoint":return e=>d(e,i);case"polyline":case"esriGeometryPolyline":return e=>p(e,i);case"polygon":case"esriGeometryPolygon":return e=>h(e,i);case"multipoint":case"esriGeometryMultipoint":return e=>f(e,i);case"extent":case"esriGeometryEnvelope":return e=>y(e,i);default:return null}}function d(e,t){null!=e?.z&&(e.z*=t)}function h(e,t){if(e)for(const r of e.rings)for(const e of r)e.length>2&&(e[2]*=t)}function p(e,t){if(e)for(const r of e.paths)for(const e of r)e.length>2&&(e[2]*=t)}function f(e,t){if(e)for(const r of e.points)r.length>2&&(r[2]*=t)}function y(e,t){e&&null!=e.zmin&&null!=e.zmax&&(e.zmin*=t,e.zmax*=t)}let _=null,g=null,m=null,w={};const S=new n.aQ;function b(){return!!_&&(0,n.gN)()}function F(){return!!b()||((0,n.aR)(S),v(),!1)}function I(e,t){return!e||!t||D(e,t)||F()}function C(e,t){return!D(e,t)&&!b()}function v(e){return null==m&&(m=Promise.all([(0,n.gL)(),Promise.all([r.e(916),r.e(2020)]).then(r.bind(r,90916)).then((e=>e.g)),r.e(6582).then(r.bind(r,6582))])),m.then((([,t,{hydratedAdapter:r}])=>{(0,n.D)(e),g=r,_=t.default,_._enableProjection(n.gM),S.notify()}))}function R(e,t,r=null,n=null){return Array.isArray(e)?0===e.length?[]:E(g,e,e[0].spatialReference,t,r,n):E(g,[e],e.spatialReference,t,r,n)[0]}function E(e,t,r,i,s=null,a=null){if(null==r||null==i)return t;if(D(r,i,s))return t.map((e=>U(e,r,i)));if(null==s&&(0,n.fv)(r))return t.map((e=>U(e,r,n.B.WGS84))).map((e=>O(e,i)));if(null==s&&(0,n.fv)(i))return t.map((e=>O(e,n.B.WGS84))).map((e=>U(e,n.B.WGS84,i)));if(null==s){const e=u.cacheKey(r,i);void 0!==w[e]?s=w[e]:(null==(s=x(r,i,void 0))&&(s=new u),w[e]=s)}if(null==_||null==e)throw new P;return null!=a?_._project(e,t,r,i,s,a):_._project(e,t,r,i,s)}function A(e,t){const r=T([e],t);return null!=r.pending?{pending:r.pending,geometry:null}:null!=r.geometries?{pending:null,geometry:r.geometries[0]}:{pending:null,geometry:null}}function T(e,t){if(!b())for(const r of e)if(null!=r&&!(0,n.bh)(r.spatialReference,t)&&(0,n.cg)(r.spatialReference)&&(0,n.cg)(t)&&!D(r.spatialReference,t))return(0,n.aR)(S),{pending:v(),geometries:null};return{pending:null,geometries:e.map((e=>null==e?null:(0,n.bh)(e.spatialReference,t)?e:(0,n.cg)(e.spatialReference)&&(0,n.cg)(t)?O(e,t):null))}}function x(e,t,r=null){if(null==e||null==t)return null;if(null==_||null==g)throw new P;const n=_._getTransformation(g,e,t,r,r?.spatialReference);return null!==n?u.fromGE(n):null}function M(e,t,r=null){if(null==_||null==g)throw new P;const n=_._getTransformationBySuitability(g,e,t,r,r?.spatialReference);if(null!==n){const e=[];for(const t of n)e.push(u.fromGE(t));return e}return[]}class P extends n.s{constructor(){super("projection:not-loaded","projection engine not fully loaded yet, please call load()")}}function k(){_=null,g=null,m=null,w={}}const L={get loadPromise(){return m}};function O(e,t){try{const r=R(e,t);return null==r?null:("xmin"in e&&"xmin"in r&&(r.zmin=e.zmin,r.zmax=e.zmax),c(r.type,e.spatialReference,t)?.(r),r)}catch(r){if(!(r instanceof P))throw r;return null}}async function N(e,t,r){const n=e.spatialReference;return null!=n&&null!=t&&await j(n,t,null,r),O(e,t)}function D(e,t,r){return!r&&(!!(0,n.bh)(e,t)||(0,n.cg)(e)&&(0,n.cg)(t)&&!!(0,i.G)(e,t,i.E))}function G(e,t){if((0,n.bh)(e,t))return!0;if(!(0,n.cg)(e)||!(0,n.cg)(t))return!1;const r=(0,n.cb)(e)||(0,n.cL)(e)||(0,n.eC)(e),i=(0,n.cb)(t)||(0,n.cL)(t)||(0,n.eC)(t);return r&&i}async function j(e,t,r,i){if(b())return(0,n.O)(i);if(Array.isArray(e)){for(const{source:n,dest:s,geographicTransformation:a}of e)if(n&&s&&!D(n,s,a))return v(i)}else if(e&&t&&!D(e,t,r))return v(i);return(0,n.O)(i)}function U(e,t,r){return e?"x"in e?q(e,t,new n.bv,r,0):"xmin"in e?$(e,t,new n.au,r,0):"rings"in e?V(e,t,new n.bC,r,0):"paths"in e?H(e,t,new n.aT,r,0):"points"in e?z(e,t,new n.bD,r,0):null:null}function B(e,t,r=t.spatialReference,n=0){return null!=r&&null!=e.spatialReference&&null!=q(e,e.spatialReference,t,r,n)}function q(e,t,r,s,a){Y[0]=e.x,Y[1]=e.y;const l=e.z;return Y[2]=void 0!==l?l:a,(0,i.n)(Y,t,0,Y,s,0)?(r.x=Y[0],r.y=Y[1],r.spatialReference=s,void 0!==l||(0,n.gK)(s)?(r.z=Y[2],r.hasZ=!0):(r.z=void 0,r.hasZ=!1),void 0===e.m?(r.m=void 0,r.hasM=!1):(r.m=e.m,r.hasM=!0),r):null}function W(e,t,r=t.spatialReference,n=0){return null!=e.spatialReference&&null!=r&&null!=z(e,e.spatialReference,t,r,n)}function z(e,t,r,s,a){const{points:l,hasZ:o,hasM:u}=e,c=[],d=l.length,h=[];for(const n of l)h.push(n[0],n[1],o?n[2]:a);if(!(0,i.n)(h,t,0,h,s,0,d))return null;const p=o||(0,n.gK)(s);for(let n=0;n<d;++n){const e=3*n,t=h[e],r=h[e+1];p&&u?c.push([t,r,h[e+2],l[n][3]]):p?c.push([t,r,h[e+2]]):u?c.push([t,r,l[n][2]]):c.push([t,r])}return r.points=c,r.spatialReference=s,r.hasZ=o,r.hasM=u,r}function Q(e,t,r=t.spatialReference,n=0){return null!=e.spatialReference&&null!=r&&null!=H(e,e.spatialReference,t,r,n)}function H(e,t,r,i,s){const{paths:a,hasZ:l,hasM:o}=e,u=[];if(!J(a,l??!1,o??!1,t,u,i,s))return null;const c=l||(0,n.gK)(i);return r.paths=u,r.spatialReference=i,r.hasZ=c,r.hasM=o,r}function Z(e,t,r=t.spatialReference,n=0){return null!=e.spatialReference&&null!=r&&null!=V(e,e.spatialReference,t,r,n)}function V(e,t,r,i,s){const{rings:a,hasZ:l,hasM:o}=e,u=[];if(!J(a,l??!1,o??!1,t,u,i,s))return null;const c=l||(0,n.gK)(i);return r.rings=u,r.spatialReference=i,r.hasZ=c,r.hasM=o,r}function K(e,t,r=t.spatialReference,n=0){return null!=e.spatialReference&&null!=r&&null!=$(e,e.spatialReference,t,r,n)}function $(e,t,r,i,a){const{xmin:l,ymin:o,xmax:u,ymax:c,hasZ:d,hasM:h}=e,p=d?e.zmin:a;if(!s(l,o,p,t,Y,i))return null;const f=d||(0,n.gK)(i);r.xmin=Y[0],r.ymin=Y[1],f&&(r.zmin=Y[2]);const y=d?e.zmax:a;return s(u,c,y,t,Y,i)?(r.xmax=Y[0],r.ymax=Y[1],f&&(r.zmax=Y[2]),h&&(r.mmin=e.mmin,r.mmax=e.mmax),r.spatialReference=i,r):null}function J(e,t,r,s,a,l,o=0){const u=new Array;for(const n of e)for(const e of n)u.push(e[0],e[1],t?e[2]:o);if(!(0,i.n)(u,s,0,u,l,0))return!1;let c=0;a.length=0;const d=t||(0,n.gK)(l);for(const n of e){const e=new Array;for(const t of n)d&&r?e.push([u[c++],u[c++],u[c++],t[3]]):d?e.push([u[c++],u[c++],u[c++]]):r?(e.push([u[c++],u[c++],t[2]]),c++):(e.push([u[c++],u[c++]]),c++);a.push(e)}return!0}const Y=(0,n.aA)(),X=Object.freeze(Object.defineProperty({__proto__:null,canProjectWithoutEngine:D,getTransformation:x,getTransformations:M,initializeProjection:j,isEqualBaseGCS:G,isLoaded:b,isLoadedOrLoad:F,isLoadedOrLoadFor:I,load:v,project:R,projectExtent:K,projectMany:E,projectMultipoint:W,projectOrLoad:A,projectOrLoadMany:T,projectPoint:B,projectPolygon:Z,projectPolyline:Q,projectWithZConversion:N,projectWithoutEngine:U,requiresLoad:C,test:L,tryProjectWithZConversion:O,unload:k},Symbol.toStringTag,{value:"Module"}))},8891:function(e,t,r){r.d(t,{B:function(){return b},C:function(){return F},D:function(){return I},H:function(){return C},j:function(){return S},s:function(){return n},u:function(){return s}});r(98503);function n(e){return e?{originPosition:"upper-left"===e.originPosition?"upperLeft":"lower-left"===e.originPosition?"lowerLeft":e.originPosition,scale:e.tolerance?[e.tolerance,e.tolerance,1,1]:[1,1,1,1],translate:null!=e.extent?[e.extent.xmin,e.extent.ymax,e.extent.zmin??0,e.extent.mmin??0]:[0,0,0,0]}:null}function i(e){return"lowerLeft"===e.originPosition&&4===e.scale.length&&4===e.translate.length}function s(e){if(i(e))return e;const{originPosition:t,scale:r,translate:n}=e,s=r[0]??1,a=r[1]??1;return{originPosition:"lowerLeft",scale:[s,"lowerLeft"===t?a:-a,r[2]??1,r[3]??1],translate:[n[0]??0,n[1]??0,n[2]??0,n[3]??0]}}function a({scale:e,translate:t},r){return Math.round((r-t[0])/e[0])}function l({scale:e,translate:t},r){return Math.round((r-t[1])/e[1])}function o({scale:e,translate:t},r){return Math.round(((r??0)-t[2])/e[2])}function u({scale:e,translate:t},r){return r?Math.round((r-t[3])/e[3]):0}function c({scale:e,translate:t},r){return r*e[0]+t[0]}function d({scale:e,translate:t},r){return r*e[1]+t[1]}function h({scale:e,translate:t},r){return(r??0)*e[2]+t[2]}function p({scale:e,translate:t},r){return r?r*e[3]+t[3]:0}function f(e,t){return e&&t?m:e&&!t?_:!e&&t?g:y}const y=(e,t)=>{const r=new Array(t.length);if(!t.length)return r;const n=t[0];let i=c(e,n[0]),s=d(e,n[1]);r[0]=[i,s];const{scale:a,originPosition:l}=e,o=a[0],u="lowerLeft"===l?a[1]:-a[1];for(let c=1;c<t.length;c++){const[e,n]=t[c];i+=o*e,s+=u*n,r[c]=[i,s]}return r},_=(e,t)=>{const r=new Array(t.length);if(!t.length)return r;const n=t[0];let i=c(e,n[0]),s=d(e,n[1]);r[0]=[i,s,h(e,n[2])];const{scale:a,originPosition:l}=e,o=a[0],u="lowerLeft"===l?a[1]:-a[1];for(let c=1;c<t.length;c++){const[n,a,l]=t[c];i+=o*n,s+=u*a,r[c]=[i,s,h(e,l)]}return r},g=(e,t)=>{const r=new Array(t.length);if(!t.length)return r;const n=t[0];let i=c(e,n[0]),s=d(e,n[1]);r[0]=[i,s,p(e,n[2])];const{scale:a,originPosition:l}=e,o=a[0],u="lowerLeft"===l?a[1]:-a[1];for(let c=1;c<t.length;c++){const[n,a,l]=t[c];i+=o*n,s+=u*a,r[c]=[i,s,p(e,l)]}return r},m=(e,t)=>{const r=new Array(t.length);if(!t.length)return r;const n=t[0];let i=c(e,n[0]),s=d(e,n[1]);r[0]=[i,s,h(e,n[2]),p(e,n[3])];const{scale:a,originPosition:l}=e,o=a[0],u="lowerLeft"===l?a[1]:-a[1];for(let c=1;c<t.length;c++){const[n,a,l,d]=t[c];i+=o*n,s+=u*a,r[c]=[i,s,h(e,l),p(e,d)]}return r};function w(e,t,r){const n=new Array(r.length);for(let i=0;i<r.length;i++)n[i]=t(e,r[i]);return n}function S(e,t,r){const n=s(e);return t.x=a(n,r.x),t.y=l(n,r.y),null!=r.z&&(t.z=o(n,r.z)),null!=r.m&&(t.m=u(n,r.m)),t}function b(e,t,r,n=r?.hasZ??!1,i=r?.hasM??!1){if(null!=r){const a=s(e);t.points=f(n,i)(a,r.points),t.hasZ=n,t.hasM=i}return t}function F(e,t,r,n=null!=r?.z,i=null!=r?.m){if(null==r)return t;const a=s(e);return t.x=c(a,r.x),t.y=d(a,r.y),n&&(t.z=h(a,r.z)),i&&(t.m=p(a,r.m)),t}function I(e,t,r,n=r?.hasZ??!1,i=r?.hasM??!1){if(null!=r){const a=s(e);t.rings=w(a,f(n,i),r.rings),t.hasZ=n,t.hasM=i}return t}function C(e,t,r,n=r?.hasZ??!1,i=r?.hasM??!1){if(null!=r){const a=s(e);t.paths=w(a,f(n,i),r.paths),t.hasZ=n,t.hasM=i}return t}},6488:function(e,t,r){r.d(t,{t:function(){return i}});var n=r(49555);function i(e,t,r){if(!r?.features||!r.hasZ)return;const i=(0,n.o)(r.geometryType,t,e.outSpatialReference);if(null!=i)for(const n of r.features)i(n.geometry)}},549:function(e,t,r){r.d(t,{A:function(){return I},i:function(){return h}});var n=r(98503),i=r(5948);function s(e,t,r){return!!l(e,t,r)}function a(e,t,r){return l(e,t,r)}function l(e,t,r){return e&&e.hasOwnProperty(t)?e[t]:r}const o={name:"supportsName",size:"supportsSize",contentType:"supportsContentType",keywords:"supportsKeywords",exifInfo:"supportsExifInfo"};function u(e){const t=e?.supportedSpatialAggregationStatistics?.map((e=>e.toLowerCase()));return{envelope:!!t?.includes("envelopeaggregate"),centroid:!!t?.includes("centroidaggregate"),convexHull:!!t?.includes("convexhullaggregate")}}function c(e,t){return!!e?.supportedOperationsWithCacheHint?.map((e=>e.toLowerCase()))?.includes(t.toLowerCase())}function d(e){const t=e?.supportedStatisticTypes?.map((e=>e.toLowerCase()));return{count:!!t?.includes("count"),sum:!!t?.includes("sum"),min:!!t?.includes("min"),max:!!t?.includes("max"),avg:!!t?.includes("avg"),var:!!t?.includes("var"),stddev:!!t?.includes("stddev"),percentileContinuous:!!t?.includes("percentile_continuous"),percentileDiscrete:!!t?.includes("percentile_discrete"),envelope:!!t?.includes("envelopeaggregate"),centroid:!!t?.includes("centroidaggregate"),convexHull:!!t?.includes("convexhullaggregate")}}function h(e,t){return{analytics:p(e),attachment:f(e),data:y(e),metadata:_(e),operations:g(e.capabilities,e,t),query:m(e,t),queryBins:b(e),queryRelated:w(e),queryTopFeatures:S(e),editing:F(e)}}function p(e){return{supportsCacheHint:c(e.advancedQueryCapabilities,"queryAnalytics")}}function f(e){const t=e.attachmentProperties,r={supportsName:!1,supportsSize:!1,supportsContentType:!1,supportsKeywords:!1,supportsExifInfo:!1,supportsCacheHint:c(e.advancedQueryCapabilities,"queryAttachments"),supportsResize:s(e,"supportsAttachmentsResizing",!1)};return t&&Array.isArray(t)&&t.forEach((e=>{const t=o[e.name];t&&(r[t]=!!e.isEnabled)})),r}function y(e){return{isVersioned:s(e,"isDataVersioned",!1),isBranchVersioned:s(e,"isDataBranchVersioned",!1),supportsAttachment:s(e,"hasAttachments",!1),supportsM:s(e,"hasM",!1),supportsZ:s(e,"hasZ",!1)}}function _(e){return{supportsAdvancedFieldProperties:s(e,"supportsFieldDescriptionProperty",!1)}}function g(e,t,r){const n=e?e.toLowerCase().split(",").map((e=>e.trim())):[],a=r?(0,i.d)(r):null,l=n.includes(null!=a&&"MapServer"===a.serverType?"data":"query"),o=n.includes("editing")&&!t.datesInUnknownTimezone;let u=o&&n.includes("create"),c=o&&n.includes("delete"),d=o&&n.includes("update");const h=n.includes("changetracking"),p=t.advancedQueryCapabilities;return o&&!(u||c||d)&&(u=c=d=!0),{supportsCalculate:s(t,"supportsCalculate",!1),supportsTruncate:s(t,"supportsTruncate",!1),supportsValidateSql:s(t,"supportsValidateSql",!1),supportsAdd:u,supportsDelete:c,supportsEditing:o,supportsChangeTracking:h,supportsQuery:l,supportsQueryAnalytics:s(p,"supportsQueryAnalytic",!1),supportsQueryAttachments:s(p,"supportsQueryAttachments",!1),supportsQueryBins:s(p,"supportsQueryBins",!1),supportsQueryTopFeatures:s(p,"supportsTopFeaturesQuery",!1),supportsResizeAttachments:s(t,"supportsAttachmentsResizing",!1),supportsSync:n.includes("sync"),supportsUpdate:d,supportsExceedsLimitStatistics:s(t,"supportsExceedsLimitStatistics",!1),supportsAsyncConvert3D:s(t,"supportsAsyncConvert3D",!1)}}function m(e,t){const r=e.advancedQueryCapabilities,l=e.ownershipBasedAccessControlForFeatures,o=e.archivingInfo,d=e.currentVersion,h=t?.includes("MapServer"),p=!h||d>=(0,n.a$)("mapserver-pbf-version-support"),f=(0,i.g)(t),y=new Set((e.supportedQueryFormats??"").split(",").map((e=>e.toLowerCase().trim())));return{maxRecordCount:a(e,"maxRecordCount",void 0),maxRecordCountFactor:a(e,"maxRecordCountFactor",void 0),standardMaxRecordCount:a(e,"standardMaxRecordCount",void 0),supportedSpatialAggregationStatistics:u(r),supportsCacheHint:s(r,"supportsQueryWithCacheHint",!1)||c(r,"query"),supportsCentroid:s(r,"supportsReturningGeometryCentroid",!1),supportsCompactGeometry:f,supportsDefaultSpatialReference:s(r,"supportsDefaultSR",!1),supportsDisjointSpatialRelationship:s(r,"supportsDisjointSpatialRel",!1),supportsDistance:s(r,"supportsQueryWithDistance",!1),supportsDistinct:s(r,"supportsDistinct",e.supportsAdvancedQueries),supportsExtent:s(r,"supportsReturningQueryExtent",!1),supportsFormatPBF:p&&y.has("pbf"),supportsFullTextSearch:s(r,"supportsFullTextSearch",!1),supportsGeometryProperties:s(r,"supportsReturningGeometryProperties",!1),supportsHavingClause:s(r,"supportsHavingClause",!1),supportsHistoricMoment:s(o,"supportsQueryWithHistoricMoment",!1),supportsMaxRecordCountFactor:s(r,"supportsMaxRecordCountFactor",!1),supportsOrderBy:s(r,"supportsOrderBy",e.supportsAdvancedQueries),supportsPagination:s(r,"supportsPagination",!1),supportsPercentileStatistics:s(r,"supportsPercentileStatistics",!1),supportsQuantization:s(e,"supportsCoordinatesQuantization",!1),supportsQuantizationEditMode:s(e,"supportsQuantizationEditMode",!1),supportsQueryByAnonymous:s(l,"allowAnonymousToQuery",!0),supportsQueryByOthers:s(l,"allowOthersToQuery",!0),supportsQueryGeometry:s(e,"supportsReturningQueryGeometry",!1),supportsResultType:s(r,"supportsQueryWithResultType",!1),supportsSpatialAggregationStatistics:s(r,"supportsSpatialAggregationStatistics",!1),supportsSqlExpression:s(r,"supportsSqlExpression",!1),supportsStandardizedQueriesOnly:s(e,"useStandardizedQueries",!1),supportsStatistics:s(r,"supportsStatistics",e.supportsStatistics),supportsTopFeaturesQuery:s(r,"supportsTopFeaturesQuery",!1),tileMaxRecordCount:a(e,"tileMaxRecordCount",void 0)}}function w(e){const t=e.advancedQueryCapabilities,r=s(t,"supportsAdvancedQueryRelated",!1);return{supportsPagination:s(t,"supportsQueryRelatedPagination",!1),supportsCount:r,supportsOrderBy:r,supportsCacheHint:c(t,"queryRelated")}}function S(e){return{supportsCacheHint:c(e.advancedQueryCapabilities,"queryTopFilter")}}function b(e){const t=e?e.queryBinsCapabilities:void 0;return{supportsDate:s(t,"supportsDateBin",!1),supportsFixedInterval:s(t,"supportsFixedIntervalBin",!1),supportsAutoInterval:s(t,"supportsAutoIntervalBin",!1),supportsFixedBoundaries:s(t,"supportsFixedBoundariesBin",!1),supportedStatistics:d(t)}}function F(e){const t=e.ownershipBasedAccessControlForFeatures,r=e?e.advancedEditingCapabilities:void 0;return{supportsGeometryUpdate:s(e,"allowGeometryUpdates",!0),supportsGlobalId:s(e,"supportsApplyEditsWithGlobalIds",!1),supportsReturnServiceEditsInSourceSpatialReference:s(e,"supportsReturnServiceEditsInSourceSR",!1),supportsRollbackOnFailure:s(e,"supportsRollbackOnFailureParameter",!1),supportsUpdateWithoutM:s(e,"allowUpdateWithoutMValues",!1),supportsUploadWithItemId:s(e,"supportsAttachmentsByUploadId",!1),supportsDeleteByAnonymous:s(t,"allowAnonymousToDelete",!0),supportsDeleteByOthers:s(t,"allowOthersToDelete",!0),supportsUpdateByAnonymous:s(t,"allowAnonymousToUpdate",!0),supportsUpdateByOthers:s(t,"allowOthersToUpdate",!0),supportsAsyncApplyEdits:s(r,"supportsAsyncApplyEdits",!1),zDefault:a(e,"zDefault",void 0)}}function I(e){return{operations:{supportsAppend:s(e,"supportsAppend",!1),supportsCoverageQuery:e?.playbackInfo?.klv["0601"]??!1,supportsExportClip:s(e,"supportsExportClip",!1),supportsExportFrameset:s(e,"supportsExportFrameset",!1),supportsMensuration:s(e,"supportsMensuration",!1),supportsUpdate:s(e,"supportsUpdate",!1)}}}}}]);
//# sourceMappingURL=8241.6c8b55dc.js.map