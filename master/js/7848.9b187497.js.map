{"version":3,"file":"js/7848.9b187497.js","mappings":"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","sources":["webpack://ramp-website/./node_modules/ramp-pcar/dist/esDynamic/index-BzfDwipy.js"],"sourcesContent":["import{F as k}from\"./main-I34c1W55.js\";import{a as o}from\"./fabric-BiLu08ax.js\";const _=30,C=20,T=16,F=12,P=8,f=32,S=32,G=350,w=20,g=\"Montserrat, BlinkMacSystemFont, Segoe UI, Helvetica, Arial, sans-serif\";class I extends k{get config(){return this.$iApi.fixture.get(\"export\").config?.legend}async make(n){const r=this.$iApi.geo.layer.allLayersOnMap().filter(a=>!a.isCosmetic);if(r.length===0)return new o.fabric.Group([],{originX:\"left\"});const e=Math.min(r.length,Math.floor(n.width/(G+w))||1),t=(n.width-(e-1)*w)/e;let i=0;const s=(await Promise.all(this._makeSegments(r,t))).map(({title:a,items:m},c)=>{c>0&&(i+=_),a.top=i,i+=a.height+C;const b=m.map(({title:h,items:u},x)=>{const y=[];return h&&!(m.length===1&&h.text===a.text)&&(x>0&&(i+=T),h.top=i,i+=h.height+F,y.push(h)),u.forEach(p=>{p.top=i,i+=p.height+P}),[...y,...u].filter(p=>p)});return new o.fabric.Group([a,...b.flat()])}).flat(),l=this._makeColumns(s,t,e);return Promise.resolve(l)}_makeColumns(n,r,e){let t=0,i=0,s=0;const l=n[n.length-1].aCoords.bl.y/e;return n.forEach((a,m)=>{const c=m!==n.length-1?n[m+1].top-a.top:a.height,b=s>l*(t+1),h=i!==0&&c>l,u=e-t>n.length-m;(b||h||u)&&t<e&&(++t,i=0),a.left=t*(r+w),a.top=i,i+=c,s+=c}),new o.fabric.Group(n,{originX:\"left\"})}_makeSegments(n,r){return n.map(async e=>{const t=new o.fabric.Textbox(e.name,{fontSize:24,fontFamily:g,width:r}),i=this._getLayerTreeIds(e);let s=[];return s=e.supportsSublayers?await Promise.all(this._makeSegmentChunks(i,e,r)):await Promise.all(this._makeSegmentChunks([-1],e,r)),{title:t,items:s}})}_makeSegmentChunks(n,r,e){const t=r;return n.map(async i=>{const s=i===-1?t:t.getSublayer(i);if(!s)return{title:new o.fabric.Textbox(\"ERROR\",{fontSize:20,fontFamily:g,width:e}),items:[]};await Promise.all(s.legend.map(c=>c.drawPromise));const l=s.legend,a=new o.fabric.Textbox(s.name,{fontSize:20,fontFamily:g,width:e}),m=await Promise.all(this._makeChunkItems(l,e));return{title:a,items:m}})}_makeChunkItems(n,r){return n.map(async e=>{const t=(await M(o.fabric.loadSVGFromString)(e.svgcode))[0];if(e.esriStandard){t.originY=\"center\",t.top=f/2;const i=new o.fabric.Textbox(e.label,{fontSize:12,fontFamily:g,originY:\"center\",left:S+20,top:f/2,width:r-S-20});return new o.fabric.Group([t,i],{height:f})}else{const i=new o.fabric.Textbox(e.label,{fontSize:12,fontFamily:g,originY:\"center\",left:0,top:f/2,width:r}),s=Number(e.imgWidth),l=Number(e.imgHeight),a=Math.min(1,r/s);return t&&(t.originY=\"center\",t.top=l*a/2+f,t.scaleToHeight(l*a),t.scaleToWidth(s*a)),new o.fabric.Group([i,t].filter(Boolean),{height:l*a+f})}})}_getLayerTreeIds(n){const r=[],e=[...n.sublayers];for(;e.length>0;){const t=e.shift();t&&(t.visibility&&r.push(t.layerIdx),e.push(...t.sublayers))}return r}}const M=d=>n=>new Promise(r=>{d(n,e=>{r(e)})});export{I as default};\n"],"names":["_","C","T","F","P","f","S","G","w","g","I","config","this","$iApi","fixture","get","legend","make","n","r","geo","layer","allLayersOnMap","filter","a","isCosmetic","length","fabric","Group","originX","e","Math","min","floor","width","t","i","s","Promise","all","_makeSegments","map","title","items","m","c","top","height","b","h","u","x","y","text","push","forEach","p","flat","l","_makeColumns","resolve","aCoords","bl","left","async","Textbox","name","fontSize","fontFamily","_getLayerTreeIds","supportsSublayers","_makeSegmentChunks","getSublayer","drawPromise","_makeChunkItems","M","loadSVGFromString","svgcode","esriStandard","originY","label","Number","imgWidth","imgHeight","scaleToHeight","scaleToWidth","Boolean","sublayers","shift","visibility","layerIdx","d"],"sourceRoot":""}