"use strict";(self["webpackChunkramp_website"]=self["webpackChunkramp_website"]||[]).push([[8473],{36313:function(e,t,i){i.d(t,{l:function(){return a}});var s=i(98503),r=i(5948);const a=e=>{let t=class extends e{get title(){if(this._get("title")&&"defaults"!==this.originOf("title"))return this._get("title");if(this.url){const e=(0,r.d)(this.url);if(null!=e&&e.title)return e.title}return this._get("title")||""}set title(e){this._set("title",e)}set url(e){this._set("url",(0,r.y)(e,s.n.getLogger(this)))}};return(0,s.k)([(0,s.o)()],t.prototype,"title",null),(0,s.k)([(0,s.o)({type:String})],t.prototype,"url",null),t=(0,s.k)([(0,s.A)("esri.layers.mixins.ArcGISService")],t),t}},99907:function(e,t,i){i.d(t,{e:function(){return r}});var s=i(98503);const r=e=>{let t=class extends e{constructor(){super(...arguments),this.customParameters=null}};return(0,s.k)([(0,s.o)({type:Object,json:{write:{overridePolicy:e=>({enabled:!!(e&&Object.keys(e).length>0)})}}})],t.prototype,"customParameters",void 0),t=(0,s.k)([(0,s.A)("esri.layers.mixins.CustomParametersMixin")],t),t}},18473:function(e,t,i){i.r(t),i.d(t,{default:function(){return w}});var s=i(98503),r=i(88012),a=i(77998),n=i(28252),o=i(95134),l=i(36313),d=i(50027),p=i(99907),u=i(20784),h=i(50293),c=i(63125),y=i(83424),f=i(20014),m=i(50850);let g=class extends((0,d.l)((0,y.t)((0,c.f)((0,l.l)((0,u.b)((0,h.j)((0,r.S)((0,p.e)(n.f))))))))){constructor(e){super(e),this._graphTypeLookup=new Map,this._namedTypesModified=!1,this.dataManager=null,this.definitionSetMap=null,this.knowledgeGraph=null,this.layers=new(s.V.ofType(o.u)),this.memberEntityTypes=null,this.memberRelationshipTypes=null,this.operationalLayerType="KnowledgeGraphLayer",this.sublayerIdsCache=new Map,this.tables=new(s.V.ofType(o.u)),this.type="knowledge-graph",this.url=null,this.addHandles((0,s.aE)((()=>this.layers.concat(this.tables)),((e,t)=>this._handleSublayersChange(e,t)),s.az))}load(e){return this.addResolvingPromise(this._doLoad(e)),Promise.resolve(this)}async _doLoad(e){try{await this.loadFromPortal({supportedTypes:["Knowledge Graph Layer"]},e)}catch(t){(0,s.G)(t)}await this._fetchMetadata(),await this._initializeLayerProperties(),this.loadLayerAssumingLocalCache(),await(0,o.c)(this)}async _fetchMetadata(){if(!this.url)throw new s.s("knowledge-graph:missing-url","KnowledgeGraphLayer must be created with a url");const e=await(0,m.F)(this.url);this.knowledgeGraph=e,this._forEachGraphType((e=>{e.name&&this._graphTypeLookup.set(e.name,e)}))}async _initializeLayerProperties(){this.originIdOf("inclusionModeDefinition")===s.bm.USER?this._validateInclusionModeDefinition():await this._initializeInclusionModeDefinition(),this._setMemberTypes(),this.dataManager=new o.E({knowledgeGraph:this.knowledgeGraph,inclusionModeDefinition:this.inclusionModeDefinition})}async _initializeInclusionModeDefinition(){const e=this.definitionSetMap?await(0,o.F)(this.definitionSetMap,!0):{generateAllSublayers:!0,namedTypeDefinitions:new Map};[...this.layers.toArray(),...this.tables.toArray()].forEach((t=>{const i=this._graphTypeLookup.get(t.graphTypeName);i&&!e.namedTypeDefinitions.has(i.name)&&e.namedTypeDefinitions.set(i.name,{useAllData:!0})})),this.setAtOrigin("inclusionModeDefinition",e,(0,s.dt)(this.originIdOf("definitionSetMap")))}_validateInclusionModeDefinition(){const{inclusionModeDefinition:e}=this;if(!e)return;const{namedTypeDefinitions:t}=e;if(t?.size>0)t.forEach(((e,i)=>{const r=this._graphTypeLookup.get(i);if(!r)return s.n.getLogger(this).warn(`A named type, ${i}, was in the inclusion list that wasn't in the data model and will be removed`),void t.delete(i);"relationship"!==r.type&&"entity"!==r.type&&(s.n.getLogger(this).warn(`A named type, ${i}, was in the inclusion list that wasn't properly modeled and will be removed`),t.delete(i))}));else if(!e.generateAllSublayers)throw new s.s("knowledge-graph:composite-layer-constructor","If an explicit inclusion definition is defined, at least one namedTypeDefinition must also be defined")}_setMemberTypes(){let e=[],t=[];const{inclusionModeDefinition:i}=this,s=i?.namedTypeDefinitions;!i||i.generateAllSublayers?(e=this.knowledgeGraph.dataModel?.entityTypes??[],t=this.knowledgeGraph.dataModel?.relationshipTypes??[]):s&&s.size>0&&s.forEach(((i,s)=>{const r=this._graphTypeLookup.get(s);switch(r?.type){case"relationship":t.push(r);break;case"entity":e.push(r)}})),this.memberEntityTypes=e,this.memberRelationshipTypes=t}_forEachGraphType(e){[...this.knowledgeGraph.dataModel?.entityTypes??[],...this.knowledgeGraph.dataModel?.relationshipTypes??[]].forEach((t=>{e(t)}))}_refreshNamedTypes(){this._namedTypesModified=!0;for(const e of this.layers)e.emit("refresh",{dataChanged:!0});for(const e of this.tables)e.emit("refresh",{dataChanged:!0})}async _handleNewRecords(e){const t=[];this.dataManager.addToLayer(e);for(const i of e)this.sublayerIdsCache.has(i.typeName)||(this.sublayerIdsCache.set(i.typeName,new Set),t.push(i.typeName)),this.sublayerIdsCache.get(i.typeName).add(i.id);for(const i of t){const e=this._graphTypeLookup.get(i);e&&(this._addSublayer(e),"entity"===e.type?this.dataManager.entityTypeNames.add(i):this.dataManager.relationshipTypeNames.add(i),this.dataManager.sublayerCaches.set(i,new Map))}await(0,o.c)(this,t),this._refreshNamedTypes()}_createSublayers(e,t,i){e.forEach((e=>{const s=this._createSublayer(e);i(s)&&t.push(s),this._updateSublayerCaches(e)}))}_addSublayer(e){const t=this._createSublayer(e);return t.geometryType?this.layers.push(t):this.tables.push(t),t}_createSublayer(e){return new o.u({objectType:e,parentCompositeLayer:this,graphType:e.type})}_updateSublayers(e,t){t.forEach((t=>{t.parentCompositeLayer=this;const i=e.find((e=>e.type===t.graphType&&e.name===t.graphTypeName));i&&(t.objectType=i,this._updateSublayerCaches(i))}))}_updateSublayerCaches(e){const t=this.dataManager.sublayerCaches;t.has(e.name)||t.set(e.name,new Map)}_saveUrlAsNewResource(e,t,i,s){e[t]="<pending>",i.pendingOperations.push(b(this.inclusionModeDefinition).then((r=>{const a=_(s);e[t]=a.itemRelativeUrl,i.toAdd.push({resource:a,content:{type:"blob",blob:r},compress:!1,finish:e=>{this.definitionSetMap=e.url}})})))}_displaysAllRecords(e){for(const[,{useAllData:t}]of e.namedTypeDefinitions)if(!t)return!1;return!0}_handleSublayersChange(e,t){t&&(t.forEach((e=>{e.parent=null})),this.removeHandles("sublayers-owner")),e&&(e.forEach((e=>{e.parent=this})),this.addHandles([e.on("after-add",(({item:e})=>{e.parent=this})),e.on("after-remove",(({item:e})=>{e.parent=null}))],"sublayers-owner"))}readDefinitionSetMap(e,t,i){return(0,s.p)(e,i)}writeDefinitionSetMap(e,t,i,r){const a=r?.portalItem,n=r?.resources,o=(0,s.bl)(r?.origin);if(!a||!n||null==o)return void(e&&(t[i]=(0,s.dk)(e,r)));const{inclusionModeDefinition:l}=this;if(!l||this._displaysAllRecords(l))return void(this.definitionSetMap=null);const d=this.originIdOf("inclusionModeDefinition");if(d===s.bm.USER||this._namedTypesModified||o<d)this._saveUrlAsNewResource(t,i,n,a);else if(o===d&&e){const o=(0,s.dk)(e,r);(0,s.dm)(o)?this._saveUrlAsNewResource(t,i,n,a):t[i]=o}}set inclusionModeDefinition(e){"loaded"!==this.loadStatus&&"failed"!==this.loadStatus?this._set("inclusionModeDefinition",e):s.n.getLogger(this).error("#inclusionModeDefinition","inclusionModeDefinition cannot be changed after the layer is loaded.")}loadLayerAssumingLocalCache(){const e=[...this.memberEntityTypes,...this.memberRelationshipTypes];this.originIdOf("layers")===s.bm.DEFAULTS?this._createSublayers(e,this.layers,(e=>!!e.geometryType)):this._updateSublayers(e,this.layers),this.originIdOf("tables")===s.bm.DEFAULTS?this._createSublayers(e,this.tables,(e=>!e.geometryType)):this._updateSublayers(e,this.tables),this.dataManager.inclusionModeDefinition?.namedTypeDefinitions?.forEach(((e,t)=>{const i=(0,s.ao)(this.sublayerIdsCache,t,(()=>new Set));e.members?.forEach((e=>{i.add(e.id)}))}))}async addRecords(e){await this._handleNewRecords(e)}async removeRecords(e){const t=[];for(const i of e)!1===this.dataManager.inclusionModeDefinition?.namedTypeDefinitions?.get(i.typeName)?.useAllData&&this.dataManager.inclusionModeDefinition?.namedTypeDefinitions?.get(i.typeName)?.members?.has(i.id)&&t.push(i);this.dataManager.removeFromLayer(t);for(const i of t)this.sublayerIdsCache.get(i.typeName)?.delete(i.id);return this._refreshNamedTypes(),t}};(0,s.k)([(0,s.o)()],g.prototype,"dataManager",void 0),(0,s.k)([(0,s.o)({json:{write:{ignoreOrigin:!0,writerEnsuresNonNull:!0}}})],g.prototype,"definitionSetMap",void 0),(0,s.k)([(0,s.u)("definitionSetMap")],g.prototype,"readDefinitionSetMap",null),(0,s.k)([(0,s.q)("definitionSetMap")],g.prototype,"writeDefinitionSetMap",null),(0,s.k)([(0,s.o)()],g.prototype,"inclusionModeDefinition",null),(0,s.k)([(0,s.o)()],g.prototype,"knowledgeGraph",void 0),(0,s.k)([(0,s.o)({type:s.V.ofType(o.u),json:{write:{ignoreOrigin:!0}}})],g.prototype,"layers",void 0),(0,s.k)([(0,s.o)()],g.prototype,"memberEntityTypes",void 0),(0,s.k)([(0,s.o)()],g.prototype,"memberRelationshipTypes",void 0),(0,s.k)([(0,s.o)({type:["KnowledgeGraphLayer"]})],g.prototype,"operationalLayerType",void 0),(0,s.k)([(0,s.o)()],g.prototype,"sublayerIdsCache",void 0),(0,s.k)([(0,s.o)({type:s.V.ofType(o.u),json:{write:{ignoreOrigin:!0}}})],g.prototype,"tables",void 0),(0,s.k)([(0,s.o)({json:{read:!1}})],g.prototype,"type",void 0),(0,s.k)([(0,s.o)(f.y)],g.prototype,"url",void 0),g=(0,s.k)([(0,s.A)("esri.layers.KnowledgeGraphLayer")],g);const w=g;async function b(e){const t=await(0,o.R)(e);return new Blob([t],{type:"application/x-protobuf"})}function _(e){const t=`definitionSetMap-${(0,a.n)()}.dat`,i=(0,s.Z)("knowledgeGraphLayer",t);return e.resourceFromPath(i)}},50293:function(e,t,i){i.d(t,{j:function(){return n}});var s=i(98503),r=i(2031),a=i(83297);const n=e=>{let t=class extends e{constructor(){super(...arguments),this.resourceReferences={portalItem:null,paths:[]},this.userHasEditingPrivileges=!0,this.userHasFullEditingPrivileges=!1,this.userHasUpdateItemPrivileges=!1}destroy(){this.portalItem=(0,s.C)(this.portalItem),this.resourceReferences.portalItem=null,this.resourceReferences.paths.length=0}set portalItem(e){e!==this._get("portalItem")&&(this.removeOrigin("portal-item"),this._set("portalItem",e))}readPortalItem(e,t,i){if(t.itemId)return new r["default"]({id:t.itemId,portal:i?.portal})}writePortalItem(e,t){e?.id&&(t.itemId=e.id)}async loadFromPortal(e,t){if(this.portalItem?.id)try{const{load:r}=await Promise.all([i.e(3338),i.e(1128)]).then(i.bind(i,21128));return(0,s.D)(t),await r({instance:this,supportedTypes:e.supportedTypes,validateItem:e.validateItem,supportsData:e.supportsData,layerModuleTypeMap:e.layerModuleTypeMap},t)}catch(r){throw(0,s.E)(r)||s.n.getLogger(this).warn(`Failed to load layer (${this.title}, ${this.id}) portal item (${this.portalItem.id})\n  ${r}`),r}}async finishLoadEditablePortalLayer(e){this._set("userHasEditingPrivileges",await this._fetchUserHasEditingPrivileges(e).catch((e=>((0,s.G)(e),!0))))}async setUserPrivileges(e,t){if(!s.H.userPrivilegesApplied)return this.finishLoadEditablePortalLayer(t);if(this.url)try{const{features:{edit:i,fullEdit:s},content:{updateItem:r}}=await this._fetchUserPrivileges(e,t);this._set("userHasEditingPrivileges",i),this._set("userHasFullEditingPrivileges",s),this._set("userHasUpdateItemPrivileges",r)}catch(i){(0,s.G)(i)}}async _fetchUserPrivileges(e,t){let i=this.portalItem;if(!e||!i||!i.loaded||i.sourceUrl)return this._fetchFallbackUserPrivileges(t);const n=e===i.id;if(n&&i.portal.user)return(0,a.E)(i);let o,l;if(n)o=i.portal.url;else try{o=await(0,s.J)(this.url,t)}catch(h){(0,s.G)(h)}if(!o||!(0,s.W)(o,i.portal.url))return this._fetchFallbackUserPrivileges(t);try{const e=null!=t?t.signal:null;l=await(s.K?.getCredential(`${o}/sharing`,{prompt:!1,signal:e}))}catch(h){(0,s.G)(h)}const d=!0,p=!1,u=!1;if(!l)return{features:{edit:d,fullEdit:p},content:{updateItem:u}};try{if(n?await i.reload():(i=new r["default"]({id:e,portal:{url:o}}),await i.load(t)),i.portal.user)return(0,a.E)(i)}catch(h){(0,s.G)(h)}return{features:{edit:d,fullEdit:p},content:{updateItem:u}}}async _fetchFallbackUserPrivileges(e){let t=!0;try{t=await this._fetchUserHasEditingPrivileges(e)}catch(i){(0,s.G)(i)}return{features:{edit:t,fullEdit:!1},content:{updateItem:!1}}}async _fetchUserHasEditingPrivileges(e){const t=this.url?s.K?.findCredential(this.url):null;if(!t)return!0;const i=o.credential===t?o.user:await this._fetchEditingUser(e);return o.credential=t,o.user=i,null==i?.privileges||i.privileges.includes("features:user:edit")}async _fetchEditingUser(e){const t=this.portalItem?.portal?.user;if(t)return t;const i=s.K?.findServerInfo(this.url??"");if(!i?.owningSystemUrl)return null;const r=`${i.owningSystemUrl}/sharing/rest`,a=s.b.getDefault();if(a&&a.loaded&&(0,s.L)(a.restUrl)===(0,s.L)(r))return a.user;const n=`${r}/community/self`,o=null!=e?e.signal:null,l=await(0,s._)((0,s.U)(n,{authMode:"no-prompt",query:{f:"json"},signal:o}));return l.ok?s.M.fromJSON(l.value.data):null}read(e,t){t&&(t.layer=this),super.read(e,t)}write(e,t){const i=t?.portal,r=this.portalItem?.id&&(this.portalItem.portal||s.b.getDefault());return i&&r&&!(0,s.N)(r.restUrl,i.restUrl)?(t.messages&&t.messages.push(new s.s("layer:cross-portal",`The layer '${this.title} (${this.id})' cannot be persisted because it refers to an item on a different portal than the one being saved to. To save, set layer.portalItem to null or save to the same portal as the item associated with the layer`,{layer:this})),null):super.write(e,{...t,layer:this})}};return(0,s.k)([(0,s.o)({type:r["default"]})],t.prototype,"portalItem",null),(0,s.k)([(0,s.u)("web-document","portalItem",["itemId"])],t.prototype,"readPortalItem",null),(0,s.k)([(0,s.q)("web-document","portalItem",{itemId:{type:String}})],t.prototype,"writePortalItem",null),(0,s.k)([(0,s.o)({clonable:!1})],t.prototype,"resourceReferences",void 0),(0,s.k)([(0,s.o)({type:Boolean,readOnly:!0})],t.prototype,"userHasEditingPrivileges",void 0),(0,s.k)([(0,s.o)({type:Boolean,readOnly:!0})],t.prototype,"userHasFullEditingPrivileges",void 0),(0,s.k)([(0,s.o)({type:Boolean,readOnly:!0})],t.prototype,"userHasUpdateItemPrivileges",void 0),t=(0,s.k)([(0,s.A)("esri.layers.mixins.PortalLayer")],t),t},o={credential:null,user:null}},83297:function(e,t,i){i.d(t,{E:function(){return c},a:function(){return d},c:function(){return l},f:function(){return h},i:function(){return n},l:function(){return u},s:function(){return o},u:function(){return p}});var s=i(49555),r=i(98503);async function a(e){const t=e.spatialReference;if(t.isWGS84)return e.clone();if(t.isWebMercator)return(0,r.a0)(e);const i=r.B.WGS84;return await(0,s.N)(t,i),(0,s.K)(e,i)}function n(e,t){if(!o(e,t)){const i=e.typeKeywords;i?i.push(t):e.typeKeywords=[t]}}function o(e,t){return!!e.typeKeywords?.includes(t)}function l(e){return o(e,h.HOSTED_SERVICE)}function d(e,t){const i=e.typeKeywords;if(i){const e=i.indexOf(t);e>-1&&i.splice(e,1)}}function p(e,t,i){i?n(e,t):d(e,t)}async function u(e){const t=e.clone().normalize();let i;if(t.length>1)for(const s of t)i?s.width>i.width&&(i=s):i=s;else i=t[0];return a(i)}const h={DEVELOPER_BASEMAP:"DeveloperBasemap",JSAPI:"ArcGIS API for JavaScript",METADATA:"Metadata",MULTI_LAYER:"Multilayer",SINGLE_LAYER:"Singlelayer",TABLE:"Table",HOSTED_SERVICE:"Hosted Service",LOCAL_SCENE:"ViewingMode-Local",TILED_IMAGERY:"Tiled Imagery",GROUP_LAYER_MAP:"Map",ORIENTED_IMAGERY_LAYER:"OrientedImageryLayer"};function c(e){const{portal:t,isOrgItem:i,itemControl:s}=e,r=t.user?.privileges;let a=!r||r.includes("features:user:edit"),n=!!i&&!!r?.includes("features:user:fullEdit");const o="update"===s||"admin"===s;return o?n=a=!0:n&&(a=!0),{features:{edit:a,fullEdit:n},content:{updateItem:o}}}}}]);
//# sourceMappingURL=8473.695446e3.js.map