"use strict";(self["webpackChunkramp_website"]=self["webpackChunkramp_website"]||[]).push([[1074],{52200:function(i,e,t){t.d(e,{D:function(){return r},F:function(){return s},H:function(){return o},a:function(){return a}});const a="Ramp-Hilight",s="Ramp-Hilight-Fog-Basemap",r={mode:"glow",options:{haloColor:[0,255,0],haloOpacity:.8}};var o=(i=>(i.NONE="none",i.GLOW="glow",i.LIFT="lift",i.FOG="fog",i))(o||{})},51074:function(i,e,t){t.r(e),t.d(e,{default:function(){return l}});var a=t(98503),s=t(52200);class r extends a.gk{config={};mode=s.H.NONE;constructor(i,e){super(e),this.config=i,this.mode=i.mode}async add(i){this.notImplementedError("addGraphics")}async remove(i){this.notImplementedError("removeGraphics")}async reloadHilight(i){this.notImplementedError("reloadHilight")}async getHilightLayer(){const i=await this.layerFetcher();return i?i.isLoaded&&i instanceof a.g$?i:void console.warn("Hilight layer exists but is in bad form."):void console.warn("Hilight layer could not be fetched.")}notImplementedError(i){console.warn(`Hilight mode method ${i} was not implemented by subclass.`)}layerFetcher(){const i=this.$iApi.geo.layer.getLayer(s.a);return i?Promise.resolve(i):new Promise((i=>{let e=0;const t=setInterval((()=>{const a=this.$iApi.geo.layer.getLayer(s.a);if(a)clearInterval(t),i(a);else if(e+=125,e>=1125)return clearInterval(t),void i(void 0)}),125)}))}}class o extends r{async add(i){const e=await this.getHilightLayer();e&&await e.addGraphic(i)}async remove(i){const e=await this.getHilightLayer();e&&e.removeGraphic(i)}async reloadHilight(i){await this.remove(i),await this.add(i)}}class h extends o{handlers=[];onOpacity;offOpacity;lastAdd=0;constructor(i,e){super(i,e),this.onOpacity=i.options?.onOpacity??.75,this.offOpacity=i.options?.offOpacity>.02?i.options.offOpacity:.02,this.$iApi.geo.map.created?this.hilightSetup():this.handlers.push(this.$iApi.event.on(a.dE.MAP_CREATED,(()=>{this.hilightSetup()}))),this.handlers.push(this.$iApi.event.on(a.dE.MAP_BASEMAPCHANGE,(()=>{this.getHilightLayer().then((i=>{i&&0===i.graphics.length&&this.updateFogLayer()}))})))}async hilightSetup(){const i=(0,a.gc)(this.$vApp.$pinia).activeBasemapConfig;try{const e=this.$iApi.geo.layer.createLayer({id:s.F,layerType:a.ga.TILE,cosmetic:!0,url:i.layers[0].url});await this.$iApi.geo.map.addLayer(e),e.opacity=this.offOpacity,await this.reorderFogLayer()}catch{console.error("Something went wrong while setting up the hilighter.")}}async updateFogLayer(){this.$iApi.geo.map.removeLayer(s.F),await this.hilightSetup()}async reorderFogLayer(){const i=this.getFogLayer(),e=await this.getHilightLayer();if(!e||!i)return;const t=this.$iApi.geo.layer.layerOrderIds(),a=t.indexOf(i.id),s=t.indexOf(e.id);s<a&&s>-1&&a>-1&&this.$iApi.geo.map.reorder(e,a,!1)}async add(i){this.lastAdd=Date.now();const e=this.getFogLayer();e&&(e.opacity=this.onOpacity,await super.add(i))}async remove(i){await super.remove(i);const e=this.getFogLayer();if(!e)return;const t=Date.now(),a=await this.getHilightLayer();a&&setTimeout((()=>{this.lastAdd<t&&!a.getGraphicCount()&&(e.opacity=this.offOpacity)}),300)}async reloadHilight(i){await this.updateFogLayer(),await super.reloadHilight(i)}getFogLayer(){const i=this.$iApi.geo.layer.getLayer(s.F);if(i&&i instanceof a.h0)return i;console.warn("Hilight fog layer could not be fetched.")}}class n extends o{handlers=[];constructor(i,e){super(i,e),this.hilightSetup(i),this.handlers.push(this.$iApi.event.on(a.dE.MAP_CREATED,(()=>{this.hilightSetup(i)})))}hilightSetup(i){this.$iApi.geo.map.viewPromise.then((()=>{this.$iApi.geo.map.esriView.highlightOptions=i.options}))}async add(i){await super.add(i);const e=this.$iApi.geo.layer.getLayer(s.a);if(e&&e.esriLayer&&e.isLoaded&&e instanceof a.h1){const t=i instanceof Array?i:[i];this.$iApi.geo.map.esriView?.whenLayerView(e.esriLayer)?.then((function(i){i.highlight(t.map((i=>e.getEsriGraphic(i.id))))}))}}async remove(i){await super.remove(i)}}class c extends a.F{hilightMode=new r({},this.$iApi);initialized(){this.initHilightLayer()}_parseConfig(i){if(i)switch(i.mode){case s.H.NONE:this.hilightMode=new r(i,this.$iApi);break;case s.H.GLOW:this.hilightMode=new n(i,this.$iApi);break;case s.H.LIFT:this.hilightMode=new o(i,this.$iApi);break;case s.H.FOG:this.hilightMode=new h(i,this.$iApi);break;default:console.error("Could not find hilight mode:",i.mode);break}else this.hilightMode=new n(s.D,this.$iApi)}async initHilightLayer(){const i=this.$iApi.geo.layer.createLayer({id:s.a,layerType:a.ga.GRAPHIC,cosmetic:!0,url:""});await this.$iApi.geo.map.addLayer(i)}async addHilight(i){const e=i instanceof Array?i:[i];await this.hilightMode.add(e)}async removeHilight(i){const e=i?i instanceof Array?i:[i]:void 0;await this.hilightMode.remove(e)}async reloadHilight(i){const e=i instanceof Array?i:[i];await this.hilightMode.reloadHilight(e)}async getGraphicsByKey(i,e,t){const a=await this.getHilightLayer();if(!a)return[];let s=a.graphics.map((i=>({...this.deconstructGraphicKey(i.id),og:i})));return i&&(s=s.filter((e=>e.origin===i))),e&&(s=s.filter((i=>i.uid===e))),t&&(s=s.filter((i=>i.oid===t))),s.map((i=>i.og))}constructGraphicKey(i,e,t){return`${s.a}~${i}~${e}~${t}`}deconstructGraphicKey(i){const e=i.split("~");return 4!==e.length&&console.warn("Malformed Hilight Graphic key provided:",i),{origin:e[1],uid:e[2],oid:parseInt(e[3])}}async getHilightLayer(){if(this.hilightMode)return await this.hilightMode.getHilightLayer();console.warn("API get layer request before highlight mode object exists")}}class l extends c{async added(){this._parseConfig(this.config);const i=this.$vApp.$watch((()=>this.config),(i=>this._parseConfig(i)));this.removed=()=>{i()}}}}}]);
//# sourceMappingURL=1074.a6b0b34e.js.map